import{s as commonjsGlobal,v as getDefaultExportFromCjs,d as defineComponent,x as onMounted,o as openBlock,c as createElementBlock,_ as _export_sfc,j as createBlock}from"./index-207f3223.js";var leafletSrc={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(Je,Ce){(function(ne,Zt){Zt(Ce)})(commonjsGlobal,function(ne){var Zt="1.9.4";function de(n){var d,k,it,Ot;for(k=1,it=arguments.length;k<it;k++){Ot=arguments[k];for(d in Ot)n[d]=Ot[d]}return n}var Et=Object.create||function(){function n(){}return function(d){return n.prototype=d,new n}}();function Dt(n,d){var k=Array.prototype.slice;if(n.bind)return n.bind.apply(n,k.call(arguments,1));var it=k.call(arguments,2);return function(){return n.apply(d,it.length?it.concat(k.call(arguments)):arguments)}}var Y=0;function I(n){return"_leaflet_id"in n||(n._leaflet_id=++Y),n._leaflet_id}function At(n,d,k){var it,Ot,Bt,ce;return ce=function(){it=!1,Ot&&(Bt.apply(k,Ot),Ot=!1)},Bt=function(){it?Ot=arguments:(n.apply(k,arguments),setTimeout(ce,d),it=!0)},Bt}function Nt(n,d,k){var it=d[1],Ot=d[0],Bt=it-Ot;return n===it&&k?n:((n-Ot)%Bt+Bt)%Bt+Ot}function ft(){return!1}function at(n,d){if(d===!1)return n;var k=Math.pow(10,d===void 0?6:d);return Math.round(n*k)/k}function dt(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function et(n){return dt(n).split(/\s+/)}function _t(n,d){Object.prototype.hasOwnProperty.call(n,"options")||(n.options=n.options?Et(n.options):{});for(var k in d)n.options[k]=d[k];return n.options}function rt(n,d,k){var it=[];for(var Ot in n)it.push(encodeURIComponent(k?Ot.toUpperCase():Ot)+"="+encodeURIComponent(n[Ot]));return(!d||d.indexOf("?")===-1?"?":"&")+it.join("&")}var Pt=/\{ *([\w_ -]+) *\}/g;function St(n,d){return n.replace(Pt,function(k,it){var Ot=d[it];if(Ot===void 0)throw new Error("No value provided for variable "+k);return typeof Ot=="function"&&(Ot=Ot(d)),Ot})}var yt=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};function gt(n,d){for(var k=0;k<n.length;k++)if(n[k]===d)return k;return-1}var lt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function F(n){return window["webkit"+n]||window["moz"+n]||window["ms"+n]}var pt=0;function ht(n){var d=+new Date,k=Math.max(0,16-(d-pt));return pt=d+k,window.setTimeout(n,k)}var mt=window.requestAnimationFrame||F("RequestAnimationFrame")||ht,bt=window.cancelAnimationFrame||F("CancelAnimationFrame")||F("CancelRequestAnimationFrame")||function(n){window.clearTimeout(n)};function ut(n,d,k){if(k&&mt===ht)n.call(d);else return mt.call(window,Dt(n,d))}function Mt(n){n&&bt.call(window,n)}var st={__proto__:null,extend:de,create:Et,bind:Dt,get lastId(){return Y},stamp:I,throttle:At,wrapNum:Nt,falseFn:ft,formatNum:at,trim:dt,splitWords:et,setOptions:_t,getParamString:rt,template:St,isArray:yt,indexOf:gt,emptyImageUrl:lt,requestFn:mt,cancelFn:bt,requestAnimFrame:ut,cancelAnimFrame:Mt};function tt(){}tt.extend=function(n){var d=function(){_t(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},k=d.__super__=this.prototype,it=Et(k);it.constructor=d,d.prototype=it;for(var Ot in this)Object.prototype.hasOwnProperty.call(this,Ot)&&Ot!=="prototype"&&Ot!=="__super__"&&(d[Ot]=this[Ot]);return n.statics&&de(d,n.statics),n.includes&&(Ut(n.includes),de.apply(null,[it].concat(n.includes))),de(it,n),delete it.statics,delete it.includes,it.options&&(it.options=k.options?Et(k.options):{},de(it.options,n.options)),it._initHooks=[],it.callInitHooks=function(){if(!this._initHooksCalled){k.callInitHooks&&k.callInitHooks.call(this),this._initHooksCalled=!0;for(var Bt=0,ce=it._initHooks.length;Bt<ce;Bt++)it._initHooks[Bt].call(this)}},d},tt.include=function(n){var d=this.prototype.options;return de(this.prototype,n),n.options&&(this.prototype.options=d,this.mergeOptions(n.options)),this},tt.mergeOptions=function(n){return de(this.prototype.options,n),this},tt.addInitHook=function(n){var d=Array.prototype.slice.call(arguments,1),k=typeof n=="function"?n:function(){this[n].apply(this,d)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(k),this};function Ut(n){if(!(typeof L>"u"||!L||!L.Mixin)){n=yt(n)?n:[n];for(var d=0;d<n.length;d++)n[d]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var nt={on:function(n,d,k){if(typeof n=="object")for(var it in n)this._on(it,n[it],d);else{n=et(n);for(var Ot=0,Bt=n.length;Ot<Bt;Ot++)this._on(n[Ot],d,k)}return this},off:function(n,d,k){if(!arguments.length)delete this._events;else if(typeof n=="object")for(var it in n)this._off(it,n[it],d);else{n=et(n);for(var Ot=arguments.length===1,Bt=0,ce=n.length;Bt<ce;Bt++)Ot?this._off(n[Bt]):this._off(n[Bt],d,k)}return this},_on:function(n,d,k,it){if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}if(this._listens(n,d,k)===!1){k===this&&(k=void 0);var Ot={fn:d,ctx:k};it&&(Ot.once=!0),this._events=this._events||{},this._events[n]=this._events[n]||[],this._events[n].push(Ot)}},_off:function(n,d,k){var it,Ot,Bt;if(this._events&&(it=this._events[n],!!it)){if(arguments.length===1){if(this._firingCount)for(Ot=0,Bt=it.length;Ot<Bt;Ot++)it[Ot].fn=ft;delete this._events[n];return}if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}var ce=this._listens(n,d,k);if(ce!==!1){var jt=it[ce];this._firingCount&&(jt.fn=ft,this._events[n]=it=it.slice()),it.splice(ce,1)}}},fire:function(n,d,k){if(!this.listens(n,k))return this;var it=de({},d,{type:n,target:this,sourceTarget:d&&d.sourceTarget||this});if(this._events){var Ot=this._events[n];if(Ot){this._firingCount=this._firingCount+1||1;for(var Bt=0,ce=Ot.length;Bt<ce;Bt++){var jt=Ot[Bt],Ie=jt.fn;jt.once&&this.off(n,Ie,jt.ctx),Ie.call(jt.ctx||this,it)}this._firingCount--}}return k&&this._propagateEvent(it),this},listens:function(n,d,k,it){typeof n!="string"&&console.warn('"string" type argument expected');var Ot=d;typeof d!="function"&&(it=!!d,Ot=void 0,k=void 0);var Bt=this._events&&this._events[n];if(Bt&&Bt.length&&this._listens(n,Ot,k)!==!1)return!0;if(it){for(var ce in this._eventParents)if(this._eventParents[ce].listens(n,d,k,it))return!0}return!1},_listens:function(n,d,k){if(!this._events)return!1;var it=this._events[n]||[];if(!d)return!!it.length;k===this&&(k=void 0);for(var Ot=0,Bt=it.length;Ot<Bt;Ot++)if(it[Ot].fn===d&&it[Ot].ctx===k)return Ot;return!1},once:function(n,d,k){if(typeof n=="object")for(var it in n)this._on(it,n[it],d,!0);else{n=et(n);for(var Ot=0,Bt=n.length;Ot<Bt;Ot++)this._on(n[Ot],d,k,!0)}return this},addEventParent:function(n){return this._eventParents=this._eventParents||{},this._eventParents[I(n)]=n,this},removeEventParent:function(n){return this._eventParents&&delete this._eventParents[I(n)],this},_propagateEvent:function(n){for(var d in this._eventParents)this._eventParents[d].fire(n.type,de({layer:n.target,propagatedFrom:n.target},n),!0)}};nt.addEventListener=nt.on,nt.removeEventListener=nt.clearAllEventListeners=nt.off,nt.addOneTimeEventListener=nt.once,nt.fireEvent=nt.fire,nt.hasEventListeners=nt.listens;var ue=tt.extend(nt);function re(n,d,k){this.x=k?Math.round(n):n,this.y=k?Math.round(d):d}var ee=Math.trunc||function(n){return n>0?Math.floor(n):Math.ceil(n)};re.prototype={clone:function(){return new re(this.x,this.y)},add:function(n){return this.clone()._add(Qt(n))},_add:function(n){return this.x+=n.x,this.y+=n.y,this},subtract:function(n){return this.clone()._subtract(Qt(n))},_subtract:function(n){return this.x-=n.x,this.y-=n.y,this},divideBy:function(n){return this.clone()._divideBy(n)},_divideBy:function(n){return this.x/=n,this.y/=n,this},multiplyBy:function(n){return this.clone()._multiplyBy(n)},_multiplyBy:function(n){return this.x*=n,this.y*=n,this},scaleBy:function(n){return new re(this.x*n.x,this.y*n.y)},unscaleBy:function(n){return new re(this.x/n.x,this.y/n.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ee(this.x),this.y=ee(this.y),this},distanceTo:function(n){n=Qt(n);var d=n.x-this.x,k=n.y-this.y;return Math.sqrt(d*d+k*k)},equals:function(n){return n=Qt(n),n.x===this.x&&n.y===this.y},contains:function(n){return n=Qt(n),Math.abs(n.x)<=Math.abs(this.x)&&Math.abs(n.y)<=Math.abs(this.y)},toString:function(){return"Point("+at(this.x)+", "+at(this.y)+")"}};function Qt(n,d,k){return n instanceof re?n:yt(n)?new re(n[0],n[1]):n==null?n:typeof n=="object"&&"x"in n&&"y"in n?new re(n.x,n.y):new re(n,d,k)}function Lt(n,d){if(n)for(var k=d?[n,d]:n,it=0,Ot=k.length;it<Ot;it++)this.extend(k[it])}Lt.prototype={extend:function(n){var d,k;if(!n)return this;if(n instanceof re||typeof n[0]=="number"||"x"in n)d=k=Qt(n);else if(n=pe(n),d=n.min,k=n.max,!d||!k)return this;return!this.min&&!this.max?(this.min=d.clone(),this.max=k.clone()):(this.min.x=Math.min(d.x,this.min.x),this.max.x=Math.max(k.x,this.max.x),this.min.y=Math.min(d.y,this.min.y),this.max.y=Math.max(k.y,this.max.y)),this},getCenter:function(n){return Qt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,n)},getBottomLeft:function(){return Qt(this.min.x,this.max.y)},getTopRight:function(){return Qt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(n){var d,k;return typeof n[0]=="number"||n instanceof re?n=Qt(n):n=pe(n),n instanceof Lt?(d=n.min,k=n.max):d=k=n,d.x>=this.min.x&&k.x<=this.max.x&&d.y>=this.min.y&&k.y<=this.max.y},intersects:function(n){n=pe(n);var d=this.min,k=this.max,it=n.min,Ot=n.max,Bt=Ot.x>=d.x&&it.x<=k.x,ce=Ot.y>=d.y&&it.y<=k.y;return Bt&&ce},overlaps:function(n){n=pe(n);var d=this.min,k=this.max,it=n.min,Ot=n.max,Bt=Ot.x>d.x&&it.x<k.x,ce=Ot.y>d.y&&it.y<k.y;return Bt&&ce},isValid:function(){return!!(this.min&&this.max)},pad:function(n){var d=this.min,k=this.max,it=Math.abs(d.x-k.x)*n,Ot=Math.abs(d.y-k.y)*n;return pe(Qt(d.x-it,d.y-Ot),Qt(k.x+it,k.y+Ot))},equals:function(n){return n?(n=pe(n),this.min.equals(n.getTopLeft())&&this.max.equals(n.getBottomRight())):!1}};function pe(n,d){return!n||n instanceof Lt?n:new Lt(n,d)}function be(n,d){if(n)for(var k=d?[n,d]:n,it=0,Ot=k.length;it<Ot;it++)this.extend(k[it])}be.prototype={extend:function(n){var d=this._southWest,k=this._northEast,it,Ot;if(n instanceof Fe)it=n,Ot=n;else if(n instanceof be){if(it=n._southWest,Ot=n._northEast,!it||!Ot)return this}else return n?this.extend(Pe(n)||se(n)):this;return!d&&!k?(this._southWest=new Fe(it.lat,it.lng),this._northEast=new Fe(Ot.lat,Ot.lng)):(d.lat=Math.min(it.lat,d.lat),d.lng=Math.min(it.lng,d.lng),k.lat=Math.max(Ot.lat,k.lat),k.lng=Math.max(Ot.lng,k.lng)),this},pad:function(n){var d=this._southWest,k=this._northEast,it=Math.abs(d.lat-k.lat)*n,Ot=Math.abs(d.lng-k.lng)*n;return new be(new Fe(d.lat-it,d.lng-Ot),new Fe(k.lat+it,k.lng+Ot))},getCenter:function(){return new Fe((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Fe(this.getNorth(),this.getWest())},getSouthEast:function(){return new Fe(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(n){typeof n[0]=="number"||n instanceof Fe||"lat"in n?n=Pe(n):n=se(n);var d=this._southWest,k=this._northEast,it,Ot;return n instanceof be?(it=n.getSouthWest(),Ot=n.getNorthEast()):it=Ot=n,it.lat>=d.lat&&Ot.lat<=k.lat&&it.lng>=d.lng&&Ot.lng<=k.lng},intersects:function(n){n=se(n);var d=this._southWest,k=this._northEast,it=n.getSouthWest(),Ot=n.getNorthEast(),Bt=Ot.lat>=d.lat&&it.lat<=k.lat,ce=Ot.lng>=d.lng&&it.lng<=k.lng;return Bt&&ce},overlaps:function(n){n=se(n);var d=this._southWest,k=this._northEast,it=n.getSouthWest(),Ot=n.getNorthEast(),Bt=Ot.lat>d.lat&&it.lat<k.lat,ce=Ot.lng>d.lng&&it.lng<k.lng;return Bt&&ce},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(n,d){return n?(n=se(n),this._southWest.equals(n.getSouthWest(),d)&&this._northEast.equals(n.getNorthEast(),d)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function se(n,d){return n instanceof be?n:new be(n,d)}function Fe(n,d,k){if(isNaN(n)||isNaN(d))throw new Error("Invalid LatLng object: ("+n+", "+d+")");this.lat=+n,this.lng=+d,k!==void 0&&(this.alt=+k)}Fe.prototype={equals:function(n,d){if(!n)return!1;n=Pe(n);var k=Math.max(Math.abs(this.lat-n.lat),Math.abs(this.lng-n.lng));return k<=(d===void 0?1e-9:d)},toString:function(n){return"LatLng("+at(this.lat,n)+", "+at(this.lng,n)+")"},distanceTo:function(n){return Rt.distance(this,Pe(n))},wrap:function(){return Rt.wrapLatLng(this)},toBounds:function(n){var d=180*n/40075017,k=d/Math.cos(Math.PI/180*this.lat);return se([this.lat-d,this.lng-k],[this.lat+d,this.lng+k])},clone:function(){return new Fe(this.lat,this.lng,this.alt)}};function Pe(n,d,k){return n instanceof Fe?n:yt(n)&&typeof n[0]!="object"?n.length===3?new Fe(n[0],n[1],n[2]):n.length===2?new Fe(n[0],n[1]):null:n==null?n:typeof n=="object"&&"lat"in n?new Fe(n.lat,"lng"in n?n.lng:n.lon,n.alt):d===void 0?null:new Fe(n,d,k)}var It={latLngToPoint:function(n,d){var k=this.projection.project(n),it=this.scale(d);return this.transformation._transform(k,it)},pointToLatLng:function(n,d){var k=this.scale(d),it=this.transformation.untransform(n,k);return this.projection.unproject(it)},project:function(n){return this.projection.project(n)},unproject:function(n){return this.projection.unproject(n)},scale:function(n){return 256*Math.pow(2,n)},zoom:function(n){return Math.log(n/256)/Math.LN2},getProjectedBounds:function(n){if(this.infinite)return null;var d=this.projection.bounds,k=this.scale(n),it=this.transformation.transform(d.min,k),Ot=this.transformation.transform(d.max,k);return new Lt(it,Ot)},infinite:!1,wrapLatLng:function(n){var d=this.wrapLng?Nt(n.lng,this.wrapLng,!0):n.lng,k=this.wrapLat?Nt(n.lat,this.wrapLat,!0):n.lat,it=n.alt;return new Fe(k,d,it)},wrapLatLngBounds:function(n){var d=n.getCenter(),k=this.wrapLatLng(d),it=d.lat-k.lat,Ot=d.lng-k.lng;if(it===0&&Ot===0)return n;var Bt=n.getSouthWest(),ce=n.getNorthEast(),jt=new Fe(Bt.lat-it,Bt.lng-Ot),Ie=new Fe(ce.lat-it,ce.lng-Ot);return new be(jt,Ie)}},Rt=de({},It,{wrapLng:[-180,180],R:6371e3,distance:function(n,d){var k=Math.PI/180,it=n.lat*k,Ot=d.lat*k,Bt=Math.sin((d.lat-n.lat)*k/2),ce=Math.sin((d.lng-n.lng)*k/2),jt=Bt*Bt+Math.cos(it)*Math.cos(Ot)*ce*ce,Ie=2*Math.atan2(Math.sqrt(jt),Math.sqrt(1-jt));return this.R*Ie}}),Jt=6378137,Yt={R:Jt,MAX_LATITUDE:85.0511287798,project:function(n){var d=Math.PI/180,k=this.MAX_LATITUDE,it=Math.max(Math.min(k,n.lat),-k),Ot=Math.sin(it*d);return new re(this.R*n.lng*d,this.R*Math.log((1+Ot)/(1-Ot))/2)},unproject:function(n){var d=180/Math.PI;return new Fe((2*Math.atan(Math.exp(n.y/this.R))-Math.PI/2)*d,n.x*d/this.R)},bounds:function(){var n=Jt*Math.PI;return new Lt([-n,-n],[n,n])}()};function Te(n,d,k,it){if(yt(n)){this._a=n[0],this._b=n[1],this._c=n[2],this._d=n[3];return}this._a=n,this._b=d,this._c=k,this._d=it}Te.prototype={transform:function(n,d){return this._transform(n.clone(),d)},_transform:function(n,d){return d=d||1,n.x=d*(this._a*n.x+this._b),n.y=d*(this._c*n.y+this._d),n},untransform:function(n,d){return d=d||1,new re((n.x/d-this._b)/this._a,(n.y/d-this._d)/this._c)}};function me(n,d,k,it){return new Te(n,d,k,it)}var De=de({},Rt,{code:"EPSG:3857",projection:Yt,transformation:function(){var n=.5/(Math.PI*Yt.R);return me(n,.5,-n,.5)}()}),Ge=de({},De,{code:"EPSG:900913"});function Tt(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function Vt(n,d){var k="",it,Ot,Bt,ce,jt,Ie;for(it=0,Bt=n.length;it<Bt;it++){for(jt=n[it],Ot=0,ce=jt.length;Ot<ce;Ot++)Ie=jt[Ot],k+=(Ot?"L":"M")+Ie.x+" "+Ie.y;k+=d?h0.svg?"z":"x":""}return k||"M0 0"}var xe=document.documentElement.style,Kt="ActiveXObject"in window,Me=Kt&&!document.addEventListener,Se="msLaunchUri"in navigator&&!("documentMode"in document),ke=ix("webkit"),Ne=ix("android"),Oe=ix("android 2")||ix("android 3"),$e=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),l0=Ne&&ix("Google")&&$e<537&&!("AudioNode"in window),je=!!window.opera,I0=!Se&&ix("chrome"),X0=ix("gecko")&&!ke&&!je&&!Kt,W0=!I0&&ix("safari"),U0=ix("phantom"),J0="OTransition"in xe,yx=navigator.platform.indexOf("Win")===0,cx=Kt&&"transition"in xe,H0="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Oe,kx="MozPerspective"in xe,ri=!window.L_DISABLE_3D&&(cx||H0||kx)&&!J0&&!U0,Ox=typeof orientation<"u"||ix("mobile"),$x=Ox&&ke,lx=Ox&&H0,y0=!window.PointerEvent&&window.MSPointerEvent,he=!!(window.PointerEvent||y0),Ae="ontouchstart"in window||!!window.TouchEvent,Ve=!window.L_NO_TOUCH&&(Ae||he),x0=Ox&&je,n0=Ox&&X0,t0=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,f0=function(){var n=!1;try{var d=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("testPassiveEventSupport",ft,d),window.removeEventListener("testPassiveEventSupport",ft,d)}catch{}return n}(),c0=function(){return!!document.createElement("canvas").getContext}(),r0=!!(document.createElementNS&&Tt("svg").createSVGRect),_0=!!r0&&function(){var n=document.createElement("div");return n.innerHTML="<svg/>",(n.firstChild&&n.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),z0=!r0&&function(){try{var n=document.createElement("div");n.innerHTML='<v:shape adj="1"/>';var d=n.firstChild;return d.style.behavior="url(#default#VML)",d&&typeof d.adj=="object"}catch{return!1}}(),Q0=navigator.platform.indexOf("Mac")===0,_x=navigator.platform.indexOf("Linux")===0;function ix(n){return navigator.userAgent.toLowerCase().indexOf(n)>=0}var h0={ie:Kt,ielt9:Me,edge:Se,webkit:ke,android:Ne,android23:Oe,androidStock:l0,opera:je,chrome:I0,gecko:X0,safari:W0,phantom:U0,opera12:J0,win:yx,ie3d:cx,webkit3d:H0,gecko3d:kx,any3d:ri,mobile:Ox,mobileWebkit:$x,mobileWebkit3d:lx,msPointer:y0,pointer:he,touch:Ve,touchNative:Ae,mobileOpera:x0,mobileGecko:n0,retina:t0,passiveEvents:f0,canvas:c0,svg:r0,vml:z0,inlineSvg:_0,mac:Q0,linux:_x},Wi=h0.msPointer?"MSPointerDown":"pointerdown",bi=h0.msPointer?"MSPointerMove":"pointermove",qx=h0.msPointer?"MSPointerUp":"pointerup",Ex=h0.msPointer?"MSPointerCancel":"pointercancel",Mx={touchstart:Wi,touchmove:bi,touchend:qx,touchcancel:Ex},di={touchstart:Ps,touchmove:Zr,touchend:Zr,touchcancel:Zr},Xx={},$n=!1;function yn(n,d,k){return d==="touchstart"&&Xn(),di[d]?(k=di[d].bind(this,k),n.addEventListener(Mx[d],k,!1),k):(console.warn("wrong event specified:",d),ft)}function bs(n,d,k){if(!Mx[d]){console.warn("wrong event specified:",d);return}n.removeEventListener(Mx[d],k,!1)}function fi(n){Xx[n.pointerId]=n}function ia(n){Xx[n.pointerId]&&(Xx[n.pointerId]=n)}function ws(n){delete Xx[n.pointerId]}function Xn(){$n||(document.addEventListener(Wi,fi,!0),document.addEventListener(bi,ia,!0),document.addEventListener(qx,ws,!0),document.addEventListener(Ex,ws,!0),$n=!0)}function Zr(n,d){if(d.pointerType!==(d.MSPOINTER_TYPE_MOUSE||"mouse")){d.touches=[];for(var k in Xx)d.touches.push(Xx[k]);d.changedTouches=[d],n(d)}}function Ps(n,d){d.MSPOINTER_TYPE_TOUCH&&d.pointerType===d.MSPOINTER_TYPE_TOUCH&&mx(d),Zr(n,d)}function Ss(n){var d={},k,it;for(it in n)k=n[it],d[it]=k&&k.bind?k.bind(n):k;return n=d,d.type="dblclick",d.detail=2,d.isTrusted=!1,d._simulated=!0,d}var Ls=200;function Os(n,d){n.addEventListener("dblclick",d);var k=0,it;function Ot(Bt){if(Bt.detail!==1){it=Bt.detail;return}if(!(Bt.pointerType==="mouse"||Bt.sourceCapabilities&&!Bt.sourceCapabilities.firesTouchEvents)){var ce=Is(Bt);if(!(ce.some(function(Ie){return Ie instanceof HTMLLabelElement&&Ie.attributes.for})&&!ce.some(function(Ie){return Ie instanceof HTMLInputElement||Ie instanceof HTMLSelectElement}))){var jt=Date.now();jt-k<=Ls?(it++,it===2&&d(Ss(Bt))):it=1,k=jt}}}return n.addEventListener("click",Ot),{dblclick:d,simDblclick:Ot}}function Ts(n,d){n.removeEventListener("dblclick",d.dblclick),n.removeEventListener("click",d.simDblclick)}var _n=nr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),gr=nr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Qn=gr==="webkitTransition"||gr==="OTransition"?gr+"End":"transitionend";function jn(n){return typeof n=="string"?document.getElementById(n):n}function Jr(n,d){var k=n.style[d]||n.currentStyle&&n.currentStyle[d];if((!k||k==="auto")&&document.defaultView){var it=document.defaultView.getComputedStyle(n,null);k=it?it[d]:null}return k==="auto"?null:k}function q0(n,d,k){var it=document.createElement(n);return it.className=d||"",k&&k.appendChild(it),it}function hx(n){var d=n.parentNode;d&&d.removeChild(n)}function bn(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function qi(n){var d=n.parentNode;d&&d.lastChild!==n&&d.appendChild(n)}function Zi(n){var d=n.parentNode;d&&d.firstChild!==n&&d.insertBefore(n,d.firstChild)}function ts(n,d){if(n.classList!==void 0)return n.classList.contains(d);var k=vr(n);return k.length>0&&new RegExp("(^|\\s)"+d+"(\\s|$)").test(k)}function k0(n,d){if(n.classList!==void 0)for(var k=et(d),it=0,Ot=k.length;it<Ot;it++)n.classList.add(k[it]);else if(!ts(n,d)){var Bt=vr(n);Hr(n,(Bt?Bt+" ":"")+d)}}function dx(n,d){n.classList!==void 0?n.classList.remove(d):Hr(n,dt((" "+vr(n)+" ").replace(" "+d+" "," ")))}function Hr(n,d){n.className.baseVal===void 0?n.className=d:n.className.baseVal=d}function vr(n){return n.correspondingElement&&(n=n.correspondingElement),n.className.baseVal===void 0?n.className:n.className.baseVal}function px(n,d){"opacity"in n.style?n.style.opacity=d:"filter"in n.style&&Kr(n,d)}function Kr(n,d){var k=!1,it="DXImageTransform.Microsoft.Alpha";try{k=n.filters.item(it)}catch{if(d===1)return}d=Math.round(d*100),k?(k.Enabled=d!==100,k.Opacity=d):n.style.filter+=" progid:"+it+"(opacity="+d+")"}function nr(n){for(var d=document.documentElement.style,k=0;k<n.length;k++)if(n[k]in d)return n[k];return!1}function Ux(n,d,k){var it=d||new re(0,0);n.style[_n]=(h0.ie3d?"translate("+it.x+"px,"+it.y+"px)":"translate3d("+it.x+"px,"+it.y+"px,0)")+(k?" scale("+k+")":"")}function rx(n,d){n._leaflet_pos=d,h0.any3d?Ux(n,d):(n.style.left=d.x+"px",n.style.top=d.y+"px")}function Ji(n){return n._leaflet_pos||new re(0,0)}var yr,Nx,j0;if("onselectstart"in document)yr=function(){P0(window,"selectstart",mx)},Nx=function(){tx(window,"selectstart",mx)};else{var _r=nr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);yr=function(){if(_r){var n=document.documentElement.style;j0=n[_r],n[_r]="none"}},Nx=function(){_r&&(document.documentElement.style[_r]=j0,j0=void 0)}}function wn(){P0(window,"dragstart",mx)}function sr(){tx(window,"dragstart",mx)}var Yr,br;function es(n){for(;n.tabIndex===-1;)n=n.parentNode;n.style&&(Pn(),Yr=n,br=n.style.outlineStyle,n.style.outlineStyle="none",P0(window,"keydown",Pn))}function Pn(){Yr&&(Yr.style.outlineStyle=br,Yr=void 0,br=void 0,tx(window,"keydown",Pn))}function ci(n){do n=n.parentNode;while((!n.offsetWidth||!n.offsetHeight)&&n!==document.body);return n}function ni(n){var d=n.getBoundingClientRect();return{x:d.width/n.offsetWidth||1,y:d.height/n.offsetHeight||1,boundingClientRect:d}}var Hi={__proto__:null,TRANSFORM:_n,TRANSITION:gr,TRANSITION_END:Qn,get:jn,getStyle:Jr,create:q0,remove:hx,empty:bn,toFront:qi,toBack:Zi,hasClass:ts,addClass:k0,removeClass:dx,setClass:Hr,getClass:vr,setOpacity:px,testProp:nr,setTransform:Ux,setPosition:rx,getPosition:Ji,get disableTextSelection(){return yr},get enableTextSelection(){return Nx},disableImageDrag:wn,enableImageDrag:sr,preventOutline:es,restoreOutline:Pn,getSizedParentNode:ci,getScale:ni};function P0(n,d,k,it){if(d&&typeof d=="object")for(var Ot in d)is(n,Ot,d[Ot],k);else{d=et(d);for(var Bt=0,ce=d.length;Bt<ce;Bt++)is(n,d[Bt],k,it)}return this}var Zx="_leaflet_events";function tx(n,d,k,it){if(arguments.length===1)As(n),delete n[Zx];else if(d&&typeof d=="object")for(var Ot in d)rs(n,Ot,d[Ot],k);else if(d=et(d),arguments.length===2)As(n,function(jt){return gt(d,jt)!==-1});else for(var Bt=0,ce=d.length;Bt<ce;Bt++)rs(n,d[Bt],k,it);return this}function As(n,d){for(var k in n[Zx]){var it=k.split(/\d/)[0];(!d||d(it))&&rs(n,it,null,null,k)}}var xs={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function is(n,d,k,it){var Ot=d+I(k)+(it?"_"+I(it):"");if(n[Zx]&&n[Zx][Ot])return this;var Bt=function(jt){return k.call(it||n,jt||window.event)},ce=Bt;!h0.touchNative&&h0.pointer&&d.indexOf("touch")===0?Bt=yn(n,d,Bt):h0.touch&&d==="dblclick"?Bt=Os(n,Bt):"addEventListener"in n?d==="touchstart"||d==="touchmove"||d==="wheel"||d==="mousewheel"?n.addEventListener(xs[d]||d,Bt,h0.passiveEvents?{passive:!1}:!1):d==="mouseenter"||d==="mouseleave"?(Bt=function(jt){jt=jt||window.event,ns(n,jt)&&ce(jt)},n.addEventListener(xs[d],Bt,!1)):n.addEventListener(d,ce,!1):n.attachEvent("on"+d,Bt),n[Zx]=n[Zx]||{},n[Zx][Ot]=Bt}function rs(n,d,k,it,Ot){Ot=Ot||d+I(k)+(it?"_"+I(it):"");var Bt=n[Zx]&&n[Zx][Ot];if(!Bt)return this;!h0.touchNative&&h0.pointer&&d.indexOf("touch")===0?bs(n,d,Bt):h0.touch&&d==="dblclick"?Ts(n,Bt):"removeEventListener"in n?n.removeEventListener(xs[d]||d,Bt,!1):n.detachEvent("on"+d,Bt),n[Zx][Ot]=null}function wi(n){return n.stopPropagation?n.stopPropagation():n.originalEvent?n.originalEvent._stopped=!0:n.cancelBubble=!0,this}function $r(n){return is(n,"wheel",wi),this}function Ki(n){return P0(n,"mousedown touchstart dblclick contextmenu",wi),n._leaflet_disable_click=!0,this}function mx(n){return n.preventDefault?n.preventDefault():n.returnValue=!1,this}function Yi(n){return mx(n),wi(n),this}function Is(n){if(n.composedPath)return n.composedPath();for(var d=[],k=n.target;k;)d.push(k),k=k.parentNode;return d}function Es(n,d){if(!d)return new re(n.clientX,n.clientY);var k=ni(d),it=k.boundingClientRect;return new re((n.clientX-it.left)/k.x-d.clientLeft,(n.clientY-it.top)/k.y-d.clientTop)}var ra=h0.linux&&h0.chrome?window.devicePixelRatio:h0.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Rs(n){return h0.edge?n.wheelDeltaY/2:n.deltaY&&n.deltaMode===0?-n.deltaY/ra:n.deltaY&&n.deltaMode===1?-n.deltaY*20:n.deltaY&&n.deltaMode===2?-n.deltaY*60:n.deltaX||n.deltaZ?0:n.wheelDelta?(n.wheelDeltaY||n.wheelDelta)/2:n.detail&&Math.abs(n.detail)<32765?-n.detail*20:n.detail?n.detail/-32765*60:0}function ns(n,d){var k=d.relatedTarget;if(!k)return!0;try{for(;k&&k!==n;)k=k.parentNode}catch{return!1}return k!==n}var na={__proto__:null,on:P0,off:tx,stopPropagation:wi,disableScrollPropagation:$r,disableClickPropagation:Ki,preventDefault:mx,stop:Yi,getPropagationPath:Is,getMousePosition:Es,getWheelDelta:Rs,isExternalTarget:ns,addListener:P0,removeListener:tx},Sn=ue.extend({run:function(n,d,k,it){this.stop(),this._el=n,this._inProgress=!0,this._duration=k||.25,this._easeOutPower=1/Math.max(it||.5,.2),this._startPos=Ji(n),this._offset=d.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ut(this._animate,this),this._step()},_step:function(n){var d=+new Date-this._startTime,k=this._duration*1e3;d<k?this._runFrame(this._easeOut(d/k),n):(this._runFrame(1),this._complete())},_runFrame:function(n,d){var k=this._startPos.add(this._offset.multiplyBy(n));d&&k._round(),rx(this._el,k),this.fire("step")},_complete:function(){Mt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(n){return 1-Math.pow(1-n,this._easeOutPower)}}),N0=ue.extend({options:{crs:De,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(n,d){d=_t(this,d),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(n),this._initLayout(),this._onResize=Dt(this._onResize,this),this._initEvents(),d.maxBounds&&this.setMaxBounds(d.maxBounds),d.zoom!==void 0&&(this._zoom=this._limitZoom(d.zoom)),d.center&&d.zoom!==void 0&&this.setView(Pe(d.center),d.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=gr&&h0.any3d&&!h0.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),P0(this._proxy,Qn,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(n,d,k){if(d=d===void 0?this._zoom:this._limitZoom(d),n=this._limitCenter(Pe(n),d,this.options.maxBounds),k=k||{},this._stop(),this._loaded&&!k.reset&&k!==!0){k.animate!==void 0&&(k.zoom=de({animate:k.animate},k.zoom),k.pan=de({animate:k.animate,duration:k.duration},k.pan));var it=this._zoom!==d?this._tryAnimatedZoom&&this._tryAnimatedZoom(n,d,k.zoom):this._tryAnimatedPan(n,k.pan);if(it)return clearTimeout(this._sizeTimer),this}return this._resetView(n,d,k.pan&&k.pan.noMoveStart),this},setZoom:function(n,d){return this._loaded?this.setView(this.getCenter(),n,{zoom:d}):(this._zoom=n,this)},zoomIn:function(n,d){return n=n||(h0.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+n,d)},zoomOut:function(n,d){return n=n||(h0.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-n,d)},setZoomAround:function(n,d,k){var it=this.getZoomScale(d),Ot=this.getSize().divideBy(2),Bt=n instanceof re?n:this.latLngToContainerPoint(n),ce=Bt.subtract(Ot).multiplyBy(1-1/it),jt=this.containerPointToLatLng(Ot.add(ce));return this.setView(jt,d,{zoom:k})},_getBoundsCenterZoom:function(n,d){d=d||{},n=n.getBounds?n.getBounds():se(n);var k=Qt(d.paddingTopLeft||d.padding||[0,0]),it=Qt(d.paddingBottomRight||d.padding||[0,0]),Ot=this.getBoundsZoom(n,!1,k.add(it));if(Ot=typeof d.maxZoom=="number"?Math.min(d.maxZoom,Ot):Ot,Ot===1/0)return{center:n.getCenter(),zoom:Ot};var Bt=it.subtract(k).divideBy(2),ce=this.project(n.getSouthWest(),Ot),jt=this.project(n.getNorthEast(),Ot),Ie=this.unproject(ce.add(jt).divideBy(2).add(Bt),Ot);return{center:Ie,zoom:Ot}},fitBounds:function(n,d){if(n=se(n),!n.isValid())throw new Error("Bounds are not valid.");var k=this._getBoundsCenterZoom(n,d);return this.setView(k.center,k.zoom,d)},fitWorld:function(n){return this.fitBounds([[-90,-180],[90,180]],n)},panTo:function(n,d){return this.setView(n,this._zoom,{pan:d})},panBy:function(n,d){if(n=Qt(n).round(),d=d||{},!n.x&&!n.y)return this.fire("moveend");if(d.animate!==!0&&!this.getSize().contains(n))return this._resetView(this.unproject(this.project(this.getCenter()).add(n)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Sn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),d.noMoveStart||this.fire("movestart"),d.animate!==!1){k0(this._mapPane,"leaflet-pan-anim");var k=this._getMapPanePos().subtract(n).round();this._panAnim.run(this._mapPane,k,d.duration||.25,d.easeLinearity)}else this._rawPanBy(n),this.fire("move").fire("moveend");return this},flyTo:function(n,d,k){if(k=k||{},k.animate===!1||!h0.any3d)return this.setView(n,d,k);this._stop();var it=this.project(this.getCenter()),Ot=this.project(n),Bt=this.getSize(),ce=this._zoom;n=Pe(n),d=d===void 0?ce:d;var jt=Math.max(Bt.x,Bt.y),Ie=jt*this.getZoomScale(ce,d),qe=Ot.distanceTo(it)||1,s0=1.42,g0=s0*s0;function S0(C0){var cr=C0?-1:1,cs=C0?Ie:jt,K0=Ie*Ie-jt*jt+cr*g0*g0*qe*qe,Js=2*cs*g0*qe,Gn=K0/Js,G0=Math.sqrt(Gn*Gn+1)-Gn,ps=G0<1e-9?-18:Math.log(G0);return ps}function wx(C0){return(Math.exp(C0)-Math.exp(-C0))/2}function p0(C0){return(Math.exp(C0)+Math.exp(-C0))/2}function Gx(C0){return wx(C0)/p0(C0)}var zx=S0(0);function xr(C0){return jt*(p0(zx)/p0(zx+s0*C0))}function Ws(C0){return jt*(p0(zx)*Gx(zx+s0*C0)-wx(zx))/g0}function qs(C0){return 1-Math.pow(1-C0,1.5)}var Zs=Date.now(),Dx=(S0(1)-zx)/s0,Bx=k.duration?1e3*k.duration:1e3*Dx*.8;function ln(){var C0=(Date.now()-Zs)/Bx,cr=qs(C0)*Dx;C0<=1?(this._flyToFrame=ut(ln,this),this._move(this.unproject(it.add(Ot.subtract(it).multiplyBy(Ws(cr)/qe)),ce),this.getScaleZoom(jt/xr(cr),ce),{flyTo:!0})):this._move(n,d)._moveEnd(!0)}return this._moveStart(!0,k.noMoveStart),ln.call(this),this},flyToBounds:function(n,d){var k=this._getBoundsCenterZoom(n,d);return this.flyTo(k.center,k.zoom,d)},setMaxBounds:function(n){return n=se(n),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),n.isValid()?(this.options.maxBounds=n,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(n){var d=this.options.minZoom;return this.options.minZoom=n,this._loaded&&d!==n&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(n):this},setMaxZoom:function(n){var d=this.options.maxZoom;return this.options.maxZoom=n,this._loaded&&d!==n&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(n):this},panInsideBounds:function(n,d){this._enforcingBounds=!0;var k=this.getCenter(),it=this._limitCenter(k,this._zoom,se(n));return k.equals(it)||this.panTo(it,d),this._enforcingBounds=!1,this},panInside:function(n,d){d=d||{};var k=Qt(d.paddingTopLeft||d.padding||[0,0]),it=Qt(d.paddingBottomRight||d.padding||[0,0]),Ot=this.project(this.getCenter()),Bt=this.project(n),ce=this.getPixelBounds(),jt=pe([ce.min.add(k),ce.max.subtract(it)]),Ie=jt.getSize();if(!jt.contains(Bt)){this._enforcingBounds=!0;var qe=Bt.subtract(jt.getCenter()),s0=jt.extend(Bt).getSize().subtract(Ie);Ot.x+=qe.x<0?-s0.x:s0.x,Ot.y+=qe.y<0?-s0.y:s0.y,this.panTo(this.unproject(Ot),d),this._enforcingBounds=!1}return this},invalidateSize:function(n){if(!this._loaded)return this;n=de({animate:!1,pan:!0},n===!0?{animate:!0}:n);var d=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var k=this.getSize(),it=d.divideBy(2).round(),Ot=k.divideBy(2).round(),Bt=it.subtract(Ot);return!Bt.x&&!Bt.y?this:(n.animate&&n.pan?this.panBy(Bt):(n.pan&&this._rawPanBy(Bt),this.fire("move"),n.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(Dt(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:d,newSize:k}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(n){if(n=this._locateOptions=de({timeout:1e4,watch:!1},n),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var d=Dt(this._handleGeolocationResponse,this),k=Dt(this._handleGeolocationError,this);return n.watch?this._locationWatchId=navigator.geolocation.watchPosition(d,k,n):navigator.geolocation.getCurrentPosition(d,k,n),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(n){if(this._container._leaflet_id){var d=n.code,k=n.message||(d===1?"permission denied":d===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:d,message:"Geolocation error: "+k+"."})}},_handleGeolocationResponse:function(n){if(this._container._leaflet_id){var d=n.coords.latitude,k=n.coords.longitude,it=new Fe(d,k),Ot=it.toBounds(n.coords.accuracy*2),Bt=this._locateOptions;if(Bt.setView){var ce=this.getBoundsZoom(Ot);this.setView(it,Bt.maxZoom?Math.min(ce,Bt.maxZoom):ce)}var jt={latlng:it,bounds:Ot,timestamp:n.timestamp};for(var Ie in n.coords)typeof n.coords[Ie]=="number"&&(jt[Ie]=n.coords[Ie]);this.fire("locationfound",jt)}},addHandler:function(n,d){if(!d)return this;var k=this[n]=new d(this);return this._handlers.push(k),this.options[n]&&k.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),hx(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Mt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var n;for(n in this._layers)this._layers[n].remove();for(n in this._panes)hx(this._panes[n]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(n,d){var k="leaflet-pane"+(n?" leaflet-"+n.replace("Pane","")+"-pane":""),it=q0("div",k,d||this._mapPane);return n&&(this._panes[n]=it),it},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var n=this.getPixelBounds(),d=this.unproject(n.getBottomLeft()),k=this.unproject(n.getTopRight());return new be(d,k)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(n,d,k){n=se(n),k=Qt(k||[0,0]);var it=this.getZoom()||0,Ot=this.getMinZoom(),Bt=this.getMaxZoom(),ce=n.getNorthWest(),jt=n.getSouthEast(),Ie=this.getSize().subtract(k),qe=pe(this.project(jt,it),this.project(ce,it)).getSize(),s0=h0.any3d?this.options.zoomSnap:1,g0=Ie.x/qe.x,S0=Ie.y/qe.y,wx=d?Math.max(g0,S0):Math.min(g0,S0);return it=this.getScaleZoom(wx,it),s0&&(it=Math.round(it/(s0/100))*(s0/100),it=d?Math.ceil(it/s0)*s0:Math.floor(it/s0)*s0),Math.max(Ot,Math.min(Bt,it))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new re(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(n,d){var k=this._getTopLeftPoint(n,d);return new Lt(k,k.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(n){return this.options.crs.getProjectedBounds(n===void 0?this.getZoom():n)},getPane:function(n){return typeof n=="string"?this._panes[n]:n},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(n,d){var k=this.options.crs;return d=d===void 0?this._zoom:d,k.scale(n)/k.scale(d)},getScaleZoom:function(n,d){var k=this.options.crs;d=d===void 0?this._zoom:d;var it=k.zoom(n*k.scale(d));return isNaN(it)?1/0:it},project:function(n,d){return d=d===void 0?this._zoom:d,this.options.crs.latLngToPoint(Pe(n),d)},unproject:function(n,d){return d=d===void 0?this._zoom:d,this.options.crs.pointToLatLng(Qt(n),d)},layerPointToLatLng:function(n){var d=Qt(n).add(this.getPixelOrigin());return this.unproject(d)},latLngToLayerPoint:function(n){var d=this.project(Pe(n))._round();return d._subtract(this.getPixelOrigin())},wrapLatLng:function(n){return this.options.crs.wrapLatLng(Pe(n))},wrapLatLngBounds:function(n){return this.options.crs.wrapLatLngBounds(se(n))},distance:function(n,d){return this.options.crs.distance(Pe(n),Pe(d))},containerPointToLayerPoint:function(n){return Qt(n).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(n){return Qt(n).add(this._getMapPanePos())},containerPointToLatLng:function(n){var d=this.containerPointToLayerPoint(Qt(n));return this.layerPointToLatLng(d)},latLngToContainerPoint:function(n){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Pe(n)))},mouseEventToContainerPoint:function(n){return Es(n,this._container)},mouseEventToLayerPoint:function(n){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(n))},mouseEventToLatLng:function(n){return this.layerPointToLatLng(this.mouseEventToLayerPoint(n))},_initContainer:function(n){var d=this._container=jn(n);if(d){if(d._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");P0(d,"scroll",this._onScroll,this),this._containerId=I(d)},_initLayout:function(){var n=this._container;this._fadeAnimated=this.options.fadeAnimation&&h0.any3d,k0(n,"leaflet-container"+(h0.touch?" leaflet-touch":"")+(h0.retina?" leaflet-retina":"")+(h0.ielt9?" leaflet-oldie":"")+(h0.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var d=Jr(n,"position");d!=="absolute"&&d!=="relative"&&d!=="fixed"&&d!=="sticky"&&(n.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var n=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),rx(this._mapPane,new re(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(k0(n.markerPane,"leaflet-zoom-hide"),k0(n.shadowPane,"leaflet-zoom-hide"))},_resetView:function(n,d,k){rx(this._mapPane,new re(0,0));var it=!this._loaded;this._loaded=!0,d=this._limitZoom(d),this.fire("viewprereset");var Ot=this._zoom!==d;this._moveStart(Ot,k)._move(n,d)._moveEnd(Ot),this.fire("viewreset"),it&&this.fire("load")},_moveStart:function(n,d){return n&&this.fire("zoomstart"),d||this.fire("movestart"),this},_move:function(n,d,k,it){d===void 0&&(d=this._zoom);var Ot=this._zoom!==d;return this._zoom=d,this._lastCenter=n,this._pixelOrigin=this._getNewPixelOrigin(n),it?k&&k.pinch&&this.fire("zoom",k):((Ot||k&&k.pinch)&&this.fire("zoom",k),this.fire("move",k)),this},_moveEnd:function(n){return n&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Mt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(n){rx(this._mapPane,this._getMapPanePos().subtract(n))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(n){this._targets={},this._targets[I(this._container)]=this;var d=n?tx:P0;d(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&d(window,"resize",this._onResize,this),h0.any3d&&this.options.transform3DLimit&&(n?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Mt(this._resizeRequest),this._resizeRequest=ut(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var n=this._getMapPanePos();Math.max(Math.abs(n.x),Math.abs(n.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(n,d){for(var k=[],it,Ot=d==="mouseout"||d==="mouseover",Bt=n.target||n.srcElement,ce=!1;Bt;){if(it=this._targets[I(Bt)],it&&(d==="click"||d==="preclick")&&this._draggableMoved(it)){ce=!0;break}if(it&&it.listens(d,!0)&&(Ot&&!ns(Bt,n)||(k.push(it),Ot))||Bt===this._container)break;Bt=Bt.parentNode}return!k.length&&!ce&&!Ot&&this.listens(d,!0)&&(k=[this]),k},_isClickDisabled:function(n){for(;n&&n!==this._container;){if(n._leaflet_disable_click)return!0;n=n.parentNode}},_handleDOMEvent:function(n){var d=n.target||n.srcElement;if(!(!this._loaded||d._leaflet_disable_events||n.type==="click"&&this._isClickDisabled(d))){var k=n.type;k==="mousedown"&&es(d),this._fireDOMEvent(n,k)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(n,d,k){if(n.type==="click"){var it=de({},n);it.type="preclick",this._fireDOMEvent(it,it.type,k)}var Ot=this._findEventTargets(n,d);if(k){for(var Bt=[],ce=0;ce<k.length;ce++)k[ce].listens(d,!0)&&Bt.push(k[ce]);Ot=Bt.concat(Ot)}if(Ot.length){d==="contextmenu"&&mx(n);var jt=Ot[0],Ie={originalEvent:n};if(n.type!=="keypress"&&n.type!=="keydown"&&n.type!=="keyup"){var qe=jt.getLatLng&&(!jt._radius||jt._radius<=10);Ie.containerPoint=qe?this.latLngToContainerPoint(jt.getLatLng()):this.mouseEventToContainerPoint(n),Ie.layerPoint=this.containerPointToLayerPoint(Ie.containerPoint),Ie.latlng=qe?jt.getLatLng():this.layerPointToLatLng(Ie.layerPoint)}for(ce=0;ce<Ot.length;ce++)if(Ot[ce].fire(d,Ie,!0),Ie.originalEvent._stopped||Ot[ce].options.bubblingMouseEvents===!1&&gt(this._mouseEvents,d)!==-1)return}},_draggableMoved:function(n){return n=n.dragging&&n.dragging.enabled()?n:this,n.dragging&&n.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var n=0,d=this._handlers.length;n<d;n++)this._handlers[n].disable()},whenReady:function(n,d){return this._loaded?n.call(d||this,{target:this}):this.on("load",n,d),this},_getMapPanePos:function(){return Ji(this._mapPane)||new re(0,0)},_moved:function(){var n=this._getMapPanePos();return n&&!n.equals([0,0])},_getTopLeftPoint:function(n,d){var k=n&&d!==void 0?this._getNewPixelOrigin(n,d):this.getPixelOrigin();return k.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(n,d){var k=this.getSize()._divideBy(2);return this.project(n,d)._subtract(k)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(n,d,k){var it=this._getNewPixelOrigin(k,d);return this.project(n,d)._subtract(it)},_latLngBoundsToNewLayerBounds:function(n,d,k){var it=this._getNewPixelOrigin(k,d);return pe([this.project(n.getSouthWest(),d)._subtract(it),this.project(n.getNorthWest(),d)._subtract(it),this.project(n.getSouthEast(),d)._subtract(it),this.project(n.getNorthEast(),d)._subtract(it)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(n){return this.latLngToLayerPoint(n).subtract(this._getCenterLayerPoint())},_limitCenter:function(n,d,k){if(!k)return n;var it=this.project(n,d),Ot=this.getSize().divideBy(2),Bt=new Lt(it.subtract(Ot),it.add(Ot)),ce=this._getBoundsOffset(Bt,k,d);return Math.abs(ce.x)<=1&&Math.abs(ce.y)<=1?n:this.unproject(it.add(ce),d)},_limitOffset:function(n,d){if(!d)return n;var k=this.getPixelBounds(),it=new Lt(k.min.add(n),k.max.add(n));return n.add(this._getBoundsOffset(it,d))},_getBoundsOffset:function(n,d,k){var it=pe(this.project(d.getNorthEast(),k),this.project(d.getSouthWest(),k)),Ot=it.min.subtract(n.min),Bt=it.max.subtract(n.max),ce=this._rebound(Ot.x,-Bt.x),jt=this._rebound(Ot.y,-Bt.y);return new re(ce,jt)},_rebound:function(n,d){return n+d>0?Math.round(n-d)/2:Math.max(0,Math.ceil(n))-Math.max(0,Math.floor(d))},_limitZoom:function(n){var d=this.getMinZoom(),k=this.getMaxZoom(),it=h0.any3d?this.options.zoomSnap:1;return it&&(n=Math.round(n/it)*it),Math.max(d,Math.min(k,n))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){dx(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(n,d){var k=this._getCenterOffset(n)._trunc();return(d&&d.animate)!==!0&&!this.getSize().contains(k)?!1:(this.panBy(k,d),!0)},_createAnimProxy:function(){var n=this._proxy=q0("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(n),this.on("zoomanim",function(d){var k=_n,it=this._proxy.style[k];Ux(this._proxy,this.project(d.center,d.zoom),this.getZoomScale(d.zoom,1)),it===this._proxy.style[k]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){hx(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var n=this.getCenter(),d=this.getZoom();Ux(this._proxy,this.project(n,d),this.getZoomScale(d,1))},_catchTransitionEnd:function(n){this._animatingZoom&&n.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(n,d,k){if(this._animatingZoom)return!0;if(k=k||{},!this._zoomAnimated||k.animate===!1||this._nothingToAnimate()||Math.abs(d-this._zoom)>this.options.zoomAnimationThreshold)return!1;var it=this.getZoomScale(d),Ot=this._getCenterOffset(n)._divideBy(1-1/it);return k.animate!==!0&&!this.getSize().contains(Ot)?!1:(ut(function(){this._moveStart(!0,k.noMoveStart||!1)._animateZoom(n,d,!0)},this),!0)},_animateZoom:function(n,d,k,it){this._mapPane&&(k&&(this._animatingZoom=!0,this._animateToCenter=n,this._animateToZoom=d,k0(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:n,zoom:d,noUpdate:it}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(Dt(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&dx(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ds(n,d){return new N0(n,d)}var Qx=tt.extend({options:{position:"topright"},initialize:function(n){_t(this,n)},getPosition:function(){return this.options.position},setPosition:function(n){var d=this._map;return d&&d.removeControl(this),this.options.position=n,d&&d.addControl(this),this},getContainer:function(){return this._container},addTo:function(n){this.remove(),this._map=n;var d=this._container=this.onAdd(n),k=this.getPosition(),it=n._controlCorners[k];return k0(d,"leaflet-control"),k.indexOf("bottom")!==-1?it.insertBefore(d,it.firstChild):it.appendChild(d),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(hx(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(n){this._map&&n&&n.screenX>0&&n.screenY>0&&this._map.getContainer().focus()}}),Jx=function(n){return new Qx(n)};N0.include({addControl:function(n){return n.addTo(this),this},removeControl:function(n){return n.remove(),this},_initControlPos:function(){var n=this._controlCorners={},d="leaflet-",k=this._controlContainer=q0("div",d+"control-container",this._container);function it(Ot,Bt){var ce=d+Ot+" "+d+Bt;n[Ot+Bt]=q0("div",ce,k)}it("top","left"),it("top","right"),it("bottom","left"),it("bottom","right")},_clearControlPos:function(){for(var n in this._controlCorners)hx(this._controlCorners[n]);hx(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ex=Qx.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(n,d,k,it){return k<it?-1:it<k?1:0}},initialize:function(n,d,k){_t(this,k),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var it in n)this._addLayer(n[it],it);for(it in d)this._addLayer(d[it],it,!0)},onAdd:function(n){this._initLayout(),this._update(),this._map=n,n.on("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(n){return Qx.prototype.addTo.call(this,n),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var n=0;n<this._layers.length;n++)this._layers[n].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(n,d){return this._addLayer(n,d),this._map?this._update():this},addOverlay:function(n,d){return this._addLayer(n,d,!0),this._map?this._update():this},removeLayer:function(n){n.off("add remove",this._onLayerChange,this);var d=this._getLayer(I(n));return d&&this._layers.splice(this._layers.indexOf(d),1),this._map?this._update():this},expand:function(){k0(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var n=this._map.getSize().y-(this._container.offsetTop+50);return n<this._section.clientHeight?(k0(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=n+"px"):dx(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return dx(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var n="leaflet-control-layers",d=this._container=q0("div",n),k=this.options.collapsed;d.setAttribute("aria-haspopup",!0),Ki(d),$r(d);var it=this._section=q0("section",n+"-list");k&&(this._map.on("click",this.collapse,this),P0(d,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var Ot=this._layersLink=q0("a",n+"-toggle",d);Ot.href="#",Ot.title="Layers",Ot.setAttribute("role","button"),P0(Ot,{keydown:function(Bt){Bt.keyCode===13&&this._expandSafely()},click:function(Bt){mx(Bt),this._expandSafely()}},this),k||this.expand(),this._baseLayersList=q0("div",n+"-base",it),this._separator=q0("div",n+"-separator",it),this._overlaysList=q0("div",n+"-overlays",it),d.appendChild(it)},_getLayer:function(n){for(var d=0;d<this._layers.length;d++)if(this._layers[d]&&I(this._layers[d].layer)===n)return this._layers[d]},_addLayer:function(n,d,k){this._map&&n.on("add remove",this._onLayerChange,this),this._layers.push({layer:n,name:d,overlay:k}),this.options.sortLayers&&this._layers.sort(Dt(function(it,Ot){return this.options.sortFunction(it.layer,Ot.layer,it.name,Ot.name)},this)),this.options.autoZIndex&&n.setZIndex&&(this._lastZIndex++,n.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;bn(this._baseLayersList),bn(this._overlaysList),this._layerControlInputs=[];var n,d,k,it,Ot=0;for(k=0;k<this._layers.length;k++)it=this._layers[k],this._addItem(it),d=d||it.overlay,n=n||!it.overlay,Ot+=it.overlay?0:1;return this.options.hideSingleBase&&(n=n&&Ot>1,this._baseLayersList.style.display=n?"":"none"),this._separator.style.display=d&&n?"":"none",this},_onLayerChange:function(n){this._handlingClick||this._update();var d=this._getLayer(I(n.target)),k=d.overlay?n.type==="add"?"overlayadd":"overlayremove":n.type==="add"?"baselayerchange":null;k&&this._map.fire(k,d)},_createRadioElement:function(n,d){var k='<input type="radio" class="leaflet-control-layers-selector" name="'+n+'"'+(d?' checked="checked"':"")+"/>",it=document.createElement("div");return it.innerHTML=k,it.firstChild},_addItem:function(n){var d=document.createElement("label"),k=this._map.hasLayer(n.layer),it;n.overlay?(it=document.createElement("input"),it.type="checkbox",it.className="leaflet-control-layers-selector",it.defaultChecked=k):it=this._createRadioElement("leaflet-base-layers_"+I(this),k),this._layerControlInputs.push(it),it.layerId=I(n.layer),P0(it,"click",this._onInputClick,this);var Ot=document.createElement("span");Ot.innerHTML=" "+n.name;var Bt=document.createElement("span");d.appendChild(Bt),Bt.appendChild(it),Bt.appendChild(Ot);var ce=n.overlay?this._overlaysList:this._baseLayersList;return ce.appendChild(d),this._checkDisabledLayers(),d},_onInputClick:function(){if(!this._preventClick){var n=this._layerControlInputs,d,k,it=[],Ot=[];this._handlingClick=!0;for(var Bt=n.length-1;Bt>=0;Bt--)d=n[Bt],k=this._getLayer(d.layerId).layer,d.checked?it.push(k):d.checked||Ot.push(k);for(Bt=0;Bt<Ot.length;Bt++)this._map.hasLayer(Ot[Bt])&&this._map.removeLayer(Ot[Bt]);for(Bt=0;Bt<it.length;Bt++)this._map.hasLayer(it[Bt])||this._map.addLayer(it[Bt]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var n=this._layerControlInputs,d,k,it=this._map.getZoom(),Ot=n.length-1;Ot>=0;Ot--)d=n[Ot],k=this._getLayer(d.layerId).layer,d.disabled=k.options.minZoom!==void 0&&it<k.options.minZoom||k.options.maxZoom!==void 0&&it>k.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var n=this._section;this._preventClick=!0,P0(n,"click",mx),this.expand();var d=this;setTimeout(function(){tx(n,"click",mx),d._preventClick=!1})}}),Ln=function(n,d,k){return new ex(n,d,k)},$i=Qx.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(n){var d="leaflet-control-zoom",k=q0("div",d+" leaflet-bar"),it=this.options;return this._zoomInButton=this._createButton(it.zoomInText,it.zoomInTitle,d+"-in",k,this._zoomIn),this._zoomOutButton=this._createButton(it.zoomOutText,it.zoomOutTitle,d+"-out",k,this._zoomOut),this._updateDisabled(),n.on("zoomend zoomlevelschange",this._updateDisabled,this),k},onRemove:function(n){n.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(n){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(n.shiftKey?3:1))},_zoomOut:function(n){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(n.shiftKey?3:1))},_createButton:function(n,d,k,it,Ot){var Bt=q0("a",k,it);return Bt.innerHTML=n,Bt.href="#",Bt.title=d,Bt.setAttribute("role","button"),Bt.setAttribute("aria-label",d),Ki(Bt),P0(Bt,"click",Yi),P0(Bt,"click",Ot,this),P0(Bt,"click",this._refocusOnMap,this),Bt},_updateDisabled:function(){var n=this._map,d="leaflet-disabled";dx(this._zoomInButton,d),dx(this._zoomOutButton,d),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||n._zoom===n.getMinZoom())&&(k0(this._zoomOutButton,d),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||n._zoom===n.getMaxZoom())&&(k0(this._zoomInButton,d),this._zoomInButton.setAttribute("aria-disabled","true"))}});N0.mergeOptions({zoomControl:!0}),N0.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new $i,this.addControl(this.zoomControl))});var On=function(n){return new $i(n)},Xi=Qx.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(n){var d="leaflet-control-scale",k=q0("div",d),it=this.options;return this._addScales(it,d+"-line",k),n.on(it.updateWhenIdle?"moveend":"move",this._update,this),n.whenReady(this._update,this),k},onRemove:function(n){n.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(n,d,k){n.metric&&(this._mScale=q0("div",d,k)),n.imperial&&(this._iScale=q0("div",d,k))},_update:function(){var n=this._map,d=n.getSize().y/2,k=n.distance(n.containerPointToLatLng([0,d]),n.containerPointToLatLng([this.options.maxWidth,d]));this._updateScales(k)},_updateScales:function(n){this.options.metric&&n&&this._updateMetric(n),this.options.imperial&&n&&this._updateImperial(n)},_updateMetric:function(n){var d=this._getRoundNum(n),k=d<1e3?d+" m":d/1e3+" km";this._updateScale(this._mScale,k,d/n)},_updateImperial:function(n){var d=n*3.2808399,k,it,Ot;d>5280?(k=d/5280,it=this._getRoundNum(k),this._updateScale(this._iScale,it+" mi",it/k)):(Ot=this._getRoundNum(d),this._updateScale(this._iScale,Ot+" ft",Ot/d))},_updateScale:function(n,d,k){n.style.width=Math.round(this.options.maxWidth*k)+"px",n.innerHTML=d},_getRoundNum:function(n){var d=Math.pow(10,(Math.floor(n)+"").length-1),k=n/d;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:1,d*k}}),Rx=function(n){return new Xi(n)},Cs='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Tn=Qx.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(h0.inlineSvg?Cs+" ":"")+"Leaflet</a>"},initialize:function(n){_t(this,n),this._attributions={}},onAdd:function(n){n.attributionControl=this,this._container=q0("div","leaflet-control-attribution"),Ki(this._container);for(var d in n._layers)n._layers[d].getAttribution&&this.addAttribution(n._layers[d].getAttribution());return this._update(),n.on("layeradd",this._addAttribution,this),this._container},onRemove:function(n){n.off("layeradd",this._addAttribution,this)},_addAttribution:function(n){n.layer.getAttribution&&(this.addAttribution(n.layer.getAttribution()),n.layer.once("remove",function(){this.removeAttribution(n.layer.getAttribution())},this))},setPrefix:function(n){return this.options.prefix=n,this._update(),this},addAttribution:function(n){return n?(this._attributions[n]||(this._attributions[n]=0),this._attributions[n]++,this._update(),this):this},removeAttribution:function(n){return n?(this._attributions[n]&&(this._attributions[n]--,this._update()),this):this},_update:function(){if(this._map){var n=[];for(var d in this._attributions)this._attributions[d]&&n.push(d);var k=[];this.options.prefix&&k.push(this.options.prefix),n.length&&k.push(n.join(", ")),this._container.innerHTML=k.join(' <span aria-hidden="true">|</span> ')}}});N0.mergeOptions({attributionControl:!0}),N0.addInitHook(function(){this.options.attributionControl&&new Tn().addTo(this)});var ks=function(n){return new Tn(n)};Qx.Layers=ex,Qx.Zoom=$i,Qx.Scale=Xi,Qx.Attribution=Tn,Jx.layers=Ln,Jx.zoom=On,Jx.scale=Rx,Jx.attribution=ks;var gx=tt.extend({initialize:function(n){this._map=n},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});gx.addTo=function(n,d){return n.addHandler(d,this),this};var Xr={Events:nt},An=h0.touch?"touchstart mousedown":"mousedown",Qi=ue.extend({options:{clickTolerance:3},initialize:function(n,d,k,it){_t(this,it),this._element=n,this._dragStartTarget=d||n,this._preventOutline=k},enable:function(){this._enabled||(P0(this._dragStartTarget,An,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Qi._dragging===this&&this.finishDrag(!0),tx(this._dragStartTarget,An,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(n){if(this._enabled&&(this._moved=!1,!ts(this._element,"leaflet-zoom-anim"))){if(n.touches&&n.touches.length!==1){Qi._dragging===this&&this.finishDrag();return}if(!(Qi._dragging||n.shiftKey||n.which!==1&&n.button!==1&&!n.touches)&&(Qi._dragging=this,this._preventOutline&&es(this._element),wn(),yr(),!this._moving)){this.fire("down");var d=n.touches?n.touches[0]:n,k=ci(this._element);this._startPoint=new re(d.clientX,d.clientY),this._startPos=Ji(this._element),this._parentScale=ni(k);var it=n.type==="mousedown";P0(document,it?"mousemove":"touchmove",this._onMove,this),P0(document,it?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(n){if(this._enabled){if(n.touches&&n.touches.length>1){this._moved=!0;return}var d=n.touches&&n.touches.length===1?n.touches[0]:n,k=new re(d.clientX,d.clientY)._subtract(this._startPoint);!k.x&&!k.y||Math.abs(k.x)+Math.abs(k.y)<this.options.clickTolerance||(k.x/=this._parentScale.x,k.y/=this._parentScale.y,mx(n),this._moved||(this.fire("dragstart"),this._moved=!0,k0(document.body,"leaflet-dragging"),this._lastTarget=n.target||n.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),k0(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(k),this._moving=!0,this._lastEvent=n,this._updatePosition())}},_updatePosition:function(){var n={originalEvent:this._lastEvent};this.fire("predrag",n),rx(this._element,this._newPos),this.fire("drag",n)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(n){dx(document.body,"leaflet-dragging"),this._lastTarget&&(dx(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),tx(document,"mousemove touchmove",this._onMove,this),tx(document,"mouseup touchend touchcancel",this._onUp,this),sr(),Nx();var d=this._moved&&this._moving;this._moving=!1,Qi._dragging=!1,d&&this.fire("dragend",{noInertia:n,distance:this._newPos.distanceTo(this._startPos)})}});function Ms(n,d,k){var it,Ot=[1,4,2,8],Bt,ce,jt,Ie,qe,s0,g0,S0;for(Bt=0,s0=n.length;Bt<s0;Bt++)n[Bt]._code=pi(n[Bt],d);for(jt=0;jt<4;jt++){for(g0=Ot[jt],it=[],Bt=0,s0=n.length,ce=s0-1;Bt<s0;ce=Bt++)Ie=n[Bt],qe=n[ce],Ie._code&g0?qe._code&g0||(S0=tn(qe,Ie,g0,d,k),S0._code=pi(S0,d),it.push(S0)):(qe._code&g0&&(S0=tn(qe,Ie,g0,d,k),S0._code=pi(S0,d),it.push(S0)),it.push(Ie));n=it}return n}function zs(n,d){var k,it,Ot,Bt,ce,jt,Ie,qe,s0;if(!n||n.length===0)throw new Error("latlngs not passed");Hx(n)||(console.warn("latlngs are not flat! Only the first ring will be used"),n=n[0]);var g0=Pe([0,0]),S0=se(n),wx=S0.getNorthWest().distanceTo(S0.getSouthWest())*S0.getNorthEast().distanceTo(S0.getNorthWest());wx<1700&&(g0=ss(n));var p0=n.length,Gx=[];for(k=0;k<p0;k++){var zx=Pe(n[k]);Gx.push(d.project(Pe([zx.lat-g0.lat,zx.lng-g0.lng])))}for(jt=Ie=qe=0,k=0,it=p0-1;k<p0;it=k++)Ot=Gx[k],Bt=Gx[it],ce=Ot.y*Bt.x-Bt.y*Ot.x,Ie+=(Ot.x+Bt.x)*ce,qe+=(Ot.y+Bt.y)*ce,jt+=ce*3;jt===0?s0=Gx[0]:s0=[Ie/jt,qe/jt];var xr=d.unproject(Qt(s0));return Pe([xr.lat+g0.lat,xr.lng+g0.lng])}function ss(n){for(var d=0,k=0,it=0,Ot=0;Ot<n.length;Ot++){var Bt=Pe(n[Ot]);d+=Bt.lat,k+=Bt.lng,it++}return Pe([d/it,k/it])}var In={__proto__:null,clipPolygon:Ms,polygonCenter:zs,centroid:ss};function ar(n,d){if(!d||!n.length)return n.slice();var k=d*d;return n=as(n,k),n=Pr(n,k),n}function Qr(n,d,k){return Math.sqrt(Or(n,d,k,!0))}function wr(n,d,k){return Or(n,d,k)}function Pr(n,d){var k=n.length,it=typeof Uint8Array!=void 0+""?Uint8Array:Array,Ot=new it(k);Ot[0]=Ot[k-1]=1,Pi(n,Ot,d,0,k-1);var Bt,ce=[];for(Bt=0;Bt<k;Bt++)Ot[Bt]&&ce.push(n[Bt]);return ce}function Pi(n,d,k,it,Ot){var Bt=0,ce,jt,Ie;for(jt=it+1;jt<=Ot-1;jt++)Ie=Or(n[jt],n[it],n[Ot],!0),Ie>Bt&&(ce=jt,Bt=Ie);Bt>k&&(d[ce]=1,Pi(n,d,k,it,ce),Pi(n,d,k,ce,Ot))}function as(n,d){for(var k=[n[0]],it=1,Ot=0,Bt=n.length;it<Bt;it++)Lr(n[it],n[Ot])>d&&(k.push(n[it]),Ot=it);return Ot<Bt-1&&k.push(n[Bt-1]),k}var jr;function Sr(n,d,k,it,Ot){var Bt=it?jr:pi(n,k),ce=pi(d,k),jt,Ie,qe;for(jr=ce;;){if(!(Bt|ce))return[n,d];if(Bt&ce)return!1;jt=Bt||ce,Ie=tn(n,d,jt,k,Ot),qe=pi(Ie,k),jt===Bt?(n=Ie,Bt=qe):(d=Ie,ce=qe)}}function tn(n,d,k,it,Ot){var Bt=d.x-n.x,ce=d.y-n.y,jt=it.min,Ie=it.max,qe,s0;return k&8?(qe=n.x+Bt*(Ie.y-n.y)/ce,s0=Ie.y):k&4?(qe=n.x+Bt*(jt.y-n.y)/ce,s0=jt.y):k&2?(qe=Ie.x,s0=n.y+ce*(Ie.x-n.x)/Bt):k&1&&(qe=jt.x,s0=n.y+ce*(jt.x-n.x)/Bt),new re(qe,s0,Ot)}function pi(n,d){var k=0;return n.x<d.min.x?k|=1:n.x>d.max.x&&(k|=2),n.y<d.min.y?k|=4:n.y>d.max.y&&(k|=8),k}function Lr(n,d){var k=d.x-n.x,it=d.y-n.y;return k*k+it*it}function Or(n,d,k,it){var Ot=d.x,Bt=d.y,ce=k.x-Ot,jt=k.y-Bt,Ie=ce*ce+jt*jt,qe;return Ie>0&&(qe=((n.x-Ot)*ce+(n.y-Bt)*jt)/Ie,qe>1?(Ot=k.x,Bt=k.y):qe>0&&(Ot+=ce*qe,Bt+=jt*qe)),ce=n.x-Ot,jt=n.y-Bt,it?ce*ce+jt*jt:new re(Ot,Bt)}function Hx(n){return!yt(n[0])||typeof n[0][0]!="object"&&typeof n[0][0]<"u"}function En(n){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Hx(n)}function Tr(n,d){var k,it,Ot,Bt,ce,jt,Ie,qe;if(!n||n.length===0)throw new Error("latlngs not passed");Hx(n)||(console.warn("latlngs are not flat! Only the first ring will be used"),n=n[0]);var s0=Pe([0,0]),g0=se(n),S0=g0.getNorthWest().distanceTo(g0.getSouthWest())*g0.getNorthEast().distanceTo(g0.getNorthWest());S0<1700&&(s0=ss(n));var wx=n.length,p0=[];for(k=0;k<wx;k++){var Gx=Pe(n[k]);p0.push(d.project(Pe([Gx.lat-s0.lat,Gx.lng-s0.lng])))}for(k=0,it=0;k<wx-1;k++)it+=p0[k].distanceTo(p0[k+1])/2;if(it===0)qe=p0[0];else for(k=0,Bt=0;k<wx-1;k++)if(ce=p0[k],jt=p0[k+1],Ot=ce.distanceTo(jt),Bt+=Ot,Bt>it){Ie=(Bt-it)/Ot,qe=[jt.x-Ie*(jt.x-ce.x),jt.y-Ie*(jt.y-ce.y)];break}var zx=d.unproject(Qt(qe));return Pe([zx.lat+s0.lat,zx.lng+s0.lng])}var os={__proto__:null,simplify:ar,pointToSegmentDistance:Qr,closestPointOnSegment:wr,clipSegment:Sr,_getEdgeIntersection:tn,_getBitCode:pi,_sqClosestPointOnSegment:Or,isFlat:Hx,_flat:En,polylineCenter:Tr},en={project:function(n){return new re(n.lng,n.lat)},unproject:function(n){return new Fe(n.y,n.x)},bounds:new Lt([-180,-90],[180,90])},Rn={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Lt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(n){var d=Math.PI/180,k=this.R,it=n.lat*d,Ot=this.R_MINOR/k,Bt=Math.sqrt(1-Ot*Ot),ce=Bt*Math.sin(it),jt=Math.tan(Math.PI/4-it/2)/Math.pow((1-ce)/(1+ce),Bt/2);return it=-k*Math.log(Math.max(jt,1e-10)),new re(n.lng*d*k,it)},unproject:function(n){for(var d=180/Math.PI,k=this.R,it=this.R_MINOR/k,Ot=Math.sqrt(1-it*it),Bt=Math.exp(-n.y/k),ce=Math.PI/2-2*Math.atan(Bt),jt=0,Ie=.1,qe;jt<15&&Math.abs(Ie)>1e-7;jt++)qe=Ot*Math.sin(ce),qe=Math.pow((1-qe)/(1+qe),Ot/2),Ie=Math.PI/2-2*Math.atan(Bt*qe)-ce,ce+=Ie;return new Fe(ce*d,n.x*d/k)}},xn={__proto__:null,LonLat:en,Mercator:Rn,SphericalMercator:Yt},Bs=de({},Rt,{code:"EPSG:3395",projection:Rn,transformation:function(){var n=.5/(Math.PI*Rn.R);return me(n,.5,-n,.5)}()}),Dn=de({},Rt,{code:"EPSG:4326",projection:en,transformation:me(1/180,1,-1/180,.5)}),ls=de({},It,{projection:en,transformation:me(1,0,-1,0),scale:function(n){return Math.pow(2,n)},zoom:function(n){return Math.log(n)/Math.LN2},distance:function(n,d){var k=d.lng-n.lng,it=d.lat-n.lat;return Math.sqrt(k*k+it*it)},infinite:!0});It.Earth=Rt,It.EPSG3395=Bs,It.EPSG3857=De,It.EPSG900913=Ge,It.EPSG4326=Dn,It.Simple=ls;var si=ue.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(n){return n.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(n){return n&&n.removeLayer(this),this},getPane:function(n){return this._map.getPane(n?this.options[n]||n:this.options.pane)},addInteractiveTarget:function(n){return this._map._targets[I(n)]=this,this},removeInteractiveTarget:function(n){return delete this._map._targets[I(n)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(n){var d=n.target;if(d.hasLayer(this)){if(this._map=d,this._zoomAnimated=d._zoomAnimated,this.getEvents){var k=this.getEvents();d.on(k,this),this.once("remove",function(){d.off(k,this)},this)}this.onAdd(d),this.fire("add"),d.fire("layeradd",{layer:this})}}});N0.include({addLayer:function(n){if(!n._layerAdd)throw new Error("The provided object is not a Layer.");var d=I(n);return this._layers[d]?this:(this._layers[d]=n,n._mapToAdd=this,n.beforeAdd&&n.beforeAdd(this),this.whenReady(n._layerAdd,n),this)},removeLayer:function(n){var d=I(n);return this._layers[d]?(this._loaded&&n.onRemove(this),delete this._layers[d],this._loaded&&(this.fire("layerremove",{layer:n}),n.fire("remove")),n._map=n._mapToAdd=null,this):this},hasLayer:function(n){return I(n)in this._layers},eachLayer:function(n,d){for(var k in this._layers)n.call(d,this._layers[k]);return this},_addLayers:function(n){n=n?yt(n)?n:[n]:[];for(var d=0,k=n.length;d<k;d++)this.addLayer(n[d])},_addZoomLimit:function(n){(!isNaN(n.options.maxZoom)||!isNaN(n.options.minZoom))&&(this._zoomBoundLayers[I(n)]=n,this._updateZoomLevels())},_removeZoomLimit:function(n){var d=I(n);this._zoomBoundLayers[d]&&(delete this._zoomBoundLayers[d],this._updateZoomLevels())},_updateZoomLevels:function(){var n=1/0,d=-1/0,k=this._getZoomSpan();for(var it in this._zoomBoundLayers){var Ot=this._zoomBoundLayers[it].options;n=Ot.minZoom===void 0?n:Math.min(n,Ot.minZoom),d=Ot.maxZoom===void 0?d:Math.max(d,Ot.maxZoom)}this._layersMaxZoom=d===-1/0?void 0:d,this._layersMinZoom=n===1/0?void 0:n,k!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var or=si.extend({initialize:function(n,d){_t(this,d),this._layers={};var k,it;if(n)for(k=0,it=n.length;k<it;k++)this.addLayer(n[k])},addLayer:function(n){var d=this.getLayerId(n);return this._layers[d]=n,this._map&&this._map.addLayer(n),this},removeLayer:function(n){var d=n in this._layers?n:this.getLayerId(n);return this._map&&this._layers[d]&&this._map.removeLayer(this._layers[d]),delete this._layers[d],this},hasLayer:function(n){var d=typeof n=="number"?n:this.getLayerId(n);return d in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(n){var d=Array.prototype.slice.call(arguments,1),k,it;for(k in this._layers)it=this._layers[k],it[n]&&it[n].apply(it,d);return this},onAdd:function(n){this.eachLayer(n.addLayer,n)},onRemove:function(n){this.eachLayer(n.removeLayer,n)},eachLayer:function(n,d){for(var k in this._layers)n.call(d,this._layers[k]);return this},getLayer:function(n){return this._layers[n]},getLayers:function(){var n=[];return this.eachLayer(n.push,n),n},setZIndex:function(n){return this.invoke("setZIndex",n)},getLayerId:function(n){return I(n)}}),hs=function(n,d){return new or(n,d)},mi=or.extend({addLayer:function(n){return this.hasLayer(n)?this:(n.addEventParent(this),or.prototype.addLayer.call(this,n),this.fire("layeradd",{layer:n}))},removeLayer:function(n){return this.hasLayer(n)?(n in this._layers&&(n=this._layers[n]),n.removeEventParent(this),or.prototype.removeLayer.call(this,n),this.fire("layerremove",{layer:n})):this},setStyle:function(n){return this.invoke("setStyle",n)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var n=new be;for(var d in this._layers){var k=this._layers[d];n.extend(k.getBounds?k.getBounds():k.getLatLng())}return n}}),Cn=function(n,d){return new mi(n,d)},Si=tt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(n){_t(this,n)},createIcon:function(n){return this._createIcon("icon",n)},createShadow:function(n){return this._createIcon("shadow",n)},_createIcon:function(n,d){var k=this._getIconUrl(n);if(!k){if(n==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var it=this._createImg(k,d&&d.tagName==="IMG"?d:null);return this._setIconStyles(it,n),(this.options.crossOrigin||this.options.crossOrigin==="")&&(it.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),it},_setIconStyles:function(n,d){var k=this.options,it=k[d+"Size"];typeof it=="number"&&(it=[it,it]);var Ot=Qt(it),Bt=Qt(d==="shadow"&&k.shadowAnchor||k.iconAnchor||Ot&&Ot.divideBy(2,!0));n.className="leaflet-marker-"+d+" "+(k.className||""),Bt&&(n.style.marginLeft=-Bt.x+"px",n.style.marginTop=-Bt.y+"px"),Ot&&(n.style.width=Ot.x+"px",n.style.height=Ot.y+"px")},_createImg:function(n,d){return d=d||document.createElement("img"),d.src=n,d},_getIconUrl:function(n){return h0.retina&&this.options[n+"RetinaUrl"]||this.options[n+"Url"]}});function sa(n){return new Si(n)}var rn=Si.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(n){return typeof rn.imagePath!="string"&&(rn.imagePath=this._detectIconPath()),(this.options.imagePath||rn.imagePath)+Si.prototype._getIconUrl.call(this,n)},_stripUrl:function(n){var d=function(k,it,Ot){var Bt=it.exec(k);return Bt&&Bt[Ot]};return n=d(n,/^url\((['"])?(.+)\1\)$/,2),n&&d(n,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var n=q0("div","leaflet-default-icon-path",document.body),d=Jr(n,"background-image")||Jr(n,"backgroundImage");if(document.body.removeChild(n),d=this._stripUrl(d),d)return d;var k=document.querySelector('link[href$="leaflet.css"]');return k?k.href.substring(0,k.href.length-11-1):""}}),Us=gx.extend({initialize:function(n){this._marker=n},addHooks:function(){var n=this._marker._icon;this._draggable||(this._draggable=new Qi(n,n,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),k0(n,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&dx(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(n){var d=this._marker,k=d._map,it=this._marker.options.autoPanSpeed,Ot=this._marker.options.autoPanPadding,Bt=Ji(d._icon),ce=k.getPixelBounds(),jt=k.getPixelOrigin(),Ie=pe(ce.min._subtract(jt).add(Ot),ce.max._subtract(jt).subtract(Ot));if(!Ie.contains(Bt)){var qe=Qt((Math.max(Ie.max.x,Bt.x)-Ie.max.x)/(ce.max.x-Ie.max.x)-(Math.min(Ie.min.x,Bt.x)-Ie.min.x)/(ce.min.x-Ie.min.x),(Math.max(Ie.max.y,Bt.y)-Ie.max.y)/(ce.max.y-Ie.max.y)-(Math.min(Ie.min.y,Bt.y)-Ie.min.y)/(ce.min.y-Ie.min.y)).multiplyBy(it);k.panBy(qe,{animate:!1}),this._draggable._newPos._add(qe),this._draggable._startPos._add(qe),rx(d._icon,this._draggable._newPos),this._onDrag(n),this._panRequest=ut(this._adjustPan.bind(this,n))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(n){this._marker.options.autoPan&&(Mt(this._panRequest),this._panRequest=ut(this._adjustPan.bind(this,n)))},_onDrag:function(n){var d=this._marker,k=d._shadow,it=Ji(d._icon),Ot=d._map.layerPointToLatLng(it);k&&rx(k,it),d._latlng=Ot,n.latlng=Ot,n.oldLatLng=this._oldLatLng,d.fire("move",n).fire("drag",n)},_onDragEnd:function(n){Mt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",n)}}),kn=si.extend({options:{icon:new rn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(n,d){_t(this,d),this._latlng=Pe(n)},onAdd:function(n){this._zoomAnimated=this._zoomAnimated&&n.options.markerZoomAnimation,this._zoomAnimated&&n.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(n){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&n.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(n){var d=this._latlng;return this._latlng=Pe(n),this.update(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},setZIndexOffset:function(n){return this.options.zIndexOffset=n,this.update()},getIcon:function(){return this.options.icon},setIcon:function(n){return this.options.icon=n,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var n=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(n)}return this},_initIcon:function(){var n=this.options,d="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),k=n.icon.createIcon(this._icon),it=!1;k!==this._icon&&(this._icon&&this._removeIcon(),it=!0,n.title&&(k.title=n.title),k.tagName==="IMG"&&(k.alt=n.alt||"")),k0(k,d),n.keyboard&&(k.tabIndex="0",k.setAttribute("role","button")),this._icon=k,n.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&P0(k,"focus",this._panOnFocus,this);var Ot=n.icon.createShadow(this._shadow),Bt=!1;Ot!==this._shadow&&(this._removeShadow(),Bt=!0),Ot&&(k0(Ot,d),Ot.alt=""),this._shadow=Ot,n.opacity<1&&this._updateOpacity(),it&&this.getPane().appendChild(this._icon),this._initInteraction(),Ot&&Bt&&this.getPane(n.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&tx(this._icon,"focus",this._panOnFocus,this),hx(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&hx(this._shadow),this._shadow=null},_setPos:function(n){this._icon&&rx(this._icon,n),this._shadow&&rx(this._shadow,n),this._zIndex=n.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(n){this._icon&&(this._icon.style.zIndex=this._zIndex+n)},_animateZoom:function(n){var d=this._map._latLngToNewLayerPoint(this._latlng,n.zoom,n.center).round();this._setPos(d)},_initInteraction:function(){if(this.options.interactive&&(k0(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Us)){var n=this.options.draggable;this.dragging&&(n=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Us(this),n&&this.dragging.enable()}},setOpacity:function(n){return this.options.opacity=n,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var n=this.options.opacity;this._icon&&px(this._icon,n),this._shadow&&px(this._shadow,n)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var n=this._map;if(n){var d=this.options.icon.options,k=d.iconSize?Qt(d.iconSize):Qt(0,0),it=d.iconAnchor?Qt(d.iconAnchor):Qt(0,0);n.panInside(this._latlng,{paddingTopLeft:it,paddingBottomRight:k.subtract(it)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function aa(n,d){return new kn(n,d)}var Li=si.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(n){this._renderer=n.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(n){return _t(this,n),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&n&&Object.prototype.hasOwnProperty.call(n,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Mn=Li.extend({options:{fill:!0,radius:10},initialize:function(n,d){_t(this,d),this._latlng=Pe(n),this._radius=this.options.radius},setLatLng:function(n){var d=this._latlng;return this._latlng=Pe(n),this.redraw(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(n){return this.options.radius=this._radius=n,this.redraw()},getRadius:function(){return this._radius},setStyle:function(n){var d=n&&n.radius||this._radius;return Li.prototype.setStyle.call(this,n),this.setRadius(d),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var n=this._radius,d=this._radiusY||n,k=this._clickTolerance(),it=[n+k,d+k];this._pxBounds=new Lt(this._point.subtract(it),this._point.add(it))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(n){return n.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function oa(n,d){return new Mn(n,d)}var us=Mn.extend({initialize:function(n,d,k){if(typeof d=="number"&&(d=de({},k,{radius:d})),_t(this,d),this._latlng=Pe(n),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(n){return this._mRadius=n,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var n=[this._radius,this._radiusY||this._radius];return new be(this._map.layerPointToLatLng(this._point.subtract(n)),this._map.layerPointToLatLng(this._point.add(n)))},setStyle:Li.prototype.setStyle,_project:function(){var n=this._latlng.lng,d=this._latlng.lat,k=this._map,it=k.options.crs;if(it.distance===Rt.distance){var Ot=Math.PI/180,Bt=this._mRadius/Rt.R/Ot,ce=k.project([d+Bt,n]),jt=k.project([d-Bt,n]),Ie=ce.add(jt).divideBy(2),qe=k.unproject(Ie).lat,s0=Math.acos((Math.cos(Bt*Ot)-Math.sin(d*Ot)*Math.sin(qe*Ot))/(Math.cos(d*Ot)*Math.cos(qe*Ot)))/Ot;(isNaN(s0)||s0===0)&&(s0=Bt/Math.cos(Math.PI/180*d)),this._point=Ie.subtract(k.getPixelOrigin()),this._radius=isNaN(s0)?0:Ie.x-k.project([qe,n-s0]).x,this._radiusY=Ie.y-ce.y}else{var g0=it.unproject(it.project(this._latlng).subtract([this._mRadius,0]));this._point=k.latLngToLayerPoint(this._latlng),this._radius=this._point.x-k.latLngToLayerPoint(g0).x}this._updateBounds()}});function la(n,d,k){return new us(n,d,k)}var Oi=Li.extend({options:{smoothFactor:1,noClip:!1},initialize:function(n,d){_t(this,d),this._setLatLngs(n)},getLatLngs:function(){return this._latlngs},setLatLngs:function(n){return this._setLatLngs(n),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(n){for(var d=1/0,k=null,it=Or,Ot,Bt,ce=0,jt=this._parts.length;ce<jt;ce++)for(var Ie=this._parts[ce],qe=1,s0=Ie.length;qe<s0;qe++){Ot=Ie[qe-1],Bt=Ie[qe];var g0=it(n,Ot,Bt,!0);g0<d&&(d=g0,k=it(n,Ot,Bt))}return k&&(k.distance=Math.sqrt(d)),k},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Tr(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(n,d){return d=d||this._defaultShape(),n=Pe(n),d.push(n),this._bounds.extend(n),this.redraw()},_setLatLngs:function(n){this._bounds=new be,this._latlngs=this._convertLatLngs(n)},_defaultShape:function(){return Hx(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(n){for(var d=[],k=Hx(n),it=0,Ot=n.length;it<Ot;it++)k?(d[it]=Pe(n[it]),this._bounds.extend(d[it])):d[it]=this._convertLatLngs(n[it]);return d},_project:function(){var n=new Lt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,n),this._bounds.isValid()&&n.isValid()&&(this._rawPxBounds=n,this._updateBounds())},_updateBounds:function(){var n=this._clickTolerance(),d=new re(n,n);this._rawPxBounds&&(this._pxBounds=new Lt([this._rawPxBounds.min.subtract(d),this._rawPxBounds.max.add(d)]))},_projectLatlngs:function(n,d,k){var it=n[0]instanceof Fe,Ot=n.length,Bt,ce;if(it){for(ce=[],Bt=0;Bt<Ot;Bt++)ce[Bt]=this._map.latLngToLayerPoint(n[Bt]),k.extend(ce[Bt]);d.push(ce)}else for(Bt=0;Bt<Ot;Bt++)this._projectLatlngs(n[Bt],d,k)},_clipPoints:function(){var n=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(n))){if(this.options.noClip){this._parts=this._rings;return}var d=this._parts,k,it,Ot,Bt,ce,jt,Ie;for(k=0,Ot=0,Bt=this._rings.length;k<Bt;k++)for(Ie=this._rings[k],it=0,ce=Ie.length;it<ce-1;it++)jt=Sr(Ie[it],Ie[it+1],n,it,!0),jt&&(d[Ot]=d[Ot]||[],d[Ot].push(jt[0]),(jt[1]!==Ie[it+1]||it===ce-2)&&(d[Ot].push(jt[1]),Ot++))}},_simplifyPoints:function(){for(var n=this._parts,d=this.options.smoothFactor,k=0,it=n.length;k<it;k++)n[k]=ar(n[k],d)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(n,d){var k,it,Ot,Bt,ce,jt,Ie=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(n))return!1;for(k=0,Bt=this._parts.length;k<Bt;k++)for(jt=this._parts[k],it=0,ce=jt.length,Ot=ce-1;it<ce;Ot=it++)if(!(!d&&it===0)&&Qr(n,jt[Ot],jt[it])<=Ie)return!0;return!1}});function ha(n,d){return new Oi(n,d)}Oi._flat=En;var Ar=Oi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return zs(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(n){var d=Oi.prototype._convertLatLngs.call(this,n),k=d.length;return k>=2&&d[0]instanceof Fe&&d[0].equals(d[k-1])&&d.pop(),d},_setLatLngs:function(n){Oi.prototype._setLatLngs.call(this,n),Hx(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Hx(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var n=this._renderer._bounds,d=this.options.weight,k=new re(d,d);if(n=new Lt(n.min.subtract(k),n.max.add(k)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(n))){if(this.options.noClip){this._parts=this._rings;return}for(var it=0,Ot=this._rings.length,Bt;it<Ot;it++)Bt=Ms(this._rings[it],n,!0),Bt.length&&this._parts.push(Bt)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(n){var d=!1,k,it,Ot,Bt,ce,jt,Ie,qe;if(!this._pxBounds||!this._pxBounds.contains(n))return!1;for(Bt=0,Ie=this._parts.length;Bt<Ie;Bt++)for(k=this._parts[Bt],ce=0,qe=k.length,jt=qe-1;ce<qe;jt=ce++)it=k[ce],Ot=k[jt],it.y>n.y!=Ot.y>n.y&&n.x<(Ot.x-it.x)*(n.y-it.y)/(Ot.y-it.y)+it.x&&(d=!d);return d||Oi.prototype._containsPoint.call(this,n,!0)}});function gi(n,d){return new Ar(n,d)}var F0=mi.extend({initialize:function(n,d){_t(this,d),this._layers={},n&&this.addData(n)},addData:function(n){var d=yt(n)?n:n.features,k,it,Ot;if(d){for(k=0,it=d.length;k<it;k++)Ot=d[k],(Ot.geometries||Ot.geometry||Ot.features||Ot.coordinates)&&this.addData(Ot);return this}var Bt=this.options;if(Bt.filter&&!Bt.filter(n))return this;var ce=vi(n,Bt);return ce?(ce.feature=Er(n),ce.defaultOptions=ce.options,this.resetStyle(ce),Bt.onEachFeature&&Bt.onEachFeature(n,ce),this.addLayer(ce)):this},resetStyle:function(n){return n===void 0?this.eachLayer(this.resetStyle,this):(n.options=de({},n.defaultOptions),this._setLayerStyle(n,this.options.style),this)},setStyle:function(n){return this.eachLayer(function(d){this._setLayerStyle(d,n)},this)},_setLayerStyle:function(n,d){n.setStyle&&(typeof d=="function"&&(d=d(n.feature)),n.setStyle(d))}});function vi(n,d){var k=n.type==="Feature"?n.geometry:n,it=k?k.coordinates:null,Ot=[],Bt=d&&d.pointToLayer,ce=d&&d.coordsToLatLng||Ai,jt,Ie,qe,s0;if(!it&&!k)return null;switch(k.type){case"Point":return jt=ce(it),Ti(Bt,n,jt,d);case"MultiPoint":for(qe=0,s0=it.length;qe<s0;qe++)jt=ce(it[qe]),Ot.push(Ti(Bt,n,jt,d));return new mi(Ot);case"LineString":case"MultiLineString":return Ie=w0(it,k.type==="LineString"?0:1,ce),new Oi(Ie,d);case"Polygon":case"MultiPolygon":return Ie=w0(it,k.type==="Polygon"?1:2,ce),new Ar(Ie,d);case"GeometryCollection":for(qe=0,s0=k.geometries.length;qe<s0;qe++){var g0=vi({geometry:k.geometries[qe],type:"Feature",properties:n.properties},d);g0&&Ot.push(g0)}return new mi(Ot);case"FeatureCollection":for(qe=0,s0=k.features.length;qe<s0;qe++){var S0=vi(k.features[qe],d);S0&&Ot.push(S0)}return new mi(Ot);default:throw new Error("Invalid GeoJSON object.")}}function Ti(n,d,k,it){return n?n(d,k):new kn(k,it&&it.markersInheritOptions&&it)}function Ai(n){return new Fe(n[1],n[0],n[2])}function w0(n,d,k){for(var it=[],Ot=0,Bt=n.length,ce;Ot<Bt;Ot++)ce=d?w0(n[Ot],d-1,k):(k||Ai)(n[Ot]),it.push(ce);return it}function bx(n,d){return n=Pe(n),n.alt!==void 0?[at(n.lng,d),at(n.lat,d),at(n.alt,d)]:[at(n.lng,d),at(n.lat,d)]}function Ir(n,d,k,it){for(var Ot=[],Bt=0,ce=n.length;Bt<ce;Bt++)Ot.push(d?Ir(n[Bt],Hx(n[Bt])?0:d-1,k,it):bx(n[Bt],it));return!d&&k&&Ot.length>0&&Ot.push(Ot[0].slice()),Ot}function ji(n,d){return n.feature?de({},n.feature,{geometry:d}):Er(d)}function Er(n){return n.type==="Feature"||n.type==="FeatureCollection"?n:{type:"Feature",properties:{},geometry:n}}var Fx={toGeoJSON:function(n){return ji(this,{type:"Point",coordinates:bx(this.getLatLng(),n)})}};kn.include(Fx),us.include(Fx),Mn.include(Fx),Oi.include({toGeoJSON:function(n){var d=!Hx(this._latlngs),k=Ir(this._latlngs,d?1:0,!1,n);return ji(this,{type:(d?"Multi":"")+"LineString",coordinates:k})}}),Ar.include({toGeoJSON:function(n){var d=!Hx(this._latlngs),k=d&&!Hx(this._latlngs[0]),it=Ir(this._latlngs,k?2:d?1:0,!0,n);return d||(it=[it]),ji(this,{type:(k?"Multi":"")+"Polygon",coordinates:it})}}),or.include({toMultiPoint:function(n){var d=[];return this.eachLayer(function(k){d.push(k.toGeoJSON(n).geometry.coordinates)}),ji(this,{type:"MultiPoint",coordinates:d})},toGeoJSON:function(n){var d=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(d==="MultiPoint")return this.toMultiPoint(n);var k=d==="GeometryCollection",it=[];return this.eachLayer(function(Ot){if(Ot.toGeoJSON){var Bt=Ot.toGeoJSON(n);if(k)it.push(Bt.geometry);else{var ce=Er(Bt);ce.type==="FeatureCollection"?it.push.apply(it,ce.features):it.push(ce)}}}),k?ji(this,{geometries:it,type:"GeometryCollection"}):{type:"FeatureCollection",features:it}}});function lr(n,d){return new F0(n,d)}var Tx=lr,Sx=si.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(n,d,k){this._url=n,this._bounds=se(d),_t(this,k)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(k0(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){hx(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(n){return this.options.opacity=n,this._image&&this._updateOpacity(),this},setStyle:function(n){return n.opacity&&this.setOpacity(n.opacity),this},bringToFront:function(){return this._map&&qi(this._image),this},bringToBack:function(){return this._map&&Zi(this._image),this},setUrl:function(n){return this._url=n,this._image&&(this._image.src=n),this},setBounds:function(n){return this._bounds=se(n),this._map&&this._reset(),this},getEvents:function(){var n={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(n.zoomanim=this._animateZoom),n},setZIndex:function(n){return this.options.zIndex=n,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var n=this._url.tagName==="IMG",d=this._image=n?this._url:q0("img");if(k0(d,"leaflet-image-layer"),this._zoomAnimated&&k0(d,"leaflet-zoom-animated"),this.options.className&&k0(d,this.options.className),d.onselectstart=ft,d.onmousemove=ft,d.onload=Dt(this.fire,this,"load"),d.onerror=Dt(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(d.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),n){this._url=d.src;return}d.src=this._url,d.alt=this.options.alt},_animateZoom:function(n){var d=this._map.getZoomScale(n.zoom),k=this._map._latLngBoundsToNewLayerBounds(this._bounds,n.zoom,n.center).min;Ux(this._image,k,d)},_reset:function(){var n=this._image,d=new Lt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),k=d.getSize();rx(n,d.min),n.style.width=k.x+"px",n.style.height=k.y+"px"},_updateOpacity:function(){px(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var n=this.options.errorOverlayUrl;n&&this._url!==n&&(this._url=n,this._image.src=n)},getCenter:function(){return this._bounds.getCenter()}}),zn=function(n,d,k){return new Sx(n,d,k)},Ii=Sx.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var n=this._url.tagName==="VIDEO",d=this._image=n?this._url:q0("video");if(k0(d,"leaflet-image-layer"),this._zoomAnimated&&k0(d,"leaflet-zoom-animated"),this.options.className&&k0(d,this.options.className),d.onselectstart=ft,d.onmousemove=ft,d.onloadeddata=Dt(this.fire,this,"load"),n){for(var k=d.getElementsByTagName("source"),it=[],Ot=0;Ot<k.length;Ot++)it.push(k[Ot].src);this._url=k.length>0?it:[d.src];return}yt(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(d.style,"objectFit")&&(d.style.objectFit="fill"),d.autoplay=!!this.options.autoplay,d.loop=!!this.options.loop,d.muted=!!this.options.muted,d.playsInline=!!this.options.playsInline;for(var Bt=0;Bt<this._url.length;Bt++){var ce=q0("source");ce.src=this._url[Bt],d.appendChild(ce)}}});function Bn(n,d,k){return new Ii(n,d,k)}var hr=Sx.extend({_initImage:function(){var n=this._image=this._url;k0(n,"leaflet-image-layer"),this._zoomAnimated&&k0(n,"leaflet-zoom-animated"),this.options.className&&k0(n,this.options.className),n.onselectstart=ft,n.onmousemove=ft}});function nx(n,d,k){return new hr(n,d,k)}var Kx=si.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(n,d){n&&(n instanceof Fe||yt(n))?(this._latlng=Pe(n),_t(this,d)):(_t(this,n),this._source=d),this.options.content&&(this._content=this.options.content)},openOn:function(n){return n=arguments.length?n:this._source._map,n.hasLayer(this)||n.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(n){return this._map?this.close():(arguments.length?this._source=n:n=this._source,this._prepareOpen(),this.openOn(n._map)),this},onAdd:function(n){this._zoomAnimated=n._zoomAnimated,this._container||this._initLayout(),n._fadeAnimated&&px(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),n._fadeAnimated&&px(this._container,1),this.bringToFront(),this.options.interactive&&(k0(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(n){n._fadeAnimated?(px(this._container,0),this._removeTimeout=setTimeout(Dt(hx,void 0,this._container),200)):hx(this._container),this.options.interactive&&(dx(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(n){return this._latlng=Pe(n),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(n){return this._content=n,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var n={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(n.zoomanim=this._animateZoom),n},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&qi(this._container),this},bringToBack:function(){return this._map&&Zi(this._container),this},_prepareOpen:function(n){var d=this._source;if(!d._map)return!1;if(d instanceof mi){d=null;var k=this._source._layers;for(var it in k)if(k[it]._map){d=k[it];break}if(!d)return!1;this._source=d}if(!n)if(d.getCenter)n=d.getCenter();else if(d.getLatLng)n=d.getLatLng();else if(d.getBounds)n=d.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(n),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var n=this._contentNode,d=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof d=="string")n.innerHTML=d;else{for(;n.hasChildNodes();)n.removeChild(n.firstChild);n.appendChild(d)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var n=this._map.latLngToLayerPoint(this._latlng),d=Qt(this.options.offset),k=this._getAnchor();this._zoomAnimated?rx(this._container,n.add(k)):d=d.add(n).add(k);var it=this._containerBottom=-d.y,Ot=this._containerLeft=-Math.round(this._containerWidth/2)+d.x;this._container.style.bottom=it+"px",this._container.style.left=Ot+"px"}},_getAnchor:function(){return[0,0]}});N0.include({_initOverlay:function(n,d,k,it){var Ot=d;return Ot instanceof n||(Ot=new n(it).setContent(d)),k&&Ot.setLatLng(k),Ot}}),si.include({_initOverlay:function(n,d,k,it){var Ot=k;return Ot instanceof n?(_t(Ot,it),Ot._source=this):(Ot=d&&!it?d:new n(it,this),Ot.setContent(k)),Ot}});var yi=Kx.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(n){return n=arguments.length?n:this._source._map,!n.hasLayer(this)&&n._popup&&n._popup.options.autoClose&&n.removeLayer(n._popup),n._popup=this,Kx.prototype.openOn.call(this,n)},onAdd:function(n){Kx.prototype.onAdd.call(this,n),n.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Li||this._source.on("preclick",wi))},onRemove:function(n){Kx.prototype.onRemove.call(this,n),n.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Li||this._source.off("preclick",wi))},getEvents:function(){var n=Kx.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(n.preclick=this.close),this.options.keepInView&&(n.moveend=this._adjustPan),n},_initLayout:function(){var n="leaflet-popup",d=this._container=q0("div",n+" "+(this.options.className||"")+" leaflet-zoom-animated"),k=this._wrapper=q0("div",n+"-content-wrapper",d);if(this._contentNode=q0("div",n+"-content",k),Ki(d),$r(this._contentNode),P0(d,"contextmenu",wi),this._tipContainer=q0("div",n+"-tip-container",d),this._tip=q0("div",n+"-tip",this._tipContainer),this.options.closeButton){var it=this._closeButton=q0("a",n+"-close-button",d);it.setAttribute("role","button"),it.setAttribute("aria-label","Close popup"),it.href="#close",it.innerHTML='<span aria-hidden="true">&#215;</span>',P0(it,"click",function(Ot){mx(Ot),this.close()},this)}},_updateLayout:function(){var n=this._contentNode,d=n.style;d.width="",d.whiteSpace="nowrap";var k=n.offsetWidth;k=Math.min(k,this.options.maxWidth),k=Math.max(k,this.options.minWidth),d.width=k+1+"px",d.whiteSpace="",d.height="";var it=n.offsetHeight,Ot=this.options.maxHeight,Bt="leaflet-popup-scrolled";Ot&&it>Ot?(d.height=Ot+"px",k0(n,Bt)):dx(n,Bt),this._containerWidth=this._container.offsetWidth},_animateZoom:function(n){var d=this._map._latLngToNewLayerPoint(this._latlng,n.zoom,n.center),k=this._getAnchor();rx(this._container,d.add(k))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var n=this._map,d=parseInt(Jr(this._container,"marginBottom"),10)||0,k=this._container.offsetHeight+d,it=this._containerWidth,Ot=new re(this._containerLeft,-k-this._containerBottom);Ot._add(Ji(this._container));var Bt=n.layerPointToContainerPoint(Ot),ce=Qt(this.options.autoPanPadding),jt=Qt(this.options.autoPanPaddingTopLeft||ce),Ie=Qt(this.options.autoPanPaddingBottomRight||ce),qe=n.getSize(),s0=0,g0=0;Bt.x+it+Ie.x>qe.x&&(s0=Bt.x+it-qe.x+Ie.x),Bt.x-s0-jt.x<0&&(s0=Bt.x-jt.x),Bt.y+k+Ie.y>qe.y&&(g0=Bt.y+k-qe.y+Ie.y),Bt.y-g0-jt.y<0&&(g0=Bt.y-jt.y),(s0||g0)&&(this.options.keepInView&&(this._autopanning=!0),n.fire("autopanstart").panBy([s0,g0]))}},_getAnchor:function(){return Qt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ur=function(n,d){return new yi(n,d)};N0.mergeOptions({closePopupOnClick:!0}),N0.include({openPopup:function(n,d,k){return this._initOverlay(yi,n,d,k).openOn(this),this},closePopup:function(n){return n=arguments.length?n:this._popup,n&&n.close(),this}}),si.include({bindPopup:function(n,d){return this._popup=this._initOverlay(yi,this._popup,n,d),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(n){return this._popup&&(this instanceof mi||(this._popup._source=this),this._popup._prepareOpen(n||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(n){return this._popup&&this._popup.setContent(n),this},getPopup:function(){return this._popup},_openPopup:function(n){if(!(!this._popup||!this._map)){Yi(n);var d=n.layer||n.target;if(this._popup._source===d&&!(d instanceof Li)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(n.latlng);return}this._popup._source=d,this.openPopup(n.latlng)}},_movePopup:function(n){this._popup.setLatLng(n.latlng)},_onKeyPress:function(n){n.originalEvent.keyCode===13&&this._openPopup(n)}});var jx=Kx.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(n){Kx.prototype.onAdd.call(this,n),this.setOpacity(this.options.opacity),n.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(n){Kx.prototype.onRemove.call(this,n),n.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var n=Kx.prototype.getEvents.call(this);return this.options.permanent||(n.preclick=this.close),n},_initLayout:function(){var n="leaflet-tooltip",d=n+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=q0("div",d),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+I(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(n){var d,k,it=this._map,Ot=this._container,Bt=it.latLngToContainerPoint(it.getCenter()),ce=it.layerPointToContainerPoint(n),jt=this.options.direction,Ie=Ot.offsetWidth,qe=Ot.offsetHeight,s0=Qt(this.options.offset),g0=this._getAnchor();jt==="top"?(d=Ie/2,k=qe):jt==="bottom"?(d=Ie/2,k=0):jt==="center"?(d=Ie/2,k=qe/2):jt==="right"?(d=0,k=qe/2):jt==="left"?(d=Ie,k=qe/2):ce.x<Bt.x?(jt="right",d=0,k=qe/2):(jt="left",d=Ie+(s0.x+g0.x)*2,k=qe/2),n=n.subtract(Qt(d,k,!0)).add(s0).add(g0),dx(Ot,"leaflet-tooltip-right"),dx(Ot,"leaflet-tooltip-left"),dx(Ot,"leaflet-tooltip-top"),dx(Ot,"leaflet-tooltip-bottom"),k0(Ot,"leaflet-tooltip-"+jt),rx(Ot,n)},_updatePosition:function(){var n=this._map.latLngToLayerPoint(this._latlng);this._setPosition(n)},setOpacity:function(n){this.options.opacity=n,this._container&&px(this._container,n)},_animateZoom:function(n){var d=this._map._latLngToNewLayerPoint(this._latlng,n.zoom,n.center);this._setPosition(d)},_getAnchor:function(){return Qt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ds=function(n,d){return new jx(n,d)};N0.include({openTooltip:function(n,d,k){return this._initOverlay(jx,n,d,k).openOn(this),this},closeTooltip:function(n){return n.close(),this}}),si.include({bindTooltip:function(n,d){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(jx,this._tooltip,n,d),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(n){if(!(!n&&this._tooltipHandlersAdded)){var d=n?"off":"on",k={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?k.add=this._openTooltip:(k.mouseover=this._openTooltip,k.mouseout=this.closeTooltip,k.click=this._openTooltip,this._map?this._addFocusListeners():k.add=this._addFocusListeners),this._tooltip.options.sticky&&(k.mousemove=this._moveTooltip),this[d](k),this._tooltipHandlersAdded=!n}},openTooltip:function(n){return this._tooltip&&(this instanceof mi||(this._tooltip._source=this),this._tooltip._prepareOpen(n)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(n){return this._tooltip&&this._tooltip.setContent(n),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(n){var d=typeof n.getElement=="function"&&n.getElement();d&&(P0(d,"focus",function(){this._tooltip._source=n,this.openTooltip()},this),P0(d,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(n){var d=typeof n.getElement=="function"&&n.getElement();d&&d.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(n){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var d=this;this._map.once("moveend",function(){d._openOnceFlag=!1,d._openTooltip(n)});return}this._tooltip._source=n.layer||n.target,this.openTooltip(this._tooltip.options.sticky?n.latlng:void 0)}},_moveTooltip:function(n){var d=n.latlng,k,it;this._tooltip.options.sticky&&n.originalEvent&&(k=this._map.mouseEventToContainerPoint(n.originalEvent),it=this._map.containerPointToLayerPoint(k),d=this._map.layerPointToLatLng(it)),this._tooltip.setLatLng(d)}});var nn=Si.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(n){var d=n&&n.tagName==="DIV"?n:document.createElement("div"),k=this.options;if(k.html instanceof Element?(bn(d),d.appendChild(k.html)):d.innerHTML=k.html!==!1?k.html:"",k.bgPos){var it=Qt(k.bgPos);d.style.backgroundPosition=-it.x+"px "+-it.y+"px"}return this._setIconStyles(d,"icon"),d},createShadow:function(){return null}});function Rr(n){return new nn(n)}Si.Default=rn;var Dr=si.extend({options:{tileSize:256,opacity:1,updateWhenIdle:h0.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(n){_t(this,n)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(n){n._addZoomLimit(this)},onRemove:function(n){this._removeAllTiles(),hx(this._container),n._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(qi(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Zi(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(n){return this.options.opacity=n,this._updateOpacity(),this},setZIndex:function(n){return this.options.zIndex=n,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var n=this._clampZoom(this._map.getZoom());n!==this._tileZoom&&(this._tileZoom=n,this._updateLevels()),this._update()}return this},getEvents:function(){var n={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=At(this._onMoveEnd,this.options.updateInterval,this)),n.move=this._onMove),this._zoomAnimated&&(n.zoomanim=this._animateZoom),n},createTile:function(){return document.createElement("div")},getTileSize:function(){var n=this.options.tileSize;return n instanceof re?n:new re(n,n)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(n){for(var d=this.getPane().children,k=-n(-1/0,1/0),it=0,Ot=d.length,Bt;it<Ot;it++)Bt=d[it].style.zIndex,d[it]!==this._container&&Bt&&(k=n(k,+Bt));isFinite(k)&&(this.options.zIndex=k+n(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!h0.ielt9){px(this._container,this.options.opacity);var n=+new Date,d=!1,k=!1;for(var it in this._tiles){var Ot=this._tiles[it];if(!(!Ot.current||!Ot.loaded)){var Bt=Math.min(1,(n-Ot.loaded)/200);px(Ot.el,Bt),Bt<1?d=!0:(Ot.active?k=!0:this._onOpaqueTile(Ot),Ot.active=!0)}}k&&!this._noPrune&&this._pruneTiles(),d&&(Mt(this._fadeFrame),this._fadeFrame=ut(this._updateOpacity,this))}},_onOpaqueTile:ft,_initContainer:function(){this._container||(this._container=q0("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var n=this._tileZoom,d=this.options.maxZoom;if(n!==void 0){for(var k in this._levels)k=Number(k),this._levels[k].el.children.length||k===n?(this._levels[k].el.style.zIndex=d-Math.abs(n-k),this._onUpdateLevel(k)):(hx(this._levels[k].el),this._removeTilesAtZoom(k),this._onRemoveLevel(k),delete this._levels[k]);var it=this._levels[n],Ot=this._map;return it||(it=this._levels[n]={},it.el=q0("div","leaflet-tile-container leaflet-zoom-animated",this._container),it.el.style.zIndex=d,it.origin=Ot.project(Ot.unproject(Ot.getPixelOrigin()),n).round(),it.zoom=n,this._setZoomTransform(it,Ot.getCenter(),Ot.getZoom()),ft(it.el.offsetWidth),this._onCreateLevel(it)),this._level=it,it}},_onUpdateLevel:ft,_onRemoveLevel:ft,_onCreateLevel:ft,_pruneTiles:function(){if(this._map){var n,d,k=this._map.getZoom();if(k>this.options.maxZoom||k<this.options.minZoom){this._removeAllTiles();return}for(n in this._tiles)d=this._tiles[n],d.retain=d.current;for(n in this._tiles)if(d=this._tiles[n],d.current&&!d.active){var it=d.coords;this._retainParent(it.x,it.y,it.z,it.z-5)||this._retainChildren(it.x,it.y,it.z,it.z+2)}for(n in this._tiles)this._tiles[n].retain||this._removeTile(n)}},_removeTilesAtZoom:function(n){for(var d in this._tiles)this._tiles[d].coords.z===n&&this._removeTile(d)},_removeAllTiles:function(){for(var n in this._tiles)this._removeTile(n)},_invalidateAll:function(){for(var n in this._levels)hx(this._levels[n].el),this._onRemoveLevel(Number(n)),delete this._levels[n];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(n,d,k,it){var Ot=Math.floor(n/2),Bt=Math.floor(d/2),ce=k-1,jt=new re(+Ot,+Bt);jt.z=+ce;var Ie=this._tileCoordsToKey(jt),qe=this._tiles[Ie];return qe&&qe.active?(qe.retain=!0,!0):(qe&&qe.loaded&&(qe.retain=!0),ce>it?this._retainParent(Ot,Bt,ce,it):!1)},_retainChildren:function(n,d,k,it){for(var Ot=2*n;Ot<2*n+2;Ot++)for(var Bt=2*d;Bt<2*d+2;Bt++){var ce=new re(Ot,Bt);ce.z=k+1;var jt=this._tileCoordsToKey(ce),Ie=this._tiles[jt];if(Ie&&Ie.active){Ie.retain=!0;continue}else Ie&&Ie.loaded&&(Ie.retain=!0);k+1<it&&this._retainChildren(Ot,Bt,k+1,it)}},_resetView:function(n){var d=n&&(n.pinch||n.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),d,d)},_animateZoom:function(n){this._setView(n.center,n.zoom,!0,n.noUpdate)},_clampZoom:function(n){var d=this.options;return d.minNativeZoom!==void 0&&n<d.minNativeZoom?d.minNativeZoom:d.maxNativeZoom!==void 0&&d.maxNativeZoom<n?d.maxNativeZoom:n},_setView:function(n,d,k,it){var Ot=Math.round(d);this.options.maxZoom!==void 0&&Ot>this.options.maxZoom||this.options.minZoom!==void 0&&Ot<this.options.minZoom?Ot=void 0:Ot=this._clampZoom(Ot);var Bt=this.options.updateWhenZooming&&Ot!==this._tileZoom;(!it||Bt)&&(this._tileZoom=Ot,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),Ot!==void 0&&this._update(n),k||this._pruneTiles(),this._noPrune=!!k),this._setZoomTransforms(n,d)},_setZoomTransforms:function(n,d){for(var k in this._levels)this._setZoomTransform(this._levels[k],n,d)},_setZoomTransform:function(n,d,k){var it=this._map.getZoomScale(k,n.zoom),Ot=n.origin.multiplyBy(it).subtract(this._map._getNewPixelOrigin(d,k)).round();h0.any3d?Ux(n.el,Ot,it):rx(n.el,Ot)},_resetGrid:function(){var n=this._map,d=n.options.crs,k=this._tileSize=this.getTileSize(),it=this._tileZoom,Ot=this._map.getPixelWorldBounds(this._tileZoom);Ot&&(this._globalTileRange=this._pxBoundsToTileRange(Ot)),this._wrapX=d.wrapLng&&!this.options.noWrap&&[Math.floor(n.project([0,d.wrapLng[0]],it).x/k.x),Math.ceil(n.project([0,d.wrapLng[1]],it).x/k.y)],this._wrapY=d.wrapLat&&!this.options.noWrap&&[Math.floor(n.project([d.wrapLat[0],0],it).y/k.x),Math.ceil(n.project([d.wrapLat[1],0],it).y/k.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(n){var d=this._map,k=d._animatingZoom?Math.max(d._animateToZoom,d.getZoom()):d.getZoom(),it=d.getZoomScale(k,this._tileZoom),Ot=d.project(n,this._tileZoom).floor(),Bt=d.getSize().divideBy(it*2);return new Lt(Ot.subtract(Bt),Ot.add(Bt))},_update:function(n){var d=this._map;if(d){var k=this._clampZoom(d.getZoom());if(n===void 0&&(n=d.getCenter()),this._tileZoom!==void 0){var it=this._getTiledPixelBounds(n),Ot=this._pxBoundsToTileRange(it),Bt=Ot.getCenter(),ce=[],jt=this.options.keepBuffer,Ie=new Lt(Ot.getBottomLeft().subtract([jt,-jt]),Ot.getTopRight().add([jt,-jt]));if(!(isFinite(Ot.min.x)&&isFinite(Ot.min.y)&&isFinite(Ot.max.x)&&isFinite(Ot.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var qe in this._tiles){var s0=this._tiles[qe].coords;(s0.z!==this._tileZoom||!Ie.contains(new re(s0.x,s0.y)))&&(this._tiles[qe].current=!1)}if(Math.abs(k-this._tileZoom)>1){this._setView(n,k);return}for(var g0=Ot.min.y;g0<=Ot.max.y;g0++)for(var S0=Ot.min.x;S0<=Ot.max.x;S0++){var wx=new re(S0,g0);if(wx.z=this._tileZoom,!!this._isValidTile(wx)){var p0=this._tiles[this._tileCoordsToKey(wx)];p0?p0.current=!0:ce.push(wx)}}if(ce.sort(function(zx,xr){return zx.distanceTo(Bt)-xr.distanceTo(Bt)}),ce.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Gx=document.createDocumentFragment();for(S0=0;S0<ce.length;S0++)this._addTile(ce[S0],Gx);this._level.el.appendChild(Gx)}}}},_isValidTile:function(n){var d=this._map.options.crs;if(!d.infinite){var k=this._globalTileRange;if(!d.wrapLng&&(n.x<k.min.x||n.x>k.max.x)||!d.wrapLat&&(n.y<k.min.y||n.y>k.max.y))return!1}if(!this.options.bounds)return!0;var it=this._tileCoordsToBounds(n);return se(this.options.bounds).overlaps(it)},_keyToBounds:function(n){return this._tileCoordsToBounds(this._keyToTileCoords(n))},_tileCoordsToNwSe:function(n){var d=this._map,k=this.getTileSize(),it=n.scaleBy(k),Ot=it.add(k),Bt=d.unproject(it,n.z),ce=d.unproject(Ot,n.z);return[Bt,ce]},_tileCoordsToBounds:function(n){var d=this._tileCoordsToNwSe(n),k=new be(d[0],d[1]);return this.options.noWrap||(k=this._map.wrapLatLngBounds(k)),k},_tileCoordsToKey:function(n){return n.x+":"+n.y+":"+n.z},_keyToTileCoords:function(n){var d=n.split(":"),k=new re(+d[0],+d[1]);return k.z=+d[2],k},_removeTile:function(n){var d=this._tiles[n];d&&(hx(d.el),delete this._tiles[n],this.fire("tileunload",{tile:d.el,coords:this._keyToTileCoords(n)}))},_initTile:function(n){k0(n,"leaflet-tile");var d=this.getTileSize();n.style.width=d.x+"px",n.style.height=d.y+"px",n.onselectstart=ft,n.onmousemove=ft,h0.ielt9&&this.options.opacity<1&&px(n,this.options.opacity)},_addTile:function(n,d){var k=this._getTilePos(n),it=this._tileCoordsToKey(n),Ot=this.createTile(this._wrapCoords(n),Dt(this._tileReady,this,n));this._initTile(Ot),this.createTile.length<2&&ut(Dt(this._tileReady,this,n,null,Ot)),rx(Ot,k),this._tiles[it]={el:Ot,coords:n,current:!0},d.appendChild(Ot),this.fire("tileloadstart",{tile:Ot,coords:n})},_tileReady:function(n,d,k){d&&this.fire("tileerror",{error:d,tile:k,coords:n});var it=this._tileCoordsToKey(n);k=this._tiles[it],k&&(k.loaded=+new Date,this._map._fadeAnimated?(px(k.el,0),Mt(this._fadeFrame),this._fadeFrame=ut(this._updateOpacity,this)):(k.active=!0,this._pruneTiles()),d||(k0(k.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:k.el,coords:n})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),h0.ielt9||!this._map._fadeAnimated?ut(this._pruneTiles,this):setTimeout(Dt(this._pruneTiles,this),250)))},_getTilePos:function(n){return n.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(n){var d=new re(this._wrapX?Nt(n.x,this._wrapX):n.x,this._wrapY?Nt(n.y,this._wrapY):n.y);return d.z=n.z,d},_pxBoundsToTileRange:function(n){var d=this.getTileSize();return new Lt(n.min.unscaleBy(d).floor(),n.max.unscaleBy(d).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var n in this._tiles)if(!this._tiles[n].loaded)return!1;return!0}});function Ns(n){return new Dr(n)}var Ei=Dr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(n,d){this._url=n,d=_t(this,d),d.detectRetina&&h0.retina&&d.maxZoom>0?(d.tileSize=Math.floor(d.tileSize/2),d.zoomReverse?(d.zoomOffset--,d.minZoom=Math.min(d.maxZoom,d.minZoom+1)):(d.zoomOffset++,d.maxZoom=Math.max(d.minZoom,d.maxZoom-1)),d.minZoom=Math.max(0,d.minZoom)):d.zoomReverse?d.minZoom=Math.min(d.maxZoom,d.minZoom):d.maxZoom=Math.max(d.minZoom,d.maxZoom),typeof d.subdomains=="string"&&(d.subdomains=d.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(n,d){return this._url===n&&d===void 0&&(d=!0),this._url=n,d||this.redraw(),this},createTile:function(n,d){var k=document.createElement("img");return P0(k,"load",Dt(this._tileOnLoad,this,d,k)),P0(k,"error",Dt(this._tileOnError,this,d,k)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(k.referrerPolicy=this.options.referrerPolicy),k.alt="",k.src=this.getTileUrl(n),k},getTileUrl:function(n){var d={r:h0.retina?"@2x":"",s:this._getSubdomain(n),x:n.x,y:n.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var k=this._globalTileRange.max.y-n.y;this.options.tms&&(d.y=k),d["-y"]=k}return St(this._url,de(d,this.options))},_tileOnLoad:function(n,d){h0.ielt9?setTimeout(Dt(n,this,null,d),0):n(null,d)},_tileOnError:function(n,d,k){var it=this.options.errorTileUrl;it&&d.getAttribute("src")!==it&&(d.src=it),n(k,d)},_onTileRemove:function(n){n.tile.onload=null},_getZoomForUrl:function(){var n=this._tileZoom,d=this.options.maxZoom,k=this.options.zoomReverse,it=this.options.zoomOffset;return k&&(n=d-n),n+it},_getSubdomain:function(n){var d=Math.abs(n.x+n.y)%this.options.subdomains.length;return this.options.subdomains[d]},_abortLoading:function(){var n,d;for(n in this._tiles)if(this._tiles[n].coords.z!==this._tileZoom&&(d=this._tiles[n].el,d.onload=ft,d.onerror=ft,!d.complete)){d.src=lt;var k=this._tiles[n].coords;hx(d),delete this._tiles[n],this.fire("tileabort",{tile:d,coords:k})}},_removeTile:function(n){var d=this._tiles[n];if(d)return d.el.setAttribute("src",lt),Dr.prototype._removeTile.call(this,n)},_tileReady:function(n,d,k){if(!(!this._map||k&&k.getAttribute("src")===lt))return Dr.prototype._tileReady.call(this,n,d,k)}});function tr(n,d){return new Ei(n,d)}var fs=Ei.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(n,d){this._url=n;var k=de({},this.defaultWmsParams);for(var it in d)it in this.options||(k[it]=d[it]);d=_t(this,d);var Ot=d.detectRetina&&h0.retina?2:1,Bt=this.getTileSize();k.width=Bt.x*Ot,k.height=Bt.y*Ot,this.wmsParams=k},onAdd:function(n){this._crs=this.options.crs||n.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var d=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[d]=this._crs.code,Ei.prototype.onAdd.call(this,n)},getTileUrl:function(n){var d=this._tileCoordsToNwSe(n),k=this._crs,it=pe(k.project(d[0]),k.project(d[1])),Ot=it.min,Bt=it.max,ce=(this._wmsVersion>=1.3&&this._crs===Dn?[Ot.y,Ot.x,Bt.y,Bt.x]:[Ot.x,Ot.y,Bt.x,Bt.y]).join(","),jt=Ei.prototype.getTileUrl.call(this,n);return jt+rt(this.wmsParams,jt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ce},setParams:function(n,d){return de(this.wmsParams,n),d||this.redraw(),this}});function Fs(n,d){return new fs(n,d)}Ei.WMS=fs,tr.wms=Fs;var ai=si.extend({options:{padding:.1},initialize:function(n){_t(this,n),I(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),k0(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var n={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(n.zoomanim=this._onAnimZoom),n},_onAnimZoom:function(n){this._updateTransform(n.center,n.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(n,d){var k=this._map.getZoomScale(d,this._zoom),it=this._map.getSize().multiplyBy(.5+this.options.padding),Ot=this._map.project(this._center,d),Bt=it.multiplyBy(-k).add(Ot).subtract(this._map._getNewPixelOrigin(n,d));h0.any3d?Ux(this._container,Bt,k):rx(this._container,Bt)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var n in this._layers)this._layers[n]._reset()},_onZoomEnd:function(){for(var n in this._layers)this._layers[n]._project()},_updatePaths:function(){for(var n in this._layers)this._layers[n]._update()},_update:function(){var n=this.options.padding,d=this._map.getSize(),k=this._map.containerPointToLayerPoint(d.multiplyBy(-n)).round();this._bounds=new Lt(k,k.add(d.multiplyBy(1+n*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Cr=ai.extend({options:{tolerance:0},getEvents:function(){var n=ai.prototype.getEvents.call(this);return n.viewprereset=this._onViewPreReset,n},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ai.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var n=this._container=document.createElement("canvas");P0(n,"mousemove",this._onMouseMove,this),P0(n,"click dblclick mousedown mouseup contextmenu",this._onClick,this),P0(n,"mouseout",this._handleMouseOut,this),n._leaflet_disable_events=!0,this._ctx=n.getContext("2d")},_destroyContainer:function(){Mt(this._redrawRequest),delete this._ctx,hx(this._container),tx(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var n;this._redrawBounds=null;for(var d in this._layers)n=this._layers[d],n._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ai.prototype._update.call(this);var n=this._bounds,d=this._container,k=n.getSize(),it=h0.retina?2:1;rx(d,n.min),d.width=it*k.x,d.height=it*k.y,d.style.width=k.x+"px",d.style.height=k.y+"px",h0.retina&&this._ctx.scale(2,2),this._ctx.translate(-n.min.x,-n.min.y),this.fire("update")}},_reset:function(){ai.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(n){this._updateDashArray(n),this._layers[I(n)]=n;var d=n._order={layer:n,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=d),this._drawLast=d,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(n){this._requestRedraw(n)},_removePath:function(n){var d=n._order,k=d.next,it=d.prev;k?k.prev=it:this._drawLast=it,it?it.next=k:this._drawFirst=k,delete n._order,delete this._layers[I(n)],this._requestRedraw(n)},_updatePath:function(n){this._extendRedrawBounds(n),n._project(),n._update(),this._requestRedraw(n)},_updateStyle:function(n){this._updateDashArray(n),this._requestRedraw(n)},_updateDashArray:function(n){if(typeof n.options.dashArray=="string"){var d=n.options.dashArray.split(/[, ]+/),k=[],it,Ot;for(Ot=0;Ot<d.length;Ot++){if(it=Number(d[Ot]),isNaN(it))return;k.push(it)}n.options._dashArray=k}else n.options._dashArray=n.options.dashArray},_requestRedraw:function(n){this._map&&(this._extendRedrawBounds(n),this._redrawRequest=this._redrawRequest||ut(this._redraw,this))},_extendRedrawBounds:function(n){if(n._pxBounds){var d=(n.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Lt,this._redrawBounds.extend(n._pxBounds.min.subtract([d,d])),this._redrawBounds.extend(n._pxBounds.max.add([d,d]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var n=this._redrawBounds;if(n){var d=n.getSize();this._ctx.clearRect(n.min.x,n.min.y,d.x,d.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var n,d=this._redrawBounds;if(this._ctx.save(),d){var k=d.getSize();this._ctx.beginPath(),this._ctx.rect(d.min.x,d.min.y,k.x,k.y),this._ctx.clip()}this._drawing=!0;for(var it=this._drawFirst;it;it=it.next)n=it.layer,(!d||n._pxBounds&&n._pxBounds.intersects(d))&&n._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(n,d){if(this._drawing){var k,it,Ot,Bt,ce=n._parts,jt=ce.length,Ie=this._ctx;if(jt){for(Ie.beginPath(),k=0;k<jt;k++){for(it=0,Ot=ce[k].length;it<Ot;it++)Bt=ce[k][it],Ie[it?"lineTo":"moveTo"](Bt.x,Bt.y);d&&Ie.closePath()}this._fillStroke(Ie,n)}}},_updateCircle:function(n){if(!(!this._drawing||n._empty())){var d=n._point,k=this._ctx,it=Math.max(Math.round(n._radius),1),Ot=(Math.max(Math.round(n._radiusY),1)||it)/it;Ot!==1&&(k.save(),k.scale(1,Ot)),k.beginPath(),k.arc(d.x,d.y/Ot,it,0,Math.PI*2,!1),Ot!==1&&k.restore(),this._fillStroke(k,n)}},_fillStroke:function(n,d){var k=d.options;k.fill&&(n.globalAlpha=k.fillOpacity,n.fillStyle=k.fillColor||k.color,n.fill(k.fillRule||"evenodd")),k.stroke&&k.weight!==0&&(n.setLineDash&&n.setLineDash(d.options&&d.options._dashArray||[]),n.globalAlpha=k.opacity,n.lineWidth=k.weight,n.strokeStyle=k.color,n.lineCap=k.lineCap,n.lineJoin=k.lineJoin,n.stroke())},_onClick:function(n){for(var d=this._map.mouseEventToLayerPoint(n),k,it,Ot=this._drawFirst;Ot;Ot=Ot.next)k=Ot.layer,k.options.interactive&&k._containsPoint(d)&&(!(n.type==="click"||n.type==="preclick")||!this._map._draggableMoved(k))&&(it=k);this._fireEvent(it?[it]:!1,n)},_onMouseMove:function(n){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var d=this._map.mouseEventToLayerPoint(n);this._handleMouseHover(n,d)}},_handleMouseOut:function(n){var d=this._hoveredLayer;d&&(dx(this._container,"leaflet-interactive"),this._fireEvent([d],n,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(n,d){if(!this._mouseHoverThrottled){for(var k,it,Ot=this._drawFirst;Ot;Ot=Ot.next)k=Ot.layer,k.options.interactive&&k._containsPoint(d)&&(it=k);it!==this._hoveredLayer&&(this._handleMouseOut(n),it&&(k0(this._container,"leaflet-interactive"),this._fireEvent([it],n,"mouseover"),this._hoveredLayer=it)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,n),this._mouseHoverThrottled=!0,setTimeout(Dt(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(n,d,k){this._map._fireDOMEvent(d,k||d.type,n)},_bringToFront:function(n){var d=n._order;if(d){var k=d.next,it=d.prev;if(k)k.prev=it;else return;it?it.next=k:k&&(this._drawFirst=k),d.prev=this._drawLast,this._drawLast.next=d,d.next=null,this._drawLast=d,this._requestRedraw(n)}},_bringToBack:function(n){var d=n._order;if(d){var k=d.next,it=d.prev;if(it)it.next=k;else return;k?k.prev=it:it&&(this._drawLast=it),d.prev=null,d.next=this._drawFirst,this._drawFirst.prev=d,this._drawFirst=d,this._requestRedraw(n)}}});function sn(n){return h0.canvas?new Cr(n):null}var er=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(n){return document.createElement("<lvml:"+n+' class="lvml">')}}catch{}return function(n){return document.createElement("<"+n+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Un={_initContainer:function(){this._container=q0("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ai.prototype._update.call(this),this.fire("update"))},_initPath:function(n){var d=n._container=er("shape");k0(d,"leaflet-vml-shape "+(this.options.className||"")),d.coordsize="1 1",n._path=er("path"),d.appendChild(n._path),this._updateStyle(n),this._layers[I(n)]=n},_addPath:function(n){var d=n._container;this._container.appendChild(d),n.options.interactive&&n.addInteractiveTarget(d)},_removePath:function(n){var d=n._container;hx(d),n.removeInteractiveTarget(d),delete this._layers[I(n)]},_updateStyle:function(n){var d=n._stroke,k=n._fill,it=n.options,Ot=n._container;Ot.stroked=!!it.stroke,Ot.filled=!!it.fill,it.stroke?(d||(d=n._stroke=er("stroke")),Ot.appendChild(d),d.weight=it.weight+"px",d.color=it.color,d.opacity=it.opacity,it.dashArray?d.dashStyle=yt(it.dashArray)?it.dashArray.join(" "):it.dashArray.replace(/( *, *)/g," "):d.dashStyle="",d.endcap=it.lineCap.replace("butt","flat"),d.joinstyle=it.lineJoin):d&&(Ot.removeChild(d),n._stroke=null),it.fill?(k||(k=n._fill=er("fill")),Ot.appendChild(k),k.color=it.fillColor||it.color,k.opacity=it.fillOpacity):k&&(Ot.removeChild(k),n._fill=null)},_updateCircle:function(n){var d=n._point.round(),k=Math.round(n._radius),it=Math.round(n._radiusY||k);this._setPath(n,n._empty()?"M0 0":"AL "+d.x+","+d.y+" "+k+","+it+" 0,"+65535*360)},_setPath:function(n,d){n._path.v=d},_bringToFront:function(n){qi(n._container)},_bringToBack:function(n){Zi(n._container)}},Ri=h0.vml?er:Tt,kr=ai.extend({_initContainer:function(){this._container=Ri("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ri("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){hx(this._container),tx(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ai.prototype._update.call(this);var n=this._bounds,d=n.getSize(),k=this._container;(!this._svgSize||!this._svgSize.equals(d))&&(this._svgSize=d,k.setAttribute("width",d.x),k.setAttribute("height",d.y)),rx(k,n.min),k.setAttribute("viewBox",[n.min.x,n.min.y,d.x,d.y].join(" ")),this.fire("update")}},_initPath:function(n){var d=n._path=Ri("path");n.options.className&&k0(d,n.options.className),n.options.interactive&&k0(d,"leaflet-interactive"),this._updateStyle(n),this._layers[I(n)]=n},_addPath:function(n){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(n._path),n.addInteractiveTarget(n._path)},_removePath:function(n){hx(n._path),n.removeInteractiveTarget(n._path),delete this._layers[I(n)]},_updatePath:function(n){n._project(),n._update()},_updateStyle:function(n){var d=n._path,k=n.options;d&&(k.stroke?(d.setAttribute("stroke",k.color),d.setAttribute("stroke-opacity",k.opacity),d.setAttribute("stroke-width",k.weight),d.setAttribute("stroke-linecap",k.lineCap),d.setAttribute("stroke-linejoin",k.lineJoin),k.dashArray?d.setAttribute("stroke-dasharray",k.dashArray):d.removeAttribute("stroke-dasharray"),k.dashOffset?d.setAttribute("stroke-dashoffset",k.dashOffset):d.removeAttribute("stroke-dashoffset")):d.setAttribute("stroke","none"),k.fill?(d.setAttribute("fill",k.fillColor||k.color),d.setAttribute("fill-opacity",k.fillOpacity),d.setAttribute("fill-rule",k.fillRule||"evenodd")):d.setAttribute("fill","none"))},_updatePoly:function(n,d){this._setPath(n,Vt(n._parts,d))},_updateCircle:function(n){var d=n._point,k=Math.max(Math.round(n._radius),1),it=Math.max(Math.round(n._radiusY),1)||k,Ot="a"+k+","+it+" 0 1,0 ",Bt=n._empty()?"M0 0":"M"+(d.x-k)+","+d.y+Ot+k*2+",0 "+Ot+-k*2+",0 ";this._setPath(n,Bt)},_setPath:function(n,d){n._path.setAttribute("d",d)},_bringToFront:function(n){qi(n._path)},_bringToBack:function(n){Zi(n._path)}});h0.vml&&kr.include(Un);function Nn(n){return h0.svg||h0.vml?new kr(n):null}N0.include({getRenderer:function(n){var d=n.options.renderer||this._getPaneRenderer(n.options.pane)||this.options.renderer||this._renderer;return d||(d=this._renderer=this._createRenderer()),this.hasLayer(d)||this.addLayer(d),d},_getPaneRenderer:function(n){if(n==="overlayPane"||n===void 0)return!1;var d=this._paneRenderers[n];return d===void 0&&(d=this._createRenderer({pane:n}),this._paneRenderers[n]=d),d},_createRenderer:function(n){return this.options.preferCanvas&&sn(n)||Nn(n)}});var dr=Ar.extend({initialize:function(n,d){Ar.prototype.initialize.call(this,this._boundsToLatLngs(n),d)},setBounds:function(n){return this.setLatLngs(this._boundsToLatLngs(n))},_boundsToLatLngs:function(n){return n=se(n),[n.getSouthWest(),n.getNorthWest(),n.getNorthEast(),n.getSouthEast()]}});function Fn(n,d){return new dr(n,d)}kr.create=Ri,kr.pointsToPath=Vt,F0.geometryToLayer=vi,F0.coordsToLatLng=Ai,F0.coordsToLatLngs=w0,F0.latLngToCoords=bx,F0.latLngsToCoords=Ir,F0.getFeature=ji,F0.asFeature=Er,N0.mergeOptions({boxZoom:!0});var Di=gx.extend({initialize:function(n){this._map=n,this._container=n._container,this._pane=n._panes.overlayPane,this._resetStateTimeout=0,n.on("unload",this._destroy,this)},addHooks:function(){P0(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){tx(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){hx(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(n){if(!n.shiftKey||n.which!==1&&n.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),yr(),wn(),this._startPoint=this._map.mouseEventToContainerPoint(n),P0(document,{contextmenu:Yi,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(n){this._moved||(this._moved=!0,this._box=q0("div","leaflet-zoom-box",this._container),k0(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(n);var d=new Lt(this._point,this._startPoint),k=d.getSize();rx(this._box,d.min),this._box.style.width=k.x+"px",this._box.style.height=k.y+"px"},_finish:function(){this._moved&&(hx(this._box),dx(this._container,"leaflet-crosshair")),Nx(),sr(),tx(document,{contextmenu:Yi,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(n){if(!(n.which!==1&&n.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(Dt(this._resetState,this),0);var d=new be(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(d).fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(n){n.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});N0.addInitHook("addHandler","boxZoom",Di),N0.mergeOptions({doubleClickZoom:!0});var Mr=gx.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(n){var d=this._map,k=d.getZoom(),it=d.options.zoomDelta,Ot=n.originalEvent.shiftKey?k-it:k+it;d.options.doubleClickZoom==="center"?d.setZoom(Ot):d.setZoomAround(n.containerPoint,Ot)}});N0.addInitHook("addHandler","doubleClickZoom",Mr),N0.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var an=gx.extend({addHooks:function(){if(!this._draggable){var n=this._map;this._draggable=new Qi(n._mapPane,n._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),n.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),n.on("zoomend",this._onZoomEnd,this),n.whenReady(this._onZoomEnd,this))}k0(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){dx(this._map._container,"leaflet-grab"),dx(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var n=this._map;if(n._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var d=se(this._map.options.maxBounds);this._offsetLimit=pe(this._map.latLngToContainerPoint(d.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(d.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;n.fire("movestart").fire("dragstart"),n.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(n){if(this._map.options.inertia){var d=this._lastTime=+new Date,k=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(k),this._times.push(d),this._prunePositions(d)}this._map.fire("move",n).fire("drag",n)},_prunePositions:function(n){for(;this._positions.length>1&&n-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var n=this._map.getSize().divideBy(2),d=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=d.subtract(n).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(n,d){return n-(n-d)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var n=this._draggable._newPos.subtract(this._draggable._startPos),d=this._offsetLimit;n.x<d.min.x&&(n.x=this._viscousLimit(n.x,d.min.x)),n.y<d.min.y&&(n.y=this._viscousLimit(n.y,d.min.y)),n.x>d.max.x&&(n.x=this._viscousLimit(n.x,d.max.x)),n.y>d.max.y&&(n.y=this._viscousLimit(n.y,d.max.y)),this._draggable._newPos=this._draggable._startPos.add(n)}},_onPreDragWrap:function(){var n=this._worldWidth,d=Math.round(n/2),k=this._initialWorldOffset,it=this._draggable._newPos.x,Ot=(it-d+k)%n+d-k,Bt=(it+d+k)%n-d-k,ce=Math.abs(Ot+k)<Math.abs(Bt+k)?Ot:Bt;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ce},_onDragEnd:function(n){var d=this._map,k=d.options,it=!k.inertia||n.noInertia||this._times.length<2;if(d.fire("dragend",n),it)d.fire("moveend");else{this._prunePositions(+new Date);var Ot=this._lastPos.subtract(this._positions[0]),Bt=(this._lastTime-this._times[0])/1e3,ce=k.easeLinearity,jt=Ot.multiplyBy(ce/Bt),Ie=jt.distanceTo([0,0]),qe=Math.min(k.inertiaMaxSpeed,Ie),s0=jt.multiplyBy(qe/Ie),g0=qe/(k.inertiaDeceleration*ce),S0=s0.multiplyBy(-g0/2).round();!S0.x&&!S0.y?d.fire("moveend"):(S0=d._limitOffset(S0,d.options.maxBounds),ut(function(){d.panBy(S0,{duration:g0,easeLinearity:ce,noMoveStart:!0,animate:!0})}))}}});N0.addInitHook("addHandler","dragging",an),N0.mergeOptions({keyboard:!0,keyboardPanDelta:80});var fr=gx.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(n){this._map=n,this._setPanDelta(n.options.keyboardPanDelta),this._setZoomDelta(n.options.zoomDelta)},addHooks:function(){var n=this._map._container;n.tabIndex<=0&&(n.tabIndex="0"),P0(n,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),tx(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var n=document.body,d=document.documentElement,k=n.scrollTop||d.scrollTop,it=n.scrollLeft||d.scrollLeft;this._map._container.focus(),window.scrollTo(it,k)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(n){var d=this._panKeys={},k=this.keyCodes,it,Ot;for(it=0,Ot=k.left.length;it<Ot;it++)d[k.left[it]]=[-1*n,0];for(it=0,Ot=k.right.length;it<Ot;it++)d[k.right[it]]=[n,0];for(it=0,Ot=k.down.length;it<Ot;it++)d[k.down[it]]=[0,n];for(it=0,Ot=k.up.length;it<Ot;it++)d[k.up[it]]=[0,-1*n]},_setZoomDelta:function(n){var d=this._zoomKeys={},k=this.keyCodes,it,Ot;for(it=0,Ot=k.zoomIn.length;it<Ot;it++)d[k.zoomIn[it]]=n;for(it=0,Ot=k.zoomOut.length;it<Ot;it++)d[k.zoomOut[it]]=-n},_addHooks:function(){P0(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){tx(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(n){if(!(n.altKey||n.ctrlKey||n.metaKey)){var d=n.keyCode,k=this._map,it;if(d in this._panKeys){if(!k._panAnim||!k._panAnim._inProgress)if(it=this._panKeys[d],n.shiftKey&&(it=Qt(it).multiplyBy(3)),k.options.maxBounds&&(it=k._limitOffset(Qt(it),k.options.maxBounds)),k.options.worldCopyJump){var Ot=k.wrapLatLng(k.unproject(k.project(k.getCenter()).add(it)));k.panTo(Ot)}else k.panBy(it)}else if(d in this._zoomKeys)k.setZoom(k.getZoom()+(n.shiftKey?3:1)*this._zoomKeys[d]);else if(d===27&&k._popup&&k._popup.options.closeOnEscapeKey)k.closePopup();else return;Yi(n)}}});N0.addInitHook("addHandler","keyboard",fr),N0.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var on=gx.extend({addHooks:function(){P0(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){tx(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(n){var d=Rs(n),k=this._map.options.wheelDebounceTime;this._delta+=d,this._lastMousePos=this._map.mouseEventToContainerPoint(n),this._startTime||(this._startTime=+new Date);var it=Math.max(k-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(Dt(this._performZoom,this),it),Yi(n)},_performZoom:function(){var n=this._map,d=n.getZoom(),k=this._map.options.zoomSnap||0;n._stop();var it=this._delta/(this._map.options.wheelPxPerZoomLevel*4),Ot=4*Math.log(2/(1+Math.exp(-Math.abs(it))))/Math.LN2,Bt=k?Math.ceil(Ot/k)*k:Ot,ce=n._limitZoom(d+(this._delta>0?Bt:-Bt))-d;this._delta=0,this._startTime=null,ce&&(n.options.scrollWheelZoom==="center"?n.setZoom(d+ce):n.setZoomAround(this._lastMousePos,d+ce))}});N0.addInitHook("addHandler","scrollWheelZoom",on);var oi=600;N0.mergeOptions({tapHold:h0.touchNative&&h0.safari&&h0.mobile,tapTolerance:15});var Gs=gx.extend({addHooks:function(){P0(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){tx(this._map._container,"touchstart",this._onDown,this)},_onDown:function(n){if(clearTimeout(this._holdTimeout),n.touches.length===1){var d=n.touches[0];this._startPos=this._newPos=new re(d.clientX,d.clientY),this._holdTimeout=setTimeout(Dt(function(){this._cancel(),this._isTapValid()&&(P0(document,"touchend",mx),P0(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",d))},this),oi),P0(document,"touchend touchcancel contextmenu",this._cancel,this),P0(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function n(){tx(document,"touchend",mx),tx(document,"touchend touchcancel",n)},_cancel:function(){clearTimeout(this._holdTimeout),tx(document,"touchend touchcancel contextmenu",this._cancel,this),tx(document,"touchmove",this._onMove,this)},_onMove:function(n){var d=n.touches[0];this._newPos=new re(d.clientX,d.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(n,d){var k=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,screenX:d.screenX,screenY:d.screenY,clientX:d.clientX,clientY:d.clientY});k._simulated=!0,d.target.dispatchEvent(k)}});N0.addInitHook("addHandler","tapHold",Gs),N0.mergeOptions({touchZoom:h0.touch,bounceAtZoomLimits:!0});var Vs=gx.extend({addHooks:function(){k0(this._map._container,"leaflet-touch-zoom"),P0(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){dx(this._map._container,"leaflet-touch-zoom"),tx(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(n){var d=this._map;if(!(!n.touches||n.touches.length!==2||d._animatingZoom||this._zooming)){var k=d.mouseEventToContainerPoint(n.touches[0]),it=d.mouseEventToContainerPoint(n.touches[1]);this._centerPoint=d.getSize()._divideBy(2),this._startLatLng=d.containerPointToLatLng(this._centerPoint),d.options.touchZoom!=="center"&&(this._pinchStartLatLng=d.containerPointToLatLng(k.add(it)._divideBy(2))),this._startDist=k.distanceTo(it),this._startZoom=d.getZoom(),this._moved=!1,this._zooming=!0,d._stop(),P0(document,"touchmove",this._onTouchMove,this),P0(document,"touchend touchcancel",this._onTouchEnd,this),mx(n)}},_onTouchMove:function(n){if(!(!n.touches||n.touches.length!==2||!this._zooming)){var d=this._map,k=d.mouseEventToContainerPoint(n.touches[0]),it=d.mouseEventToContainerPoint(n.touches[1]),Ot=k.distanceTo(it)/this._startDist;if(this._zoom=d.getScaleZoom(Ot,this._startZoom),!d.options.bounceAtZoomLimits&&(this._zoom<d.getMinZoom()&&Ot<1||this._zoom>d.getMaxZoom()&&Ot>1)&&(this._zoom=d._limitZoom(this._zoom)),d.options.touchZoom==="center"){if(this._center=this._startLatLng,Ot===1)return}else{var Bt=k._add(it)._divideBy(2)._subtract(this._centerPoint);if(Ot===1&&Bt.x===0&&Bt.y===0)return;this._center=d.unproject(d.project(this._pinchStartLatLng,this._zoom).subtract(Bt),this._zoom)}this._moved||(d._moveStart(!0,!1),this._moved=!0),Mt(this._animRequest);var ce=Dt(d._move,d,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ut(ce,this,!0),mx(n)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Mt(this._animRequest),tx(document,"touchmove",this._onTouchMove,this),tx(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});N0.addInitHook("addHandler","touchZoom",Vs),N0.BoxZoom=Di,N0.DoubleClickZoom=Mr,N0.Drag=an,N0.Keyboard=fr,N0.ScrollWheelZoom=on,N0.TapHold=Gs,N0.TouchZoom=Vs,ne.Bounds=Lt,ne.Browser=h0,ne.CRS=It,ne.Canvas=Cr,ne.Circle=us,ne.CircleMarker=Mn,ne.Class=tt,ne.Control=Qx,ne.DivIcon=nn,ne.DivOverlay=Kx,ne.DomEvent=na,ne.DomUtil=Hi,ne.Draggable=Qi,ne.Evented=ue,ne.FeatureGroup=mi,ne.GeoJSON=F0,ne.GridLayer=Dr,ne.Handler=gx,ne.Icon=Si,ne.ImageOverlay=Sx,ne.LatLng=Fe,ne.LatLngBounds=be,ne.Layer=si,ne.LayerGroup=or,ne.LineUtil=os,ne.Map=N0,ne.Marker=kn,ne.Mixin=Xr,ne.Path=Li,ne.Point=re,ne.PolyUtil=In,ne.Polygon=Ar,ne.Polyline=Oi,ne.Popup=yi,ne.PosAnimation=Sn,ne.Projection=xn,ne.Rectangle=dr,ne.Renderer=ai,ne.SVG=kr,ne.SVGOverlay=hr,ne.TileLayer=Ei,ne.Tooltip=jx,ne.Transformation=Te,ne.Util=st,ne.VideoOverlay=Ii,ne.bind=Dt,ne.bounds=pe,ne.canvas=sn,ne.circle=la,ne.circleMarker=oa,ne.control=Jx,ne.divIcon=Rr,ne.extend=de,ne.featureGroup=Cn,ne.geoJSON=lr,ne.geoJson=Tx,ne.gridLayer=Ns,ne.icon=sa,ne.imageOverlay=zn,ne.latLng=Pe,ne.latLngBounds=se,ne.layerGroup=hs,ne.map=Ds,ne.marker=aa,ne.point=Qt,ne.polygon=gi,ne.polyline=ha,ne.popup=ur,ne.rectangle=Fn,ne.setOptions=_t,ne.stamp=I,ne.svg=Nn,ne.svgOverlay=nx,ne.tileLayer=tr,ne.tooltip=ds,ne.transformation=me,ne.version=Zt,ne.videoOverlay=Bn;var ua=window.L;ne.noConflict=function(){return window.L=ua,this},window.L=ne})})(leafletSrc,leafletSrc.exports);var leafletSrcExports=leafletSrc.exports;const L$1=getDefaultExportFromCjs(leafletSrcExports),leaflet="";function commonjsRequire(Je){throw new Error('Could not dynamically require "'+Je+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var quickearth_core={exports:{}},hasRequiredQuickearth_core;function requireQuickearth_core(){return hasRequiredQuickearth_core||(hasRequiredQuickearth_core=1,function(module,exports){(function(Je,Ce){module.exports=Ce()})(self,()=>(()=>{var Q={921:Je=>{function Ce(ne){var Zt=new Error("Cannot find module '"+ne+"'");throw Zt.code="MODULE_NOT_FOUND",Zt}Ce.keys=()=>[],Ce.resolve=Ce,Ce.id=921,Je.exports=Ce},378:(Je,Ce,ne)=>{Je.exports=function Zt(de,Et,Dt){function Y(Nt,ft){if(!Et[Nt]){if(!de[Nt]){if(!ft&&ne(921))return commonjsRequire(Nt);if(I)return I(Nt,!0);var at=new Error("Cannot find module '"+Nt+"'");throw at.code="MODULE_NOT_FOUND",at}var dt=Et[Nt]={exports:{}};de[Nt][0].call(dt.exports,function(et){return Y(de[Nt][1][et]||et)},dt,dt.exports,Zt,de,Et,Dt)}return Et[Nt].exports}for(var I=void 0,At=0;At<Dt.length;At++)Y(Dt[At]);return Y}({1:[function(Zt,de,Et){var Dt=Zt("./utils"),Y=Zt("./support"),I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Et.encode=function(At){for(var Nt,ft,at,dt,et,_t,rt,Pt=[],St=0,yt=At.length,gt=yt,lt=Dt.getTypeOf(At)!=="string";St<At.length;)gt=yt-St,at=lt?(Nt=At[St++],ft=St<yt?At[St++]:0,St<yt?At[St++]:0):(Nt=At.charCodeAt(St++),ft=St<yt?At.charCodeAt(St++):0,St<yt?At.charCodeAt(St++):0),dt=Nt>>2,et=(3&Nt)<<4|ft>>4,_t=1<gt?(15&ft)<<2|at>>6:64,rt=2<gt?63&at:64,Pt.push(I.charAt(dt)+I.charAt(et)+I.charAt(_t)+I.charAt(rt));return Pt.join("")},Et.decode=function(At){var Nt,ft,at,dt,et,_t,rt=0,Pt=0,St="data:";if(At.substr(0,5)===St)throw new Error("Invalid base64 input, it looks like a data url.");var yt,gt=3*(At=At.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(At.charAt(At.length-1)===I.charAt(64)&&gt--,At.charAt(At.length-2)===I.charAt(64)&&gt--,gt%1!=0)throw new Error("Invalid base64 input, bad content length.");for(yt=Y.uint8array?new Uint8Array(0|gt):new Array(0|gt);rt<At.length;)Nt=I.indexOf(At.charAt(rt++))<<2|(dt=I.indexOf(At.charAt(rt++)))>>4,ft=(15&dt)<<4|(et=I.indexOf(At.charAt(rt++)))>>2,at=(3&et)<<6|(_t=I.indexOf(At.charAt(rt++))),yt[Pt++]=Nt,et!==64&&(yt[Pt++]=ft),_t!==64&&(yt[Pt++]=at);return yt}},{"./support":30,"./utils":32}],2:[function(Zt,de,Et){var Dt=Zt("./external"),Y=Zt("./stream/DataWorker"),I=Zt("./stream/Crc32Probe"),At=Zt("./stream/DataLengthProbe");function Nt(ft,at,dt,et,_t){this.compressedSize=ft,this.uncompressedSize=at,this.crc32=dt,this.compression=et,this.compressedContent=_t}Nt.prototype={getContentWorker:function(){var ft=new Y(Dt.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new At("data_length")),at=this;return ft.on("end",function(){if(this.streamInfo.data_length!==at.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),ft},getCompressedWorker:function(){return new Y(Dt.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},Nt.createWorkerFrom=function(ft,at,dt){return ft.pipe(new I).pipe(new At("uncompressedSize")).pipe(at.compressWorker(dt)).pipe(new At("compressedSize")).withStreamInfo("compression",at)},de.exports=Nt},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(Zt,de,Et){var Dt=Zt("./stream/GenericWorker");Et.STORE={magic:"\0\0",compressWorker:function(){return new Dt("STORE compression")},uncompressWorker:function(){return new Dt("STORE decompression")}},Et.DEFLATE=Zt("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(Zt,de,Et){var Dt=Zt("./utils"),Y=function(){for(var I,At=[],Nt=0;Nt<256;Nt++){I=Nt;for(var ft=0;ft<8;ft++)I=1&I?3988292384^I>>>1:I>>>1;At[Nt]=I}return At}();de.exports=function(I,At){return I!==void 0&&I.length?Dt.getTypeOf(I)!=="string"?function(Nt,ft,at,dt){var et=Y,_t=0+at;Nt^=-1;for(var rt=0;rt<_t;rt++)Nt=Nt>>>8^et[255&(Nt^ft[rt])];return-1^Nt}(0|At,I,I.length):function(Nt,ft,at,dt){var et=Y,_t=0+at;Nt^=-1;for(var rt=0;rt<_t;rt++)Nt=Nt>>>8^et[255&(Nt^ft.charCodeAt(rt))];return-1^Nt}(0|At,I,I.length):0}},{"./utils":32}],5:[function(Zt,de,Et){Et.base64=!1,Et.binary=!1,Et.dir=!1,Et.createFolders=!0,Et.date=null,Et.compression=null,Et.compressionOptions=null,Et.comment=null,Et.unixPermissions=null,Et.dosPermissions=null},{}],6:[function(Zt,de,Et){var Dt;Dt=typeof Promise<"u"?Promise:Zt("lie"),de.exports={Promise:Dt}},{lie:37}],7:[function(Zt,de,Et){var Dt=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",Y=Zt("pako"),I=Zt("./utils"),At=Zt("./stream/GenericWorker"),Nt=Dt?"uint8array":"array";function ft(at,dt){At.call(this,"FlateWorker/"+at),this._pako=null,this._pakoAction=at,this._pakoOptions=dt,this.meta={}}Et.magic="\b\0",I.inherits(ft,At),ft.prototype.processChunk=function(at){this.meta=at.meta,this._pako===null&&this._createPako(),this._pako.push(I.transformTo(Nt,at.data),!1)},ft.prototype.flush=function(){At.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},ft.prototype.cleanUp=function(){At.prototype.cleanUp.call(this),this._pako=null},ft.prototype._createPako=function(){this._pako=new Y[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var at=this;this._pako.onData=function(dt){at.push({data:dt,meta:at.meta})}},Et.compressWorker=function(at){return new ft("Deflate",at)},Et.uncompressWorker=function(){return new ft("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(Zt,de,Et){function Dt(et,_t){var rt,Pt="";for(rt=0;rt<_t;rt++)Pt+=String.fromCharCode(255&et),et>>>=8;return Pt}function Y(et,_t,rt,Pt,St,yt){var gt,lt,F=et.file,pt=et.compression,ht=yt!==Nt.utf8encode,mt=I.transformTo("string",yt(F.name)),bt=I.transformTo("string",Nt.utf8encode(F.name)),ut=F.comment,Mt=I.transformTo("string",yt(ut)),st=I.transformTo("string",Nt.utf8encode(ut)),tt=bt.length!==F.name.length,Ut=st.length!==ut.length,nt="",ue="",re="",ee=F.dir,Qt=F.date,Lt={crc32:0,compressedSize:0,uncompressedSize:0};_t&&!rt||(Lt.crc32=et.crc32,Lt.compressedSize=et.compressedSize,Lt.uncompressedSize=et.uncompressedSize);var pe=0;_t&&(pe|=8),ht||!tt&&!Ut||(pe|=2048);var be=0,se=0;ee&&(be|=16),St==="UNIX"?(se=798,be|=function(Pe,It){var Rt=Pe;return Pe||(Rt=It?16893:33204),(65535&Rt)<<16}(F.unixPermissions,ee)):(se=20,be|=function(Pe){return 63&(Pe||0)}(F.dosPermissions)),gt=Qt.getUTCHours(),gt<<=6,gt|=Qt.getUTCMinutes(),gt<<=5,gt|=Qt.getUTCSeconds()/2,lt=Qt.getUTCFullYear()-1980,lt<<=4,lt|=Qt.getUTCMonth()+1,lt<<=5,lt|=Qt.getUTCDate(),tt&&(ue=Dt(1,1)+Dt(ft(mt),4)+bt,nt+="up"+Dt(ue.length,2)+ue),Ut&&(re=Dt(1,1)+Dt(ft(Mt),4)+st,nt+="uc"+Dt(re.length,2)+re);var Fe="";return Fe+=`
\0`,Fe+=Dt(pe,2),Fe+=pt.magic,Fe+=Dt(gt,2),Fe+=Dt(lt,2),Fe+=Dt(Lt.crc32,4),Fe+=Dt(Lt.compressedSize,4),Fe+=Dt(Lt.uncompressedSize,4),Fe+=Dt(mt.length,2),Fe+=Dt(nt.length,2),{fileRecord:at.LOCAL_FILE_HEADER+Fe+mt+nt,dirRecord:at.CENTRAL_FILE_HEADER+Dt(se,2)+Fe+Dt(Mt.length,2)+"\0\0\0\0"+Dt(be,4)+Dt(Pt,4)+mt+nt+Mt}}var I=Zt("../utils"),At=Zt("../stream/GenericWorker"),Nt=Zt("../utf8"),ft=Zt("../crc32"),at=Zt("../signature");function dt(et,_t,rt,Pt){At.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_t,this.zipPlatform=rt,this.encodeFileName=Pt,this.streamFiles=et,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}I.inherits(dt,At),dt.prototype.push=function(et){var _t=et.meta.percent||0,rt=this.entriesCount,Pt=this._sources.length;this.accumulate?this.contentBuffer.push(et):(this.bytesWritten+=et.data.length,At.prototype.push.call(this,{data:et.data,meta:{currentFile:this.currentFile,percent:rt?(_t+100*(rt-Pt-1))/rt:100}}))},dt.prototype.openedSource=function(et){this.currentSourceOffset=this.bytesWritten,this.currentFile=et.file.name;var _t=this.streamFiles&&!et.file.dir;if(_t){var rt=Y(et,_t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:rt.fileRecord,meta:{percent:0}})}else this.accumulate=!0},dt.prototype.closedSource=function(et){this.accumulate=!1;var _t=this.streamFiles&&!et.file.dir,rt=Y(et,_t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(rt.dirRecord),_t)this.push({data:function(Pt){return at.DATA_DESCRIPTOR+Dt(Pt.crc32,4)+Dt(Pt.compressedSize,4)+Dt(Pt.uncompressedSize,4)}(et),meta:{percent:100}});else for(this.push({data:rt.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},dt.prototype.flush=function(){for(var et=this.bytesWritten,_t=0;_t<this.dirRecords.length;_t++)this.push({data:this.dirRecords[_t],meta:{percent:100}});var rt=this.bytesWritten-et,Pt=function(St,yt,gt,lt,F){var pt=I.transformTo("string",F(lt));return at.CENTRAL_DIRECTORY_END+"\0\0\0\0"+Dt(St,2)+Dt(St,2)+Dt(yt,4)+Dt(gt,4)+Dt(pt.length,2)+pt}(this.dirRecords.length,rt,et,this.zipComment,this.encodeFileName);this.push({data:Pt,meta:{percent:100}})},dt.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},dt.prototype.registerPrevious=function(et){this._sources.push(et);var _t=this;return et.on("data",function(rt){_t.processChunk(rt)}),et.on("end",function(){_t.closedSource(_t.previous.streamInfo),_t._sources.length?_t.prepareNextSource():_t.end()}),et.on("error",function(rt){_t.error(rt)}),this},dt.prototype.resume=function(){return!!At.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},dt.prototype.error=function(et){var _t=this._sources;if(!At.prototype.error.call(this,et))return!1;for(var rt=0;rt<_t.length;rt++)try{_t[rt].error(et)}catch{}return!0},dt.prototype.lock=function(){At.prototype.lock.call(this);for(var et=this._sources,_t=0;_t<et.length;_t++)et[_t].lock()},de.exports=dt},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(Zt,de,Et){var Dt=Zt("../compressions"),Y=Zt("./ZipFileWorker");Et.generateWorker=function(I,At,Nt){var ft=new Y(At.streamFiles,Nt,At.platform,At.encodeFileName),at=0;try{I.forEach(function(dt,et){at++;var _t=function(yt,gt){var lt=yt||gt,F=Dt[lt];if(!F)throw new Error(lt+" is not a valid compression method !");return F}(et.options.compression,At.compression),rt=et.options.compressionOptions||At.compressionOptions||{},Pt=et.dir,St=et.date;et._compressWorker(_t,rt).withStreamInfo("file",{name:dt,dir:Pt,date:St,comment:et.comment||"",unixPermissions:et.unixPermissions,dosPermissions:et.dosPermissions}).pipe(ft)}),ft.entriesCount=at}catch(dt){ft.error(dt)}return ft}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(Zt,de,Et){function Dt(){if(!(this instanceof Dt))return new Dt;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var Y=new Dt;for(var I in this)typeof this[I]!="function"&&(Y[I]=this[I]);return Y}}(Dt.prototype=Zt("./object")).loadAsync=Zt("./load"),Dt.support=Zt("./support"),Dt.defaults=Zt("./defaults"),Dt.version="3.10.1",Dt.loadAsync=function(Y,I){return new Dt().loadAsync(Y,I)},Dt.external=Zt("./external"),de.exports=Dt},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(Zt,de,Et){var Dt=Zt("./utils"),Y=Zt("./external"),I=Zt("./utf8"),At=Zt("./zipEntries"),Nt=Zt("./stream/Crc32Probe"),ft=Zt("./nodejsUtils");function at(dt){return new Y.Promise(function(et,_t){var rt=dt.decompressed.getContentWorker().pipe(new Nt);rt.on("error",function(Pt){_t(Pt)}).on("end",function(){rt.streamInfo.crc32!==dt.decompressed.crc32?_t(new Error("Corrupted zip : CRC32 mismatch")):et()}).resume()})}de.exports=function(dt,et){var _t=this;return et=Dt.extend(et||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:I.utf8decode}),ft.isNode&&ft.isStream(dt)?Y.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):Dt.prepareContent("the loaded zip file",dt,!0,et.optimizedBinaryString,et.base64).then(function(rt){var Pt=new At(et);return Pt.load(rt),Pt}).then(function(rt){var Pt=[Y.Promise.resolve(rt)],St=rt.files;if(et.checkCRC32)for(var yt=0;yt<St.length;yt++)Pt.push(at(St[yt]));return Y.Promise.all(Pt)}).then(function(rt){for(var Pt=rt.shift(),St=Pt.files,yt=0;yt<St.length;yt++){var gt=St[yt],lt=gt.fileNameStr,F=Dt.resolve(gt.fileNameStr);_t.file(F,gt.decompressed,{binary:!0,optimizedBinaryString:!0,date:gt.date,dir:gt.dir,comment:gt.fileCommentStr.length?gt.fileCommentStr:null,unixPermissions:gt.unixPermissions,dosPermissions:gt.dosPermissions,createFolders:et.createFolders}),gt.dir||(_t.file(F).unsafeOriginalName=lt)}return Pt.zipComment.length&&(_t.comment=Pt.zipComment),_t})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(Zt,de,Et){var Dt=Zt("../utils"),Y=Zt("../stream/GenericWorker");function I(At,Nt){Y.call(this,"Nodejs stream input adapter for "+At),this._upstreamEnded=!1,this._bindStream(Nt)}Dt.inherits(I,Y),I.prototype._bindStream=function(At){var Nt=this;(this._stream=At).pause(),At.on("data",function(ft){Nt.push({data:ft,meta:{percent:0}})}).on("error",function(ft){Nt.isPaused?this.generatedError=ft:Nt.error(ft)}).on("end",function(){Nt.isPaused?Nt._upstreamEnded=!0:Nt.end()})},I.prototype.pause=function(){return!!Y.prototype.pause.call(this)&&(this._stream.pause(),!0)},I.prototype.resume=function(){return!!Y.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},de.exports=I},{"../stream/GenericWorker":28,"../utils":32}],13:[function(Zt,de,Et){var Dt=Zt("readable-stream").Readable;function Y(I,At,Nt){Dt.call(this,At),this._helper=I;var ft=this;I.on("data",function(at,dt){ft.push(at)||ft._helper.pause(),Nt&&Nt(dt)}).on("error",function(at){ft.emit("error",at)}).on("end",function(){ft.push(null)})}Zt("../utils").inherits(Y,Dt),Y.prototype._read=function(){this._helper.resume()},de.exports=Y},{"../utils":32,"readable-stream":16}],14:[function(Zt,de,Et){de.exports={isNode:typeof Buffer<"u",newBufferFrom:function(Dt,Y){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(Dt,Y);if(typeof Dt=="number")throw new Error('The "data" argument must not be a number');return new Buffer(Dt,Y)},allocBuffer:function(Dt){if(Buffer.alloc)return Buffer.alloc(Dt);var Y=new Buffer(Dt);return Y.fill(0),Y},isBuffer:function(Dt){return Buffer.isBuffer(Dt)},isStream:function(Dt){return Dt&&typeof Dt.on=="function"&&typeof Dt.pause=="function"&&typeof Dt.resume=="function"}}},{}],15:[function(Zt,de,Et){function Dt(F,pt,ht){var mt,bt=I.getTypeOf(pt),ut=I.extend(ht||{},ft);ut.date=ut.date||new Date,ut.compression!==null&&(ut.compression=ut.compression.toUpperCase()),typeof ut.unixPermissions=="string"&&(ut.unixPermissions=parseInt(ut.unixPermissions,8)),ut.unixPermissions&&16384&ut.unixPermissions&&(ut.dir=!0),ut.dosPermissions&&16&ut.dosPermissions&&(ut.dir=!0),ut.dir&&(F=St(F)),ut.createFolders&&(mt=Pt(F))&&yt.call(this,mt,!0);var Mt=bt==="string"&&ut.binary===!1&&ut.base64===!1;ht&&ht.binary!==void 0||(ut.binary=!Mt),(pt instanceof at&&pt.uncompressedSize===0||ut.dir||!pt||pt.length===0)&&(ut.base64=!1,ut.binary=!0,pt="",ut.compression="STORE",bt="string");var st;st=pt instanceof at||pt instanceof At?pt:_t.isNode&&_t.isStream(pt)?new rt(F,pt):I.prepareContent(F,pt,ut.binary,ut.optimizedBinaryString,ut.base64);var tt=new dt(F,st,ut);this.files[F]=tt}var Y=Zt("./utf8"),I=Zt("./utils"),At=Zt("./stream/GenericWorker"),Nt=Zt("./stream/StreamHelper"),ft=Zt("./defaults"),at=Zt("./compressedObject"),dt=Zt("./zipObject"),et=Zt("./generate"),_t=Zt("./nodejsUtils"),rt=Zt("./nodejs/NodejsStreamInputAdapter"),Pt=function(F){F.slice(-1)==="/"&&(F=F.substring(0,F.length-1));var pt=F.lastIndexOf("/");return 0<pt?F.substring(0,pt):""},St=function(F){return F.slice(-1)!=="/"&&(F+="/"),F},yt=function(F,pt){return pt=pt!==void 0?pt:ft.createFolders,F=St(F),this.files[F]||Dt.call(this,F,null,{dir:!0,createFolders:pt}),this.files[F]};function gt(F){return Object.prototype.toString.call(F)==="[object RegExp]"}var lt={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(F){var pt,ht,mt;for(pt in this.files)mt=this.files[pt],(ht=pt.slice(this.root.length,pt.length))&&pt.slice(0,this.root.length)===this.root&&F(ht,mt)},filter:function(F){var pt=[];return this.forEach(function(ht,mt){F(ht,mt)&&pt.push(mt)}),pt},file:function(F,pt,ht){if(arguments.length!==1)return F=this.root+F,Dt.call(this,F,pt,ht),this;if(gt(F)){var mt=F;return this.filter(function(ut,Mt){return!Mt.dir&&mt.test(ut)})}var bt=this.files[this.root+F];return bt&&!bt.dir?bt:null},folder:function(F){if(!F)return this;if(gt(F))return this.filter(function(bt,ut){return ut.dir&&F.test(bt)});var pt=this.root+F,ht=yt.call(this,pt),mt=this.clone();return mt.root=ht.name,mt},remove:function(F){F=this.root+F;var pt=this.files[F];if(pt||(F.slice(-1)!=="/"&&(F+="/"),pt=this.files[F]),pt&&!pt.dir)delete this.files[F];else for(var ht=this.filter(function(bt,ut){return ut.name.slice(0,F.length)===F}),mt=0;mt<ht.length;mt++)delete this.files[ht[mt].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(F){var pt,ht={};try{if((ht=I.extend(F||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:Y.utf8encode})).type=ht.type.toLowerCase(),ht.compression=ht.compression.toUpperCase(),ht.type==="binarystring"&&(ht.type="string"),!ht.type)throw new Error("No output type specified.");I.checkSupport(ht.type),ht.platform!=="darwin"&&ht.platform!=="freebsd"&&ht.platform!=="linux"&&ht.platform!=="sunos"||(ht.platform="UNIX"),ht.platform==="win32"&&(ht.platform="DOS");var mt=ht.comment||this.comment||"";pt=et.generateWorker(this,ht,mt)}catch(bt){(pt=new At("error")).error(bt)}return new Nt(pt,ht.type||"string",ht.mimeType)},generateAsync:function(F,pt){return this.generateInternalStream(F).accumulate(pt)},generateNodeStream:function(F,pt){return(F=F||{}).type||(F.type="nodebuffer"),this.generateInternalStream(F).toNodejsStream(pt)}};de.exports=lt},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(Zt,de,Et){de.exports=Zt("stream")},{stream:void 0}],17:[function(Zt,de,Et){var Dt=Zt("./DataReader");function Y(I){Dt.call(this,I);for(var At=0;At<this.data.length;At++)I[At]=255&I[At]}Zt("../utils").inherits(Y,Dt),Y.prototype.byteAt=function(I){return this.data[this.zero+I]},Y.prototype.lastIndexOfSignature=function(I){for(var At=I.charCodeAt(0),Nt=I.charCodeAt(1),ft=I.charCodeAt(2),at=I.charCodeAt(3),dt=this.length-4;0<=dt;--dt)if(this.data[dt]===At&&this.data[dt+1]===Nt&&this.data[dt+2]===ft&&this.data[dt+3]===at)return dt-this.zero;return-1},Y.prototype.readAndCheckSignature=function(I){var At=I.charCodeAt(0),Nt=I.charCodeAt(1),ft=I.charCodeAt(2),at=I.charCodeAt(3),dt=this.readData(4);return At===dt[0]&&Nt===dt[1]&&ft===dt[2]&&at===dt[3]},Y.prototype.readData=function(I){if(this.checkOffset(I),I===0)return[];var At=this.data.slice(this.zero+this.index,this.zero+this.index+I);return this.index+=I,At},de.exports=Y},{"../utils":32,"./DataReader":18}],18:[function(Zt,de,Et){var Dt=Zt("../utils");function Y(I){this.data=I,this.length=I.length,this.index=0,this.zero=0}Y.prototype={checkOffset:function(I){this.checkIndex(this.index+I)},checkIndex:function(I){if(this.length<this.zero+I||I<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+I+"). Corrupted zip ?")},setIndex:function(I){this.checkIndex(I),this.index=I},skip:function(I){this.setIndex(this.index+I)},byteAt:function(){},readInt:function(I){var At,Nt=0;for(this.checkOffset(I),At=this.index+I-1;At>=this.index;At--)Nt=(Nt<<8)+this.byteAt(At);return this.index+=I,Nt},readString:function(I){return Dt.transformTo("string",this.readData(I))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var I=this.readInt(4);return new Date(Date.UTC(1980+(I>>25&127),(I>>21&15)-1,I>>16&31,I>>11&31,I>>5&63,(31&I)<<1))}},de.exports=Y},{"../utils":32}],19:[function(Zt,de,Et){var Dt=Zt("./Uint8ArrayReader");function Y(I){Dt.call(this,I)}Zt("../utils").inherits(Y,Dt),Y.prototype.readData=function(I){this.checkOffset(I);var At=this.data.slice(this.zero+this.index,this.zero+this.index+I);return this.index+=I,At},de.exports=Y},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(Zt,de,Et){var Dt=Zt("./DataReader");function Y(I){Dt.call(this,I)}Zt("../utils").inherits(Y,Dt),Y.prototype.byteAt=function(I){return this.data.charCodeAt(this.zero+I)},Y.prototype.lastIndexOfSignature=function(I){return this.data.lastIndexOf(I)-this.zero},Y.prototype.readAndCheckSignature=function(I){return I===this.readData(4)},Y.prototype.readData=function(I){this.checkOffset(I);var At=this.data.slice(this.zero+this.index,this.zero+this.index+I);return this.index+=I,At},de.exports=Y},{"../utils":32,"./DataReader":18}],21:[function(Zt,de,Et){var Dt=Zt("./ArrayReader");function Y(I){Dt.call(this,I)}Zt("../utils").inherits(Y,Dt),Y.prototype.readData=function(I){if(this.checkOffset(I),I===0)return new Uint8Array(0);var At=this.data.subarray(this.zero+this.index,this.zero+this.index+I);return this.index+=I,At},de.exports=Y},{"../utils":32,"./ArrayReader":17}],22:[function(Zt,de,Et){var Dt=Zt("../utils"),Y=Zt("../support"),I=Zt("./ArrayReader"),At=Zt("./StringReader"),Nt=Zt("./NodeBufferReader"),ft=Zt("./Uint8ArrayReader");de.exports=function(at){var dt=Dt.getTypeOf(at);return Dt.checkSupport(dt),dt!=="string"||Y.uint8array?dt==="nodebuffer"?new Nt(at):Y.uint8array?new ft(Dt.transformTo("uint8array",at)):new I(Dt.transformTo("array",at)):new At(at)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(Zt,de,Et){Et.LOCAL_FILE_HEADER="PK",Et.CENTRAL_FILE_HEADER="PK",Et.CENTRAL_DIRECTORY_END="PK",Et.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",Et.ZIP64_CENTRAL_DIRECTORY_END="PK",Et.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(Zt,de,Et){var Dt=Zt("./GenericWorker"),Y=Zt("../utils");function I(At){Dt.call(this,"ConvertWorker to "+At),this.destType=At}Y.inherits(I,Dt),I.prototype.processChunk=function(At){this.push({data:Y.transformTo(this.destType,At.data),meta:At.meta})},de.exports=I},{"../utils":32,"./GenericWorker":28}],25:[function(Zt,de,Et){var Dt=Zt("./GenericWorker"),Y=Zt("../crc32");function I(){Dt.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}Zt("../utils").inherits(I,Dt),I.prototype.processChunk=function(At){this.streamInfo.crc32=Y(At.data,this.streamInfo.crc32||0),this.push(At)},de.exports=I},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(Zt,de,Et){var Dt=Zt("../utils"),Y=Zt("./GenericWorker");function I(At){Y.call(this,"DataLengthProbe for "+At),this.propName=At,this.withStreamInfo(At,0)}Dt.inherits(I,Y),I.prototype.processChunk=function(At){if(At){var Nt=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=Nt+At.data.length}Y.prototype.processChunk.call(this,At)},de.exports=I},{"../utils":32,"./GenericWorker":28}],27:[function(Zt,de,Et){var Dt=Zt("../utils"),Y=Zt("./GenericWorker");function I(At){Y.call(this,"DataWorker");var Nt=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,At.then(function(ft){Nt.dataIsReady=!0,Nt.data=ft,Nt.max=ft&&ft.length||0,Nt.type=Dt.getTypeOf(ft),Nt.isPaused||Nt._tickAndRepeat()},function(ft){Nt.error(ft)})}Dt.inherits(I,Y),I.prototype.cleanUp=function(){Y.prototype.cleanUp.call(this),this.data=null},I.prototype.resume=function(){return!!Y.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,Dt.delay(this._tickAndRepeat,[],this)),!0)},I.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(Dt.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},I.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var At=null,Nt=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":At=this.data.substring(this.index,Nt);break;case"uint8array":At=this.data.subarray(this.index,Nt);break;case"array":case"nodebuffer":At=this.data.slice(this.index,Nt)}return this.index=Nt,this.push({data:At,meta:{percent:this.max?this.index/this.max*100:0}})},de.exports=I},{"../utils":32,"./GenericWorker":28}],28:[function(Zt,de,Et){function Dt(Y){this.name=Y||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}Dt.prototype={push:function(Y){this.emit("data",Y)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(Y){this.emit("error",Y)}return!0},error:function(Y){return!this.isFinished&&(this.isPaused?this.generatedError=Y:(this.isFinished=!0,this.emit("error",Y),this.previous&&this.previous.error(Y),this.cleanUp()),!0)},on:function(Y,I){return this._listeners[Y].push(I),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(Y,I){if(this._listeners[Y])for(var At=0;At<this._listeners[Y].length;At++)this._listeners[Y][At].call(this,I)},pipe:function(Y){return Y.registerPrevious(this)},registerPrevious:function(Y){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=Y.streamInfo,this.mergeStreamInfo(),this.previous=Y;var I=this;return Y.on("data",function(At){I.processChunk(At)}),Y.on("end",function(){I.end()}),Y.on("error",function(At){I.error(At)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var Y=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),Y=!0),this.previous&&this.previous.resume(),!Y},flush:function(){},processChunk:function(Y){this.push(Y)},withStreamInfo:function(Y,I){return this.extraStreamInfo[Y]=I,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var Y in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,Y)&&(this.streamInfo[Y]=this.extraStreamInfo[Y])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var Y="Worker "+this.name;return this.previous?this.previous+" -> "+Y:Y}},de.exports=Dt},{}],29:[function(Zt,de,Et){var Dt=Zt("../utils"),Y=Zt("./ConvertWorker"),I=Zt("./GenericWorker"),At=Zt("../base64"),Nt=Zt("../support"),ft=Zt("../external"),at=null;if(Nt.nodestream)try{at=Zt("../nodejs/NodejsStreamOutputAdapter")}catch{}function dt(et,_t,rt){var Pt=_t;switch(_t){case"blob":case"arraybuffer":Pt="uint8array";break;case"base64":Pt="string"}try{this._internalType=Pt,this._outputType=_t,this._mimeType=rt,Dt.checkSupport(Pt),this._worker=et.pipe(new Y(Pt)),et.lock()}catch(St){this._worker=new I("error"),this._worker.error(St)}}dt.prototype={accumulate:function(et){return function(_t,rt){return new ft.Promise(function(Pt,St){var yt=[],gt=_t._internalType,lt=_t._outputType,F=_t._mimeType;_t.on("data",function(pt,ht){yt.push(pt),rt&&rt(ht)}).on("error",function(pt){yt=[],St(pt)}).on("end",function(){try{var pt=function(ht,mt,bt){switch(ht){case"blob":return Dt.newBlob(Dt.transformTo("arraybuffer",mt),bt);case"base64":return At.encode(mt);default:return Dt.transformTo(ht,mt)}}(lt,function(ht,mt){var bt,ut=0,Mt=null,st=0;for(bt=0;bt<mt.length;bt++)st+=mt[bt].length;switch(ht){case"string":return mt.join("");case"array":return Array.prototype.concat.apply([],mt);case"uint8array":for(Mt=new Uint8Array(st),bt=0;bt<mt.length;bt++)Mt.set(mt[bt],ut),ut+=mt[bt].length;return Mt;case"nodebuffer":return Buffer.concat(mt);default:throw new Error("concat : unsupported type '"+ht+"'")}}(gt,yt),F);Pt(pt)}catch(ht){St(ht)}yt=[]}).resume()})}(this,et)},on:function(et,_t){var rt=this;return et==="data"?this._worker.on(et,function(Pt){_t.call(rt,Pt.data,Pt.meta)}):this._worker.on(et,function(){Dt.delay(_t,arguments,rt)}),this},resume:function(){return Dt.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(et){if(Dt.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new at(this,{objectMode:this._outputType!=="nodebuffer"},et)}},de.exports=dt},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(Zt,de,Et){if(Et.base64=!0,Et.array=!0,Et.string=!0,Et.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",Et.nodebuffer=typeof Buffer<"u",Et.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")Et.blob=!1;else{var Dt=new ArrayBuffer(0);try{Et.blob=new Blob([Dt],{type:"application/zip"}).size===0}catch{try{var Y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);Y.append(Dt),Et.blob=Y.getBlob("application/zip").size===0}catch{Et.blob=!1}}}try{Et.nodestream=!!Zt("readable-stream").Readable}catch{Et.nodestream=!1}},{"readable-stream":16}],31:[function(Zt,de,Et){for(var Dt=Zt("./utils"),Y=Zt("./support"),I=Zt("./nodejsUtils"),At=Zt("./stream/GenericWorker"),Nt=new Array(256),ft=0;ft<256;ft++)Nt[ft]=252<=ft?6:248<=ft?5:240<=ft?4:224<=ft?3:192<=ft?2:1;function at(){At.call(this,"utf-8 decode"),this.leftOver=null}function dt(){At.call(this,"utf-8 encode")}Nt[254]=Nt[254]=1,Et.utf8encode=function(et){return Y.nodebuffer?I.newBufferFrom(et,"utf-8"):function(_t){var rt,Pt,St,yt,gt,lt=_t.length,F=0;for(yt=0;yt<lt;yt++)(64512&(Pt=_t.charCodeAt(yt)))==55296&&yt+1<lt&&(64512&(St=_t.charCodeAt(yt+1)))==56320&&(Pt=65536+(Pt-55296<<10)+(St-56320),yt++),F+=Pt<128?1:Pt<2048?2:Pt<65536?3:4;for(rt=Y.uint8array?new Uint8Array(F):new Array(F),yt=gt=0;gt<F;yt++)(64512&(Pt=_t.charCodeAt(yt)))==55296&&yt+1<lt&&(64512&(St=_t.charCodeAt(yt+1)))==56320&&(Pt=65536+(Pt-55296<<10)+(St-56320),yt++),Pt<128?rt[gt++]=Pt:(Pt<2048?rt[gt++]=192|Pt>>>6:(Pt<65536?rt[gt++]=224|Pt>>>12:(rt[gt++]=240|Pt>>>18,rt[gt++]=128|Pt>>>12&63),rt[gt++]=128|Pt>>>6&63),rt[gt++]=128|63&Pt);return rt}(et)},Et.utf8decode=function(et){return Y.nodebuffer?Dt.transformTo("nodebuffer",et).toString("utf-8"):function(_t){var rt,Pt,St,yt,gt=_t.length,lt=new Array(2*gt);for(rt=Pt=0;rt<gt;)if((St=_t[rt++])<128)lt[Pt++]=St;else if(4<(yt=Nt[St]))lt[Pt++]=65533,rt+=yt-1;else{for(St&=yt===2?31:yt===3?15:7;1<yt&&rt<gt;)St=St<<6|63&_t[rt++],yt--;1<yt?lt[Pt++]=65533:St<65536?lt[Pt++]=St:(St-=65536,lt[Pt++]=55296|St>>10&1023,lt[Pt++]=56320|1023&St)}return lt.length!==Pt&&(lt.subarray?lt=lt.subarray(0,Pt):lt.length=Pt),Dt.applyFromCharCode(lt)}(et=Dt.transformTo(Y.uint8array?"uint8array":"array",et))},Dt.inherits(at,At),at.prototype.processChunk=function(et){var _t=Dt.transformTo(Y.uint8array?"uint8array":"array",et.data);if(this.leftOver&&this.leftOver.length){if(Y.uint8array){var rt=_t;(_t=new Uint8Array(rt.length+this.leftOver.length)).set(this.leftOver,0),_t.set(rt,this.leftOver.length)}else _t=this.leftOver.concat(_t);this.leftOver=null}var Pt=function(yt,gt){var lt;for((gt=gt||yt.length)>yt.length&&(gt=yt.length),lt=gt-1;0<=lt&&(192&yt[lt])==128;)lt--;return lt<0||lt===0?gt:lt+Nt[yt[lt]]>gt?lt:gt}(_t),St=_t;Pt!==_t.length&&(Y.uint8array?(St=_t.subarray(0,Pt),this.leftOver=_t.subarray(Pt,_t.length)):(St=_t.slice(0,Pt),this.leftOver=_t.slice(Pt,_t.length))),this.push({data:Et.utf8decode(St),meta:et.meta})},at.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:Et.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},Et.Utf8DecodeWorker=at,Dt.inherits(dt,At),dt.prototype.processChunk=function(et){this.push({data:Et.utf8encode(et.data),meta:et.meta})},Et.Utf8EncodeWorker=dt},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(Zt,de,Et){var Dt=Zt("./support"),Y=Zt("./base64"),I=Zt("./nodejsUtils"),At=Zt("./external");function Nt(rt){return rt}function ft(rt,Pt){for(var St=0;St<rt.length;++St)Pt[St]=255&rt.charCodeAt(St);return Pt}Zt("setimmediate"),Et.newBlob=function(rt,Pt){Et.checkSupport("blob");try{return new Blob([rt],{type:Pt})}catch{try{var St=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return St.append(rt),St.getBlob(Pt)}catch{throw new Error("Bug : can't construct the Blob.")}}};var at={stringifyByChunk:function(rt,Pt,St){var yt=[],gt=0,lt=rt.length;if(lt<=St)return String.fromCharCode.apply(null,rt);for(;gt<lt;)Pt==="array"||Pt==="nodebuffer"?yt.push(String.fromCharCode.apply(null,rt.slice(gt,Math.min(gt+St,lt)))):yt.push(String.fromCharCode.apply(null,rt.subarray(gt,Math.min(gt+St,lt)))),gt+=St;return yt.join("")},stringifyByChar:function(rt){for(var Pt="",St=0;St<rt.length;St++)Pt+=String.fromCharCode(rt[St]);return Pt},applyCanBeUsed:{uint8array:function(){try{return Dt.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return Dt.nodebuffer&&String.fromCharCode.apply(null,I.allocBuffer(1)).length===1}catch{return!1}}()}};function dt(rt){var Pt=65536,St=Et.getTypeOf(rt),yt=!0;if(St==="uint8array"?yt=at.applyCanBeUsed.uint8array:St==="nodebuffer"&&(yt=at.applyCanBeUsed.nodebuffer),yt)for(;1<Pt;)try{return at.stringifyByChunk(rt,St,Pt)}catch{Pt=Math.floor(Pt/2)}return at.stringifyByChar(rt)}function et(rt,Pt){for(var St=0;St<rt.length;St++)Pt[St]=rt[St];return Pt}Et.applyFromCharCode=dt;var _t={};_t.string={string:Nt,array:function(rt){return ft(rt,new Array(rt.length))},arraybuffer:function(rt){return _t.string.uint8array(rt).buffer},uint8array:function(rt){return ft(rt,new Uint8Array(rt.length))},nodebuffer:function(rt){return ft(rt,I.allocBuffer(rt.length))}},_t.array={string:dt,array:Nt,arraybuffer:function(rt){return new Uint8Array(rt).buffer},uint8array:function(rt){return new Uint8Array(rt)},nodebuffer:function(rt){return I.newBufferFrom(rt)}},_t.arraybuffer={string:function(rt){return dt(new Uint8Array(rt))},array:function(rt){return et(new Uint8Array(rt),new Array(rt.byteLength))},arraybuffer:Nt,uint8array:function(rt){return new Uint8Array(rt)},nodebuffer:function(rt){return I.newBufferFrom(new Uint8Array(rt))}},_t.uint8array={string:dt,array:function(rt){return et(rt,new Array(rt.length))},arraybuffer:function(rt){return rt.buffer},uint8array:Nt,nodebuffer:function(rt){return I.newBufferFrom(rt)}},_t.nodebuffer={string:dt,array:function(rt){return et(rt,new Array(rt.length))},arraybuffer:function(rt){return _t.nodebuffer.uint8array(rt).buffer},uint8array:function(rt){return et(rt,new Uint8Array(rt.length))},nodebuffer:Nt},Et.transformTo=function(rt,Pt){if(Pt=Pt||"",!rt)return Pt;Et.checkSupport(rt);var St=Et.getTypeOf(Pt);return _t[St][rt](Pt)},Et.resolve=function(rt){for(var Pt=rt.split("/"),St=[],yt=0;yt<Pt.length;yt++){var gt=Pt[yt];gt==="."||gt===""&&yt!==0&&yt!==Pt.length-1||(gt===".."?St.pop():St.push(gt))}return St.join("/")},Et.getTypeOf=function(rt){return typeof rt=="string"?"string":Object.prototype.toString.call(rt)==="[object Array]"?"array":Dt.nodebuffer&&I.isBuffer(rt)?"nodebuffer":Dt.uint8array&&rt instanceof Uint8Array?"uint8array":Dt.arraybuffer&&rt instanceof ArrayBuffer?"arraybuffer":void 0},Et.checkSupport=function(rt){if(!Dt[rt.toLowerCase()])throw new Error(rt+" is not supported by this platform")},Et.MAX_VALUE_16BITS=65535,Et.MAX_VALUE_32BITS=-1,Et.pretty=function(rt){var Pt,St,yt="";for(St=0;St<(rt||"").length;St++)yt+="\\x"+((Pt=rt.charCodeAt(St))<16?"0":"")+Pt.toString(16).toUpperCase();return yt},Et.delay=function(rt,Pt,St){setImmediate(function(){rt.apply(St||null,Pt||[])})},Et.inherits=function(rt,Pt){function St(){}St.prototype=Pt.prototype,rt.prototype=new St},Et.extend=function(){var rt,Pt,St={};for(rt=0;rt<arguments.length;rt++)for(Pt in arguments[rt])Object.prototype.hasOwnProperty.call(arguments[rt],Pt)&&St[Pt]===void 0&&(St[Pt]=arguments[rt][Pt]);return St},Et.prepareContent=function(rt,Pt,St,yt,gt){return At.Promise.resolve(Pt).then(function(lt){return Dt.blob&&(lt instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(lt))!==-1)&&typeof FileReader<"u"?new At.Promise(function(F,pt){var ht=new FileReader;ht.onload=function(mt){F(mt.target.result)},ht.onerror=function(mt){pt(mt.target.error)},ht.readAsArrayBuffer(lt)}):lt}).then(function(lt){var F=Et.getTypeOf(lt);return F?(F==="arraybuffer"?lt=Et.transformTo("uint8array",lt):F==="string"&&(gt?lt=Y.decode(lt):St&&yt!==!0&&(lt=function(pt){return ft(pt,Dt.uint8array?new Uint8Array(pt.length):new Array(pt.length))}(lt))),lt):At.Promise.reject(new Error("Can't read the data of '"+rt+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(Zt,de,Et){var Dt=Zt("./reader/readerFor"),Y=Zt("./utils"),I=Zt("./signature"),At=Zt("./zipEntry"),Nt=Zt("./support");function ft(at){this.files=[],this.loadOptions=at}ft.prototype={checkSignature:function(at){if(!this.reader.readAndCheckSignature(at)){this.reader.index-=4;var dt=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+Y.pretty(dt)+", expected "+Y.pretty(at)+")")}},isSignature:function(at,dt){var et=this.reader.index;this.reader.setIndex(at);var _t=this.reader.readString(4)===dt;return this.reader.setIndex(et),_t},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var at=this.reader.readData(this.zipCommentLength),dt=Nt.uint8array?"uint8array":"array",et=Y.transformTo(dt,at);this.zipComment=this.loadOptions.decodeFileName(et)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var at,dt,et,_t=this.zip64EndOfCentralSize-44;0<_t;)at=this.reader.readInt(2),dt=this.reader.readInt(4),et=this.reader.readData(dt),this.zip64ExtensibleData[at]={id:at,length:dt,value:et}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var at,dt;for(at=0;at<this.files.length;at++)dt=this.files[at],this.reader.setIndex(dt.localHeaderOffset),this.checkSignature(I.LOCAL_FILE_HEADER),dt.readLocalPart(this.reader),dt.handleUTF8(),dt.processAttributes()},readCentralDir:function(){var at;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(I.CENTRAL_FILE_HEADER);)(at=new At({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(at);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var at=this.reader.lastIndexOfSignature(I.CENTRAL_DIRECTORY_END);if(at<0)throw this.isSignature(0,I.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(at);var dt=at;if(this.checkSignature(I.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===Y.MAX_VALUE_16BITS||this.diskWithCentralDirStart===Y.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===Y.MAX_VALUE_16BITS||this.centralDirRecords===Y.MAX_VALUE_16BITS||this.centralDirSize===Y.MAX_VALUE_32BITS||this.centralDirOffset===Y.MAX_VALUE_32BITS){if(this.zip64=!0,(at=this.reader.lastIndexOfSignature(I.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(at),this.checkSignature(I.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,I.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(I.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(I.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var et=this.centralDirOffset+this.centralDirSize;this.zip64&&(et+=20,et+=12+this.zip64EndOfCentralSize);var _t=dt-et;if(0<_t)this.isSignature(dt,I.CENTRAL_FILE_HEADER)||(this.reader.zero=_t);else if(_t<0)throw new Error("Corrupted zip: missing "+Math.abs(_t)+" bytes.")},prepareReader:function(at){this.reader=Dt(at)},load:function(at){this.prepareReader(at),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},de.exports=ft},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(Zt,de,Et){var Dt=Zt("./reader/readerFor"),Y=Zt("./utils"),I=Zt("./compressedObject"),At=Zt("./crc32"),Nt=Zt("./utf8"),ft=Zt("./compressions"),at=Zt("./support");function dt(et,_t){this.options=et,this.loadOptions=_t}dt.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(et){var _t,rt;if(et.skip(22),this.fileNameLength=et.readInt(2),rt=et.readInt(2),this.fileName=et.readData(this.fileNameLength),et.skip(rt),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_t=function(Pt){for(var St in ft)if(Object.prototype.hasOwnProperty.call(ft,St)&&ft[St].magic===Pt)return ft[St];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+Y.pretty(this.compressionMethod)+" unknown (inner file : "+Y.transformTo("string",this.fileName)+")");this.decompressed=new I(this.compressedSize,this.uncompressedSize,this.crc32,_t,et.readData(this.compressedSize))},readCentralPart:function(et){this.versionMadeBy=et.readInt(2),et.skip(2),this.bitFlag=et.readInt(2),this.compressionMethod=et.readString(2),this.date=et.readDate(),this.crc32=et.readInt(4),this.compressedSize=et.readInt(4),this.uncompressedSize=et.readInt(4);var _t=et.readInt(2);if(this.extraFieldsLength=et.readInt(2),this.fileCommentLength=et.readInt(2),this.diskNumberStart=et.readInt(2),this.internalFileAttributes=et.readInt(2),this.externalFileAttributes=et.readInt(4),this.localHeaderOffset=et.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");et.skip(_t),this.readExtraFields(et),this.parseZIP64ExtraField(et),this.fileComment=et.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var et=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),et==0&&(this.dosPermissions=63&this.externalFileAttributes),et==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var et=Dt(this.extraFields[1].value);this.uncompressedSize===Y.MAX_VALUE_32BITS&&(this.uncompressedSize=et.readInt(8)),this.compressedSize===Y.MAX_VALUE_32BITS&&(this.compressedSize=et.readInt(8)),this.localHeaderOffset===Y.MAX_VALUE_32BITS&&(this.localHeaderOffset=et.readInt(8)),this.diskNumberStart===Y.MAX_VALUE_32BITS&&(this.diskNumberStart=et.readInt(4))}},readExtraFields:function(et){var _t,rt,Pt,St=et.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});et.index+4<St;)_t=et.readInt(2),rt=et.readInt(2),Pt=et.readData(rt),this.extraFields[_t]={id:_t,length:rt,value:Pt};et.setIndex(St)},handleUTF8:function(){var et=at.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=Nt.utf8decode(this.fileName),this.fileCommentStr=Nt.utf8decode(this.fileComment);else{var _t=this.findExtraFieldUnicodePath();if(_t!==null)this.fileNameStr=_t;else{var rt=Y.transformTo(et,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(rt)}var Pt=this.findExtraFieldUnicodeComment();if(Pt!==null)this.fileCommentStr=Pt;else{var St=Y.transformTo(et,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(St)}}},findExtraFieldUnicodePath:function(){var et=this.extraFields[28789];if(et){var _t=Dt(et.value);return _t.readInt(1)!==1||At(this.fileName)!==_t.readInt(4)?null:Nt.utf8decode(_t.readData(et.length-5))}return null},findExtraFieldUnicodeComment:function(){var et=this.extraFields[25461];if(et){var _t=Dt(et.value);return _t.readInt(1)!==1||At(this.fileComment)!==_t.readInt(4)?null:Nt.utf8decode(_t.readData(et.length-5))}return null}},de.exports=dt},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(Zt,de,Et){function Dt(_t,rt,Pt){this.name=_t,this.dir=Pt.dir,this.date=Pt.date,this.comment=Pt.comment,this.unixPermissions=Pt.unixPermissions,this.dosPermissions=Pt.dosPermissions,this._data=rt,this._dataBinary=Pt.binary,this.options={compression:Pt.compression,compressionOptions:Pt.compressionOptions}}var Y=Zt("./stream/StreamHelper"),I=Zt("./stream/DataWorker"),At=Zt("./utf8"),Nt=Zt("./compressedObject"),ft=Zt("./stream/GenericWorker");Dt.prototype={internalStream:function(_t){var rt=null,Pt="string";try{if(!_t)throw new Error("No output type specified.");var St=(Pt=_t.toLowerCase())==="string"||Pt==="text";Pt!=="binarystring"&&Pt!=="text"||(Pt="string"),rt=this._decompressWorker();var yt=!this._dataBinary;yt&&!St&&(rt=rt.pipe(new At.Utf8EncodeWorker)),!yt&&St&&(rt=rt.pipe(new At.Utf8DecodeWorker))}catch(gt){(rt=new ft("error")).error(gt)}return new Y(rt,Pt,"")},async:function(_t,rt){return this.internalStream(_t).accumulate(rt)},nodeStream:function(_t,rt){return this.internalStream(_t||"nodebuffer").toNodejsStream(rt)},_compressWorker:function(_t,rt){if(this._data instanceof Nt&&this._data.compression.magic===_t.magic)return this._data.getCompressedWorker();var Pt=this._decompressWorker();return this._dataBinary||(Pt=Pt.pipe(new At.Utf8EncodeWorker)),Nt.createWorkerFrom(Pt,_t,rt)},_decompressWorker:function(){return this._data instanceof Nt?this._data.getContentWorker():this._data instanceof ft?this._data:new I(this._data)}};for(var at=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],dt=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},et=0;et<at.length;et++)Dt.prototype[at[et]]=dt;de.exports=Dt},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(Zt,de,Et){(function(Dt){var Y,I,At=Dt.MutationObserver||Dt.WebKitMutationObserver;if(At){var Nt=0,ft=new At(_t),at=Dt.document.createTextNode("");ft.observe(at,{characterData:!0}),Y=function(){at.data=Nt=++Nt%2}}else if(Dt.setImmediate||Dt.MessageChannel===void 0)Y="document"in Dt&&"onreadystatechange"in Dt.document.createElement("script")?function(){var rt=Dt.document.createElement("script");rt.onreadystatechange=function(){_t(),rt.onreadystatechange=null,rt.parentNode.removeChild(rt),rt=null},Dt.document.documentElement.appendChild(rt)}:function(){setTimeout(_t,0)};else{var dt=new Dt.MessageChannel;dt.port1.onmessage=_t,Y=function(){dt.port2.postMessage(0)}}var et=[];function _t(){var rt,Pt;I=!0;for(var St=et.length;St;){for(Pt=et,et=[],rt=-1;++rt<St;)Pt[rt]();St=et.length}I=!1}de.exports=function(rt){et.push(rt)!==1||I||Y()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(Zt,de,Et){var Dt=Zt("immediate");function Y(){}var I={},At=["REJECTED"],Nt=["FULFILLED"],ft=["PENDING"];function at(St){if(typeof St!="function")throw new TypeError("resolver must be a function");this.state=ft,this.queue=[],this.outcome=void 0,St!==Y&&rt(this,St)}function dt(St,yt,gt){this.promise=St,typeof yt=="function"&&(this.onFulfilled=yt,this.callFulfilled=this.otherCallFulfilled),typeof gt=="function"&&(this.onRejected=gt,this.callRejected=this.otherCallRejected)}function et(St,yt,gt){Dt(function(){var lt;try{lt=yt(gt)}catch(F){return I.reject(St,F)}lt===St?I.reject(St,new TypeError("Cannot resolve promise with itself")):I.resolve(St,lt)})}function _t(St){var yt=St&&St.then;if(St&&(typeof St=="object"||typeof St=="function")&&typeof yt=="function")return function(){yt.apply(St,arguments)}}function rt(St,yt){var gt=!1;function lt(ht){gt||(gt=!0,I.reject(St,ht))}function F(ht){gt||(gt=!0,I.resolve(St,ht))}var pt=Pt(function(){yt(F,lt)});pt.status==="error"&&lt(pt.value)}function Pt(St,yt){var gt={};try{gt.value=St(yt),gt.status="success"}catch(lt){gt.status="error",gt.value=lt}return gt}(de.exports=at).prototype.finally=function(St){if(typeof St!="function")return this;var yt=this.constructor;return this.then(function(gt){return yt.resolve(St()).then(function(){return gt})},function(gt){return yt.resolve(St()).then(function(){throw gt})})},at.prototype.catch=function(St){return this.then(null,St)},at.prototype.then=function(St,yt){if(typeof St!="function"&&this.state===Nt||typeof yt!="function"&&this.state===At)return this;var gt=new this.constructor(Y);return this.state!==ft?et(gt,this.state===Nt?St:yt,this.outcome):this.queue.push(new dt(gt,St,yt)),gt},dt.prototype.callFulfilled=function(St){I.resolve(this.promise,St)},dt.prototype.otherCallFulfilled=function(St){et(this.promise,this.onFulfilled,St)},dt.prototype.callRejected=function(St){I.reject(this.promise,St)},dt.prototype.otherCallRejected=function(St){et(this.promise,this.onRejected,St)},I.resolve=function(St,yt){var gt=Pt(_t,yt);if(gt.status==="error")return I.reject(St,gt.value);var lt=gt.value;if(lt)rt(St,lt);else{St.state=Nt,St.outcome=yt;for(var F=-1,pt=St.queue.length;++F<pt;)St.queue[F].callFulfilled(yt)}return St},I.reject=function(St,yt){St.state=At,St.outcome=yt;for(var gt=-1,lt=St.queue.length;++gt<lt;)St.queue[gt].callRejected(yt);return St},at.resolve=function(St){return St instanceof this?St:I.resolve(new this(Y),St)},at.reject=function(St){var yt=new this(Y);return I.reject(yt,St)},at.all=function(St){var yt=this;if(Object.prototype.toString.call(St)!=="[object Array]")return this.reject(new TypeError("must be an array"));var gt=St.length,lt=!1;if(!gt)return this.resolve([]);for(var F=new Array(gt),pt=0,ht=-1,mt=new this(Y);++ht<gt;)bt(St[ht],ht);return mt;function bt(ut,Mt){yt.resolve(ut).then(function(st){F[Mt]=st,++pt!==gt||lt||(lt=!0,I.resolve(mt,F))},function(st){lt||(lt=!0,I.reject(mt,st))})}},at.race=function(St){if(Object.prototype.toString.call(St)!=="[object Array]")return this.reject(new TypeError("must be an array"));var yt=St.length,gt=!1;if(!yt)return this.resolve([]);for(var lt,F=-1,pt=new this(Y);++F<yt;)lt=St[F],this.resolve(lt).then(function(ht){gt||(gt=!0,I.resolve(pt,ht))},function(ht){gt||(gt=!0,I.reject(pt,ht))});return pt}},{immediate:36}],38:[function(Zt,de,Et){var Dt={};(0,Zt("./lib/utils/common").assign)(Dt,Zt("./lib/deflate"),Zt("./lib/inflate"),Zt("./lib/zlib/constants")),de.exports=Dt},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(Zt,de,Et){var Dt=Zt("./zlib/deflate"),Y=Zt("./utils/common"),I=Zt("./utils/strings"),At=Zt("./zlib/messages"),Nt=Zt("./zlib/zstream"),ft=Object.prototype.toString,at=0,dt=-1,et=0,_t=8;function rt(St){if(!(this instanceof rt))return new rt(St);this.options=Y.assign({level:dt,method:_t,chunkSize:16384,windowBits:15,memLevel:8,strategy:et,to:""},St||{});var yt=this.options;yt.raw&&0<yt.windowBits?yt.windowBits=-yt.windowBits:yt.gzip&&0<yt.windowBits&&yt.windowBits<16&&(yt.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Nt,this.strm.avail_out=0;var gt=Dt.deflateInit2(this.strm,yt.level,yt.method,yt.windowBits,yt.memLevel,yt.strategy);if(gt!==at)throw new Error(At[gt]);if(yt.header&&Dt.deflateSetHeader(this.strm,yt.header),yt.dictionary){var lt;if(lt=typeof yt.dictionary=="string"?I.string2buf(yt.dictionary):ft.call(yt.dictionary)==="[object ArrayBuffer]"?new Uint8Array(yt.dictionary):yt.dictionary,(gt=Dt.deflateSetDictionary(this.strm,lt))!==at)throw new Error(At[gt]);this._dict_set=!0}}function Pt(St,yt){var gt=new rt(yt);if(gt.push(St,!0),gt.err)throw gt.msg||At[gt.err];return gt.result}rt.prototype.push=function(St,yt){var gt,lt,F=this.strm,pt=this.options.chunkSize;if(this.ended)return!1;lt=yt===~~yt?yt:yt===!0?4:0,typeof St=="string"?F.input=I.string2buf(St):ft.call(St)==="[object ArrayBuffer]"?F.input=new Uint8Array(St):F.input=St,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new Y.Buf8(pt),F.next_out=0,F.avail_out=pt),(gt=Dt.deflate(F,lt))!==1&&gt!==at)return this.onEnd(gt),!(this.ended=!0);F.avail_out!==0&&(F.avail_in!==0||lt!==4&&lt!==2)||(this.options.to==="string"?this.onData(I.buf2binstring(Y.shrinkBuf(F.output,F.next_out))):this.onData(Y.shrinkBuf(F.output,F.next_out)))}while((0<F.avail_in||F.avail_out===0)&&gt!==1);return lt===4?(gt=Dt.deflateEnd(this.strm),this.onEnd(gt),this.ended=!0,gt===at):lt!==2||(this.onEnd(at),!(F.avail_out=0))},rt.prototype.onData=function(St){this.chunks.push(St)},rt.prototype.onEnd=function(St){St===at&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Y.flattenChunks(this.chunks)),this.chunks=[],this.err=St,this.msg=this.strm.msg},Et.Deflate=rt,Et.deflate=Pt,Et.deflateRaw=function(St,yt){return(yt=yt||{}).raw=!0,Pt(St,yt)},Et.gzip=function(St,yt){return(yt=yt||{}).gzip=!0,Pt(St,yt)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(Zt,de,Et){var Dt=Zt("./zlib/inflate"),Y=Zt("./utils/common"),I=Zt("./utils/strings"),At=Zt("./zlib/constants"),Nt=Zt("./zlib/messages"),ft=Zt("./zlib/zstream"),at=Zt("./zlib/gzheader"),dt=Object.prototype.toString;function et(rt){if(!(this instanceof et))return new et(rt);this.options=Y.assign({chunkSize:16384,windowBits:0,to:""},rt||{});var Pt=this.options;Pt.raw&&0<=Pt.windowBits&&Pt.windowBits<16&&(Pt.windowBits=-Pt.windowBits,Pt.windowBits===0&&(Pt.windowBits=-15)),!(0<=Pt.windowBits&&Pt.windowBits<16)||rt&&rt.windowBits||(Pt.windowBits+=32),15<Pt.windowBits&&Pt.windowBits<48&&!(15&Pt.windowBits)&&(Pt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ft,this.strm.avail_out=0;var St=Dt.inflateInit2(this.strm,Pt.windowBits);if(St!==At.Z_OK)throw new Error(Nt[St]);this.header=new at,Dt.inflateGetHeader(this.strm,this.header)}function _t(rt,Pt){var St=new et(Pt);if(St.push(rt,!0),St.err)throw St.msg||Nt[St.err];return St.result}et.prototype.push=function(rt,Pt){var St,yt,gt,lt,F,pt,ht=this.strm,mt=this.options.chunkSize,bt=this.options.dictionary,ut=!1;if(this.ended)return!1;yt=Pt===~~Pt?Pt:Pt===!0?At.Z_FINISH:At.Z_NO_FLUSH,typeof rt=="string"?ht.input=I.binstring2buf(rt):dt.call(rt)==="[object ArrayBuffer]"?ht.input=new Uint8Array(rt):ht.input=rt,ht.next_in=0,ht.avail_in=ht.input.length;do{if(ht.avail_out===0&&(ht.output=new Y.Buf8(mt),ht.next_out=0,ht.avail_out=mt),(St=Dt.inflate(ht,At.Z_NO_FLUSH))===At.Z_NEED_DICT&&bt&&(pt=typeof bt=="string"?I.string2buf(bt):dt.call(bt)==="[object ArrayBuffer]"?new Uint8Array(bt):bt,St=Dt.inflateSetDictionary(this.strm,pt)),St===At.Z_BUF_ERROR&&ut===!0&&(St=At.Z_OK,ut=!1),St!==At.Z_STREAM_END&&St!==At.Z_OK)return this.onEnd(St),!(this.ended=!0);ht.next_out&&(ht.avail_out!==0&&St!==At.Z_STREAM_END&&(ht.avail_in!==0||yt!==At.Z_FINISH&&yt!==At.Z_SYNC_FLUSH)||(this.options.to==="string"?(gt=I.utf8border(ht.output,ht.next_out),lt=ht.next_out-gt,F=I.buf2string(ht.output,gt),ht.next_out=lt,ht.avail_out=mt-lt,lt&&Y.arraySet(ht.output,ht.output,gt,lt,0),this.onData(F)):this.onData(Y.shrinkBuf(ht.output,ht.next_out)))),ht.avail_in===0&&ht.avail_out===0&&(ut=!0)}while((0<ht.avail_in||ht.avail_out===0)&&St!==At.Z_STREAM_END);return St===At.Z_STREAM_END&&(yt=At.Z_FINISH),yt===At.Z_FINISH?(St=Dt.inflateEnd(this.strm),this.onEnd(St),this.ended=!0,St===At.Z_OK):yt!==At.Z_SYNC_FLUSH||(this.onEnd(At.Z_OK),!(ht.avail_out=0))},et.prototype.onData=function(rt){this.chunks.push(rt)},et.prototype.onEnd=function(rt){rt===At.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Y.flattenChunks(this.chunks)),this.chunks=[],this.err=rt,this.msg=this.strm.msg},Et.Inflate=et,Et.inflate=_t,Et.inflateRaw=function(rt,Pt){return(Pt=Pt||{}).raw=!0,_t(rt,Pt)},Et.ungzip=_t},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(Zt,de,Et){var Dt=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";Et.assign=function(At){for(var Nt=Array.prototype.slice.call(arguments,1);Nt.length;){var ft=Nt.shift();if(ft){if(typeof ft!="object")throw new TypeError(ft+"must be non-object");for(var at in ft)ft.hasOwnProperty(at)&&(At[at]=ft[at])}}return At},Et.shrinkBuf=function(At,Nt){return At.length===Nt?At:At.subarray?At.subarray(0,Nt):(At.length=Nt,At)};var Y={arraySet:function(At,Nt,ft,at,dt){if(Nt.subarray&&At.subarray)At.set(Nt.subarray(ft,ft+at),dt);else for(var et=0;et<at;et++)At[dt+et]=Nt[ft+et]},flattenChunks:function(At){var Nt,ft,at,dt,et,_t;for(Nt=at=0,ft=At.length;Nt<ft;Nt++)at+=At[Nt].length;for(_t=new Uint8Array(at),Nt=dt=0,ft=At.length;Nt<ft;Nt++)et=At[Nt],_t.set(et,dt),dt+=et.length;return _t}},I={arraySet:function(At,Nt,ft,at,dt){for(var et=0;et<at;et++)At[dt+et]=Nt[ft+et]},flattenChunks:function(At){return[].concat.apply([],At)}};Et.setTyped=function(At){At?(Et.Buf8=Uint8Array,Et.Buf16=Uint16Array,Et.Buf32=Int32Array,Et.assign(Et,Y)):(Et.Buf8=Array,Et.Buf16=Array,Et.Buf32=Array,Et.assign(Et,I))},Et.setTyped(Dt)},{}],42:[function(Zt,de,Et){var Dt=Zt("./common"),Y=!0,I=!0;try{String.fromCharCode.apply(null,[0])}catch{Y=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{I=!1}for(var At=new Dt.Buf8(256),Nt=0;Nt<256;Nt++)At[Nt]=252<=Nt?6:248<=Nt?5:240<=Nt?4:224<=Nt?3:192<=Nt?2:1;function ft(at,dt){if(dt<65537&&(at.subarray&&I||!at.subarray&&Y))return String.fromCharCode.apply(null,Dt.shrinkBuf(at,dt));for(var et="",_t=0;_t<dt;_t++)et+=String.fromCharCode(at[_t]);return et}At[254]=At[254]=1,Et.string2buf=function(at){var dt,et,_t,rt,Pt,St=at.length,yt=0;for(rt=0;rt<St;rt++)(64512&(et=at.charCodeAt(rt)))==55296&&rt+1<St&&(64512&(_t=at.charCodeAt(rt+1)))==56320&&(et=65536+(et-55296<<10)+(_t-56320),rt++),yt+=et<128?1:et<2048?2:et<65536?3:4;for(dt=new Dt.Buf8(yt),rt=Pt=0;Pt<yt;rt++)(64512&(et=at.charCodeAt(rt)))==55296&&rt+1<St&&(64512&(_t=at.charCodeAt(rt+1)))==56320&&(et=65536+(et-55296<<10)+(_t-56320),rt++),et<128?dt[Pt++]=et:(et<2048?dt[Pt++]=192|et>>>6:(et<65536?dt[Pt++]=224|et>>>12:(dt[Pt++]=240|et>>>18,dt[Pt++]=128|et>>>12&63),dt[Pt++]=128|et>>>6&63),dt[Pt++]=128|63&et);return dt},Et.buf2binstring=function(at){return ft(at,at.length)},Et.binstring2buf=function(at){for(var dt=new Dt.Buf8(at.length),et=0,_t=dt.length;et<_t;et++)dt[et]=at.charCodeAt(et);return dt},Et.buf2string=function(at,dt){var et,_t,rt,Pt,St=dt||at.length,yt=new Array(2*St);for(et=_t=0;et<St;)if((rt=at[et++])<128)yt[_t++]=rt;else if(4<(Pt=At[rt]))yt[_t++]=65533,et+=Pt-1;else{for(rt&=Pt===2?31:Pt===3?15:7;1<Pt&&et<St;)rt=rt<<6|63&at[et++],Pt--;1<Pt?yt[_t++]=65533:rt<65536?yt[_t++]=rt:(rt-=65536,yt[_t++]=55296|rt>>10&1023,yt[_t++]=56320|1023&rt)}return ft(yt,_t)},Et.utf8border=function(at,dt){var et;for((dt=dt||at.length)>at.length&&(dt=at.length),et=dt-1;0<=et&&(192&at[et])==128;)et--;return et<0||et===0?dt:et+At[at[et]]>dt?et:dt}},{"./common":41}],43:[function(Zt,de,Et){de.exports=function(Dt,Y,I,At){for(var Nt=65535&Dt|0,ft=Dt>>>16&65535|0,at=0;I!==0;){for(I-=at=2e3<I?2e3:I;ft=ft+(Nt=Nt+Y[At++]|0)|0,--at;);Nt%=65521,ft%=65521}return Nt|ft<<16|0}},{}],44:[function(Zt,de,Et){de.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(Zt,de,Et){var Dt=function(){for(var Y,I=[],At=0;At<256;At++){Y=At;for(var Nt=0;Nt<8;Nt++)Y=1&Y?3988292384^Y>>>1:Y>>>1;I[At]=Y}return I}();de.exports=function(Y,I,At,Nt){var ft=Dt,at=Nt+At;Y^=-1;for(var dt=Nt;dt<at;dt++)Y=Y>>>8^ft[255&(Y^I[dt])];return-1^Y}},{}],46:[function(Zt,de,Et){var Dt,Y=Zt("../utils/common"),I=Zt("./trees"),At=Zt("./adler32"),Nt=Zt("./crc32"),ft=Zt("./messages"),at=0,dt=0,et=-2,_t=2,rt=8,Pt=286,St=30,yt=19,gt=2*Pt+1,lt=15,F=3,pt=258,ht=pt+F+1,mt=42,bt=113;function ut(It,Rt){return It.msg=ft[Rt],Rt}function Mt(It){return(It<<1)-(4<It?9:0)}function st(It){for(var Rt=It.length;0<=--Rt;)It[Rt]=0}function tt(It){var Rt=It.state,Jt=Rt.pending;Jt>It.avail_out&&(Jt=It.avail_out),Jt!==0&&(Y.arraySet(It.output,Rt.pending_buf,Rt.pending_out,Jt,It.next_out),It.next_out+=Jt,Rt.pending_out+=Jt,It.total_out+=Jt,It.avail_out-=Jt,Rt.pending-=Jt,Rt.pending===0&&(Rt.pending_out=0))}function Ut(It,Rt){I._tr_flush_block(It,0<=It.block_start?It.block_start:-1,It.strstart-It.block_start,Rt),It.block_start=It.strstart,tt(It.strm)}function nt(It,Rt){It.pending_buf[It.pending++]=Rt}function ue(It,Rt){It.pending_buf[It.pending++]=Rt>>>8&255,It.pending_buf[It.pending++]=255&Rt}function re(It,Rt){var Jt,Yt,Te=It.max_chain_length,me=It.strstart,De=It.prev_length,Ge=It.nice_match,Tt=It.strstart>It.w_size-ht?It.strstart-(It.w_size-ht):0,Vt=It.window,xe=It.w_mask,Kt=It.prev,Me=It.strstart+pt,Se=Vt[me+De-1],ke=Vt[me+De];It.prev_length>=It.good_match&&(Te>>=2),Ge>It.lookahead&&(Ge=It.lookahead);do if(Vt[(Jt=Rt)+De]===ke&&Vt[Jt+De-1]===Se&&Vt[Jt]===Vt[me]&&Vt[++Jt]===Vt[me+1]){me+=2,Jt++;do;while(Vt[++me]===Vt[++Jt]&&Vt[++me]===Vt[++Jt]&&Vt[++me]===Vt[++Jt]&&Vt[++me]===Vt[++Jt]&&Vt[++me]===Vt[++Jt]&&Vt[++me]===Vt[++Jt]&&Vt[++me]===Vt[++Jt]&&Vt[++me]===Vt[++Jt]&&me<Me);if(Yt=pt-(Me-me),me=Me-pt,De<Yt){if(It.match_start=Rt,Ge<=(De=Yt))break;Se=Vt[me+De-1],ke=Vt[me+De]}}while((Rt=Kt[Rt&xe])>Tt&&--Te!=0);return De<=It.lookahead?De:It.lookahead}function ee(It){var Rt,Jt,Yt,Te,me,De,Ge,Tt,Vt,xe,Kt=It.w_size;do{if(Te=It.window_size-It.lookahead-It.strstart,It.strstart>=Kt+(Kt-ht)){for(Y.arraySet(It.window,It.window,Kt,Kt,0),It.match_start-=Kt,It.strstart-=Kt,It.block_start-=Kt,Rt=Jt=It.hash_size;Yt=It.head[--Rt],It.head[Rt]=Kt<=Yt?Yt-Kt:0,--Jt;);for(Rt=Jt=Kt;Yt=It.prev[--Rt],It.prev[Rt]=Kt<=Yt?Yt-Kt:0,--Jt;);Te+=Kt}if(It.strm.avail_in===0)break;if(De=It.strm,Ge=It.window,Tt=It.strstart+It.lookahead,xe=void 0,(Vt=Te)<(xe=De.avail_in)&&(xe=Vt),Jt=xe===0?0:(De.avail_in-=xe,Y.arraySet(Ge,De.input,De.next_in,xe,Tt),De.state.wrap===1?De.adler=At(De.adler,Ge,xe,Tt):De.state.wrap===2&&(De.adler=Nt(De.adler,Ge,xe,Tt)),De.next_in+=xe,De.total_in+=xe,xe),It.lookahead+=Jt,It.lookahead+It.insert>=F)for(me=It.strstart-It.insert,It.ins_h=It.window[me],It.ins_h=(It.ins_h<<It.hash_shift^It.window[me+1])&It.hash_mask;It.insert&&(It.ins_h=(It.ins_h<<It.hash_shift^It.window[me+F-1])&It.hash_mask,It.prev[me&It.w_mask]=It.head[It.ins_h],It.head[It.ins_h]=me,me++,It.insert--,!(It.lookahead+It.insert<F)););}while(It.lookahead<ht&&It.strm.avail_in!==0)}function Qt(It,Rt){for(var Jt,Yt;;){if(It.lookahead<ht){if(ee(It),It.lookahead<ht&&Rt===at)return 1;if(It.lookahead===0)break}if(Jt=0,It.lookahead>=F&&(It.ins_h=(It.ins_h<<It.hash_shift^It.window[It.strstart+F-1])&It.hash_mask,Jt=It.prev[It.strstart&It.w_mask]=It.head[It.ins_h],It.head[It.ins_h]=It.strstart),Jt!==0&&It.strstart-Jt<=It.w_size-ht&&(It.match_length=re(It,Jt)),It.match_length>=F)if(Yt=I._tr_tally(It,It.strstart-It.match_start,It.match_length-F),It.lookahead-=It.match_length,It.match_length<=It.max_lazy_match&&It.lookahead>=F){for(It.match_length--;It.strstart++,It.ins_h=(It.ins_h<<It.hash_shift^It.window[It.strstart+F-1])&It.hash_mask,Jt=It.prev[It.strstart&It.w_mask]=It.head[It.ins_h],It.head[It.ins_h]=It.strstart,--It.match_length!=0;);It.strstart++}else It.strstart+=It.match_length,It.match_length=0,It.ins_h=It.window[It.strstart],It.ins_h=(It.ins_h<<It.hash_shift^It.window[It.strstart+1])&It.hash_mask;else Yt=I._tr_tally(It,0,It.window[It.strstart]),It.lookahead--,It.strstart++;if(Yt&&(Ut(It,!1),It.strm.avail_out===0))return 1}return It.insert=It.strstart<F-1?It.strstart:F-1,Rt===4?(Ut(It,!0),It.strm.avail_out===0?3:4):It.last_lit&&(Ut(It,!1),It.strm.avail_out===0)?1:2}function Lt(It,Rt){for(var Jt,Yt,Te;;){if(It.lookahead<ht){if(ee(It),It.lookahead<ht&&Rt===at)return 1;if(It.lookahead===0)break}if(Jt=0,It.lookahead>=F&&(It.ins_h=(It.ins_h<<It.hash_shift^It.window[It.strstart+F-1])&It.hash_mask,Jt=It.prev[It.strstart&It.w_mask]=It.head[It.ins_h],It.head[It.ins_h]=It.strstart),It.prev_length=It.match_length,It.prev_match=It.match_start,It.match_length=F-1,Jt!==0&&It.prev_length<It.max_lazy_match&&It.strstart-Jt<=It.w_size-ht&&(It.match_length=re(It,Jt),It.match_length<=5&&(It.strategy===1||It.match_length===F&&4096<It.strstart-It.match_start)&&(It.match_length=F-1)),It.prev_length>=F&&It.match_length<=It.prev_length){for(Te=It.strstart+It.lookahead-F,Yt=I._tr_tally(It,It.strstart-1-It.prev_match,It.prev_length-F),It.lookahead-=It.prev_length-1,It.prev_length-=2;++It.strstart<=Te&&(It.ins_h=(It.ins_h<<It.hash_shift^It.window[It.strstart+F-1])&It.hash_mask,Jt=It.prev[It.strstart&It.w_mask]=It.head[It.ins_h],It.head[It.ins_h]=It.strstart),--It.prev_length!=0;);if(It.match_available=0,It.match_length=F-1,It.strstart++,Yt&&(Ut(It,!1),It.strm.avail_out===0))return 1}else if(It.match_available){if((Yt=I._tr_tally(It,0,It.window[It.strstart-1]))&&Ut(It,!1),It.strstart++,It.lookahead--,It.strm.avail_out===0)return 1}else It.match_available=1,It.strstart++,It.lookahead--}return It.match_available&&(Yt=I._tr_tally(It,0,It.window[It.strstart-1]),It.match_available=0),It.insert=It.strstart<F-1?It.strstart:F-1,Rt===4?(Ut(It,!0),It.strm.avail_out===0?3:4):It.last_lit&&(Ut(It,!1),It.strm.avail_out===0)?1:2}function pe(It,Rt,Jt,Yt,Te){this.good_length=It,this.max_lazy=Rt,this.nice_length=Jt,this.max_chain=Yt,this.func=Te}function be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=rt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Y.Buf16(2*gt),this.dyn_dtree=new Y.Buf16(2*(2*St+1)),this.bl_tree=new Y.Buf16(2*(2*yt+1)),st(this.dyn_ltree),st(this.dyn_dtree),st(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Y.Buf16(lt+1),this.heap=new Y.Buf16(2*Pt+1),st(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Y.Buf16(2*Pt+1),st(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function se(It){var Rt;return It&&It.state?(It.total_in=It.total_out=0,It.data_type=_t,(Rt=It.state).pending=0,Rt.pending_out=0,Rt.wrap<0&&(Rt.wrap=-Rt.wrap),Rt.status=Rt.wrap?mt:bt,It.adler=Rt.wrap===2?0:1,Rt.last_flush=at,I._tr_init(Rt),dt):ut(It,et)}function Fe(It){var Rt=se(It);return Rt===dt&&function(Jt){Jt.window_size=2*Jt.w_size,st(Jt.head),Jt.max_lazy_match=Dt[Jt.level].max_lazy,Jt.good_match=Dt[Jt.level].good_length,Jt.nice_match=Dt[Jt.level].nice_length,Jt.max_chain_length=Dt[Jt.level].max_chain,Jt.strstart=0,Jt.block_start=0,Jt.lookahead=0,Jt.insert=0,Jt.match_length=Jt.prev_length=F-1,Jt.match_available=0,Jt.ins_h=0}(It.state),Rt}function Pe(It,Rt,Jt,Yt,Te,me){if(!It)return et;var De=1;if(Rt===-1&&(Rt=6),Yt<0?(De=0,Yt=-Yt):15<Yt&&(De=2,Yt-=16),Te<1||9<Te||Jt!==rt||Yt<8||15<Yt||Rt<0||9<Rt||me<0||4<me)return ut(It,et);Yt===8&&(Yt=9);var Ge=new be;return(It.state=Ge).strm=It,Ge.wrap=De,Ge.gzhead=null,Ge.w_bits=Yt,Ge.w_size=1<<Ge.w_bits,Ge.w_mask=Ge.w_size-1,Ge.hash_bits=Te+7,Ge.hash_size=1<<Ge.hash_bits,Ge.hash_mask=Ge.hash_size-1,Ge.hash_shift=~~((Ge.hash_bits+F-1)/F),Ge.window=new Y.Buf8(2*Ge.w_size),Ge.head=new Y.Buf16(Ge.hash_size),Ge.prev=new Y.Buf16(Ge.w_size),Ge.lit_bufsize=1<<Te+6,Ge.pending_buf_size=4*Ge.lit_bufsize,Ge.pending_buf=new Y.Buf8(Ge.pending_buf_size),Ge.d_buf=1*Ge.lit_bufsize,Ge.l_buf=3*Ge.lit_bufsize,Ge.level=Rt,Ge.strategy=me,Ge.method=Jt,Fe(It)}Dt=[new pe(0,0,0,0,function(It,Rt){var Jt=65535;for(Jt>It.pending_buf_size-5&&(Jt=It.pending_buf_size-5);;){if(It.lookahead<=1){if(ee(It),It.lookahead===0&&Rt===at)return 1;if(It.lookahead===0)break}It.strstart+=It.lookahead,It.lookahead=0;var Yt=It.block_start+Jt;if((It.strstart===0||It.strstart>=Yt)&&(It.lookahead=It.strstart-Yt,It.strstart=Yt,Ut(It,!1),It.strm.avail_out===0)||It.strstart-It.block_start>=It.w_size-ht&&(Ut(It,!1),It.strm.avail_out===0))return 1}return It.insert=0,Rt===4?(Ut(It,!0),It.strm.avail_out===0?3:4):(It.strstart>It.block_start&&(Ut(It,!1),It.strm.avail_out),1)}),new pe(4,4,8,4,Qt),new pe(4,5,16,8,Qt),new pe(4,6,32,32,Qt),new pe(4,4,16,16,Lt),new pe(8,16,32,32,Lt),new pe(8,16,128,128,Lt),new pe(8,32,128,256,Lt),new pe(32,128,258,1024,Lt),new pe(32,258,258,4096,Lt)],Et.deflateInit=function(It,Rt){return Pe(It,Rt,rt,15,8,0)},Et.deflateInit2=Pe,Et.deflateReset=Fe,Et.deflateResetKeep=se,Et.deflateSetHeader=function(It,Rt){return It&&It.state?It.state.wrap!==2?et:(It.state.gzhead=Rt,dt):et},Et.deflate=function(It,Rt){var Jt,Yt,Te,me;if(!It||!It.state||5<Rt||Rt<0)return It?ut(It,et):et;if(Yt=It.state,!It.output||!It.input&&It.avail_in!==0||Yt.status===666&&Rt!==4)return ut(It,It.avail_out===0?-5:et);if(Yt.strm=It,Jt=Yt.last_flush,Yt.last_flush=Rt,Yt.status===mt)if(Yt.wrap===2)It.adler=0,nt(Yt,31),nt(Yt,139),nt(Yt,8),Yt.gzhead?(nt(Yt,(Yt.gzhead.text?1:0)+(Yt.gzhead.hcrc?2:0)+(Yt.gzhead.extra?4:0)+(Yt.gzhead.name?8:0)+(Yt.gzhead.comment?16:0)),nt(Yt,255&Yt.gzhead.time),nt(Yt,Yt.gzhead.time>>8&255),nt(Yt,Yt.gzhead.time>>16&255),nt(Yt,Yt.gzhead.time>>24&255),nt(Yt,Yt.level===9?2:2<=Yt.strategy||Yt.level<2?4:0),nt(Yt,255&Yt.gzhead.os),Yt.gzhead.extra&&Yt.gzhead.extra.length&&(nt(Yt,255&Yt.gzhead.extra.length),nt(Yt,Yt.gzhead.extra.length>>8&255)),Yt.gzhead.hcrc&&(It.adler=Nt(It.adler,Yt.pending_buf,Yt.pending,0)),Yt.gzindex=0,Yt.status=69):(nt(Yt,0),nt(Yt,0),nt(Yt,0),nt(Yt,0),nt(Yt,0),nt(Yt,Yt.level===9?2:2<=Yt.strategy||Yt.level<2?4:0),nt(Yt,3),Yt.status=bt);else{var De=rt+(Yt.w_bits-8<<4)<<8;De|=(2<=Yt.strategy||Yt.level<2?0:Yt.level<6?1:Yt.level===6?2:3)<<6,Yt.strstart!==0&&(De|=32),De+=31-De%31,Yt.status=bt,ue(Yt,De),Yt.strstart!==0&&(ue(Yt,It.adler>>>16),ue(Yt,65535&It.adler)),It.adler=1}if(Yt.status===69)if(Yt.gzhead.extra){for(Te=Yt.pending;Yt.gzindex<(65535&Yt.gzhead.extra.length)&&(Yt.pending!==Yt.pending_buf_size||(Yt.gzhead.hcrc&&Yt.pending>Te&&(It.adler=Nt(It.adler,Yt.pending_buf,Yt.pending-Te,Te)),tt(It),Te=Yt.pending,Yt.pending!==Yt.pending_buf_size));)nt(Yt,255&Yt.gzhead.extra[Yt.gzindex]),Yt.gzindex++;Yt.gzhead.hcrc&&Yt.pending>Te&&(It.adler=Nt(It.adler,Yt.pending_buf,Yt.pending-Te,Te)),Yt.gzindex===Yt.gzhead.extra.length&&(Yt.gzindex=0,Yt.status=73)}else Yt.status=73;if(Yt.status===73)if(Yt.gzhead.name){Te=Yt.pending;do{if(Yt.pending===Yt.pending_buf_size&&(Yt.gzhead.hcrc&&Yt.pending>Te&&(It.adler=Nt(It.adler,Yt.pending_buf,Yt.pending-Te,Te)),tt(It),Te=Yt.pending,Yt.pending===Yt.pending_buf_size)){me=1;break}me=Yt.gzindex<Yt.gzhead.name.length?255&Yt.gzhead.name.charCodeAt(Yt.gzindex++):0,nt(Yt,me)}while(me!==0);Yt.gzhead.hcrc&&Yt.pending>Te&&(It.adler=Nt(It.adler,Yt.pending_buf,Yt.pending-Te,Te)),me===0&&(Yt.gzindex=0,Yt.status=91)}else Yt.status=91;if(Yt.status===91)if(Yt.gzhead.comment){Te=Yt.pending;do{if(Yt.pending===Yt.pending_buf_size&&(Yt.gzhead.hcrc&&Yt.pending>Te&&(It.adler=Nt(It.adler,Yt.pending_buf,Yt.pending-Te,Te)),tt(It),Te=Yt.pending,Yt.pending===Yt.pending_buf_size)){me=1;break}me=Yt.gzindex<Yt.gzhead.comment.length?255&Yt.gzhead.comment.charCodeAt(Yt.gzindex++):0,nt(Yt,me)}while(me!==0);Yt.gzhead.hcrc&&Yt.pending>Te&&(It.adler=Nt(It.adler,Yt.pending_buf,Yt.pending-Te,Te)),me===0&&(Yt.status=103)}else Yt.status=103;if(Yt.status===103&&(Yt.gzhead.hcrc?(Yt.pending+2>Yt.pending_buf_size&&tt(It),Yt.pending+2<=Yt.pending_buf_size&&(nt(Yt,255&It.adler),nt(Yt,It.adler>>8&255),It.adler=0,Yt.status=bt)):Yt.status=bt),Yt.pending!==0){if(tt(It),It.avail_out===0)return Yt.last_flush=-1,dt}else if(It.avail_in===0&&Mt(Rt)<=Mt(Jt)&&Rt!==4)return ut(It,-5);if(Yt.status===666&&It.avail_in!==0)return ut(It,-5);if(It.avail_in!==0||Yt.lookahead!==0||Rt!==at&&Yt.status!==666){var Ge=Yt.strategy===2?function(Tt,Vt){for(var xe;;){if(Tt.lookahead===0&&(ee(Tt),Tt.lookahead===0)){if(Vt===at)return 1;break}if(Tt.match_length=0,xe=I._tr_tally(Tt,0,Tt.window[Tt.strstart]),Tt.lookahead--,Tt.strstart++,xe&&(Ut(Tt,!1),Tt.strm.avail_out===0))return 1}return Tt.insert=0,Vt===4?(Ut(Tt,!0),Tt.strm.avail_out===0?3:4):Tt.last_lit&&(Ut(Tt,!1),Tt.strm.avail_out===0)?1:2}(Yt,Rt):Yt.strategy===3?function(Tt,Vt){for(var xe,Kt,Me,Se,ke=Tt.window;;){if(Tt.lookahead<=pt){if(ee(Tt),Tt.lookahead<=pt&&Vt===at)return 1;if(Tt.lookahead===0)break}if(Tt.match_length=0,Tt.lookahead>=F&&0<Tt.strstart&&(Kt=ke[Me=Tt.strstart-1])===ke[++Me]&&Kt===ke[++Me]&&Kt===ke[++Me]){Se=Tt.strstart+pt;do;while(Kt===ke[++Me]&&Kt===ke[++Me]&&Kt===ke[++Me]&&Kt===ke[++Me]&&Kt===ke[++Me]&&Kt===ke[++Me]&&Kt===ke[++Me]&&Kt===ke[++Me]&&Me<Se);Tt.match_length=pt-(Se-Me),Tt.match_length>Tt.lookahead&&(Tt.match_length=Tt.lookahead)}if(Tt.match_length>=F?(xe=I._tr_tally(Tt,1,Tt.match_length-F),Tt.lookahead-=Tt.match_length,Tt.strstart+=Tt.match_length,Tt.match_length=0):(xe=I._tr_tally(Tt,0,Tt.window[Tt.strstart]),Tt.lookahead--,Tt.strstart++),xe&&(Ut(Tt,!1),Tt.strm.avail_out===0))return 1}return Tt.insert=0,Vt===4?(Ut(Tt,!0),Tt.strm.avail_out===0?3:4):Tt.last_lit&&(Ut(Tt,!1),Tt.strm.avail_out===0)?1:2}(Yt,Rt):Dt[Yt.level].func(Yt,Rt);if(Ge!==3&&Ge!==4||(Yt.status=666),Ge===1||Ge===3)return It.avail_out===0&&(Yt.last_flush=-1),dt;if(Ge===2&&(Rt===1?I._tr_align(Yt):Rt!==5&&(I._tr_stored_block(Yt,0,0,!1),Rt===3&&(st(Yt.head),Yt.lookahead===0&&(Yt.strstart=0,Yt.block_start=0,Yt.insert=0))),tt(It),It.avail_out===0))return Yt.last_flush=-1,dt}return Rt!==4?dt:Yt.wrap<=0?1:(Yt.wrap===2?(nt(Yt,255&It.adler),nt(Yt,It.adler>>8&255),nt(Yt,It.adler>>16&255),nt(Yt,It.adler>>24&255),nt(Yt,255&It.total_in),nt(Yt,It.total_in>>8&255),nt(Yt,It.total_in>>16&255),nt(Yt,It.total_in>>24&255)):(ue(Yt,It.adler>>>16),ue(Yt,65535&It.adler)),tt(It),0<Yt.wrap&&(Yt.wrap=-Yt.wrap),Yt.pending!==0?dt:1)},Et.deflateEnd=function(It){var Rt;return It&&It.state?(Rt=It.state.status)!==mt&&Rt!==69&&Rt!==73&&Rt!==91&&Rt!==103&&Rt!==bt&&Rt!==666?ut(It,et):(It.state=null,Rt===bt?ut(It,-3):dt):et},Et.deflateSetDictionary=function(It,Rt){var Jt,Yt,Te,me,De,Ge,Tt,Vt,xe=Rt.length;if(!It||!It.state||(me=(Jt=It.state).wrap)===2||me===1&&Jt.status!==mt||Jt.lookahead)return et;for(me===1&&(It.adler=At(It.adler,Rt,xe,0)),Jt.wrap=0,xe>=Jt.w_size&&(me===0&&(st(Jt.head),Jt.strstart=0,Jt.block_start=0,Jt.insert=0),Vt=new Y.Buf8(Jt.w_size),Y.arraySet(Vt,Rt,xe-Jt.w_size,Jt.w_size,0),Rt=Vt,xe=Jt.w_size),De=It.avail_in,Ge=It.next_in,Tt=It.input,It.avail_in=xe,It.next_in=0,It.input=Rt,ee(Jt);Jt.lookahead>=F;){for(Yt=Jt.strstart,Te=Jt.lookahead-(F-1);Jt.ins_h=(Jt.ins_h<<Jt.hash_shift^Jt.window[Yt+F-1])&Jt.hash_mask,Jt.prev[Yt&Jt.w_mask]=Jt.head[Jt.ins_h],Jt.head[Jt.ins_h]=Yt,Yt++,--Te;);Jt.strstart=Yt,Jt.lookahead=F-1,ee(Jt)}return Jt.strstart+=Jt.lookahead,Jt.block_start=Jt.strstart,Jt.insert=Jt.lookahead,Jt.lookahead=0,Jt.match_length=Jt.prev_length=F-1,Jt.match_available=0,It.next_in=Ge,It.input=Tt,It.avail_in=De,Jt.wrap=me,dt},Et.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(Zt,de,Et){de.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(Zt,de,Et){de.exports=function(Dt,Y){var I,At,Nt,ft,at,dt,et,_t,rt,Pt,St,yt,gt,lt,F,pt,ht,mt,bt,ut,Mt,st,tt,Ut,nt;I=Dt.state,At=Dt.next_in,Ut=Dt.input,Nt=At+(Dt.avail_in-5),ft=Dt.next_out,nt=Dt.output,at=ft-(Y-Dt.avail_out),dt=ft+(Dt.avail_out-257),et=I.dmax,_t=I.wsize,rt=I.whave,Pt=I.wnext,St=I.window,yt=I.hold,gt=I.bits,lt=I.lencode,F=I.distcode,pt=(1<<I.lenbits)-1,ht=(1<<I.distbits)-1;t:do{gt<15&&(yt+=Ut[At++]<<gt,gt+=8,yt+=Ut[At++]<<gt,gt+=8),mt=lt[yt&pt];e:for(;;){if(yt>>>=bt=mt>>>24,gt-=bt,(bt=mt>>>16&255)==0)nt[ft++]=65535&mt;else{if(!(16&bt)){if(!(64&bt)){mt=lt[(65535&mt)+(yt&(1<<bt)-1)];continue e}if(32&bt){I.mode=12;break t}Dt.msg="invalid literal/length code",I.mode=30;break t}ut=65535&mt,(bt&=15)&&(gt<bt&&(yt+=Ut[At++]<<gt,gt+=8),ut+=yt&(1<<bt)-1,yt>>>=bt,gt-=bt),gt<15&&(yt+=Ut[At++]<<gt,gt+=8,yt+=Ut[At++]<<gt,gt+=8),mt=F[yt&ht];x:for(;;){if(yt>>>=bt=mt>>>24,gt-=bt,!(16&(bt=mt>>>16&255))){if(!(64&bt)){mt=F[(65535&mt)+(yt&(1<<bt)-1)];continue x}Dt.msg="invalid distance code",I.mode=30;break t}if(Mt=65535&mt,gt<(bt&=15)&&(yt+=Ut[At++]<<gt,(gt+=8)<bt&&(yt+=Ut[At++]<<gt,gt+=8)),et<(Mt+=yt&(1<<bt)-1)){Dt.msg="invalid distance too far back",I.mode=30;break t}if(yt>>>=bt,gt-=bt,(bt=ft-at)<Mt){if(rt<(bt=Mt-bt)&&I.sane){Dt.msg="invalid distance too far back",I.mode=30;break t}if(tt=St,(st=0)===Pt){if(st+=_t-bt,bt<ut){for(ut-=bt;nt[ft++]=St[st++],--bt;);st=ft-Mt,tt=nt}}else if(Pt<bt){if(st+=_t+Pt-bt,(bt-=Pt)<ut){for(ut-=bt;nt[ft++]=St[st++],--bt;);if(st=0,Pt<ut){for(ut-=bt=Pt;nt[ft++]=St[st++],--bt;);st=ft-Mt,tt=nt}}}else if(st+=Pt-bt,bt<ut){for(ut-=bt;nt[ft++]=St[st++],--bt;);st=ft-Mt,tt=nt}for(;2<ut;)nt[ft++]=tt[st++],nt[ft++]=tt[st++],nt[ft++]=tt[st++],ut-=3;ut&&(nt[ft++]=tt[st++],1<ut&&(nt[ft++]=tt[st++]))}else{for(st=ft-Mt;nt[ft++]=nt[st++],nt[ft++]=nt[st++],nt[ft++]=nt[st++],2<(ut-=3););ut&&(nt[ft++]=nt[st++],1<ut&&(nt[ft++]=nt[st++]))}break}}break}}while(At<Nt&&ft<dt);At-=ut=gt>>3,yt&=(1<<(gt-=ut<<3))-1,Dt.next_in=At,Dt.next_out=ft,Dt.avail_in=At<Nt?Nt-At+5:5-(At-Nt),Dt.avail_out=ft<dt?dt-ft+257:257-(ft-dt),I.hold=yt,I.bits=gt}},{}],49:[function(Zt,de,Et){var Dt=Zt("../utils/common"),Y=Zt("./adler32"),I=Zt("./crc32"),At=Zt("./inffast"),Nt=Zt("./inftrees"),ft=0,at=-2,dt=1,et=852,_t=592;function rt(ut){return(ut>>>24&255)+(ut>>>8&65280)+((65280&ut)<<8)+((255&ut)<<24)}function Pt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Dt.Buf16(320),this.work=new Dt.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function St(ut){var Mt;return ut&&ut.state?(Mt=ut.state,ut.total_in=ut.total_out=Mt.total=0,ut.msg="",Mt.wrap&&(ut.adler=1&Mt.wrap),Mt.mode=dt,Mt.last=0,Mt.havedict=0,Mt.dmax=32768,Mt.head=null,Mt.hold=0,Mt.bits=0,Mt.lencode=Mt.lendyn=new Dt.Buf32(et),Mt.distcode=Mt.distdyn=new Dt.Buf32(_t),Mt.sane=1,Mt.back=-1,ft):at}function yt(ut){var Mt;return ut&&ut.state?((Mt=ut.state).wsize=0,Mt.whave=0,Mt.wnext=0,St(ut)):at}function gt(ut,Mt){var st,tt;return ut&&ut.state?(tt=ut.state,Mt<0?(st=0,Mt=-Mt):(st=1+(Mt>>4),Mt<48&&(Mt&=15)),Mt&&(Mt<8||15<Mt)?at:(tt.window!==null&&tt.wbits!==Mt&&(tt.window=null),tt.wrap=st,tt.wbits=Mt,yt(ut))):at}function lt(ut,Mt){var st,tt;return ut?(tt=new Pt,(ut.state=tt).window=null,(st=gt(ut,Mt))!==ft&&(ut.state=null),st):at}var F,pt,ht=!0;function mt(ut){if(ht){var Mt;for(F=new Dt.Buf32(512),pt=new Dt.Buf32(32),Mt=0;Mt<144;)ut.lens[Mt++]=8;for(;Mt<256;)ut.lens[Mt++]=9;for(;Mt<280;)ut.lens[Mt++]=7;for(;Mt<288;)ut.lens[Mt++]=8;for(Nt(1,ut.lens,0,288,F,0,ut.work,{bits:9}),Mt=0;Mt<32;)ut.lens[Mt++]=5;Nt(2,ut.lens,0,32,pt,0,ut.work,{bits:5}),ht=!1}ut.lencode=F,ut.lenbits=9,ut.distcode=pt,ut.distbits=5}function bt(ut,Mt,st,tt){var Ut,nt=ut.state;return nt.window===null&&(nt.wsize=1<<nt.wbits,nt.wnext=0,nt.whave=0,nt.window=new Dt.Buf8(nt.wsize)),tt>=nt.wsize?(Dt.arraySet(nt.window,Mt,st-nt.wsize,nt.wsize,0),nt.wnext=0,nt.whave=nt.wsize):(tt<(Ut=nt.wsize-nt.wnext)&&(Ut=tt),Dt.arraySet(nt.window,Mt,st-tt,Ut,nt.wnext),(tt-=Ut)?(Dt.arraySet(nt.window,Mt,st-tt,tt,0),nt.wnext=tt,nt.whave=nt.wsize):(nt.wnext+=Ut,nt.wnext===nt.wsize&&(nt.wnext=0),nt.whave<nt.wsize&&(nt.whave+=Ut))),0}Et.inflateReset=yt,Et.inflateReset2=gt,Et.inflateResetKeep=St,Et.inflateInit=function(ut){return lt(ut,15)},Et.inflateInit2=lt,Et.inflate=function(ut,Mt){var st,tt,Ut,nt,ue,re,ee,Qt,Lt,pe,be,se,Fe,Pe,It,Rt,Jt,Yt,Te,me,De,Ge,Tt,Vt,xe=0,Kt=new Dt.Buf8(4),Me=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ut||!ut.state||!ut.output||!ut.input&&ut.avail_in!==0)return at;(st=ut.state).mode===12&&(st.mode=13),ue=ut.next_out,Ut=ut.output,ee=ut.avail_out,nt=ut.next_in,tt=ut.input,re=ut.avail_in,Qt=st.hold,Lt=st.bits,pe=re,be=ee,Ge=ft;t:for(;;)switch(st.mode){case dt:if(st.wrap===0){st.mode=13;break}for(;Lt<16;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(2&st.wrap&&Qt===35615){Kt[st.check=0]=255&Qt,Kt[1]=Qt>>>8&255,st.check=I(st.check,Kt,2,0),Lt=Qt=0,st.mode=2;break}if(st.flags=0,st.head&&(st.head.done=!1),!(1&st.wrap)||(((255&Qt)<<8)+(Qt>>8))%31){ut.msg="incorrect header check",st.mode=30;break}if((15&Qt)!=8){ut.msg="unknown compression method",st.mode=30;break}if(Lt-=4,De=8+(15&(Qt>>>=4)),st.wbits===0)st.wbits=De;else if(De>st.wbits){ut.msg="invalid window size",st.mode=30;break}st.dmax=1<<De,ut.adler=st.check=1,st.mode=512&Qt?10:12,Lt=Qt=0;break;case 2:for(;Lt<16;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(st.flags=Qt,(255&st.flags)!=8){ut.msg="unknown compression method",st.mode=30;break}if(57344&st.flags){ut.msg="unknown header flags set",st.mode=30;break}st.head&&(st.head.text=Qt>>8&1),512&st.flags&&(Kt[0]=255&Qt,Kt[1]=Qt>>>8&255,st.check=I(st.check,Kt,2,0)),Lt=Qt=0,st.mode=3;case 3:for(;Lt<32;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}st.head&&(st.head.time=Qt),512&st.flags&&(Kt[0]=255&Qt,Kt[1]=Qt>>>8&255,Kt[2]=Qt>>>16&255,Kt[3]=Qt>>>24&255,st.check=I(st.check,Kt,4,0)),Lt=Qt=0,st.mode=4;case 4:for(;Lt<16;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}st.head&&(st.head.xflags=255&Qt,st.head.os=Qt>>8),512&st.flags&&(Kt[0]=255&Qt,Kt[1]=Qt>>>8&255,st.check=I(st.check,Kt,2,0)),Lt=Qt=0,st.mode=5;case 5:if(1024&st.flags){for(;Lt<16;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}st.length=Qt,st.head&&(st.head.extra_len=Qt),512&st.flags&&(Kt[0]=255&Qt,Kt[1]=Qt>>>8&255,st.check=I(st.check,Kt,2,0)),Lt=Qt=0}else st.head&&(st.head.extra=null);st.mode=6;case 6:if(1024&st.flags&&(re<(se=st.length)&&(se=re),se&&(st.head&&(De=st.head.extra_len-st.length,st.head.extra||(st.head.extra=new Array(st.head.extra_len)),Dt.arraySet(st.head.extra,tt,nt,se,De)),512&st.flags&&(st.check=I(st.check,tt,se,nt)),re-=se,nt+=se,st.length-=se),st.length))break t;st.length=0,st.mode=7;case 7:if(2048&st.flags){if(re===0)break t;for(se=0;De=tt[nt+se++],st.head&&De&&st.length<65536&&(st.head.name+=String.fromCharCode(De)),De&&se<re;);if(512&st.flags&&(st.check=I(st.check,tt,se,nt)),re-=se,nt+=se,De)break t}else st.head&&(st.head.name=null);st.length=0,st.mode=8;case 8:if(4096&st.flags){if(re===0)break t;for(se=0;De=tt[nt+se++],st.head&&De&&st.length<65536&&(st.head.comment+=String.fromCharCode(De)),De&&se<re;);if(512&st.flags&&(st.check=I(st.check,tt,se,nt)),re-=se,nt+=se,De)break t}else st.head&&(st.head.comment=null);st.mode=9;case 9:if(512&st.flags){for(;Lt<16;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(Qt!==(65535&st.check)){ut.msg="header crc mismatch",st.mode=30;break}Lt=Qt=0}st.head&&(st.head.hcrc=st.flags>>9&1,st.head.done=!0),ut.adler=st.check=0,st.mode=12;break;case 10:for(;Lt<32;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}ut.adler=st.check=rt(Qt),Lt=Qt=0,st.mode=11;case 11:if(st.havedict===0)return ut.next_out=ue,ut.avail_out=ee,ut.next_in=nt,ut.avail_in=re,st.hold=Qt,st.bits=Lt,2;ut.adler=st.check=1,st.mode=12;case 12:if(Mt===5||Mt===6)break t;case 13:if(st.last){Qt>>>=7&Lt,Lt-=7&Lt,st.mode=27;break}for(;Lt<3;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}switch(st.last=1&Qt,Lt-=1,3&(Qt>>>=1)){case 0:st.mode=14;break;case 1:if(mt(st),st.mode=20,Mt!==6)break;Qt>>>=2,Lt-=2;break t;case 2:st.mode=17;break;case 3:ut.msg="invalid block type",st.mode=30}Qt>>>=2,Lt-=2;break;case 14:for(Qt>>>=7&Lt,Lt-=7&Lt;Lt<32;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if((65535&Qt)!=(Qt>>>16^65535)){ut.msg="invalid stored block lengths",st.mode=30;break}if(st.length=65535&Qt,Lt=Qt=0,st.mode=15,Mt===6)break t;case 15:st.mode=16;case 16:if(se=st.length){if(re<se&&(se=re),ee<se&&(se=ee),se===0)break t;Dt.arraySet(Ut,tt,nt,se,ue),re-=se,nt+=se,ee-=se,ue+=se,st.length-=se;break}st.mode=12;break;case 17:for(;Lt<14;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(st.nlen=257+(31&Qt),Qt>>>=5,Lt-=5,st.ndist=1+(31&Qt),Qt>>>=5,Lt-=5,st.ncode=4+(15&Qt),Qt>>>=4,Lt-=4,286<st.nlen||30<st.ndist){ut.msg="too many length or distance symbols",st.mode=30;break}st.have=0,st.mode=18;case 18:for(;st.have<st.ncode;){for(;Lt<3;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}st.lens[Me[st.have++]]=7&Qt,Qt>>>=3,Lt-=3}for(;st.have<19;)st.lens[Me[st.have++]]=0;if(st.lencode=st.lendyn,st.lenbits=7,Tt={bits:st.lenbits},Ge=Nt(0,st.lens,0,19,st.lencode,0,st.work,Tt),st.lenbits=Tt.bits,Ge){ut.msg="invalid code lengths set",st.mode=30;break}st.have=0,st.mode=19;case 19:for(;st.have<st.nlen+st.ndist;){for(;Rt=(xe=st.lencode[Qt&(1<<st.lenbits)-1])>>>16&255,Jt=65535&xe,!((It=xe>>>24)<=Lt);){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(Jt<16)Qt>>>=It,Lt-=It,st.lens[st.have++]=Jt;else{if(Jt===16){for(Vt=It+2;Lt<Vt;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(Qt>>>=It,Lt-=It,st.have===0){ut.msg="invalid bit length repeat",st.mode=30;break}De=st.lens[st.have-1],se=3+(3&Qt),Qt>>>=2,Lt-=2}else if(Jt===17){for(Vt=It+3;Lt<Vt;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}Lt-=It,De=0,se=3+(7&(Qt>>>=It)),Qt>>>=3,Lt-=3}else{for(Vt=It+7;Lt<Vt;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}Lt-=It,De=0,se=11+(127&(Qt>>>=It)),Qt>>>=7,Lt-=7}if(st.have+se>st.nlen+st.ndist){ut.msg="invalid bit length repeat",st.mode=30;break}for(;se--;)st.lens[st.have++]=De}}if(st.mode===30)break;if(st.lens[256]===0){ut.msg="invalid code -- missing end-of-block",st.mode=30;break}if(st.lenbits=9,Tt={bits:st.lenbits},Ge=Nt(1,st.lens,0,st.nlen,st.lencode,0,st.work,Tt),st.lenbits=Tt.bits,Ge){ut.msg="invalid literal/lengths set",st.mode=30;break}if(st.distbits=6,st.distcode=st.distdyn,Tt={bits:st.distbits},Ge=Nt(2,st.lens,st.nlen,st.ndist,st.distcode,0,st.work,Tt),st.distbits=Tt.bits,Ge){ut.msg="invalid distances set",st.mode=30;break}if(st.mode=20,Mt===6)break t;case 20:st.mode=21;case 21:if(6<=re&&258<=ee){ut.next_out=ue,ut.avail_out=ee,ut.next_in=nt,ut.avail_in=re,st.hold=Qt,st.bits=Lt,At(ut,be),ue=ut.next_out,Ut=ut.output,ee=ut.avail_out,nt=ut.next_in,tt=ut.input,re=ut.avail_in,Qt=st.hold,Lt=st.bits,st.mode===12&&(st.back=-1);break}for(st.back=0;Rt=(xe=st.lencode[Qt&(1<<st.lenbits)-1])>>>16&255,Jt=65535&xe,!((It=xe>>>24)<=Lt);){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(Rt&&!(240&Rt)){for(Yt=It,Te=Rt,me=Jt;Rt=(xe=st.lencode[me+((Qt&(1<<Yt+Te)-1)>>Yt)])>>>16&255,Jt=65535&xe,!(Yt+(It=xe>>>24)<=Lt);){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}Qt>>>=Yt,Lt-=Yt,st.back+=Yt}if(Qt>>>=It,Lt-=It,st.back+=It,st.length=Jt,Rt===0){st.mode=26;break}if(32&Rt){st.back=-1,st.mode=12;break}if(64&Rt){ut.msg="invalid literal/length code",st.mode=30;break}st.extra=15&Rt,st.mode=22;case 22:if(st.extra){for(Vt=st.extra;Lt<Vt;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}st.length+=Qt&(1<<st.extra)-1,Qt>>>=st.extra,Lt-=st.extra,st.back+=st.extra}st.was=st.length,st.mode=23;case 23:for(;Rt=(xe=st.distcode[Qt&(1<<st.distbits)-1])>>>16&255,Jt=65535&xe,!((It=xe>>>24)<=Lt);){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(!(240&Rt)){for(Yt=It,Te=Rt,me=Jt;Rt=(xe=st.distcode[me+((Qt&(1<<Yt+Te)-1)>>Yt)])>>>16&255,Jt=65535&xe,!(Yt+(It=xe>>>24)<=Lt);){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}Qt>>>=Yt,Lt-=Yt,st.back+=Yt}if(Qt>>>=It,Lt-=It,st.back+=It,64&Rt){ut.msg="invalid distance code",st.mode=30;break}st.offset=Jt,st.extra=15&Rt,st.mode=24;case 24:if(st.extra){for(Vt=st.extra;Lt<Vt;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}st.offset+=Qt&(1<<st.extra)-1,Qt>>>=st.extra,Lt-=st.extra,st.back+=st.extra}if(st.offset>st.dmax){ut.msg="invalid distance too far back",st.mode=30;break}st.mode=25;case 25:if(ee===0)break t;if(se=be-ee,st.offset>se){if((se=st.offset-se)>st.whave&&st.sane){ut.msg="invalid distance too far back",st.mode=30;break}Fe=se>st.wnext?(se-=st.wnext,st.wsize-se):st.wnext-se,se>st.length&&(se=st.length),Pe=st.window}else Pe=Ut,Fe=ue-st.offset,se=st.length;for(ee<se&&(se=ee),ee-=se,st.length-=se;Ut[ue++]=Pe[Fe++],--se;);st.length===0&&(st.mode=21);break;case 26:if(ee===0)break t;Ut[ue++]=st.length,ee--,st.mode=21;break;case 27:if(st.wrap){for(;Lt<32;){if(re===0)break t;re--,Qt|=tt[nt++]<<Lt,Lt+=8}if(be-=ee,ut.total_out+=be,st.total+=be,be&&(ut.adler=st.check=st.flags?I(st.check,Ut,be,ue-be):Y(st.check,Ut,be,ue-be)),be=ee,(st.flags?Qt:rt(Qt))!==st.check){ut.msg="incorrect data check",st.mode=30;break}Lt=Qt=0}st.mode=28;case 28:if(st.wrap&&st.flags){for(;Lt<32;){if(re===0)break t;re--,Qt+=tt[nt++]<<Lt,Lt+=8}if(Qt!==(4294967295&st.total)){ut.msg="incorrect length check",st.mode=30;break}Lt=Qt=0}st.mode=29;case 29:Ge=1;break t;case 30:Ge=-3;break t;case 31:return-4;default:return at}return ut.next_out=ue,ut.avail_out=ee,ut.next_in=nt,ut.avail_in=re,st.hold=Qt,st.bits=Lt,(st.wsize||be!==ut.avail_out&&st.mode<30&&(st.mode<27||Mt!==4))&&bt(ut,ut.output,ut.next_out,be-ut.avail_out)?(st.mode=31,-4):(pe-=ut.avail_in,be-=ut.avail_out,ut.total_in+=pe,ut.total_out+=be,st.total+=be,st.wrap&&be&&(ut.adler=st.check=st.flags?I(st.check,Ut,be,ut.next_out-be):Y(st.check,Ut,be,ut.next_out-be)),ut.data_type=st.bits+(st.last?64:0)+(st.mode===12?128:0)+(st.mode===20||st.mode===15?256:0),(pe==0&&be===0||Mt===4)&&Ge===ft&&(Ge=-5),Ge)},Et.inflateEnd=function(ut){if(!ut||!ut.state)return at;var Mt=ut.state;return Mt.window&&(Mt.window=null),ut.state=null,ft},Et.inflateGetHeader=function(ut,Mt){var st;return ut&&ut.state&&2&(st=ut.state).wrap?((st.head=Mt).done=!1,ft):at},Et.inflateSetDictionary=function(ut,Mt){var st,tt=Mt.length;return ut&&ut.state?(st=ut.state).wrap!==0&&st.mode!==11?at:st.mode===11&&Y(1,Mt,tt,0)!==st.check?-3:bt(ut,Mt,tt,tt)?(st.mode=31,-4):(st.havedict=1,ft):at},Et.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(Zt,de,Et){var Dt=Zt("../utils/common"),Y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],I=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],At=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Nt=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];de.exports=function(ft,at,dt,et,_t,rt,Pt,St){var yt,gt,lt,F,pt,ht,mt,bt,ut,Mt=St.bits,st=0,tt=0,Ut=0,nt=0,ue=0,re=0,ee=0,Qt=0,Lt=0,pe=0,be=null,se=0,Fe=new Dt.Buf16(16),Pe=new Dt.Buf16(16),It=null,Rt=0;for(st=0;st<=15;st++)Fe[st]=0;for(tt=0;tt<et;tt++)Fe[at[dt+tt]]++;for(ue=Mt,nt=15;1<=nt&&Fe[nt]===0;nt--);if(nt<ue&&(ue=nt),nt===0)return _t[rt++]=20971520,_t[rt++]=20971520,St.bits=1,0;for(Ut=1;Ut<nt&&Fe[Ut]===0;Ut++);for(ue<Ut&&(ue=Ut),st=Qt=1;st<=15;st++)if(Qt<<=1,(Qt-=Fe[st])<0)return-1;if(0<Qt&&(ft===0||nt!==1))return-1;for(Pe[1]=0,st=1;st<15;st++)Pe[st+1]=Pe[st]+Fe[st];for(tt=0;tt<et;tt++)at[dt+tt]!==0&&(Pt[Pe[at[dt+tt]]++]=tt);if(ht=ft===0?(be=It=Pt,19):ft===1?(be=Y,se-=257,It=I,Rt-=257,256):(be=At,It=Nt,-1),st=Ut,pt=rt,ee=tt=pe=0,lt=-1,F=(Lt=1<<(re=ue))-1,ft===1&&852<Lt||ft===2&&592<Lt)return 1;for(;;){for(mt=st-ee,ut=Pt[tt]<ht?(bt=0,Pt[tt]):Pt[tt]>ht?(bt=It[Rt+Pt[tt]],be[se+Pt[tt]]):(bt=96,0),yt=1<<st-ee,Ut=gt=1<<re;_t[pt+(pe>>ee)+(gt-=yt)]=mt<<24|bt<<16|ut|0,gt!==0;);for(yt=1<<st-1;pe&yt;)yt>>=1;if(yt!==0?(pe&=yt-1,pe+=yt):pe=0,tt++,--Fe[st]==0){if(st===nt)break;st=at[dt+Pt[tt]]}if(ue<st&&(pe&F)!==lt){for(ee===0&&(ee=ue),pt+=Ut,Qt=1<<(re=st-ee);re+ee<nt&&!((Qt-=Fe[re+ee])<=0);)re++,Qt<<=1;if(Lt+=1<<re,ft===1&&852<Lt||ft===2&&592<Lt)return 1;_t[lt=pe&F]=ue<<24|re<<16|pt-rt|0}}return pe!==0&&(_t[pt+pe]=st-ee<<24|4194304|0),St.bits=ue,0}},{"../utils/common":41}],51:[function(Zt,de,Et){de.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(Zt,de,Et){var Dt=Zt("../utils/common");function Y(Rt){for(var Jt=Rt.length;0<=--Jt;)Rt[Jt]=0}var I=256,At=286,Nt=30,ft=15,at=16,dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],et=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Pt=new Array(576);Y(Pt);var St=new Array(60);Y(St);var yt=new Array(512);Y(yt);var gt=new Array(256);Y(gt);var lt=new Array(29);Y(lt);var F,pt,ht,mt=new Array(Nt);function bt(Rt,Jt,Yt,Te,me){this.static_tree=Rt,this.extra_bits=Jt,this.extra_base=Yt,this.elems=Te,this.max_length=me,this.has_stree=Rt&&Rt.length}function ut(Rt,Jt){this.dyn_tree=Rt,this.max_code=0,this.stat_desc=Jt}function Mt(Rt){return Rt<256?yt[Rt]:yt[256+(Rt>>>7)]}function st(Rt,Jt){Rt.pending_buf[Rt.pending++]=255&Jt,Rt.pending_buf[Rt.pending++]=Jt>>>8&255}function tt(Rt,Jt,Yt){Rt.bi_valid>at-Yt?(Rt.bi_buf|=Jt<<Rt.bi_valid&65535,st(Rt,Rt.bi_buf),Rt.bi_buf=Jt>>at-Rt.bi_valid,Rt.bi_valid+=Yt-at):(Rt.bi_buf|=Jt<<Rt.bi_valid&65535,Rt.bi_valid+=Yt)}function Ut(Rt,Jt,Yt){tt(Rt,Yt[2*Jt],Yt[2*Jt+1])}function nt(Rt,Jt){for(var Yt=0;Yt|=1&Rt,Rt>>>=1,Yt<<=1,0<--Jt;);return Yt>>>1}function ue(Rt,Jt,Yt){var Te,me,De=new Array(ft+1),Ge=0;for(Te=1;Te<=ft;Te++)De[Te]=Ge=Ge+Yt[Te-1]<<1;for(me=0;me<=Jt;me++){var Tt=Rt[2*me+1];Tt!==0&&(Rt[2*me]=nt(De[Tt]++,Tt))}}function re(Rt){var Jt;for(Jt=0;Jt<At;Jt++)Rt.dyn_ltree[2*Jt]=0;for(Jt=0;Jt<Nt;Jt++)Rt.dyn_dtree[2*Jt]=0;for(Jt=0;Jt<19;Jt++)Rt.bl_tree[2*Jt]=0;Rt.dyn_ltree[512]=1,Rt.opt_len=Rt.static_len=0,Rt.last_lit=Rt.matches=0}function ee(Rt){8<Rt.bi_valid?st(Rt,Rt.bi_buf):0<Rt.bi_valid&&(Rt.pending_buf[Rt.pending++]=Rt.bi_buf),Rt.bi_buf=0,Rt.bi_valid=0}function Qt(Rt,Jt,Yt,Te){var me=2*Jt,De=2*Yt;return Rt[me]<Rt[De]||Rt[me]===Rt[De]&&Te[Jt]<=Te[Yt]}function Lt(Rt,Jt,Yt){for(var Te=Rt.heap[Yt],me=Yt<<1;me<=Rt.heap_len&&(me<Rt.heap_len&&Qt(Jt,Rt.heap[me+1],Rt.heap[me],Rt.depth)&&me++,!Qt(Jt,Te,Rt.heap[me],Rt.depth));)Rt.heap[Yt]=Rt.heap[me],Yt=me,me<<=1;Rt.heap[Yt]=Te}function pe(Rt,Jt,Yt){var Te,me,De,Ge,Tt=0;if(Rt.last_lit!==0)for(;Te=Rt.pending_buf[Rt.d_buf+2*Tt]<<8|Rt.pending_buf[Rt.d_buf+2*Tt+1],me=Rt.pending_buf[Rt.l_buf+Tt],Tt++,Te===0?Ut(Rt,me,Jt):(Ut(Rt,(De=gt[me])+I+1,Jt),(Ge=dt[De])!==0&&tt(Rt,me-=lt[De],Ge),Ut(Rt,De=Mt(--Te),Yt),(Ge=et[De])!==0&&tt(Rt,Te-=mt[De],Ge)),Tt<Rt.last_lit;);Ut(Rt,256,Jt)}function be(Rt,Jt){var Yt,Te,me,De=Jt.dyn_tree,Ge=Jt.stat_desc.static_tree,Tt=Jt.stat_desc.has_stree,Vt=Jt.stat_desc.elems,xe=-1;for(Rt.heap_len=0,Rt.heap_max=573,Yt=0;Yt<Vt;Yt++)De[2*Yt]!==0?(Rt.heap[++Rt.heap_len]=xe=Yt,Rt.depth[Yt]=0):De[2*Yt+1]=0;for(;Rt.heap_len<2;)De[2*(me=Rt.heap[++Rt.heap_len]=xe<2?++xe:0)]=1,Rt.depth[me]=0,Rt.opt_len--,Tt&&(Rt.static_len-=Ge[2*me+1]);for(Jt.max_code=xe,Yt=Rt.heap_len>>1;1<=Yt;Yt--)Lt(Rt,De,Yt);for(me=Vt;Yt=Rt.heap[1],Rt.heap[1]=Rt.heap[Rt.heap_len--],Lt(Rt,De,1),Te=Rt.heap[1],Rt.heap[--Rt.heap_max]=Yt,Rt.heap[--Rt.heap_max]=Te,De[2*me]=De[2*Yt]+De[2*Te],Rt.depth[me]=(Rt.depth[Yt]>=Rt.depth[Te]?Rt.depth[Yt]:Rt.depth[Te])+1,De[2*Yt+1]=De[2*Te+1]=me,Rt.heap[1]=me++,Lt(Rt,De,1),2<=Rt.heap_len;);Rt.heap[--Rt.heap_max]=Rt.heap[1],function(Kt,Me){var Se,ke,Ne,Oe,$e,l0,je=Me.dyn_tree,I0=Me.max_code,X0=Me.stat_desc.static_tree,W0=Me.stat_desc.has_stree,U0=Me.stat_desc.extra_bits,J0=Me.stat_desc.extra_base,yx=Me.stat_desc.max_length,cx=0;for(Oe=0;Oe<=ft;Oe++)Kt.bl_count[Oe]=0;for(je[2*Kt.heap[Kt.heap_max]+1]=0,Se=Kt.heap_max+1;Se<573;Se++)yx<(Oe=je[2*je[2*(ke=Kt.heap[Se])+1]+1]+1)&&(Oe=yx,cx++),je[2*ke+1]=Oe,I0<ke||(Kt.bl_count[Oe]++,$e=0,J0<=ke&&($e=U0[ke-J0]),l0=je[2*ke],Kt.opt_len+=l0*(Oe+$e),W0&&(Kt.static_len+=l0*(X0[2*ke+1]+$e)));if(cx!==0){do{for(Oe=yx-1;Kt.bl_count[Oe]===0;)Oe--;Kt.bl_count[Oe]--,Kt.bl_count[Oe+1]+=2,Kt.bl_count[yx]--,cx-=2}while(0<cx);for(Oe=yx;Oe!==0;Oe--)for(ke=Kt.bl_count[Oe];ke!==0;)I0<(Ne=Kt.heap[--Se])||(je[2*Ne+1]!==Oe&&(Kt.opt_len+=(Oe-je[2*Ne+1])*je[2*Ne],je[2*Ne+1]=Oe),ke--)}}(Rt,Jt),ue(De,xe,Rt.bl_count)}function se(Rt,Jt,Yt){var Te,me,De=-1,Ge=Jt[1],Tt=0,Vt=7,xe=4;for(Ge===0&&(Vt=138,xe=3),Jt[2*(Yt+1)+1]=65535,Te=0;Te<=Yt;Te++)me=Ge,Ge=Jt[2*(Te+1)+1],++Tt<Vt&&me===Ge||(Tt<xe?Rt.bl_tree[2*me]+=Tt:me!==0?(me!==De&&Rt.bl_tree[2*me]++,Rt.bl_tree[32]++):Tt<=10?Rt.bl_tree[34]++:Rt.bl_tree[36]++,De=me,xe=(Tt=0)===Ge?(Vt=138,3):me===Ge?(Vt=6,3):(Vt=7,4))}function Fe(Rt,Jt,Yt){var Te,me,De=-1,Ge=Jt[1],Tt=0,Vt=7,xe=4;for(Ge===0&&(Vt=138,xe=3),Te=0;Te<=Yt;Te++)if(me=Ge,Ge=Jt[2*(Te+1)+1],!(++Tt<Vt&&me===Ge)){if(Tt<xe)for(;Ut(Rt,me,Rt.bl_tree),--Tt!=0;);else me!==0?(me!==De&&(Ut(Rt,me,Rt.bl_tree),Tt--),Ut(Rt,16,Rt.bl_tree),tt(Rt,Tt-3,2)):Tt<=10?(Ut(Rt,17,Rt.bl_tree),tt(Rt,Tt-3,3)):(Ut(Rt,18,Rt.bl_tree),tt(Rt,Tt-11,7));De=me,xe=(Tt=0)===Ge?(Vt=138,3):me===Ge?(Vt=6,3):(Vt=7,4)}}Y(mt);var Pe=!1;function It(Rt,Jt,Yt,Te){tt(Rt,0+(Te?1:0),3),function(me,De,Ge,Tt){ee(me),st(me,Ge),st(me,~Ge),Dt.arraySet(me.pending_buf,me.window,De,Ge,me.pending),me.pending+=Ge}(Rt,Jt,Yt)}Et._tr_init=function(Rt){Pe||(function(){var Jt,Yt,Te,me,De,Ge=new Array(ft+1);for(me=Te=0;me<28;me++)for(lt[me]=Te,Jt=0;Jt<1<<dt[me];Jt++)gt[Te++]=me;for(gt[Te-1]=me,me=De=0;me<16;me++)for(mt[me]=De,Jt=0;Jt<1<<et[me];Jt++)yt[De++]=me;for(De>>=7;me<Nt;me++)for(mt[me]=De<<7,Jt=0;Jt<1<<et[me]-7;Jt++)yt[256+De++]=me;for(Yt=0;Yt<=ft;Yt++)Ge[Yt]=0;for(Jt=0;Jt<=143;)Pt[2*Jt+1]=8,Jt++,Ge[8]++;for(;Jt<=255;)Pt[2*Jt+1]=9,Jt++,Ge[9]++;for(;Jt<=279;)Pt[2*Jt+1]=7,Jt++,Ge[7]++;for(;Jt<=287;)Pt[2*Jt+1]=8,Jt++,Ge[8]++;for(ue(Pt,287,Ge),Jt=0;Jt<Nt;Jt++)St[2*Jt+1]=5,St[2*Jt]=nt(Jt,5);F=new bt(Pt,dt,257,At,ft),pt=new bt(St,et,0,Nt,ft),ht=new bt(new Array(0),_t,0,19,7)}(),Pe=!0),Rt.l_desc=new ut(Rt.dyn_ltree,F),Rt.d_desc=new ut(Rt.dyn_dtree,pt),Rt.bl_desc=new ut(Rt.bl_tree,ht),Rt.bi_buf=0,Rt.bi_valid=0,re(Rt)},Et._tr_stored_block=It,Et._tr_flush_block=function(Rt,Jt,Yt,Te){var me,De,Ge=0;0<Rt.level?(Rt.strm.data_type===2&&(Rt.strm.data_type=function(Tt){var Vt,xe=4093624447;for(Vt=0;Vt<=31;Vt++,xe>>>=1)if(1&xe&&Tt.dyn_ltree[2*Vt]!==0)return 0;if(Tt.dyn_ltree[18]!==0||Tt.dyn_ltree[20]!==0||Tt.dyn_ltree[26]!==0)return 1;for(Vt=32;Vt<I;Vt++)if(Tt.dyn_ltree[2*Vt]!==0)return 1;return 0}(Rt)),be(Rt,Rt.l_desc),be(Rt,Rt.d_desc),Ge=function(Tt){var Vt;for(se(Tt,Tt.dyn_ltree,Tt.l_desc.max_code),se(Tt,Tt.dyn_dtree,Tt.d_desc.max_code),be(Tt,Tt.bl_desc),Vt=18;3<=Vt&&Tt.bl_tree[2*rt[Vt]+1]===0;Vt--);return Tt.opt_len+=3*(Vt+1)+5+5+4,Vt}(Rt),me=Rt.opt_len+3+7>>>3,(De=Rt.static_len+3+7>>>3)<=me&&(me=De)):me=De=Yt+5,Yt+4<=me&&Jt!==-1?It(Rt,Jt,Yt,Te):Rt.strategy===4||De===me?(tt(Rt,2+(Te?1:0),3),pe(Rt,Pt,St)):(tt(Rt,4+(Te?1:0),3),function(Tt,Vt,xe,Kt){var Me;for(tt(Tt,Vt-257,5),tt(Tt,xe-1,5),tt(Tt,Kt-4,4),Me=0;Me<Kt;Me++)tt(Tt,Tt.bl_tree[2*rt[Me]+1],3);Fe(Tt,Tt.dyn_ltree,Vt-1),Fe(Tt,Tt.dyn_dtree,xe-1)}(Rt,Rt.l_desc.max_code+1,Rt.d_desc.max_code+1,Ge+1),pe(Rt,Rt.dyn_ltree,Rt.dyn_dtree)),re(Rt),Te&&ee(Rt)},Et._tr_tally=function(Rt,Jt,Yt){return Rt.pending_buf[Rt.d_buf+2*Rt.last_lit]=Jt>>>8&255,Rt.pending_buf[Rt.d_buf+2*Rt.last_lit+1]=255&Jt,Rt.pending_buf[Rt.l_buf+Rt.last_lit]=255&Yt,Rt.last_lit++,Jt===0?Rt.dyn_ltree[2*Yt]++:(Rt.matches++,Jt--,Rt.dyn_ltree[2*(gt[Yt]+I+1)]++,Rt.dyn_dtree[2*Mt(Jt)]++),Rt.last_lit===Rt.lit_bufsize-1},Et._tr_align=function(Rt){tt(Rt,2,3),Ut(Rt,256,Pt),function(Jt){Jt.bi_valid===16?(st(Jt,Jt.bi_buf),Jt.bi_buf=0,Jt.bi_valid=0):8<=Jt.bi_valid&&(Jt.pending_buf[Jt.pending++]=255&Jt.bi_buf,Jt.bi_buf>>=8,Jt.bi_valid-=8)}(Rt)}},{"../utils/common":41}],53:[function(Zt,de,Et){de.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(Zt,de,Et){(function(Dt){(function(Y,I){if(!Y.setImmediate){var At,Nt,ft,at,dt=1,et={},_t=!1,rt=Y.document,Pt=Object.getPrototypeOf&&Object.getPrototypeOf(Y);Pt=Pt&&Pt.setTimeout?Pt:Y,At={}.toString.call(Y.process)==="[object process]"?function(lt){process.nextTick(function(){yt(lt)})}:function(){if(Y.postMessage&&!Y.importScripts){var lt=!0,F=Y.onmessage;return Y.onmessage=function(){lt=!1},Y.postMessage("","*"),Y.onmessage=F,lt}}()?(at="setImmediate$"+Math.random()+"$",Y.addEventListener?Y.addEventListener("message",gt,!1):Y.attachEvent("onmessage",gt),function(lt){Y.postMessage(at+lt,"*")}):Y.MessageChannel?((ft=new MessageChannel).port1.onmessage=function(lt){yt(lt.data)},function(lt){ft.port2.postMessage(lt)}):rt&&"onreadystatechange"in rt.createElement("script")?(Nt=rt.documentElement,function(lt){var F=rt.createElement("script");F.onreadystatechange=function(){yt(lt),F.onreadystatechange=null,Nt.removeChild(F),F=null},Nt.appendChild(F)}):function(lt){setTimeout(yt,0,lt)},Pt.setImmediate=function(lt){typeof lt!="function"&&(lt=new Function(""+lt));for(var F=new Array(arguments.length-1),pt=0;pt<F.length;pt++)F[pt]=arguments[pt+1];var ht={callback:lt,args:F};return et[dt]=ht,At(dt),dt++},Pt.clearImmediate=St}function St(lt){delete et[lt]}function yt(lt){if(_t)setTimeout(yt,0,lt);else{var F=et[lt];if(F){_t=!0;try{(function(pt){var ht=pt.callback,mt=pt.args;switch(mt.length){case 0:ht();break;case 1:ht(mt[0]);break;case 2:ht(mt[0],mt[1]);break;case 3:ht(mt[0],mt[1],mt[2]);break;default:ht.apply(I,mt)}})(F)}finally{St(lt),_t=!1}}}}function gt(lt){lt.source===Y&&typeof lt.data=="string"&&lt.data.indexOf(at)===0&&yt(+lt.data.slice(at.length))}})(typeof self>"u"?Dt===void 0?this:Dt:self)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)},838:(Je,Ce,ne)=>{ne.d(Ce,{v:()=>Zt});const Zt={Debug:!0,resourcePath:"public",defaultLegendPath:"public/styles/colors",fieldLoaderIndicator:"#",fieldPropertiesIndicator:"$",themeIndicator:"@",functionIndicator:"//!QuickEarth",customPanes:{feature:{name:"featurePane",zIdx:450},filled:{name:"filledPane",zIdx:380},topmap:{name:"tommapPane",zIdx:430},bottommap:{name:"bottommapPane",zIdx:260},station:{name:"stationPane",zIdx:480},bellowtile:{name:"bellowtilePane",zIdx:100}},defaultUndef:999999,useWebGL2:!0,checkRetina:!0,retinaRatio:void 0,licPath:"public/qe.lic",wasmPath:"public/libs/wasm",workerPath:"public/libs/workers"};Zt.defaultLegendPath=Zt.resourcePath+"/styles/colors",Zt.licPath=Zt.resourcePath+"/qe.lic",Zt.wasmPath=Zt.resourcePath+"/libs/wasm"},915:(Je,Ce,ne)=>{ne.d(Ce,{c:()=>Dt});var Zt=ne(923),de=ne(1);function Et(){return!1}class Dt{constructor(){this._events={},this._firingCount=0,this._eventParents={},this._locked=0,this._lockedEvents={}}on(I,At,Nt){if(typeof I=="object")for(var ft in I)this._on(ft,I[ft],At);else for(var at=0,dt=(I=(0,de.nf)(I)).length;at<dt;at++)this._on(I[at],At,Nt);return this}off(I,At,Nt){if(I)if(typeof I=="object")for(var ft in I)this._off(ft,I[ft],At);else for(var at=0,dt=(I=(0,de.nf)(I)).length;at<dt;at++)this._off(I[at],At,Nt);else delete this._events;return this}lock(){return this._locked++,this}unlock(I=!0){if(this._locked--,this._locked<0&&(this._locked=0),this._locked===0&&I){const At=Object.keys(this._lockedEvents);for(const Nt of At)this.fire(Nt,this._lockedEvents[Nt].data,this._lockedEvents[Nt].prop);At.length>0&&Zt.kg.debug("locked msg fired,count "+At.length)}}_on(I,At,Nt){this._events=this._events||{};var ft=this._events[I];ft||(ft=[],this._events[I]=ft),Nt===this&&(Nt=void 0);for(var at={fn:At,ctx:Nt},dt=ft,et=0,_t=dt.length;et<_t;et++)if(dt[et].fn===At&&dt[et].ctx===Nt)return;dt.push(at)}_off(I,At,Nt){var ft,at,dt;if(this._events&&(ft=this._events[I]))if(At){if(Nt===this&&(Nt=void 0),ft)for(at=0,dt=ft.length;at<dt;at++){var et=ft[at];if(et.ctx===Nt&&et.fn===At)return et.fn=Et,this._firingCount&&(this._events[I]=ft=ft.slice()),void ft.splice(at,1)}}else{for(at=0,dt=ft.length;at<dt;at++)ft[at].fn=Et;delete this._events[I]}}fire(I,At,Nt){if(!(this._locked>0)){if(!this.listens(I,Nt))return this;var ft=(0,de.l7)({},At,{type:I,target:this,sourceTarget:At&&At.firer||this});if(this._events){var at=this._events[I];if(at){this._firingCount=this._firingCount+1||1;for(var dt=0,et=at.length;dt<et;dt++){var _t=at[dt];_t.fn.call(_t.ctx||this,ft)}this._firingCount--}}return Nt&&this._propagateEvent(ft),this}this._lockedEvents[I]={data:At,prop:Nt}}listens(I,At){var Nt=this._events&&this._events[I];if(Nt&&Nt.length)return!0;if(At){for(var ft in this._eventParents)if(this._eventParents[ft].listens(I,At))return!0}return!1}once(I,At,Nt){if(typeof I=="object"){for(var ft in I)this.once(ft,I[ft],At);return this}var at=function(dt,et){var _t=Array.prototype.slice;if(dt.bind)return dt.bind.apply(dt,_t.call(arguments,1));var rt=_t.call(arguments,2);return function(){return dt.apply(et,rt.length?rt.concat(_t.call(arguments)):arguments)}}(function(){this.off(I,At,Nt).off(I,at,Nt)},this);return this.on(I,At,Nt).on(I,at,Nt)}addEventParent(I){return this._eventParents=this._eventParents||{},this._eventParents[(0,de.Rc)(I)]=I,this}removeEventParent(I){return this._eventParents&&delete this._eventParents[(0,de.Rc)(I)],this}_propagateEvent(I){for(var At in this._eventParents)this._eventParents[At].fire(I.type,(0,de.l7)({layer:I.target,propagatedFrom:I.target},I),!0)}}},413:(Je,Ce,ne)=>{ne.d(Ce,{CI:()=>F,Fj:()=>dt,JW:()=>at,Jf:()=>rt,M:()=>ut,NX:()=>Mt,PE:()=>lt,SC:()=>pt,Tw:()=>yt,Xx:()=>ht,_7:()=>mt,cQ:()=>Pt,oL:()=>gt,pd:()=>et,q$:()=>_t,rJ:()=>St,sC:()=>bt});var Zt=ne(923),de=ne(251),Et=ne(1),Dt=ne(838),Y=ne(576),I=ne(478),At=ne(608),Nt=ne(307);function ft(st,tt){let Ut,nt,ue=tt;if(tt.indexOf(Dt.v.fieldLoaderIndicator)>0){const ee=ue.split(Dt.v.fieldLoaderIndicator);ue=ee[0];const Qt=ee[1].split("?");nt=(0,Nt.vl)(Qt[1]),Ut=(0,de.nA)(Qt[0])}else tt.indexOf(Dt.v.fieldLoaderIndicator)===0&&(ue=tt.slice(1),Zt.kg.error("引用类型字段中的loader标记不能是第一个字符！"+tt));const re=st.properties&&st.properties[ue];if(re!=null)return Ut?Ut(re,Object.assign(Object.assign({},nt),{feature:st,fieldName:ue})):re}function at(st){const tt=(0,Nt.it)(st);if(typeof tt=="number")return Ut=>tt;if(typeof tt=="function")return tt;if(typeof tt=="object"&&tt.stops){const Ut=new At.NB(tt,nt=>(nt.stop=parseFloat(nt.stop),nt));return nt=>Ut.getRule(nt.properties[Ut.fieldName]).stop}if(typeof tt=="string"){if(tt.startsWith(Dt.v.fieldPropertiesIndicator)){const Ut=tt.substr(1);return nt=>ft(nt,Ut)}{const Ut=parseFloat(tt);return Ut===void 0&&Zt.kg.error("提供了非数值属性"+tt+"！"),nt=>Ut}}Zt.kg.error("数字字段不支持当前类型："+typeof tt)}function dt(st){const tt=(0,Nt.it)(st);if(typeof tt=="number"){const Ut=tt.toString();return nt=>Ut}if(typeof tt=="function")return tt;if(typeof tt=="object"&&tt.stops){const Ut=new At.NB(tt,nt=>(nt.stop.toString&&nt.stop.toString(),nt));return nt=>Ut.getRule(nt.properties[Ut.fieldName]).stop}if(typeof tt=="string"){if(tt.startsWith(Dt.v.fieldPropertiesIndicator)){let Ut=tt.substr(1);return nt=>ft(nt,Ut)}return Ut=>tt}Zt.kg.error("字符串字段不支持当前类型："+typeof tt)}function et(st){const tt=(0,Nt.it)(st);if(typeof tt=="number"){const Ut=tt!==0;return nt=>Ut}if(typeof tt=="boolean")return Ut=>tt;if(typeof tt=="function")return tt;if(typeof tt=="object"&&tt.stops){const Ut=new At.NB(tt);return nt=>Ut.getRule(nt.properties[Ut.fieldName]).stop}if(typeof tt=="string"){if(tt.startsWith(Dt.v.fieldPropertiesIndicator)){const Ut=tt.substr(1);return nt=>{const ue=ft(nt,Ut);return!!ue&&(typeof ue=="number"?ue!==0:typeof ue=="string"?ue!=="0"&&ue.toLowerCase()!=="false":ue!==!1)}}{const Ut=tt!=="0"&&tt.toLowerCase()!=="false";return nt=>Ut}}Zt.kg.error("逻辑字段不支持当前类型："+typeof tt)}function _t(st){const tt=(0,Nt.it)(st);if(tt instanceof Array)return Ut=>tt;if(typeof tt=="function")return tt;if(typeof tt=="object"&&tt.stops){const Ut=new At.NB(tt);return nt=>Ut.getRule(nt.properties[Ut.fieldName]).stop}Zt.kg.error("数值数组字段不支持当前类型："+typeof tt)}function rt(st){const tt=(0,Nt.it)(st);if(typeof tt=="string"){if(tt.startsWith(Dt.v.fieldPropertiesIndicator)){const Ut=tt.substr(1);return nt=>{const ue=ft(nt,Ut);return ue?typeof ue=="string"?(0,Nt.$P)(ue):typeof ue=="number"?(0,Nt.lW)(ue):ue instanceof I.t?ue:ue instanceof Array?(0,Nt.LH)(ue):void Zt.kg.error("不能识别的颜色类型！"+ue):new I.t("black")}}{const Ut=(0,Nt.$P)(tt);return nt=>Ut}}if(typeof tt=="number"){const Ut=(0,Nt.lW)(tt);return nt=>Ut}if(tt instanceof I.t)return Ut=>tt;if(tt instanceof Array){const Ut=new I.t({r:tt[0],g:tt[1],b:tt[2],a:tt.length===3?1:tt[3]});return nt=>Ut}if(typeof tt=="function")return Ut=>{const nt=tt(Ut);return nt instanceof I.t?nt:typeof nt=="string"?(0,Nt.$P)(nt):typeof nt=="number"?(0,Nt.lW)(nt):nt instanceof Array?(0,Nt.LH)(nt):void Zt.kg.warn("不支持的颜色类型！")};if(typeof tt=="object"&&(tt.r!==void 0||tt.red!==void 0)){const Ut=new I.t(tt);return nt=>Ut}if(typeof tt=="object"&&tt.stops){const Ut=new At.NB(tt,Nt.$k);return nt=>Ut.getRule(nt.properties[Ut.fieldName]).stop}Zt.kg.error("颜色字段不支持当前类型："+typeof tt)}function Pt(st){const tt=(0,Nt.it)(st);if(typeof tt=="string"){if(tt.startsWith(Dt.v.fieldPropertiesIndicator)){const Ut=tt.substr(1);return nt=>ft(nt,Ut)}return Ut=>tt}if(tt instanceof HTMLImageElement||tt instanceof HTMLVideoElement||tt instanceof HTMLCanvasElement)return Ut=>tt;if(typeof tt=="function")return tt;if(typeof tt=="object"&&tt.stops){const Ut=new At.NB(tt);return nt=>Ut.getRule(nt.properties[Ut.fieldName]).stop}Zt.kg.error("图像字段不支持当前类型："+typeof tt)}class St extends Nt.Uw{_createCacheId(tt){if((0,Et.ri)(tt))return tt.id||(tt.id=(0,Et.hQ)())}}class yt extends St{constructor(tt){super(tt),tt.data||Zt.kg.error("图像数据是必选字段！"),this._update(tt,!0)}_update(tt,Ut){Ut?(this.size=_t((0,Et.En)(tt.size,yt.DefaultOptions.size)),this.data=Pt(tt.data),this.visible=et((0,Et.En)(tt.visible,yt.DefaultOptions.visible)),this.avoidCollison=et((0,Et.En)(tt.avoidCollison,yt.DefaultOptions.avoidCollison)),this.shadowOffset=_t((0,Et.En)(tt.shadowOffset,yt.DefaultOptions.shadowOffset)),this.shadowBlur=at((0,Et.En)(tt.shadowBlur,yt.DefaultOptions.shadowBlur)),this.heightMode=(0,Et.En)(tt.heightMode,yt.DefaultOptions.heightMode),this.depthTest=et((0,Et.En)(tt.depthTest,yt.DefaultOptions.depthTest)),this.offset=_t((0,Et.En)(tt.offset,yt.DefaultOptions.offset)),this.eyeOffset=_t((0,Et.En)(tt.eyeOffset,yt.DefaultOptions.eyeOffset)),this.sizeInMeters=et((0,Et.En)(tt.sizeInMeters,yt.DefaultOptions.sizeInMeters))):(this.size=(0,Et.Rf)(tt.size,this.size,_t),this.data=(0,Et.Rf)(tt.data,this.data,Pt),this.visible=(0,Et.Rf)(tt.visible,this.visible,et),this.avoidCollison=(0,Et.Rf)(tt.avoidCollison,this.avoidCollison,et),this.shadowOffset=(0,Et.Rf)(tt.shadowOffset,this.shadowOffset,_t),this.shadowBlur=(0,Et.Rf)(tt.shadowBlur,this.shadowBlur,at),this.heightMode=(0,Et.Rf)(tt.heightMode,this.heightMode),this.depthTest=(0,Et.Rf)(tt.depthTest,this.depthTest,et),this.offset=(0,Et.Rf)(tt.offset,this.offset,_t),this.eyeOffset=(0,Et.Rf)(tt.eyeOffset,this.eyeOffset,_t),this.sizeInMeters=(0,Et.Rf)(tt.sizeInMeters,this.sizeInMeters,et)),this.angle=(0,Et.Rf)(tt.angle,this.angle,at),this.shadowColor=(0,Et.Rf)(tt.shadowColor,this.shadowColor,rt),this.color=(0,Et.Rf)(tt.color,this.color,rt)}}yt.DefaultOptions={data:void 0,size:[32,32],visible:!0,avoidCollison:!1,shadowBlur:5,shadowOffset:[5,5],heightMode:"none",depthTest:!0,offset:[0,0],eyeOffset:[0,0,0],sizeInMeters:!1};class gt extends St{constructor(tt){super(tt),tt&&tt.data||Zt.kg.error("文本类data字段不能为空！"),this._update(tt,!0)}_update(tt,Ut){Ut?(this.data=dt(tt.data),this.font=dt((0,Et.En)(tt.font,gt.DefaultOptions.font)),this.color=rt((0,Et.En)(tt.color,gt.DefaultOptions.color)),this.visible=et((0,Et.En)(tt.visible,gt.DefaultOptions.visible)),this.avoidCollison=et((0,Et.En)(tt.avoidCollison,gt.DefaultOptions.avoidCollison)),this.collisionExtendSize=_t((0,Et.En)(tt.collisionExtendSize,gt.DefaultOptions.collisionExtendSize)),this.backHeight=at((0,Et.En)(tt.backHeight,gt.DefaultOptions.backHeight)),this.backPadding=_t((0,Et.En)(tt.backPadding,gt.DefaultOptions.backPadding)),this.strokeWidth=at((0,Et.En)(tt.strokeWidth,gt.DefaultOptions.strokeWidth)),this.backStrokeWidth=at((0,Et.En)(tt.backStrokeWidth,gt.DefaultOptions.backStrokeWidth)),this.align=dt((0,Et.En)(tt.align,gt.DefaultOptions.align)),this.baseline=dt((0,Et.En)(tt.baseline,gt.DefaultOptions.baseline)),this.backShadowBlur=at((0,Et.En)(tt.backShadowBlur,gt.DefaultOptions.backShadowBlur)),this.backShadowOffset=_t((0,Et.En)(tt.backShadowOffset,gt.DefaultOptions.backShadowOffset)),this.shadowOffset=_t((0,Et.En)(tt.shadowOffset,gt.DefaultOptions.shadowOffset)),this.shadowBlur=at((0,Et.En)(tt.shadowBlur,gt.DefaultOptions.shadowBlur)),this.backRoundRadius=at((0,Et.En)(tt.backRoundRadius,gt.DefaultOptions.backRoundRadius)),this.heightMode=(0,Et.En)(tt.heightMode,gt.DefaultOptions.heightMode),this.forceImage=et((0,Et.En)(tt.forceImage,gt.DefaultOptions.forceImage)),this.depthTest=et((0,Et.En)(tt.depthTest,gt.DefaultOptions.depthTest)),this.eyeOffset=_t((0,Et.En)(tt.eyeOffset,gt.DefaultOptions.eyeOffset))):(this.data=(0,Et.Rf)(tt.data,this.data,dt),this.font=(0,Et.Rf)(tt.font,this.font,dt),this.color=(0,Et.Rf)(tt.color,this.color,rt),this.visible=(0,Et.Rf)(tt.visible,this.visible,et),this.avoidCollison=(0,Et.Rf)(tt.avoidCollison,this.avoidCollison,et),this.collisionExtendSize=(0,Et.Rf)(tt.collisionExtendSize,this.collisionExtendSize,_t),this.backHeight=(0,Et.Rf)(tt.backHeight,this.backHeight,at),this.backPadding=(0,Et.Rf)(tt.backPadding,this.backPadding,_t),this.strokeWidth=(0,Et.Rf)(tt.strokeWidth,this.strokeWidth,at),this.backStrokeWidth=(0,Et.Rf)(tt.backStrokeWidth,this.backStrokeWidth,at),this.align=(0,Et.Rf)(tt.align,this.align,dt),this.baseline=(0,Et.Rf)(tt.baseline,this.baseline,dt),this.backShadowOffset=(0,Et.Rf)(tt.backShadowOffset,this.backShadowOffset,_t),this.backShadowBlur=(0,Et.Rf)(tt.backShadowBlur,this.backShadowBlur,at),this.shadowOffset=(0,Et.Rf)(tt.shadowOffset,this.shadowOffset,_t),this.shadowBlur=(0,Et.Rf)(tt.shadowBlur,this.shadowBlur,at),this.backRoundRadius=(0,Et.Rf)(tt.backRoundRadius,this.backRoundRadius,at),this.heightMode=(0,Et.Rf)(tt.heightMode,this.heightMode),this.forceImage=(0,Et.Rf)(tt.forceImage,this.forceImage,et),this.depthTest=(0,Et.Rf)(tt.depthTest,this.depthTest,et),this.eyeOffset=(0,Et.Rf)(tt.eyeOffset,this.eyeOffset,_t)),this.angle=(0,Et.Rf)(tt.angle,this.angle,at),this.strokeColor=(0,Et.Rf)(tt.strokeColor,this.strokeColor,rt),this.backColor=(0,Et.Rf)(tt.backColor,this.backColor,rt),this.backCircle=(0,Et.Rf)(tt.backCircle,this.backCircle,et),this.offset=(0,Et.Rf)(tt.offset,this.offset,_t),this.backStrokeColor=(0,Et.Rf)(tt.backStrokeColor,this.backStrokeColor,rt),this.backRoundRect=(0,Et.Rf)(tt.backRoundRect,this.backRoundRect,et),this.backShadowColor=(0,Et.Rf)(tt.backShadowColor,this.backShadowColor,rt),this.backStrokeDashArray=(0,Et.Rf)(tt.backStrokeDashArray,this.backStrokeDashArray,_t),this.shadowColor=(0,Et.Rf)(tt.shadowColor,this.shadowColor,rt),this.backWidth=(0,Et.Rf)(tt.backWidth,this.backWidth,at),this.forceImageSize=(0,Et.Rf)(tt.forceImageSize,this.forceImageSize,_t)}}gt.DefaultOptions={data:void 0,font:"12px 微软雅黑",color:"black",visible:!0,avoidCollison:!1,collisionExtendSize:[0,0],backHeight:14,backPadding:[5,4],strokeWidth:1,backStrokeWidth:1,align:"center",baseline:"middle",backShadowBlur:6,backShadowOffset:[3,3],shadowBlur:6,shadowOffset:[3,3],backRoundRadius:6,heightMode:"none",forceImage:!1,depthTest:!0,eyeOffset:[0,0,0]};class lt extends St{constructor(tt){super(tt),tt||Zt.kg.error("当提供标签字段时，标签字段选项不能为空！"),this._update(tt,!0)}_update(tt,Ut){tt.image&&(this.image&&!Ut?this.image.update(tt.image):this.image=new yt(tt.image)),tt.text&&(this.text&&!Ut?this.text.update(tt.text):this.text=new gt(tt.text))}}class F extends St{constructor(tt){super(tt),tt||Zt.kg.error("点线面的样式构造参数为空！"),this._update(tt,!0)}_update(tt,Ut){Ut?(this.color=rt((0,Et.En)(tt.color,F.DefaultOptions.color)),this.visible=et((0,Et.En)(tt.visible,F.DefaultOptions.visible)),this.shadowOffset=_t((0,Et.En)(tt.shadowOffset,F.DefaultOptions.shadowOffset)),this.shadowBlur=at((0,Et.En)(tt.shadowBlur,F.DefaultOptions.shadowBlur)),this.usePositionHeight=et((0,Et.En)(tt.usePositionHeight,F.DefaultOptions.usePositionHeight)),this.height=at((0,Et.En)(tt.height,F.DefaultOptions.height)),this.zoomMin=at((0,Et.En)(tt.zoomMin,F.DefaultOptions.zoomMin)),this.zoomMax=at((0,Et.En)(tt.zoomMax,F.DefaultOptions.zoomMax)),this.heightOffset=at((0,Et.En)(tt.heightOffset,F.DefaultOptions.heightOffset)),this.heightMin=at((0,Et.En)(tt.heightMin,F.DefaultOptions.heightMin)),this.heightMax=at((0,Et.En)(tt.heightMax,F.DefaultOptions.heightMax))):(this.color=(0,Et.Rf)(tt.color,this.color,rt),this.visible=(0,Et.Rf)(tt.visible,this.visible,et),this.shadowOffset=(0,Et.Rf)(tt.shadowOffset,this.shadowOffset,_t),this.shadowBlur=(0,Et.Rf)(tt.shadowBlur,this.shadowBlur,at),this.usePositionHeight=(0,Et.Rf)(tt.usePositionHeight,this.usePositionHeight,et),this.height=(0,Et.Rf)(tt.height,this.height,at),this.zoomMin=(0,Et.Rf)(tt.zoomMin,this.zoomMin,at),this.zoomMax=(0,Et.Rf)(tt.zoomMax,this.zoomMax,at),this.heightOffset=(0,Et.Rf)(tt.heightOffset,this.heightOffset,at),this.heightMin=(0,Et.Rf)(tt.heightMin,this.heightMin,at),this.heightMax=(0,Et.Rf)(tt.heightMax,this.heightMax,at)),this.shadowColor=(0,Et.Rf)(tt.shadowColor,this.shadowColor,rt)}}F.DefaultOptions={color:"rgba(22,7,201,0.7)",visible:!0,shadowOffset:[10,10],shadowBlur:10,usePositionHeight:!1,height:0,zoomMin:0,zoomMax:100,heightOffset:10,heightMin:0,heightMax:1/0};class pt extends F{constructor(tt){super(tt),this._update(tt,!0)}updateLabels(tt){const Ut=[];if(tt.label&&tt.label.length>0)for(const nt of tt.label)Ut.push(new lt(nt));this.label=Ut}_update(tt,Ut){super._update(tt,Ut),Ut?(this.size=at((0,Et.En)(tt.size,pt.DefaultOptions.size)),this.fill=et((0,Et.En)(tt.fill,pt.DefaultOptions.fill)),this.strokeWidth=at((0,Et.En)(tt.strokeWidth,pt.DefaultOptions.strokeWidth)),this.collisionBuffer=_t((0,Et.En)(tt.collisionBuffer,pt.DefaultOptions.collisionBuffer))):(this.size=(0,Et.Rf)(tt.size,this.size,at),this.fill=(0,Et.Rf)(tt.fill,this.fill,et),this.strokeWidth=(0,Et.Rf)(tt.strokeWidth,this.strokeWidth,at),this.collisionBuffer=(0,Et.Rf)(tt.collisionBuffer,this.collisionBuffer,_t)),this.strokeColor=(0,Et.Rf)(tt.strokeColor,this.strokeColor,rt),this.strokeDashArray=(0,Et.Rf)(tt.strokeDashArray,this.strokeDashArray,_t),this.avoidCollison=(0,Et.Rf)(tt.avoidCollison,this.avoidCollison,et),this.updateLabels(tt)}}pt.DefaultOptions={color:"rgba(22,7,201,0.7)",visible:!0,size:5,fill:!0,strokeWidth:1,shadowOffset:[5,5],shadowBlur:10,collisionBuffer:[0,0]};class ht extends F{constructor(tt){super(tt),this._update(tt,!0)}_update(tt,Ut){super._update(tt,Ut),Ut?(this.width=at((0,Et.En)(tt.width,ht.DefaultOptions.width)),this.labelDistance=at((0,Et.En)(tt.labelDistance,ht.DefaultOptions.labelDistance)),this.labelDistance3D=at((0,Et.En)(tt.labelDistance3D,ht.DefaultOptions.labelDistance3D)),this.labelAutoFlip=et((0,Et.En)(tt.labelAutoFlip,ht.DefaultOptions.labelAutoFlip))):(this.width=(0,Et.Rf)(tt.width,this.width,at),this.labelDistance=(0,Et.Rf)(tt.labelDistance,this.labelDistance,at),this.labelDistance3D=(0,Et.Rf)(tt.labelDistance3D,this.labelDistance3D,at),this.labelAutoFlip=(0,Et.Rf)(tt.labelAutoFlip,this.labelAutoFlip,et)),this.dashArray=(0,Et.Rf)(tt.dashArray,this.dashArray,_t),this.alwaysDrawFirstLabel=(0,Et.Rf)(tt.alwaysDrawFirstLabel,this.alwaysDrawFirstLabel,et),this.lineJoin=(0,Et.Rf)(tt.lineJoin,this.lineJoin,dt),this.lineCap=(0,Et.Rf)(tt.lineCap,this.lineCap,dt);const nt=[];if(tt.label&&tt.label.length>0)for(const ue of tt.label)nt.push(new lt(ue));this.label=nt}}ht.DefaultOptions={color:"rgba(22,7,201,0.7)",visible:!0,width:1,labelDistance:200,labelDistance3D:1e5,labelAutoFlip:!0};class mt extends F{constructor(tt){super(tt),this._update(tt,!0)}updateLabels(tt){const Ut=[];if(tt.label&&tt.label.length>0)for(const nt of tt.label)Ut.push(new lt(nt));this.label=Ut}updateLineStyle(tt){this.lineStyle=tt.lineStyle&&new ht(tt.lineStyle)}_update(tt,Ut){super._update(tt,Ut),this.fill=Ut?et((0,Et.En)(tt.fill,mt.DefaultOptions.fill)):(0,Et.Rf)(tt.fill,this.fill,et),this.fillImage=(0,Et.Rf)(tt.fillImage,this.fillImage,Pt),this.updateLineStyle(tt),this.updateLabels(tt)}}mt.DefaultOptions={color:"rgba(22,7,201,0.7)",visible:!0,fill:!0};class bt extends St{constructor(tt){super(tt),this.styleName="featureStyle",this._update(tt,!0)}_update(tt,Ut){tt&&(tt.point&&(this.point&&!Ut?this.point.update(tt.point):this.point=new pt(tt.point)),tt.polyline&&(this.polyline&&!Ut?this.polyline.update(tt.polyline):this.polyline=new ht(tt.polyline)),tt.polygon&&(this.polygon&&!Ut?this.polygon.update(tt.polygon):this.polygon=new mt(tt.polygon)),this.globalOpacity=Ut?at((0,Et.En)(tt.globalOpacity,bt.DefaultOptions.globalOpacity)):(0,Et.Rf)(tt.globalOpacity,this.globalOpacity,at))}}function ut(st){const tt=(0,Nt.it)(st);if(tt instanceof Array)return()=>tt;if(typeof tt=="function")return tt;if(typeof tt=="object"&&tt.stops){const Ut=new At.NB(tt);return()=>Ut.getVals()}if(typeof st=="string")return()=>st.split(",").map(Ut=>parseFloat(Ut));Zt.kg.error("数值数组字段不支持当前类型："+typeof tt)}bt.DefaultOptions={globalOpacity:1};class Mt extends bt{constructor(tt){tt.analysisValues?super(tt):Zt.kg.error("分析值analysisValues必须配置！",!0)}_update(tt,Ut){Ut?(this.analysisValues=ut(tt.analysisValues),this.withShaded=(0,Et.En)(tt.withShaded,Mt.DefaultOptions.withShaded)):(this.analysisValues=(0,Et.Rf)(tt.analysisValues,this.analysisValues,ut),this.withShaded=(0,Et.Rf)(tt.withShaded,this.withShaded)),this.interpField=(0,Et.Rf)(tt.interpField,this.interpField),this.interpGridOptions=(0,Et.Rf)(tt.interpGridOptions,this.interpGridOptions),this.interpGridOptions&&(0,Y.T)(this.interpGridOptions),this.undef=(0,Et.Rf)(tt.undef,this.undef),super._update(tt,Ut)}}Mt.DefaultOptions=Object.assign(Object.assign({},bt.DefaultOptions),{withShaded:!0,analysisValues:void 0})},576:(Je,Ce,ne)=>{ne.d(Ce,{T:()=>de,Z:()=>Dt});var Zt=ne(1);function de(Y){let I={start:Y.xStart,end:Y.xEnd,delta:Y.xDelta,size:Y.xSize};Et(I),Y.xStart=I.start,Y.xEnd=I.end,Y.xDelta=I.delta,Y.xSize=I.size;let At={start:Y.yStart,end:Y.yEnd,delta:Y.yDelta,size:Y.ySize};Et(At),Y.yStart=At.start,Y.yEnd=At.end,Y.yDelta=At.delta,Y.ySize=At.size,Y.zValues||(Y.zValues=[0]),Y.tCount=(0,Zt.En)(Y.tCount,1)}function Et(Y){let I=new Error("不完整的参数，无法计算维度信息--from ensureOneDim");if(Y.start!==void 0){if(Y.end===void 0){if(Y.start===void 0||!Y.delta||!Y.size)throw I;Y.end=Y.start+Y.delta*(Y.size-1)}if(!Y.size){if(Y.start===void 0||Y.end===void 0||!Y.delta)throw I;Y.size=Math.floor((Y.end-Y.start)/Y.delta)+1}if(!Y.delta){if(Y.start===void 0||Y.end===void 0||!Y.size)throw I;Y.delta=(Y.end-Y.start)/(Y.size-1)}}else{if(!Y.delta||Y.end===void 0||!Y.size)throw I;Y.start=Y.end-Y.delta*(Y.size-1)}}function Dt(Y,I=6){var At,Nt;return{minLat:parseFloat(Math.min(Y.yStart,Y.yEnd).toFixed(I)),maxLat:parseFloat(Math.max(Y.yStart,Y.yEnd).toFixed(I)),minLon:parseFloat(Math.min(Y.xStart,Y.xEnd).toFixed(I)),maxLon:parseFloat(Math.max(Y.xStart,Y.xEnd).toFixed(I)),minHeight:((At=Y.zValues)===null||At===void 0?void 0:At.length)>0?Math.min(Y.zValues[0],Y.zValues[Y.zValues.length-1]):0,maxHeight:((Nt=Y.zValues)===null||Nt===void 0?void 0:Nt.length)>0?Math.max(Y.zValues[0],Y.zValues[Y.zValues.length-1]):0}}},824:(Je,Ce,ne)=>{ne.d(Ce,{K:()=>At,P:()=>I});var Zt=ne(923),de=ne(149),Et=ne(1),Dt=ne(96);const Y=((0,de.Tz)(),Nt=>new ArrayBuffer(Nt));class I{get raw(){return this._raw}set raw(ft){this._raw=ft}get maxMin(){return this._maxMin||(this._maxMin=(0,Et.pj)(this)),this._maxMin}constructor(ft,at,dt,et,_t,rt=0,Pt=1,St=0,yt=!0){this.dataType=ft,this.xSize=at,this.ySize=dt,this.algo=rt,this.dataScale=Pt,this.dataOffset=St,this._useAccurateUndef=!0,this.setTypeLen(),et?this.setRaw(et):yt&&this.setRaw(at*dt),this.undef=_t,this.setReadAndWriteFunc()}setReadAndWriteFunc(){switch(this.algo){case void 0:case null:case 0:this.readFunc=ft=>ft,this.writeFunc=ft=>ft;break;case 1:this.readFunc=ft=>ft*this.dataScale+this.dataOffset,this.writeFunc=ft=>(ft-this.dataOffset)/this.dataScale;break;case 2:this.readFunc=ft=>(ft+this.dataOffset)*this.dataScale,this.writeFunc=ft=>ft/this.dataScale-this.dataOffset;break;default:throw new Error("不支持的算法类型！")}}get undef(){return this._undef}get useAccurateUndef(){return this._useAccurateUndef}set useAccurateUndef(ft){this._useAccurateUndef!==ft&&(this._useAccurateUndef=ft,this.setUndefFunc(this._undef))}set undef(ft){this._undef=ft,this.setUndefFunc(ft)}getBuffer(){return this.raw.buffer}setUndefFunc(ft){this.useAccurateUndef?this.isUndef=at=>at===ft:this.isUndef=ft===void 0?()=>!1:ft>0?at=>at>=ft:at=>at<=ft}setRaw(ft){const at=this.xSize*this.ySize;if(ft instanceof ArrayBuffer){let dt;const et=Y(at*this.typeLen);switch(this.dataType){case Dt.U.UInt8:dt=new Uint8Array(ft),this.raw=new Uint8Array(et);break;case Dt.U.Int8:dt=new Int8Array(ft),this.raw=new Int8Array(et);break;case Dt.U.UInt16:dt=new Uint16Array(ft),this.raw=new Uint16Array(et);break;case Dt.U.Int16:this.raw=new Int16Array(et),dt=new Int16Array(ft);break;case Dt.U.UInt32:dt=new Uint32Array(ft),this.raw=new Uint32Array(et);break;case Dt.U.Int32:dt=new Int32Array(ft),this.raw=new Int32Array(et);break;case Dt.U.Float32:dt=new Float32Array(ft),this.raw=new Float32Array(et);break;case Dt.U.Float64:dt=new Float64Array(ft),this.raw=new Float64Array(et);break;default:throw new Error("not supported grid data type "+this.dataType)}this.raw.set(dt),dt=void 0}else{const dt=Y(at*this.typeLen);this.raw=(0,Et.cM)(this.dataType,dt),ft&&ft.length&&(ft[0]instanceof Array&&(ft=(0,Et.LG)(ft)),this.raw.set(ft))}}setTypeLen(){switch(this.dataType){case Dt.U.UInt8:case Dt.U.Int8:this.typeLen=1;break;case Dt.U.UInt16:case Dt.U.Int16:this.typeLen=2;break;case Dt.U.Float64:this.typeLen=8;break;default:this.typeLen=4}}write1D(ft,at){return this.isUndef(at)||(at=this.writeFunc(at)),this.raw[ft]=at,this}read1D(ft){let at=this.raw[ft];return this.isUndef(at)?at:this.readFunc(at)}write2D(ft,at,dt){let et=this.getPos(ft,at);return this.write1D(et,dt)}read2D(ft,at){let dt=this.getPos(ft,at);return this.read1D(dt)}toNumberArr(ft=!1){let at=[];return ft?this.forEachYx((dt,et,_t)=>{let rt=(this.ySize-et-1)*this.xSize+_t;at[rt]=dt}):this.forEachRealValue(dt=>{at.push(dt)}),at}forEach(ft){for(let at=0;at<this.raw.length;at++)ft(this.raw[at],at,this.raw)}forEachRealValue(ft){for(let at=0;at<this.raw.length;at++)ft(this.read1D(at),at,this.raw)}forEachYx(ft){for(let at=0;at<this.ySize;at++)for(let dt=0;dt<this.xSize;dt++)ft(this.read2D(at,dt),at,dt)}getYxArr(){let ft=[];for(let at=0;at<this.ySize;at++){ft[at]=[];for(let dt=0;dt<this.xSize;dt++)ft[at][dt]=this.read2D(at,dt)}return ft}update(ft){ft instanceof Array&&ft[0]instanceof Array&&(ft=(0,Et.LG)(ft)),this.setRaw(ft)}getPos(ft,at){return ft*this.xSize+at}flipY(ft=!0){let at=this.raw;const dt=this.raw;if(ft){const _t=Y(this.ySize*this.xSize*this.typeLen);at=(0,Et.cM)(this.dataType,_t)}else this.setRaw(void 0),at=this.raw;let et=0;for(let _t=0;_t<this.ySize;_t++){const rt=(this.ySize-_t-1)*this.xSize;at.set(dt.slice(rt,rt+this.xSize),et),et+=this.xSize}return at}updateMaxMin(ft=!1){return this._maxMin&&!ft?this._maxMin:(this._maxMin=void 0,this.maxMin)}}class At extends I{constructor(ft,at,dt,et,_t=!1,rt=0,Pt=1,St=0,yt=Dt.U.UInt8){super(yt,ft,at,void 0,et,rt,Pt,St,!1),this.xSize=ft,this.ySize=at,this.autoLoad=_t,this.algo=rt,this.dataScale=Pt,this.dataOffset=St,this.dataType=yt,this._decoded=!1,this.imageSource=dt}get raw(){return this._decoded||(this.autoLoad?this.loadImageSource():Zt.kg.error("尚未解码该数据！")),this._raw}loadImageSource(){if(this._decoded)return;const ft=performance.now(),at=this.imageSource,dt=document.createElement("canvas");let et,_t;dt.width=this.xSize,dt.height=this.ySize,at instanceof HTMLVideoElement?(et=at.videoWidth,_t=at.videoHeight):(et=at.width,_t=at.height),this.xSize!==et&&console.warn("给定的xSize与图片宽度不一致：grid x "+this.xSize+",img width "+et),this.ySize!==_t&&console.warn("给定的ySize与图片高度不一致：grid y "+this.ySize+",img height "+_t);const rt=dt.getContext("2d");rt.drawImage(at,0,0,et,_t,0,0,this.xSize,this.ySize);const Pt=rt.getImageData(0,0,dt.width,dt.height).data;let St;if(this.dataType===Dt.U.UInt8){St=new Uint8Array(dt.width*dt.height);let yt=0;for(let gt=0;gt<Pt.length;gt+=4)St[yt]=Pt[gt],yt++}else if(this.dataType===Dt.U.Float32)St=new Float32Array(Pt.buffer);else if(this.dataType===Dt.U.UInt16){let yt=0;St=new Uint16Array(dt.width*dt.height);for(let gt=0;gt<Pt.length;gt+=4)St[yt++]=255*Pt[gt]+Pt[gt+1]}else Zt.kg.error("不支持的类型！");return this._raw=St,this._decoded=!0,At.ReplaceImageAfterDecode&&(this.imageSource=dt),Zt.kg.debug("decode grid data costs "+(performance.now()-ft)+"ms"),dt}}At.ReplaceImageAfterDecode=!1},858:(Je,Ce,ne)=>{ne.d(Ce,{$n:()=>_t,IW:()=>Mt,Lh:()=>de,Rd:()=>ht,S2:()=>tt,SR:()=>bt,Xm:()=>rt,Yv:()=>st,_E:()=>pt,ce:()=>mt,hM:()=>St,lj:()=>F,m3:()=>et,m_:()=>yt,sC:()=>gt,sW:()=>Zt,uI:()=>Pt,vS:()=>Et,we:()=>ut});var Zt,de,Et,Dt=ne(923),Y=ne(1),I=ne(413),At=ne(537),Nt=ne(478),ft=ne(608),at=ne(307);function dt(Ut){return new ft.NB({stops:[{value:0,stop:Ut}],fieldName:"0"})}function et(Ut){let nt=(0,at.it)(Ut);return typeof nt=="string"&&(nt=parseFloat(nt),nt===void 0&&Dt.kg.error("提供了非数值属性"+nt+"！")),typeof nt=="number"?dt(nt):nt instanceof ft.NB?nt:typeof nt=="object"&&nt.stops?new ft.NB(nt,ue=>(ue.stop=parseFloat(ue.stop),ue)):void Dt.kg.error("数字字段不支持当前类型："+typeof nt)}class _t extends At.W6{_createCacheId(nt){return"0"}}class rt extends _t{constructor(nt){super(nt),(0,Y.ri)(nt.colorScale)||Dt.kg.error("BitmapColorScale中的colorScale未配置！"),this._update(nt,!0)}_update(nt,ue){this.min=(0,Y.Rf)(nt.min,this.min),this.max=(0,Y.Rf)(nt.max,this.max),this.colorScale=(0,Y.Rf)(nt.colorScale,this.colorScale,ht)}static createColorScale(nt,ue,re,ee,Qt=1){const Lt=document.createElement("canvas");if(Lt.width=nt,Lt.height=Qt||1,!ee){ee=[];const be=1/re.length;be>=1&&Dt.kg.error("提供的颜色数量超出了图像宽度，无法生成色例！"),re.forEach((se,Fe)=>{ee.push(be*(Fe+1))})}const pe=Lt.getContext("2d");if(ue){const be=pe.createLinearGradient(0,0,nt,0);for(let se=0;se<re.length;se++){const Fe=Pt(re[se]),Pe=ee[se];be.addColorStop(Pe,Fe.rgbaString())}pe.fillStyle=be,pe.fillRect(0,0,nt,Qt)}else{let be=0;for(let se=0;se<re.length;se++){const Fe=Pt(re[se]),Pe=ee[se];pe.fillStyle=Fe.rgbaString();let It=parseInt((Pe*nt).toFixed(1));It===0&&(It=1),pe.fillRect(be,0,It-be,Qt),be=It}}return Lt}static create(nt,ue,re,ee,Qt,Lt,pe=1){return new rt({min:nt,max:ue,colorScale:rt.createColorScale(re,ee,Qt,Lt,pe)})}static createFromStopRules(nt,ue,re,ee,Qt,Lt=1){Qt<=0&&(Qt=nt.stops.length+Qt-1);const pe=nt.stops[ee].value,be=nt.stops[Qt].value,se=be-pe,Fe=[],Pe=[];for(let It=ee;It<=Qt;It++){const Rt=nt.stops[It],Jt=Rt.stop,Yt=(Rt.value-pe)/se;Fe.push(Jt),Pe.push(Yt)}return rt.create(pe,be,ue,re,Fe,Pe,Lt)}static copyFromStopRules(nt,ue,re,ee,Qt,Lt,pe,be,se,Fe=1){pe<=0&&(pe=nt.stops.length+pe-1);const Pe=be?re-ue:pe-Lt,It=[],Rt=[];for(let Jt=Lt;Jt<=pe;Jt++){const Yt=nt.stops[Jt],Te=Yt.stop,me=be?(Yt.value-ue)/Pe:Jt/Pe;It.push(Te),Rt.push(me)}return rt.create(ue,re,ee,Qt,It,se||Rt,Fe)}}function Pt(Ut){const nt=(0,at.it)(Ut);return typeof nt=="string"?(0,at.$P)(nt):typeof nt=="number"?(0,at.lW)(nt):nt instanceof Nt.t?nt:nt instanceof Array?(0,at.LH)(nt):typeof nt!="object"||nt.r===void 0&&nt.red===void 0?void Dt.kg.error("颜色字段不支持当前类型："+typeof nt):new Nt.t(nt)}function St(Ut){const nt=Pt(Ut);return nt==null?void 0:nt.glNumberArray()}function yt(Ut){const nt=(0,at.it)(Ut);return typeof nt=="string"?dt((0,at.$P)(nt)):typeof nt=="number"?dt((0,at.lW)(nt)):nt instanceof Nt.t?dt(nt):nt instanceof Array?dt((0,at.LH)(nt)):typeof nt!="object"||nt.r===void 0&&nt.red===void 0?Ut instanceof ft.NB?Ut:typeof nt=="object"&&nt.stops?new ft.NB(nt,at.$k):void Dt.kg.error("颜色字段不支持当前类型："+typeof nt):dt(new Nt.t(nt))}function gt(Ut){const nt=(0,at.it)(Ut);return nt instanceof rt?nt:nt.colorScale?new rt(nt):void Dt.kg.error("不能识别的GL色例配置！")}function lt(Ut){if(typeof Ut=="number")return Ut>4&&Dt.kg.error("不能识别的格点数据填色类型："+Ut),Ut;if(typeof Ut=="string"){switch(Ut.toLowerCase()){case"shaded1":return Zt.shaded1;case"pixel2":return Zt.pixel2;case"bitmap":return Zt.bitmap;case"none":return Zt.none;case"shaded2":return Zt.shaded2}return Zt.pixel1}Dt.kg.error("不能识别的格点数据填色类型："+Ut)}(function(Ut){Ut[Ut.none=-1]="none",Ut[Ut.bitmap=0]="bitmap",Ut[Ut.pixel1=1]="pixel1",Ut[Ut.pixel2=2]="pixel2",Ut[Ut.shaded1=4]="shaded1",Ut[Ut.shaded2=3]="shaded2"})(Zt||(Zt={}));class F extends _t{constructor(nt){super(nt),nt.fillColor||nt.colorScale||Dt.kg.error("填色图层中fillColor和colorScale需要设置一个！"),this._update(nt,!0)}getPlaneOptions(nt,ue){return super.getPlaneOptions(nt,!1)}_update(nt,ue){ue?(this.pixelRatio=(0,Y.En)(nt.pixelRatio,F.DefaultOptions.pixelRatio),this.fillMode=lt((0,Y.En)(nt.fillMode,F.DefaultOptions.fillMode)),this.lineWidth=(0,Y.En)(nt.lineWidth,F.DefaultOptions.lineWidth),this.fillModeForLine=lt((0,Y.En)(nt.fillModeForLine,pt.DefaultOptions.fillModeForLine)),this.globalOpacity=(0,Y.En)(nt.globalOpacity,F.DefaultOptions.globalOpacity),this.optimizedInterp=(0,Y.En)(nt.optimizedInterp,F.DefaultOptions.optimizedInterp)):(this.pixelRatio=(0,Y.Rf)(nt.pixelRatio,this.pixelRatio),this.fillMode=(0,Y.Rf)(nt.fillMode,this.fillMode,lt),this.lineWidth=(0,Y.Rf)(nt.lineWidth,this.lineWidth),this.fillModeForLine=(0,Y.Rf)(nt.fillModeForLine,this.fillModeForLine,lt),this.globalOpacity=(0,Y.Rf)(nt.globalOpacity,this.globalOpacity),this.optimizedInterp=(0,Y.Rf)(nt.optimizedInterp,this.optimizedInterp)),this.fillColor=(0,Y.Rf)(nt.fillColor,this.fillColor,yt),this.lineColor=(0,Y.Rf)(nt.lineColor,this.lineColor,St),this.showLine=(0,Y.Rf)(nt.showLine,this.showLine),this.colorScale=(0,Y.Rf)(nt.colorScale,this.colorScale,gt),this.showRelief=(0,Y.Rf)(nt.showRelief,this.showRelief),nt.maskLineStyle&&(this.maskLineStyle&&!ue?this.maskLineStyle.update(nt.maskLineStyle):this.maskLineStyle=new I.Xx(nt.maskLineStyle))}}F.DefaultOptions={pixelRatio:.3,fillMode:Zt.pixel1,lineWidth:1.5,fillColor:void 0,fillModeForLine:Zt.shaded1,globalOpacity:1,optimizedInterp:!0};class pt extends F{constructor(nt){super(nt)}_update(nt,ue){super._update(nt,ue),ue?(this.flat=(0,Y.En)(nt.flat,pt.DefaultOptions.flat),this.diffuse=Pt((0,Y.En)(nt.diffuse,pt.DefaultOptions.diffuse)),this.emission=Pt((0,Y.En)(nt.emission,pt.DefaultOptions.emission)),this.specular=(0,Y.En)(nt.specular,pt.DefaultOptions.specular),this.shininess=(0,Y.En)(nt.shininess,pt.DefaultOptions.shininess),this.extrudeScale=(0,Y.En)(nt.extrudeScale,pt.DefaultOptions.extrudeScale),this.extrudeOffset=(0,Y.En)(nt.extrudeOffset,pt.DefaultOptions.extrudeOffset),this.zScale=(0,Y.En)(nt.zScale,pt.DefaultOptions.zScale),this.noHeight=(0,Y.En)(nt.noHeight,pt.DefaultOptions.noHeight),this.depthTest=(0,Y.En)(nt.depthTest,pt.DefaultOptions.depthTest),this.opaque=(0,Y.En)(nt.opaque,pt.DefaultOptions.opaque),this.height=(0,Y.En)(nt.height,pt.DefaultOptions.height),this.discardColor=St((0,Y.En)(nt.discardColor,pt.DefaultOptions.discardColor))):(this.flat=(0,Y.Rf)(nt.flat,this.flat),this.diffuse=(0,Y.Rf)(nt.diffuse,this.diffuse,Pt),this.emission=(0,Y.Rf)(nt.emission,this.emission,Pt),this.specular=(0,Y.Rf)(nt.specular,this.specular),this.shininess=(0,Y.Rf)(nt.shininess,this.shininess),this.extrudeScale=(0,Y.Rf)(nt.extrudeScale,this.extrudeScale),this.extrudeOffset=(0,Y.Rf)(nt.extrudeOffset,this.extrudeOffset),this.zScale=(0,Y.Rf)(nt.zScale,this.zScale),this.noHeight=(0,Y.Rf)(nt.noHeight,this.noHeight),this.depthTest=(0,Y.Rf)(nt.depthTest,this.depthTest),this.opaque=(0,Y.Rf)(nt.opaque,this.opaque),this.height=(0,Y.Rf)(nt.height,this.height),this.discardColor=(0,Y.Rf)(nt.discardColor,this.discardColor,St))}}function ht(Ut){if(typeof Ut=="string"&&!Ut.length||!(0,Y.ri)(Ut))return;const nt=(0,at.it)(Ut);if(nt instanceof HTMLImageElement||nt instanceof HTMLVideoElement||nt instanceof HTMLCanvasElement)return nt;Dt.kg.error("图像字段不支持当前类型："+typeof nt)}function mt(Ut){const nt=(0,at.it)(Ut);return nt instanceof Array?nt:typeof nt=="number"||typeof nt=="string"?[nt]:void Dt.kg.error("数值数组字段不支持当前类型："+typeof nt)}pt.DefaultOptions=Object.assign(Object.assign({},F.DefaultOptions),{extrudeScale:1,extrudeOffset:0,zScale:1,noHeight:!1,depthTest:!0,opaque:!1,height:0,discardColor:[255,255,255,0],flat:!0,diffuse:[0,0,0],emission:[0,0,0],specular:.2,shininess:5}),function(Ut){Ut[Ut.none=0]="none",Ut[Ut.fast=1]="fast",Ut[Ut.smooth=2]="smooth"}(de||(de={}));class bt extends _t{constructor(nt){super(nt),this._update(nt,!0)}_update(nt,ue){ue?(this.color=yt((0,Y.En)(nt.color,bt.DefaultOptions.color)),this.dropRate=(0,Y.En)(nt.dropRate,bt.DefaultOptions.dropRate),this.fadeRate=(0,Y.En)(nt.fadeRate,bt.DefaultOptions.fadeRate),this.speedFactor=(0,Y.En)(nt.speedFactor,bt.DefaultOptions.speedFactor),this.usePoint=(0,Y.En)(nt.usePoint,bt.DefaultOptions.usePoint),this.minOpacity=(0,Y.En)(nt.minOpacity,bt.DefaultOptions.minOpacity),this.pointSize=(0,Y.En)(nt.pointSize,bt.DefaultOptions.pointSize),this.minSpeed=(0,Y.En)(nt.minSpeed,bt.DefaultOptions.minSpeed),this.fadeSpeedMax=(0,Y.En)(nt.fadeSpeedMax,bt.DefaultOptions.fadeSpeedMax),this.speedFitZoom=(0,Y.En)(nt.speedFitZoom,bt.DefaultOptions.speedFitZoom),this.countFitZoom=(0,Y.En)(nt.countFitZoom,bt.DefaultOptions.countFitZoom),this.interpMethod=(0,Y.En)(nt.interpMethod,bt.DefaultOptions.interpMethod),this.interpSmoothFactor=(0,Y.En)(nt.interpSmoothFactor,bt.DefaultOptions.interpSmoothFactor),this.pointDropPosY=(0,Y.En)(nt.pointDropPosY,bt.DefaultOptions.pointDropPosY),this.count=(0,Y.En)(nt.count,bt.DefaultOptions.count),this.lineMaxDistance=(0,Y.En)(nt.lineMaxDistance,bt.DefaultOptions.lineMaxDistance),this.showPixel=(0,Y.En)(nt.showPixel,bt.DefaultOptions.showPixel),this.pixelOptions=(0,Y.En)(nt.pixelOptions,bt.DefaultOptions.pixelOptions)):(this.color=(0,Y.Rf)(nt.color,this.color,yt),this.dropRate=(0,Y.Rf)(nt.dropRate,this.dropRate),this.fadeRate=(0,Y.Rf)(nt.fadeRate,this.fadeRate),this.speedFactor=(0,Y.Rf)(nt.speedFactor,this.speedFactor),this.usePoint=(0,Y.Rf)(nt.usePoint,this.usePoint),this.minOpacity=(0,Y.Rf)(nt.minOpacity,this.minOpacity),this.pointSize=(0,Y.Rf)(nt.pointSize,this.pointSize),this.minSpeed=(0,Y.Rf)(nt.minSpeed,this.minSpeed),this.fadeSpeedMax=(0,Y.Rf)(nt.fadeSpeedMax,this.fadeSpeedMax),this.speedFitZoom=(0,Y.Rf)(nt.speedFitZoom,this.speedFitZoom),this.countFitZoom=(0,Y.Rf)(nt.countFitZoom,this.countFitZoom),this.interpMethod=(0,Y.Rf)(nt.interpMethod,this.interpMethod),this.interpSmoothFactor=(0,Y.Rf)(nt.interpSmoothFactor,this.interpSmoothFactor),this.pointDropPosY=(0,Y.Rf)(nt.pointDropPosY,this.pointDropPosY),this.count=(0,Y.Rf)(nt.count,this.count),this.lineMaxDistance=(0,Y.Rf)(nt.lineMaxDistance,this.lineMaxDistance),this.showPixel=(0,Y.Rf)(nt.showPixel,this.showPixel),this.pixelOptions=(0,Y.Rf)(nt.pixelOptions,this.pixelOptions)),this.texture=(0,Y.Rf)(nt.texture,this.texture,ht),this.mixColor=(0,Y.Rf)(nt.mixColor,this.mixColor),this.fadeWithSpeed=(0,Y.Rf)(nt.fadeWithSpeed,this.fadeWithSpeed),this.particleRegion=(0,Y.Rf)(nt.particleRegion,this.particleRegion)}}bt.DefaultOptions={color:Nt.m.beige,dropRate:.003,fadeRate:.996,speedFactor:1,usePoint:!0,minOpacity:.5,pointSize:1,minSpeed:0,fadeSpeedMax:20,speedFitZoom:!0,countFitZoom:!0,interpMethod:de.fast,interpSmoothFactor:.8,pointDropPosY:1,count:64,lineMaxDistance:10,showPixel:!1,pixelOptions:{fillColor:"white"}};class ut extends bt{constructor(nt){super(nt)}_update(nt,ue){super._update(nt,ue),ue?(this.zScale=(0,Y.En)(nt.zScale,ut.DefaultOptions.zScale),this.zIndex=(0,Y.En)(nt.zIndex,ut.DefaultOptions.zIndex),this.hgtOffset=(0,Y.En)(nt.hgtOffset,ut.DefaultOptions.hgtOffset),this.zSpeedFactor=(0,Y.En)(nt.zSpeedFactor,ut.DefaultOptions.zSpeedFactor),this.onlyZ=(0,Y.En)(nt.onlyZ,ut.DefaultOptions.onlyZ),this.colorWith=(0,Y.En)(nt.colorWith,ut.DefaultOptions.colorWith)):(this.zScale=(0,Y.Rf)(nt.zScale,this.zScale),this.zIndex=(0,Y.Rf)(nt.zIndex,this.zIndex),this.hgtOffset=(0,Y.Rf)(nt.hgtOffset,this.hgtOffset),this.zSpeedFactor=(0,Y.Rf)(nt.zSpeedFactor,this.zSpeedFactor),this.onlyZ=(0,Y.Rf)(nt.onlyZ,this.onlyZ),this.colorWith=(0,Y.Rf)(nt.colorWith,this.colorWith))}}ut.DefaultOptions=Object.assign(Object.assign({},bt.DefaultOptions),{zScale:1,zIndex:0,hgtOffset:0,zSpeedFactor:1,onlyZ:!1,colorWith:"uv"});class Mt extends _t{constructor(nt){super(nt),nt.color||Dt.kg.error("体渲染需要提供颜色！"),this._update(nt,!0)}_update(nt,ue){ue?(this.color=yt(nt.color),this.zScale=(0,Y.En)(nt.zScale,Mt.DefaultOptions.zScale),this.samplingRate=(0,Y.En)(nt.samplingRate,Mt.DefaultOptions.samplingRate),this.opaque=(0,Y.En)(nt.opaque,Mt.DefaultOptions.opaque)):(this.color=(0,Y.Rf)(nt.color,this.color,yt),this.zScale=(0,Y.Rf)(nt.zScale,this.zScale),this.samplingRate=(0,Y.Rf)(nt.samplingRate,Mt.DefaultOptions.samplingRate),this.opaque=(0,Y.Rf)(nt.opaque,this.opaque)),this.visibleExtent=(0,Y.Rf)(nt.visibleExtent,this.visibleExtent)}}Mt.DefaultOptions={color:void 0,zScale:1,samplingRate:1,opaque:!1},function(Ut){Ut[Ut.none=0]="none",Ut[Ut.rect=1]="rect",Ut[Ut.tilt=2]="tilt"}(Et||(Et={}));class st extends _t{constructor(nt){super(nt),nt.fillColor||nt.colorScale||Dt.kg.error("填色图层中fillColor和colorScale需要设置一个！"),this._update(nt,!0)}_update(nt,ue){ue?(this.flat=(0,Y.En)(nt.flat,st.DefaultOptions.flat),this.diffuse=Pt((0,Y.En)(nt.diffuse,st.DefaultOptions.diffuse)),this.emission=Pt((0,Y.En)(nt.emission,st.DefaultOptions.emission)),this.globalOpacity=(0,Y.En)(nt.globalOpacity,st.DefaultOptions.globalOpacity),this.specular=(0,Y.En)(nt.specular,st.DefaultOptions.specular),this.shininess=(0,Y.En)(nt.shininess,st.DefaultOptions.shininess),this.fillMode=lt((0,Y.En)(nt.fillMode,st.DefaultOptions.fillMode)),this.opaque=(0,Y.En)(nt.opaque,st.DefaultOptions.opaque),this.zScale=(0,Y.En)(nt.zScale,st.DefaultOptions.zScale),this.depthTest=(0,Y.En)(nt.depthTest,st.DefaultOptions.depthTest),this.sectionMode=(0,Y.En)(nt.sectionMode,st.DefaultOptions.sectionMode)):(this.flat=(0,Y.Rf)(nt.flat,this.flat),this.diffuse=(0,Y.Rf)(nt.diffuse,this.diffuse,Pt),this.emission=(0,Y.Rf)(nt.emission,this.emission,Pt),this.globalOpacity=(0,Y.Rf)(nt.globalOpacity,this.globalOpacity),this.specular=(0,Y.Rf)(nt.specular,this.specular),this.shininess=(0,Y.Rf)(nt.shininess,this.shininess),this.fillMode=(0,Y.Rf)(nt.fillMode,this.fillMode,lt),this.opaque=(0,Y.Rf)(nt.opaque,this.opaque),this.zScale=(0,Y.Rf)(nt.zScale,this.zScale),this.depthTest=(0,Y.Rf)(nt.depthTest,this.depthTest),this.sectionMode=(0,Y.Rf)(nt.sectionMode,this.sectionMode)),this.fillColor=(0,Y.Rf)(nt.fillColor,this.fillColor,yt),this.colorScale=(0,Y.Rf)(nt.colorScale,this.colorScale,gt),this.section=(0,Y.Rf)(nt.section,this.section)}}st.DefaultOptions={flat:!1,diffuse:[0,0,0],emission:[0,0,0],globalOpacity:1,specular:0,shininess:1,fillMode:Zt.pixel1,opaque:!0,zScale:1,depthTest:!0,sectionMode:Et.none};class tt extends st{constructor(nt){super(nt)}_update(nt,ue){super._update(nt,ue),ue?(this.baseSpeed=(0,Y.En)(nt.baseSpeed,tt.DefaultOptions.baseSpeed),this.headRadius=(0,Y.En)(nt.headRadius,tt.DefaultOptions.headRadius),this.headLength=(0,Y.En)(nt.headLength,tt.DefaultOptions.headLength),this.headSegments=(0,Y.En)(nt.headSegments,tt.DefaultOptions.headSegments),this.bodyTopRadius=(0,Y.En)(nt.bodyTopRadius,tt.DefaultOptions.bodyTopRadius),this.bodyBottomRadius=(0,Y.En)(nt.bodyBottomRadius,tt.DefaultOptions.bodyBottomRadius),this.bodyLength=(0,Y.En)(nt.bodyLength,tt.DefaultOptions.bodyLength),this.bodySegments=(0,Y.En)(nt.bodySegments,tt.DefaultOptions.bodySegments),this.shapeNeedsUpdate=(0,Y.En)(nt.shapeNeedsUpdate,tt.DefaultOptions.shapeNeedsUpdate),this.maxCount=(0,Y.En)(nt.maxCount,tt.DefaultOptions.maxCount),this.shapeScale=(0,Y.En)(nt.shapeScale,tt.DefaultOptions.shapeScale),this.verticalDataScale=(0,Y.En)(nt.verticalDataScale,tt.DefaultOptions.verticalDataScale),this.flipArrow=(0,Y.En)(nt.flipArrow,tt.DefaultOptions.flipArrow)):(this.baseSpeed=(0,Y.Rf)(nt.baseSpeed,this.baseSpeed),this.headRadius=(0,Y.Rf)(nt.headRadius,this.headRadius),this.headLength=(0,Y.Rf)(nt.headLength,this.headLength),this.headSegments=(0,Y.Rf)(nt.headSegments,this.headSegments),this.bodyTopRadius=(0,Y.Rf)(nt.bodyTopRadius,this.bodyTopRadius),this.bodyBottomRadius=(0,Y.Rf)(nt.bodyBottomRadius,this.bodyBottomRadius),this.bodyLength=(0,Y.Rf)(nt.bodyLength,this.bodyLength),this.bodySegments=(0,Y.Rf)(nt.bodySegments,this.bodySegments),this.shapeNeedsUpdate=(0,Y.Rf)(nt.shapeNeedsUpdate,this.shapeNeedsUpdate),this.maxCount=(0,Y.Rf)(nt.maxCount,this.maxCount),this.shapeScale=(0,Y.Rf)(nt.shapeScale,this.shapeScale),this.verticalDataScale=(0,Y.Rf)(nt.verticalDataScale,this.verticalDataScale),this.flipArrow=(0,Y.Rf)(nt.flipArrow,this.flipArrow)),this.speed=(0,Y.Rf)(nt.speed,this.speed,I.JW),this.angle=(0,Y.Rf)(nt.angle,this.angle,I.JW),this.height=(0,Y.Rf)(nt.height,this.height,I.JW),this.gridPreferSD=(0,Y.Rf)(nt.gridPreferSD,this.gridPreferSD)}}tt.DefaultOptions=Object.assign(Object.assign({},st.DefaultOptions),{baseSpeed:5,headRadius:3e3,headLength:5e3,headSegments:30,bodyTopRadius:1e3,bodyBottomRadius:1e3,bodyLength:1e4,bodySegments:30,maxCount:500,shapeNeedsUpdate:!1,shapeScale:1,verticalDataScale:1,flipArrow:!0})},537:(Je,Ce,ne)=>{ne.d(Ce,{$f:()=>St,CN:()=>_t,Dg:()=>Nt,UZ:()=>dt,W6:()=>rt,dl:()=>yt,no:()=>ft,se:()=>at,vX:()=>et,x1:()=>Pt});var Zt=ne(923),de=ne(251),Et=ne(1),Dt=ne(838),Y=ne(478),I=ne(608),At=ne(307);function Nt(gt){let lt=(0,At.it)(gt);if(typeof lt=="number")return F=>lt;if(typeof lt=="function")return lt;if(typeof lt=="object"&&lt.stops){const F=new I.NB(lt,ht=>(ht.stop=parseFloat(ht.stop),ht));let pt=parseInt(F.fieldName)||0;return(ht,mt)=>F.getRule(mt[pt]).stop}if(typeof lt=="string"){if(lt.trim().length===0)return F=>F;if(lt.startsWith(Dt.v.fieldPropertiesIndicator)||lt.startsWith(Dt.v.fieldLoaderIndicator)){let F=0;if(lt.indexOf("|")>0){const pt=lt.split("|");F=parseInt(pt[1])||0,lt=pt[0]}if(lt.indexOf(Dt.v.fieldLoaderIndicator)<0)return(pt,ht)=>ht[F];{const pt=lt.split(Dt.v.fieldLoaderIndicator),ht=pt[1].split("?"),mt=(0,de.nA)(ht[0]);if(!mt)return Zt.kg.warn("当前字段"+pt[0]+"的loader未找到，将直接使用格点值！"),(bt,ut)=>ut[F];if(ht.length>1){const bt=(0,At.vl)(ht[1]);return(ut,Mt)=>mt(Mt[F],bt)}return(bt,ut)=>mt(ut[F],void 0)}}{const F=parseFloat(lt);return F===void 0&&Zt.kg.error("提供了非数值属性"+lt+"！"),pt=>F}}Zt.kg.error("数字字段不支持当前类型："+typeof lt)}function ft(gt){let lt=(0,At.it)(gt);if(typeof lt=="function")return lt;if(typeof lt=="object"&&lt.stops){const F=new I.NB(lt,ht=>(ht.stop.toString&&ht.stop.toString(),ht));let pt=parseInt(F.fieldName)||0;return(ht,mt)=>F.getRule(mt[pt]).stop}if(lt===void 0)return(F,pt)=>F.toString();if(typeof lt=="string"){if(lt.trim().length===0)return(F,pt)=>F.toString();if(lt.startsWith(Dt.v.fieldPropertiesIndicator)||lt.startsWith(Dt.v.fieldLoaderIndicator)){let F=0;if(lt.indexOf("|")>0){const pt=lt.split("|");F=parseInt(pt[1])||0,lt=pt[0]}if(lt.indexOf(Dt.v.fieldLoaderIndicator)<0)return(pt,ht)=>ht[F].toString();{const pt=lt.split(Dt.v.fieldLoaderIndicator),ht=pt[1].split("?"),mt=(0,de.nA)(ht[0]);if(!mt)return Zt.kg.warn("当前字段"+pt[0]+"的loader未找到，将直接使用格点值！"),(bt,ut)=>ut[F].toString();if(ht.length>1){const bt=(0,At.vl)(ht[1]);return(ut,Mt)=>mt(Mt[F],bt)}return(bt,ut)=>mt(ut[F])}}return(F,pt)=>lt}Zt.kg.error("字符串字段不支持当前类型："+typeof lt)}function at(gt){const lt=(0,At.it)(gt);if(typeof lt=="number"){const F=lt!==0;return pt=>F}if(typeof lt=="boolean")return F=>lt;if(typeof lt=="function")return lt;if(typeof lt=="object"&&lt.stops){const F=new I.NB(lt);let pt=parseInt(F.fieldName)||0;return(ht,mt)=>F.getRule(mt[pt]).stop}if(typeof lt=="string"){const F=lt!=="0"&&lt.toLowerCase()!=="false";return pt=>F}Zt.kg.error("逻辑字段不支持当前类型："+typeof lt)}function dt(gt){const lt=(0,At.it)(gt);if(lt instanceof Array)return F=>lt;if(typeof lt=="function")return lt;if(typeof lt=="object"&&lt.stops){const F=new I.NB(lt);let pt=parseInt(F.fieldName)||0;return(ht,mt)=>F.getRule(mt[pt]).stop}Zt.kg.error("数值数组字段不支持当前类型："+typeof lt)}function et(gt){const lt=(0,At.it)(gt);if(typeof lt=="string"){const F=(0,At.$P)(lt);return pt=>F}if(typeof lt=="number"){const F=(0,At.lW)(lt);return pt=>F}if(lt instanceof Y.t)return F=>lt;if(lt instanceof Array){const F=new Y.t({r:lt[0],g:lt[1],b:lt[2],a:lt.length===3?1:lt[3]});return pt=>F}if(typeof lt=="function")return(F,pt)=>{const ht=lt(F,pt);return ht instanceof Y.t?ht:typeof ht=="string"?(0,At.$P)(ht):typeof ht=="number"?(0,At.lW)(ht):ht instanceof Array?(0,At.LH)(ht):void Zt.kg.error("不支持的颜色类型！")};if(typeof lt=="object"&&(lt.r!==void 0||lt.red!==void 0)){const F=new Y.t(lt);return pt=>F}if(typeof lt=="object"&&lt.stops){const F=new I.NB(lt,At.$k);let pt=parseInt(F.fieldName)||0;return(ht,mt)=>F.getRule(mt[pt]).stop}Zt.kg.error("颜色字段不支持当前类型："+typeof lt)}function _t(gt){const lt=(0,At.it)(gt);if(typeof lt=="string")return F=>lt;if(lt instanceof HTMLImageElement||lt instanceof HTMLVideoElement||lt instanceof HTMLCanvasElement)return F=>lt;if(typeof lt=="function")return lt;if(typeof lt=="object"&&lt.stops){const F=new I.NB(lt);let pt=parseInt(F.fieldName)||0;return(ht,mt)=>F.getRule(mt[pt]).stop}Zt.kg.error("图像字段不支持当前类型："+typeof lt)}class rt extends At.Uw{constructor(){super(...arguments),this.styleName="gridStyle"}_createCacheId(lt){if(lt!==void 0&&!isNaN(lt))return lt.toString()}}class Pt extends rt{constructor(lt){super(lt),this._update(lt,!0)}_update(lt,F){F?(this.data=ft(lt.data),this.font=ft((0,Et.En)(lt.font,Pt.DefaultOptions.font)),this.color=et((0,Et.En)(lt.color,Pt.DefaultOptions.color)),this.visible=at((0,Et.En)(lt.visible,Pt.DefaultOptions.visible)),this.backHeight=Nt((0,Et.En)(lt.backHeight,Pt.DefaultOptions.backHeight)),this.backPadding=dt((0,Et.En)(lt.backPadding,Pt.DefaultOptions.backPadding)),this.strokeWidth=Nt((0,Et.En)(lt.strokeWidth,Pt.DefaultOptions.strokeWidth)),this.backStrokeWidth=Nt((0,Et.En)(lt.backStrokeWidth,Pt.DefaultOptions.backStrokeWidth)),this.align=ft((0,Et.En)(lt.align,Pt.DefaultOptions.align)),this.baseline=ft((0,Et.En)(lt.baseline,Pt.DefaultOptions.baseline)),this.backShadowBlur=Nt((0,Et.En)(lt.backShadowBlur,Pt.DefaultOptions.backShadowBlur)),this.backShadowOffset=dt((0,Et.En)(lt.backShadowOffset,Pt.DefaultOptions.backShadowOffset)),this.shadowOffset=dt((0,Et.En)(lt.shadowOffset,Pt.DefaultOptions.shadowOffset)),this.shadowBlur=Nt((0,Et.En)(lt.shadowBlur,Pt.DefaultOptions.shadowBlur)),this.backRoundRadius=Nt((0,Et.En)(lt.backRoundRadius,Pt.DefaultOptions.backRoundRadius)),this.zoomMin=Nt((0,Et.En)(lt.zoomMin,Pt.DefaultOptions.zoomMin)),this.zoomMax=Nt((0,Et.En)(lt.zoomMax,Pt.DefaultOptions.zoomMax))):(this.data=(0,Et.Rf)(lt.data,this.data,ft),this.font=(0,Et.Rf)(lt.font,this.font,ft),this.color=(0,Et.Rf)(lt.color,this.color,et),this.visible=(0,Et.Rf)(lt.visible,this.visible,at),this.backHeight=(0,Et.Rf)(lt.backHeight,this.backHeight,Nt),this.backPadding=(0,Et.Rf)(lt.backPadding,this.backPadding,dt),this.strokeWidth=(0,Et.Rf)(lt.strokeWidth,this.strokeWidth,Nt),this.backStrokeWidth=(0,Et.Rf)(lt.backStrokeWidth,this.backStrokeWidth,Nt),this.align=(0,Et.Rf)(lt.align,this.align,ft),this.baseline=(0,Et.Rf)(lt.baseline,this.baseline,ft),this.backShadowOffset=(0,Et.Rf)(lt.backShadowOffset,this.backShadowOffset,dt),this.backShadowBlur=(0,Et.Rf)(lt.backShadowBlur,this.backShadowBlur,Nt),this.shadowOffset=(0,Et.Rf)(lt.shadowOffset,this.shadowOffset,dt),this.shadowBlur=(0,Et.Rf)(lt.shadowBlur,this.shadowBlur,Nt),this.backRoundRadius=(0,Et.Rf)(lt.backRoundRadius,this.backRoundRadius,Nt),this.zoomMin=(0,Et.Rf)(lt.zoomMin,this.zoomMin,Nt),this.zoomMax=(0,Et.Rf)(lt.zoomMax,this.zoomMax,Nt)),this.angle=(0,Et.Rf)(lt.angle,this.angle,Nt),this.strokeColor=(0,Et.Rf)(lt.strokeColor,this.strokeColor,et),this.backColor=(0,Et.Rf)(lt.backColor,this.backColor,et),this.backCircle=(0,Et.Rf)(lt.backCircle,this.backCircle,at),this.offset=(0,Et.Rf)(lt.offset,this.offset,dt),this.backStrokeColor=(0,Et.Rf)(lt.backStrokeColor,this.backStrokeColor,et),this.backRoundRect=(0,Et.Rf)(lt.backRoundRect,this.backRoundRect,at),this.backShadowColor=(0,Et.Rf)(lt.backShadowColor,this.backShadowColor,et),this.backStrokeDashArray=(0,Et.Rf)(lt.backStrokeDashArray,this.backStrokeDashArray,dt),this.shadowColor=(0,Et.Rf)(lt.shadowColor,this.shadowColor,et)}}Pt.DefaultOptions={data:void 0,font:"12px 微软雅黑",color:"black",visible:!0,backHeight:14,backPadding:[3,2],strokeWidth:1,backStrokeWidth:1,align:"center",baseline:"middle",backShadowBlur:6,backShadowOffset:[3,3],shadowBlur:6,shadowOffset:[3,3],backRoundRadius:6,zoomMin:0,zoomMax:25};class St extends rt{constructor(lt){super(lt),lt.data||Zt.kg.error("图像数据是必选字段！"),this._update(lt,!0)}_update(lt,F){F?(this.size=dt((0,Et.En)(lt.size,St.DefaultOptions.size)),this.data=_t(lt.data),this.visible=at((0,Et.En)(lt.visible,St.DefaultOptions.visible)),this.shadowOffset=dt((0,Et.En)(lt.shadowOffset,St.DefaultOptions.shadowOffset)),this.shadowBlur=Nt((0,Et.En)(lt.shadowBlur,St.DefaultOptions.shadowBlur)),this.zoomMin=Nt((0,Et.En)(lt.zoomMin,St.DefaultOptions.zoomMin)),this.zoomMax=Nt((0,Et.En)(lt.zoomMax,St.DefaultOptions.zoomMax))):(this.size=(0,Et.Rf)(lt.size,this.size,dt),this.data=(0,Et.Rf)(lt.data,this.data,_t),this.visible=(0,Et.Rf)(lt.visible,this.visible,at),this.shadowOffset=(0,Et.Rf)(lt.shadowOffset,this.shadowOffset,dt),this.shadowBlur=(0,Et.Rf)(lt.shadowBlur,this.shadowBlur,Nt),this.zoomMin=(0,Et.Rf)(lt.zoomMin,this.zoomMin,Nt),this.zoomMax=(0,Et.Rf)(lt.zoomMax,this.zoomMax,Nt)),this.angle=(0,Et.Rf)(lt.angle,this.angle,Nt),this.offset=(0,Et.Rf)(lt.offset,this.offset,dt),this.shadowColor=(0,Et.Rf)(lt.shadowColor,this.shadowColor,et),this.color=(0,Et.Rf)(lt.color,this.color,et)}}St.DefaultOptions={data:void 0,size:[32,32],visible:!0,shadowBlur:5,shadowOffset:[5,5],zoomMin:0,zoomMax:25};class yt extends rt{constructor(lt){super(lt),this._update(lt,!0)}_update(lt,F){F?(this.interval=(0,Et.En)(lt.interval,yt.DefaultOptions.interval),this.pos=(0,Et.En)(lt.pos,yt.DefaultOptions.pos)):(lt.interval&&(this.interval=lt.interval),this.pos=(0,Et.Rf)(lt.pos,this.pos)),lt.image&&(F?this.image=lt.image&&new St(lt.image):this.image.update(lt.image)),lt.text&&(F?this.text=lt.text&&new Pt(lt.text):this.text.update(lt.text))}}yt.DefaultOptions={interval:[50,50],pos:[.5,.5]}},787:(Je,Ce,ne)=>{ne.d(Ce,{K9:()=>rt,dO:()=>_t,uD:()=>et,xS:()=>At});var Zt=ne(923),de=ne(1),Et=ne(838),Dt=ne(858),Y=ne(608),I=function(Pt,St,yt,gt){return new(yt||(yt=Promise))(function(lt,F){function pt(bt){try{mt(gt.next(bt))}catch(ut){F(ut)}}function ht(bt){try{mt(gt.throw(bt))}catch(ut){F(ut)}}function mt(bt){var ut;bt.done?lt(bt.value):(ut=bt.value,ut instanceof yt?ut:new yt(function(Mt){Mt(ut)})).then(pt,ht)}mt((gt=gt.apply(Pt,St||[])).next())})};const At={"3gauss":"3gauss","3saw":"3saw",BkBlAqGrYeOrReViWh200:"BkBlAqGrYeOrReViWh200",BlAqGrYeOrRe:"BlAqGrYeOrRe",BlAqGrYeOrReVi200:"BlAqGrYeOrReVi200",BlGrYeOrReVi200:"BlGrYeOrReVi200",BlRe:"BlRe",BlWhRe:"BlWhRe",BlueDarkOrange18:"BlueDarkOrange18",BlueDarkRed18:"BlueDarkRed18",BlueGreen14:"BlueGreen14",BlueRed:"BlueRed",BlueRedGray:"BlueRedGray",BlueWhiteOrangeRed:"BlueWhiteOrangeRed",BlueYellowRed:"BlueYellowRed",BrownBlue12:"BrownBlue12",Cat12:"Cat12",GHRSST_anomaly:"GHRSST_anomaly",GMT_cool:"GMT_cool",GMT_copper:"GMT_copper",GMT_drywet:"GMT_drywet",GMT_gebco:"GMT_gebco",GMT_globe:"GMT_globe",GMT_gray:"GMT_gray",GMT_haxby:"GMT_haxby",GMT_hot:"GMT_hot",GMT_jet:"GMT_jet",GMT_nighttime:"GMT_nighttime",GMT_no_green:"GMT_no_green",GMT_ocean:"GMT_ocean",GMT_paired:"GMT_paired",GMT_panoply:"GMT_panoply",GMT_polar:"GMT_polar",GMT_red2green:"GMT_red2green",GMT_relief:"GMT_relief",GMT_relief_oceanonly:"GMT_relief_oceanonly",GMT_seis:"GMT_seis",GMT_split:"GMT_split",GMT_topo:"GMT_topo",GMT_wysiwyg:"GMT_wysiwyg",GMT_wysiwygcont:"GMT_wysiwygcont",GrayWhiteGray:"GrayWhiteGray",GreenMagenta16:"GreenMagenta16",GreenYellow:"GreenYellow",MPL_Accent:"MPL_Accent",MPL_Blues:"MPL_Blues",MPL_BrBG:"MPL_BrBG",MPL_BuGn:"MPL_BuGn",MPL_BuPu:"MPL_BuPu",MPL_Dark2:"MPL_Dark2",MPL_GnBu:"MPL_GnBu",MPL_Greens:"MPL_Greens",MPL_Greys:"MPL_Greys",MPL_OrRd:"MPL_OrRd",MPL_Oranges:"MPL_Oranges",MPL_PRGn:"MPL_PRGn",MPL_Paired:"MPL_Paired",MPL_Pastel1:"MPL_Pastel1",MPL_Pastel2:"MPL_Pastel2",MPL_PiYG:"MPL_PiYG",MPL_PuBu:"MPL_PuBu",MPL_PuBuGn:"MPL_PuBuGn",MPL_PuOr:"MPL_PuOr",MPL_PuRd:"MPL_PuRd",MPL_Purples:"MPL_Purples",MPL_RdBu:"MPL_RdBu",MPL_RdGy:"MPL_RdGy",MPL_RdPu:"MPL_RdPu",MPL_RdYlBu:"MPL_RdYlBu",MPL_RdYlGn:"MPL_RdYlGn",MPL_Reds:"MPL_Reds",MPL_Set1:"MPL_Set1",MPL_Set2:"MPL_Set2",MPL_Set3:"MPL_Set3",MPL_Spectral:"MPL_Spectral",MPL_StepSeq:"MPL_StepSeq",MPL_YlGn:"MPL_YlGn",MPL_YlGnBu:"MPL_YlGnBu",MPL_YlOrBr:"MPL_YlOrBr",MPL_YlOrRd:"MPL_YlOrRd",MPL_afmhot:"MPL_afmhot",MPL_autumn:"MPL_autumn",MPL_bone:"MPL_bone",MPL_brg:"MPL_brg",MPL_bwr:"MPL_bwr",MPL_cool:"MPL_cool",MPL_coolwarm:"MPL_coolwarm",MPL_copper:"MPL_copper",MPL_cubehelix:"MPL_cubehelix",MPL_flag:"MPL_flag",MPL_gist_earth:"MPL_gist_earth",MPL_gist_gray:"MPL_gist_gray",MPL_gist_heat:"MPL_gist_heat",MPL_gist_ncar:"MPL_gist_ncar",MPL_gist_rainbow:"MPL_gist_rainbow",MPL_gist_stern:"MPL_gist_stern",MPL_gist_yarg:"MPL_gist_yarg",MPL_gnuplot:"MPL_gnuplot",MPL_gnuplot2:"MPL_gnuplot2",MPL_hot:"MPL_hot",MPL_hsv:"MPL_hsv",MPL_jet:"MPL_jet",MPL_ocean:"MPL_ocean",MPL_pink:"MPL_pink",MPL_prism:"MPL_prism",MPL_rainbow:"MPL_rainbow",MPL_s3pcpn:"MPL_s3pcpn",MPL_s3pcpn_l:"MPL_s3pcpn_l",MPL_seismic:"MPL_seismic",MPL_spring:"MPL_spring",MPL_sstanom:"MPL_sstanom",MPL_summer:"MPL_summer",MPL_terrain:"MPL_terrain",MPL_winter:"MPL_winter",NCV_banded:"NCV_banded",NCV_blu_red:"NCV_blu_red",NCV_blue_red:"NCV_blue_red",NCV_bright:"NCV_bright",NCV_gebco:"NCV_gebco",NCV_jaisnd:"NCV_jaisnd",NCV_jet:"NCV_jet",NCV_manga:"NCV_manga",NCV_rainbow2:"NCV_rainbow2",NCV_roullet:"NCV_roullet",OceanLakeLandSnow:"OceanLakeLandSnow",SVG_Gallet13:"SVG_Gallet13",SVG_Lindaa06:"SVG_Lindaa06",SVG_Lindaa07:"SVG_Lindaa07",SVG_bhw3_22:"SVG_bhw3_22",SVG_es_landscape_79:"SVG_es_landscape_79",SVG_feb_sunrise:"SVG_feb_sunrise",SVG_foggy_sunrise:"SVG_foggy_sunrise",SVG_fs2006:"SVG_fs2006",StepSeq25:"StepSeq25",ViBlGrWhYeOrRe:"ViBlGrWhYeOrRe",WhBlGrYeRe:"WhBlGrYeRe",WhBlReWh:"WhBlReWh",WhViBlGrYeOrRe:"WhViBlGrYeOrRe",WhViBlGrYeOrReWh:"WhViBlGrYeOrReWh",WhiteBlue:"WhiteBlue",WhiteBlueGreenYellowRed:"WhiteBlueGreenYellowRed",WhiteGreen:"WhiteGreen",WhiteYellowOrangeRed:"WhiteYellowOrangeRed",amwg:"amwg",amwg256:"amwg256",amwg_blueyellowred:"amwg_blueyellowred",cb_9step:"cb_9step",cb_rainbow:"cb_rainbow",cb_rainbow_inv:"cb_rainbow_inv",cmp_b2r:"cmp_b2r",cmp_flux:"cmp_flux",cmp_haxby:"cmp_haxby",cosam:"cosam",cosam12:"cosam12",cyclic:"cyclic",default:"default",detail:"detail",example:"example",extrema:"extrema",grads_default:"grads_default",grads_rainbow:"grads_rainbow",gscyclic:"gscyclic",gsdtol:"gsdtol",gsltod:"gsltod",gui_default:"gui_default",helix:"helix",helix1:"helix1",hlu_default:"hlu_default",hotcold_18lev:"hotcold_18lev",hotcolr_19lev:"hotcolr_19lev",hotres:"hotres",matlab_hot:"matlab_hot",matlab_hsv:"matlab_hsv",matlab_jet:"matlab_jet",matlab_lines:"matlab_lines",mch_default:"mch_default",ncl_default:"ncl_default",ncview_default:"ncview_default",nice_gfdl:"nice_gfdl",nrl_sirkes:"nrl_sirkes",nrl_sirkes_nowhite:"nrl_sirkes_nowhite",perc2_9lev:"perc2_9lev",percent_11lev:"percent_11lev",posneg_1:"posneg_1",posneg_2:"posneg_2",prcp_1:"prcp_1",prcp_2:"prcp_2",prcp_3:"prcp_3",precip2_15lev:"precip2_15lev",precip2_17lev:"precip2_17lev",precip3_16lev:"precip3_16lev",precip4_11lev:"precip4_11lev",precip4_diff_19lev:"precip4_diff_19lev",precip_11lev:"precip_11lev",precip_diff_12lev:"precip_diff_12lev",precip_diff_1lev:"precip_diff_1lev",psgcap:"psgcap",radar:"radar",radar_1:"radar_1","rainbow+gray":"rainbow+gray","rainbow+white+gray":"rainbow+white+gray","rainbow+white":"rainbow+white",rainbow:"rainbow",rh_19lev:"rh_19lev",seaice_1:"seaice_1",seaice_2:"seaice_2",so4_21:"so4_21",so4_23:"so4_23",spread_15lev:"spread_15lev",sunshine_9lev:"sunshine_9lev",sunshine_diff_12lev:"sunshine_diff_12lev",t2m_29lev:"t2m_29lev",tbrAvg1:"tbrAvg1",tbrStd1:"tbrStd1",tbrVar1:"tbrVar1","tbr_240-300":"tbr_240-300","tbr_stdev_0-30":"tbr_stdev_0-30","tbr_var_0-500":"tbr_var_0-500",temp1:"temp1",temp_19lev:"temp_19lev",temp_diff_18lev:"temp_diff_18lev",temp_diff_1lev:"temp_diff_1lev",testcmap:"testcmap",thelix:"thelix",topo_15lev:"topo_15lev",uniform:"uniform",wgne15:"wgne15","wh-bl-gr-ye-re":"wh-bl-gr-ye-re",wind_17lev:"wind_17lev",wxpEnIR:"wxpEnIR"},Nt={},ft={};function at(Pt,St){let yt="linear-gradient(90deg,";const gt=[];return Pt.forEach((lt,F)=>{const pt=lt.split(/\s+/);if(pt[0].trim().length===0&&pt.shift(),isNaN(parseFloat(pt[0]))||pt.length<3)return void Zt.kg.debug("skip line "+lt);const ht=parseFloat(pt[0]),mt=parseFloat(pt[1]),bt=parseFloat(pt[2]);let ut;ut=ht<=1&&mt<=1&&bt<=1?"rgb("+(255*ht).toFixed(0)+","+(255*mt).toFixed(0)+","+(255*bt).toFixed(0)+")":"rgb("+pt[0]+","+pt[1]+","+pt[2]+")",yt+=ut+" "+F/(Pt.length-1)*100+"%,",gt.push(ut)}),Pt=gt,yt=yt.substring(0,yt.length-1)+")",ft[St]={colors:Pt,cssColor:yt},{colors:Pt,cssColor:yt}}function dt(Pt){return I(this,void 0,void 0,function*(){if(ft[Pt])return ft[Pt];const St=Et.v.defaultLegendPath.endsWith("/")?Et.v.defaultLegendPath:Et.v.defaultLegendPath+"/";let yt=(yield(yield fetch(St+"/"+Pt+".rgb").catch(()=>{})).text()).split(`
`);if(!yt)throw new Error("调色文件不存在！");return at(yt,Pt)})}function et(Pt,St,yt,gt=0,lt,F){return I(this,void 0,void 0,function*(){if((0,de.ri)(St)&&(0,de.ri)(yt)){(0,de.ri)(lt)||(Zt.kg.warn("未提供字段名称，将使用随机值！"),lt="field"+(0,de.hQ)());try{const{colors:pt,cssColor:ht}=yield dt(Pt),mt={stops:[],fieldName:lt};F&&(mt.action=F);let bt=0;for(let ut=0;ut<pt.length;ut+=gt+1){const Mt=St+(yt-St)*bt/(pt.length-1);mt.stops.push({stop:pt[ut],value:Mt}),bt++}return{stopRules:new Y.NB(mt),css:ht}}catch(pt){return void Zt.kg.error("颜色解析错误："+pt,!1)}}else Zt.kg.warn("无法获取分级规则，最大值或最小值未定义")})}function _t(Pt,St,yt,gt){const lt=Pt+"_"+(gt?"1":"0");if(Nt[lt]){const F=new Dt.Xm({min:St,max:yt,colorScale:Nt[lt].canvas});return F.css=ft[Pt].cssColor,F}try{const{colors:F,cssColor:pt}=function(bt){if(ft[bt])return ft[bt];const ut=Et.v.defaultLegendPath.endsWith("/")?Et.v.defaultLegendPath:Et.v.defaultLegendPath+"/",Mt=new XMLHttpRequest;return Mt.open("GET",ut+"/"+bt+".rgb",!1),Mt.send(null),Mt.status!==200?void Zt.kg.error("色标文件不存在："+ut):at(Mt.responseText.split(`
`),bt)}(Pt),ht=Dt.Xm.createColorScale(F.length>200?512:256,gt,F,void 0,15),mt=new Dt.Xm({colorScale:ht,min:St,max:yt});return mt.css=pt,Nt[lt]={canvas:ht},mt}catch(F){return void Zt.kg.error("颜色解析错误："+F,!1)}}function rt(Pt,St,yt,gt){return I(this,void 0,void 0,function*(){const lt=Pt+"_"+(gt?"1":"0");if(Nt[lt]){const F=new Dt.Xm({min:St,max:yt,colorScale:Nt[lt].canvas});return F.css=ft[Pt].cssColor,F}try{const{colors:F,cssColor:pt}=yield dt(Pt),ht=Dt.Xm.createColorScale(F.length>200?512:256,gt,F,void 0,15),mt=new Dt.Xm({colorScale:ht,min:St,max:yt});return mt.css=pt,Nt[lt]={canvas:ht},mt}catch(F){return void Zt.kg.error("颜色解析错误："+F,!1)}})}},478:(Je,Ce,ne)=>{ne.d(Ce,{m:()=>de,t:()=>Et});var Zt={};const de={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};Zt.clamp=function(Dt,Y,I){return Dt=Dt===void 0?0:Dt,Y=Y!==void 0?Y:0,I=I!==void 0?I:1,Math.max(Y,Math.min(I,Dt))},Zt.rgbToHsv=function(Dt){var Y={},I=Number(Dt.r===void 0?0:Dt.r)/255,At=Number(Dt.g===void 0?0:Dt.g)/255,Nt=Number(Dt.b===void 0?0:Dt.b)/255,ft=Math.max(I,At,Nt),at=Math.min(I,At,Nt),dt=ft-at;return Y.v=ft,Y.v===0?(Y.h=0,Y.s=0):(Y.s=(ft-at)/ft,Y.s===0?Y.h=0:(Y.h=ft===I?(At-Nt)/dt:ft===At?2+(Nt-I)/dt:4+(I-At)/dt,Y.h*=60,Y.h<0&&(Y.h+=360))),Y},Zt.hsvToRgb=function(Dt){var Y={r:0,g:0,b:0},I=Zt.clamp(Dt.h||Dt.hue,0,360),At=Zt.clamp(Dt.s||Dt.saturation,0,1),Nt=Zt.clamp(Dt.v||Dt.value),ft=At*Nt,at=I/60,dt=ft*(1-Math.abs(at%2-1));at<1?(Y.r=ft,Y.g=dt):at<2?(Y.r=dt,Y.g=ft):at<3?(Y.g=ft,Y.b=dt):at<4?(Y.g=dt,Y.b=ft):at<5?(Y.r=dt,Y.b=ft):(Y.r=ft,Y.b=dt);var et=Nt-ft;return Y.r+=et,Y.g+=et,Y.b+=et,Y.r*=255,Y.g*=255,Y.b*=255,Y},Zt.rgbToHsl=function(Dt){var Y=Zt.rgbToHsv(Dt),I={};return I.h=Y.h,I.l=(2-Y.s)*Y.v,I.s=Y.s*Y.v,I.s/=I.l<=1?I.l:2-I.l,I.l/=2,isNaN(I.s)&&(I.s=0),I},Zt.hslToRgb=function(Dt){var Y=Zt.clamp(Dt.h||Dt.hue,0,360),I=Zt.clamp(Dt.s||Dt.saturation),At=Zt.clamp(Dt.l||Dt.lightness),Nt={};return Nt.h=Y,I*=At<.5?At:1-At,Nt.s=2*I/(At+I),Nt.v=At+I,Zt.hsvToRgb(Nt)},Zt.rgbToLab=function(Dt){var Y,I;for(I in Dt={r:Dt.r/255,g:Dt.g/255,b:Dt.b/255})Dt.hasOwnProperty(I)&&(Dt[I]>.04045?Dt[I]=Math.pow((Dt[I]+.055)/1.055,2.4):Dt[I]/=12.92,Dt[I]=100*Dt[I]);Y={x:.4124*Dt.r+.3576*Dt.g+.1805*Dt.b,y:.2126*Dt.r+.7152*Dt.g+.0722*Dt.b,z:.0193*Dt.r+.1192*Dt.g+.9505*Dt.b};var At={},Nt={x:95.047,y:100,z:108.883};for(I in Y)Y.hasOwnProperty(I)&&(At[I]=Y[I]/Nt[I],At[I]>.008856?At[I]=Math.pow(At[I],.3333333333333333):At[I]=7.787*At[I]+.13793103448275862);return{l:116*At.y-16,a:500*(At.x-At.y),b:200*(At.y-At.z)}},Zt.labToRgb=function(Dt){var Y={},I={};for(var At in Y.y=((Dt.l||Dt.L)+16)/116,Y.x=Dt.a/500+Y.y,Y.z=Y.y-Dt.b/200,Y)Y.hasOwnProperty(At)&&(Math.pow(Y[At],3)>.008856?Y[At]=Math.pow(Y[At],3):Y[At]=(Y[At]-.13793103448275862)/7.787);return Y.x*=.9504699999999999,Y.y*=1,Y.z*=1.08883,I.r=3.2406*Y.x+-1.5372*Y.y+-.4986*Y.z,I.g=-.9689*Y.x+1.8758*Y.y+.0415*Y.z,I.b=.0557*Y.x+-.204*Y.y+1.057*Y.z,I.r>.0031308?I.r=1.055*Math.pow(I.r,.4166666666666667)-.055:I.r*=12.92,I.g>.0031308?I.g=1.055*Math.pow(I.g,.4166666666666667)-.055:I.g*=12.92,I.b>.0031308?I.b=1.055*Math.pow(I.b,.4166666666666667)-.055:I.b*=12.92,I.r=Zt.clamp(255*I.r,0,255),I.g=Zt.clamp(255*I.g,0,255),I.b=Zt.clamp(255*I.b,0,255),I},Zt.parseCss=function(Dt){var Y={};if(Dt.match(/^#[0-9a-f]{3}$/i))return Y={r:17*parseInt(Dt.charAt(1),16),g:17*parseInt(Dt.charAt(2),16),b:17*parseInt(Dt.charAt(3),16)},Zt.normalize(Y);if(Dt.match(/^#[0-9a-f]{6}$/i))return Y={r:parseInt(Dt.slice(1,3),16),g:parseInt(Dt.slice(3,5),16),b:parseInt(Dt.slice(5,7),16)},Zt.normalize(Y);var I=Dt.match(/^rgb\(\s*([0-9]+),\s*([0-9]+),\s*([0-9]+)\s*\)$/i);if(I)return Y={r:parseInt(I[1],10),g:parseInt(I[2],10),b:parseInt(I[3],10)},Zt.normalize(Y);var At=Dt.match(/^rgba\(\s*([0-9]+),\s*([0-9]+),\s*([0-9]+),\s*([0-9\.]+)\s*\)$/i);if(At)return Y={r:parseInt(At[1],10),g:parseInt(At[2],10),b:parseInt(At[3],10),a:parseFloat(At[4])},Zt.normalize(Y);throw new TypeError(Dt+" is not a valid CSS string for Spectra.")},Zt.parsePredefinedColor=function(Dt){return new Et(de[Dt])},Zt.normalize=function(Dt){Dt.a=Dt.a===void 0?1:Dt.a;var Y=Dt;return Y.hsv!==void 0?(Y=Zt.hsvToRgb(Y.hsv)).a=Dt.a:Y.hsl!==void 0?(Y=Zt.hslToRgb(Y.hsl)).a=Dt.a:Y.css!==void 0?Y=Zt.parseCss(Y.css):Y.lab!==void 0&&((Y=Zt.labToRgb(Y.lab)).a=Dt.a),Y.r=Y.red||Y.r,Y.g=Y.green||Y.g,Y.b=Y.blue||Y.b,Y.a=Y.alpha||Y.a,Y.r=Zt.clamp(Y.r,0,255),Y.g=Zt.clamp(Y.g,0,255),Y.b=Zt.clamp(Y.b,0,255),Y.a=Zt.clamp(Y.a,0,1),Y.r1=Y.r/255,Y.g1=Y.g/255,Y.b1=Y.b/255,Y};class Et{constructor(Y){var I,At,Nt,ft;if(Y==null)throw new TypeError("Spectra argument must be defined.");if(this.toString=this.rgbaString,this.toJSON=this.rgbaString,Y instanceof Et)for(const at in Y)this[at]=Y[at];else if(Y instanceof Array){const at={r:Y[0],g:Y[1],b:Y[2],a:Y.length>3?Y[3]:1};this.color=Zt.normalize(at)}else if(typeof Y=="object")if(Y.r!==void 0||Y.red!==void 0)this.color=Zt.normalize({r:(I=Y.r)!==null&&I!==void 0?I:Y.red,g:(At=Y.g)!==null&&At!==void 0?At:Y.green,b:(Nt=Y.b)!==null&&Nt!==void 0?Nt:Y.blue,a:(ft=Y.a)!==null&&ft!==void 0?ft:Y.alpha});else if(Y.v!==void 0||Y.value!==void 0)this.color=Zt.normalize({hsv:Y,a:Y.a});else if(Y.l===void 0&&Y.lightness===void 0||Y.s===void 0&&Y.saturation===void 0){if(Y.l===void 0&&Y.L===void 0||Y.a===void 0)throw new TypeError("Spectra argument "+Y+" is invalid.");this.color=Zt.normalize({lab:Y,a:Y.a||Y.alpha})}else this.color=Zt.normalize({hsl:Y,a:Y.a||Y.alpha});else{if(typeof Y!="string")throw new TypeError("Spectra argument "+Y+" is invalid.");if(Y.toLowerCase()in de)return Zt.parsePredefinedColor(Y);this.color=Zt.normalize({css:Y})}}red(Y){var I=this.color;return arguments.length?(I.r=Y,this.color=Zt.normalize(I),this):Math.round(I.r)}green(Y){var I=this.color;return arguments.length?(I.g=Y,this.color=Zt.normalize(I),this):Math.round(I.g)}blue(Y){var I=this.color;return arguments.length?(I.b=Y,this.color=Zt.normalize(I),this):Math.round(I.b)}hue(Y){var I=Zt.rgbToHsv(this.color);return arguments.length?(I.h=Y,this.color=Zt.normalize({hsv:I,a:this.color.a}),this):Math.round(I.h)}saturationv(Y){var I=Zt.rgbToHsv(this.color);return arguments.length?(I.s=Y,this.color=Zt.normalize({hsv:I,a:this.color.a}),this):I.s}value(Y){var I=Zt.rgbToHsv(this.color);return arguments.length?(I.v=Y,this.color=Zt.normalize({hsv:I,a:this.color.a}),this):I.v}saturation(Y){var I=Zt.rgbToHsl(this.color);return arguments.length?(I.s=Y,this.color=Zt.normalize({hsl:I,a:this.color.a}),this):I.s}lightness(Y){var I=Zt.rgbToHsl(this.color);return arguments.length?(I.l=Y,this.color=Zt.normalize({hsl:I,a:this.color.a}),this):I.l}alpha(Y){var I=this.color;return arguments.length?(I.a=Y,this):I.a}hexNumber(){return"0x"+("0"+this.red().toString(16)).slice(-2)+("0"+this.green().toString(16)).slice(-2)+("0"+this.blue().toString(16)).slice(-2)}hexWidthAlpha(){var Y=("0"+Math.round(255*this.alpha()).toString(16)).slice(-2);return this.hex()+Y}hex(){return"#"+("0"+this.red().toString(16)).slice(-2)+("0"+this.green().toString(16)).slice(-2)+("0"+this.blue().toString(16)).slice(-2)}rgbaString(){var Y,I;return"rgba("+this.red()+","+this.green()+","+this.blue()+","+((I=(Y=this.alpha()).toFixed)===null||I===void 0?void 0:I.call(Y,2))+")"}hslString(){return"hsl("+this.hue()+","+this.saturation()+","+Math.round(100*this.lightness())/100+")"}hslaString(){return"hsla("+this.hue()+","+this.saturation()+","+Math.round(100*this.lightness())/100+","+this.alpha()+")"}rgbNumber(){return this.red()<<16|this.green()<<8|this.blue()}labObject(){return Zt.rgbToLab(this.color)}glNumberArray(){return[this.color.r1,this.color.g1,this.color.b1,this.alpha()]}getColor(){return this.color}equals(Y){var I=Y;return arguments.length<1?this===I:this.near(I,0)}near(Y,I){var At=this,Nt=Y,ft=(I=Math.abs(I===void 0?0:I))/100*255;return Math.abs(Nt.red()-At.red())<=ft&&Math.abs(Nt.green()-At.green())<=ft&&Math.abs(Nt.blue()-At.blue())<=ft&&Math.abs(Nt.alpha()-At.alpha())<=I/100}complement(){var Y=new Et(this.color);return Y.hue((Y.hue()+180)%360),Y}negate(){var Y=new Et(this.color);return Y.red(255-Y.red()),Y.green(255-Y.green()),Y.blue(255-Y.blue()),Y}lighten(Y){var I=new Et(this.color),At=Zt.clamp(I.lightness()+Y/100,0,1);return I.lightness(At),I}darken(Y){return this.lighten(-Y)}randomColorRange(Y){var I=(2*Math.random()-1)*Y,At=new Et(this.color);return At.lighten(I)}saturate(Y){var I=Y/100,At=new Et(this.color);return At.saturation(At.saturation()+I),At}desaturate(Y){var I=Y/100,At=new Et(this.color);return At.saturation(At.saturation()-I),At}fadeIn(Y){var I=Y/100,At=new Et(this.color);return At.alpha(At.alpha()+I),At}fadeOut(Y){var I=Y/100,At=new Et(this.color);return At.alpha(At.alpha()-I),At}luma(){return .2126*this.red()+.7152*this.green()+.0722*this.blue()}grayscale(){return this.desaturate(100)}isDark(){return(299*this.red()+587*this.green()+144*this.blue())/1e3<131.5}isLight(){return!this.isDark()}mix(Y,I){Y=new Et(Y);var At=arguments.length<2?.5:I/100;return new Et({r:this.red()*(1-At)+Y.red()*At,g:this.green()*(1-At)+Y.green()*At,b:this.blue()*(1-At)+Y.blue()*At,a:this.alpha()*(1-At)+Y.alpha()*At})}contrast(Y){return Y=new Et(Y),(Math.max(this.red(),Y.red())-Math.min(this.red(),Y.red())+Math.max(this.green(),Y.green())-Math.min(this.green(),Y.green())+Math.max(this.blue(),Y.blue())-Math.min(this.blue(),Y.blue()))/765}gradient(Y,I){Y=new Et(Y);for(var At=[],Nt=this.red(),ft=this.green(),at=this.blue(),dt=(Y.red()-this.red())/(I-1),et=(Y.green()-this.green())/(I-1),_t=(Y.blue()-this.blue())/(I-1),rt=0;rt<I;rt++)At.push(new Et({r:Nt,g:ft,b:at})),Nt+=dt,ft+=et,at+=_t;return At}harmony(Y,I){I=typeof I=="number"?Math.abs(parseInt(I,10)):0;var At=[],Nt=Zt.rgbToHsv(this.color),ft=[0,180];switch(Y){case"analogous":ft=[0,30,60];break;case"triad":ft=[0,120,240];break;case"split-complementary":ft=[0,150,210];break;case"rectangle":ft=[0,60,180,240];break;case"square":ft=[0,90,180,270];break;case"complementary":ft=[0,180]}for(var at=ft.length,dt=ft[I%at],et=0;et<at;et++)At.push(new Et({h:(Nt.h+ft[et]-dt)%360,s:Nt.s,v:Nt.v,a:this.color.a}));return At}static random(){return new Et({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random())})}}},608:(Je,Ce,ne)=>{ne.d(Ce,{DY:()=>Zt,Mg:()=>de,NB:()=>Nt});var Zt,de,Et=ne(923),Dt=ne(251),Y=ne(1),I=ne(838),At=ne(307);(function(ft){ft.greater="greater",ft.less="less",ft.inside="inside",ft.outside="outside"})(Zt||(Zt={})),function(ft){ft.class="class",ft.less="less",ft.less_and_equal="less_and_equal",ft.greater="greater",ft.greater_and_equal="greater_and_equal",ft.unique="unique",ft.equal="equal"}(de||(de={}));class Nt{constructor(at,dt){this.options=at,this.stopConverter=dt,at.fieldName&&at.stops||(Et.kg.warn("分段渲染需要提供字段名和分段配置！当前配置："),Et.kg.error(at)),this.options instanceof Nt&&(this.options={stops:this.options.stops,fieldName:this.options.fieldName,action:this.options.action}),this.options.action===de.unique||this.options.action===de.equal?(this.getCurrentRule=this._getUniqueCurrentRule,this.getPreRule=this._getUniquePreRule,this.getNextRule=this._getUniqueNextRule,this.getRuleIndex=this._getUniqueRuleIndex,this.getDesc=this._getUniqueDesc):this.options.action===de.greater?(this.getCurrentRule=this._getGreaterCurrentRule,this.getPreRule=this._getGreaterPreRule,this.getNextRule=this._getGreaterNextRule,this.getRuleIndex=this._getGreaterRuleIndex,this.getDesc=this._getGreaterDesc):this.options.action===de.greater_and_equal?(this.getCurrentRule=this._getGreaterAndEqualCurrentRule,this.getPreRule=this._getGreaterAndEqualPreRule,this.getNextRule=this._getGreaterAndEqualNextRule,this.getRuleIndex=this._getGreaterAndEqualRuleIndex,this.getDesc=this._getGreaterAndEqualDesc):this.options.action===de.less?(this.getCurrentRule=this._getLessCurrentRule,this.getPreRule=this._getLessPreRule,this.getNextRule=this._getLessNextRule,this.getRuleIndex=this._getLessRuleIndex,this.getDesc=this._getLessDesc):(this.getCurrentRule=this._getClassCurrentRule,this.getPreRule=this._getClassPreRule,this.getNextRule=this._getClassNextRule,this.getRuleIndex=this._getClassRuleIndex,this.getDesc=this._getClassDesc),this.originalOptions=JSON.parse(JSON.stringify(this.options)),(0,Y.Ov)(this,this.options),this.action||(this.action=de.class),this.deserialize()}deserialize(){let at=0;for(const dt of this.stops){if(typeof dt.stop=="string"&&dt.stop.trim().indexOf(I.v.fieldLoaderIndicator)>0){const et=dt.stop.split(I.v.fieldLoaderIndicator),_t=et[0],rt=et[1].split("?"),Pt=(0,Dt.nA)(rt[0]);let St;Pt||(console.warn("未能找到对应指定的loader"+et[1]),dt.stop=_t),rt.length>1&&(St=(0,At.vl)(rt[1]));const yt=Pt(_t,St);yt==null&&Et.kg.warn("stop rule中的loader返回了无效值！"),dt.stop=yt}dt.stop=this.stopConverter?this.stopConverter(dt).stop:dt.stop,dt.idx=at++}}static updateStopValuesByMaxMin(at,dt,et,_t=1,rt=0,Pt=-1){if(Pt=at.length-1+Pt,dt=parseFloat(dt),et=parseFloat(et),!(0,Y.ri)(dt)||!(0,Y.ri)(et))return void Et.kg.warn("用来更新色标的最大最小值错误！");const St=parseFloat((1*(et-dt)/(Pt-rt)).toFixed(_t));for(let yt=rt;yt<Pt;yt++)at[yt].value=dt+parseFloat(((yt-rt)*St).toFixed(_t));at[Pt].value=et}updateValuesByMaxMin(at,dt,et=1,_t=0,rt=-1){Nt.updateStopValuesByMaxMin(this.stops,at,dt,et,_t,rt)}getRule(at,dt="current"){if(!this.stops||this.stops.length===0)throw new Error("尚未初始化该调色板");return dt==="next"?this.getNextRule(at):dt==="pre"?this.getPreRule(at):this.getCurrentRule(at)}getVal(at,dt){let et={},_t=dt(at),rt=0;for(let Pt of this.stops){if(_t===dt(Pt.stop))break;rt++}return rt===0?et.max=this.stops[0]:rt>=this.stops.length-1?et.min=this.stops[this.stops.length-1]:(et.min=this.stops[rt-1],et.max=this.stops[rt]),et}getVals(){return this.stops.map(at=>at.value)}getStops(){return this.stops.map(at=>at.stop)}clone(at=!1,dt=!1){const et=dt?this.originalOptions:this.options;return new Nt(at?JSON.parse(JSON.stringify(et)):et)}reset(){(0,Y.Ov)(this,this.originalOptions),this.deserialize()}setOpacityByIndex(at,dt,et,_t){if(at<0||at>=this.stops.length)return void Et.kg.warn("开始序号超出了stop数量！");if(_t=(0,Y.En)(_t,this.stops.length-1),et=(0,Y.En)(et,0),(0,Y.ri)(_t)&&(_t<0||_t>=this.stops.length))return void Et.kg.warn("结束序号超出了stop数量！");if(at>_t)return void Et.kg.warn("开始序号大于了结束序号");const rt=(Pt,St)=>{for(let yt=Pt;yt<=St;yt++)this.stops[yt].stop.alpha(et)};dt===Zt.greater?rt(at,this.stops.length-1):dt===Zt.less?rt(0,at-1):dt===Zt.inside?rt(at+1,_t):(rt(0,at-1),rt(_t,this.stops.length-1))}_getUniqueCurrentRule(at){for(let dt of this.stops)if(at==dt.value)return dt;return this.stops[this.stops.length-1]}_getUniquePreRule(at){for(let dt=0;dt<this.stops.length;dt++){let et=this.stops[dt];if(at==et.value)return dt===0?et:this.stops[dt-1]}return this.stops[this.stops.length-1]}_getUniqueNextRule(at){for(let dt=0;dt<this.stops.length;dt++){let et=this.stops[dt];if(at==et.value)return dt===this.stops.length-1?et:this.stops[dt+1]}return this.stops[this.stops.length-1]}_getUniqueRuleIndex(at){for(let dt=0;dt<this.stops.length;dt++)if(at==this.stops[dt].value)return dt;return this.stops.length-1}_getUniqueDesc(at){return this.getCurrentRule(at).value.toString()}_getClassCurrentRule(at){for(let dt of this.stops)if(at<=dt.value)return dt;return this.stops[this.stops.length-1]}_getClassPreRule(at){for(let dt=0;dt<this.stops.length;dt++){let et=this.stops[dt];if(at<=et.value)return dt===0?et:this.stops[dt-1]}return this.stops[this.stops.length-1]}_getClassNextRule(at){for(let dt=0;dt<this.stops.length;dt++){let et=this.stops[dt];if(at<=et.value)return dt===this.stops.length-1?et:this.stops[dt+1]}return this.stops[this.stops.length-1]}_getClassRuleIndex(at){for(let dt=0;dt<this.stops.length;dt++)if(at<=this.stops[dt].value)return dt;return this.stops.length-1}_getClassDesc(at){let dt=this.getPreRule(at);if(!dt||dt.value===at)return"<="+at;let et=this.getNextRule(at);return et&&et.value!==at?dt.value+"-"+at:">"+dt.value}_getGreaterCurrentRule(at){for(let dt=this.stops.length-1;dt>=0;dt--)if(at>this.stops[dt].value)return this.stops[dt];return this.stops[this.stops.length-1]}_getGreaterPreRule(at){for(let dt=this.stops.length-1;dt>=0;dt--){let et=this.stops[dt];if(at>et.value)return dt===0?et:this.stops[dt-1]}return this.stops[this.stops.length-1]}_getGreaterNextRule(at){for(let dt=this.stops.length-1;dt>=0;dt--){let et=this.stops[dt];if(at>et.value)return dt===this.stops.length-1?et:this.stops[dt+1]}return this.stops[this.stops.length-1]}_getGreaterRuleIndex(at){for(let dt=this.stops.length-1;dt>=0;dt--)if(at>this.stops[dt].value)return dt;return 0}_getGreaterDesc(at){let dt=this.getNextRule(at);return dt&&dt.value!==at?at+"-"+dt.value:">"+at}_getGreaterAndEqualCurrentRule(at){for(let dt=this.stops.length-1;dt>=0;dt--)if(at>=this.stops[dt].value)return this.stops[dt];return this.stops[this.stops.length-1]}_getGreaterAndEqualPreRule(at){for(let dt=this.stops.length-1;dt>=0;dt--){let et=this.stops[dt];if(at>=et.value)return dt===0?et:this.stops[dt-1]}return this.stops[this.stops.length-1]}_getGreaterAndEqualNextRule(at){for(let dt=this.stops.length-1;dt>=0;dt--){let et=this.stops[dt];if(at>=et.value)return dt===this.stops.length-1?et:this.stops[dt+1]}return this.stops[this.stops.length-1]}_getGreaterAndEqualRuleIndex(at){for(let dt=this.stops.length-1;dt>=0;dt--)if(at>=this.stops[dt].value)return dt;return 0}_getGreaterAndEqualDesc(at){let dt=this.getNextRule(at);return dt&&dt.value!==at?at+"-"+dt.value:">="+at}_getLessCurrentRule(at){for(let dt of this.stops)if(at<dt.value)return dt;return this.stops[this.stops.length-1]}_getLessPreRule(at){for(let dt=0;dt<this.stops.length;dt++){let et=this.stops[dt];if(at<et.value)return dt===0?et:this.stops[dt-1]}return this.stops[this.stops.length-1]}_getLessNextRule(at){for(let dt=0;dt<this.stops.length;dt++){let et=this.stops[dt];if(at<et.value)return dt===this.stops.length-1?et:this.stops[dt+1]}return this.stops[this.stops.length-1]}_getLessRuleIndex(at){for(let dt=0;dt<this.stops.length;dt++)if(at<this.stops[dt].value)return dt;return this.stops.length-1}_getLessDesc(at){let dt=this.getPreRule(at);if(!dt||dt.value===at)return"<"+at;let et=this.getNextRule(at);return et&&et.value!==at?dt.value+"-"+at:">"+dt.value}}},307:(J,S,y)=>{y.d(S,{$P:()=>v,$k:()=>i,LH:()=>A,Uw:()=>O,it:()=>e,lW:()=>U,vl:()=>P});var Z=y(923),G=y(316),c=y(251),R=y(838),H=y(478);function P(Je,Ce="&",ne="="){const Zt={};if(!Je||Je.trim().length===0)return Zt;const de=Je.split(Ce),Et=[];for(var Dt=0;Dt<de.length;Dt++){var Y=de[Dt].indexOf(ne);let I,At;Y==-1?(I=de[Dt],At=void 0):(I=de[Dt].substring(0,Y),At=de[Dt].substring(Y+1)),Zt[I]=At,Et.push(I)}return Zt.__order=Et,Zt}function e(D){var W;if(D!=null){if(typeof D=="string"){if(D=D.trim(),D.length===0||D.startsWith(R.v.fieldPropertiesIndicator)||D.startsWith(R.v.fieldLoaderIndicator))return D;if(D.indexOf(R.v.fieldLoaderIndicator)>0){const Je=D.split(R.v.fieldLoaderIndicator),Ce=Je[1].split("?"),ne=(0,c.nA)(Ce[0]);if(ne)if(Ce.length>1){const Zt=P(Ce[1]);D=ne(Je[0],Zt)}else D=ne(Je[0],{});else Z.kg.warn("当前字段"+Je[0]+"的loader未找到，将直接使用字段值！"),D=Je[0]}else G.Zc.hasResource(D)&&(D=(W=G.Zc.getResource(D))===null||W===void 0?void 0:W.instance);if(typeof D=="string"&&D.trim().startsWith(R.v.functionIndicator)){D=D.trim();const h=eval(D.substring(R.v.functionIndicator.length));return typeof h=="function"?(...Je)=>h(...Je):D}return D}return D}Z.kg.warn("字段配置为空！")}const v=Je=>Je.startsWith("0x")?(Je="#"+Je.slice(2),new H.t(Je)):new H.t(Je),U=Je=>{const Ce="#"+Je.toString(16);return v(Ce)},A=Je=>Je.length===3?new H.t({r:Je[0],g:Je[1],b:Je[2]}):new H.t({r:Je[0],g:Je[1],b:Je[2],a:Je[3]});class O{constructor(Ce){this.sourceOptions=Ce,this._cache={},this.styleName="qeStyle"}isStyle(){return!0}getPublicKeys(){const Ce=Object.keys(this),ne=[];for(const Zt of Ce)Zt.startsWith("_")||ne.push(Zt);return ne}clearCaches(){this._cache={};const Ce=this.getPublicKeys();for(const ne of Ce){if(typeof ne!="string"){Z.kg.warn("key不是字符串！");continue}const Zt=this[ne],de=Et=>{if(Et!==void 0&&Et!=null){if(Et.isStyle&&Et.isStyle())Et.clearCaches&&Et.clearCaches();else if(Et instanceof Array)for(const Dt of Et)de(Dt)}};de(Zt)}}update(Ce,ne=!1){if(this._cache={},ne){const de=this.getPublicKeys();for(const Et of de)this[Et]=void 0;return void this._update(Ce,!0)}const Zt=Object.assign({},Ce);for(const de of Object.keys(Ce))Ce[de]===void 0&&this[de]&&(this[de]=void 0,delete Zt[de]);this._update(Zt,!1)}getPlaneOptions(Ce,ne=!0,Zt){const de=this._createCacheId(Ce);if(ne&&this._cache[de]!==void 0)return this._cache[de];const Et={},Dt=this.getPublicKeys();for(const Y of Dt){if(typeof Y!="string"){Z.kg.warn("key不是字符串！");continue}const I=this[Y],At=Nt=>{if(Nt!==void 0&&Nt!=null){if(Nt.isStyle&&Nt.isStyle())return Nt.getPlaneOptions(Ce,ne,Zt);if(Nt instanceof Array){const ft=[];for(const at of Nt)ft.push(At(at));return ft}return typeof Nt=="function"?Nt(Ce,Zt):Nt}};Et[Y]=At(I)}return ne&&de&&(this._cache[de]=Et),Et}}const i=Je=>(Je.stop instanceof H.t||(typeof Je.stop=="string"?Je.stop=v(Je.stop):typeof Je.stop=="number"?Je.stop=U(Je.stop):Je.stop instanceof Array?Je.stop=A(Je.stop):typeof Je.stop!="object"||Je.stop.r===void 0&&Je.stop.red===void 0?Z.kg.error("调色板中不能识别的颜色配置："+Je.stop):Je.stop=new H.t(Je.stop)),Je)},96:(Je,Ce,ne)=>{var Zt;ne.d(Ce,{U:()=>Zt}),function(de){de[de.Int8=0]="Int8",de[de.UInt8=1]="UInt8",de[de.Int16=2]="Int16",de[de.UInt16=3]="UInt16",de[de.Int32=4]="Int32",de[de.UInt32=5]="UInt32",de[de.Float32=6]="Float32",de[de.Float64=7]="Float64"}(Zt||(Zt={}))},589:(Je,Ce,ne)=>{ne.d(Ce,{r:()=>Et});var Zt=ne(915),de=ne(1);class Et extends Zt.c{constructor(Y){super(),this.eventNames={tChanged:"tChanged",zChanged:"zChanged",tzChanged:"tzChanged",iTChanged:"iTChanged",iZChanged:"iZChanged",iTZChanged:"iTZChanged",activeTZDataUpated:"activeTZDataUpated"},this.meta={},this._currentTIdx=0,this._currentZIdx=0,this.grids=[],this.options=(0,de.Ov)(this.options,Y,{maxTimeCount:0})}addGridTo(Y,I,At,Nt,ft,at){I=parseInt(I),At=parseInt(At);const dt=this.getIntTIdx(),et=this.getIntZIdx();return at[I]=at[I]||[],at[I][At]=Y,this.gridOptions.tCount=at.length,(0,de.ri)(Nt)&&this.gridOptions.zValues&&(this.gridOptions.zValues[At]=Nt),I===dt&&At===et?this.fire(this.eventNames.activeTZDataUpated,{firer:this,msg:this}):ft&&(this.lock(),this.currentTIdx=I,this.currentZIdx=At,this.unlock()),this}get currentTIdx(){return this._currentTIdx}set currentTIdx(Y){if(this.grids&&Y>=this.grids.length||Y===this.currentTIdx)return;const I=this.getIntTIdx();this._currentTIdx=Y,I!==this.getIntTIdx()?(this.fire(this.eventNames.iTChanged,{firer:this,msg:this}),this.fire(this.eventNames.iTZChanged,{firer:this,msg:this})):(this.fire(this.eventNames.tChanged,{firer:this,msg:this}),this.fire(this.eventNames.tzChanged,{firer:this,msg:this}))}get currentZIdx(){return this._currentZIdx}set currentZIdx(Y){var I;if(this.grids&&Y>=((I=this.grids[this.getIntTIdx()])===null||I===void 0?void 0:I.length)||Y===this.currentZIdx)return;const At=this.getIntZIdx();this._currentZIdx=Y,At!==this.getIntZIdx()?(this.fire(this.eventNames.iZChanged,{firer:this,msg:this}),this.fire(this.eventNames.iTZChanged,{firer:this,msg:this})):(this.fire(this.eventNames.zChanged,{firer:this,msg:this}),this.fire(this.eventNames.tzChanged,{firer:this,msg:this}))}centerLon(){return(this.gridOptions.xStart+this.gridOptions.xEnd)/2}centerLat(){return(this.gridOptions.yStart+this.gridOptions.yEnd)/2}centerZ(){var Y,I,At;return((Y=this.gridOptions)===null||Y===void 0?void 0:Y.zValues.length)>1?(this.gridOptions.zValues[0]+this.gridOptions.zValues[this.gridOptions.zValues.length-1])/2:(At=(I=this.gridOptions)===null||I===void 0?void 0:I.zValues[0])!==null&&At!==void 0?At:0}center(){return{lon:this.centerLon(),lat:this.centerLat(),z:this.centerZ()}}getGrid(Y,I){var At,Nt;return Y===void 0&&(Y=this.getIntTIdx()),I===void 0&&(I=this.getIntZIdx()),(Nt=(At=this.grids)===null||At===void 0?void 0:At[Y])===null||Nt===void 0?void 0:Nt[I]}allGrids(){return this.grids}updateGrid(Y,I,At,Nt,ft){return this.addGridTo(Y,I,At,Nt,ft,this.allGrids())}getIntTIdx(){return parseInt(this._currentTIdx)}getIntZIdx(){return parseInt(this._currentZIdx)}onTChanged(Y){return this.on(this.eventNames.tChanged,Y),this}onZChanged(Y){return this.on(this.eventNames.zChanged,Y),this}onTZChanged(Y){return this.on(this.eventNames.tzChanged,Y),this}onIntTChanged(Y){return this.on(this.eventNames.iTChanged,Y),this}onIntZChanged(Y){return this.on(this.eventNames.iZChanged,Y),this}onIntTZChanged(Y){return this.on(this.eventNames.iTZChanged,Y),this}offTChanged(Y){return this.off(this.eventNames.tChanged,Y),this}offZChanged(Y){return this.off(this.eventNames.zChanged,Y),this}offTZChanged(Y){return this.off(this.eventNames.tzChanged,Y),this}offIntTChanged(Y){return this.off(this.eventNames.iTChanged,Y),this}offIntZChanged(Y){return this.off(this.eventNames.iZChanged,Y),this}offIntTZChanged(Y){return this.off(this.eventNames.iTZChanged,Y),this}onActiveGridUpdated(Y){return this.on(this.eventNames.activeTZDataUpated,Y),this}offActiveGridUpdated(Y){return this.off(this.eventNames.activeTZDataUpated,Y),this}pickValue(Y,I,At,Nt){const ft=this.getGrid(At,Nt);if(!ft)return;const at=(0,de.tr)(this.gridOptions.xStart,this.gridOptions.xDelta,Y),dt=(0,de.tr)(this.gridOptions.yStart,this.gridOptions.yDelta,I);return ft.read2D(dt,at)}}},458:(Je,Ce,ne)=>{ne.d(Ce,{o:()=>de});var Zt=ne(589);class de extends Zt.r{constructor(Dt,Y){var I;super(Y),this.grids=Dt||[],this.gridOptions=this.options.gridOptions,this.meta=(I=this.options.meta)!==null&&I!==void 0?I:{}}}},285:(J,S,y)=>{y.d(S,{Bn:()=>B,b_:()=>L,cF:()=>T,ko:()=>h});var Z=["byte","int","uint","int16","uint16","int32","uint32","float32","float64","string","url","alias"],G=["Sequence","Structure","Dataset"],c="(\\\\=|\\\\\\]|[^\\]=])+",R="\\d+",H="\\w+",P="(\\\\;|\\\\\\[|[^\\[;])+",e="(\\\\;|[^;])+",v="(\\\\;|[^;])+",U='".*?[^\\\\]"|[^;,]+',A="\\w+",O="(\\\\\\s|[^\\s])+",i="(\\\\{|[^{])+",D="(\\\\{|[^{])+",W='".*?[^\\\\]"|[^;,]+',m='"(\\\\\\\\|\\\\"|[^"])*"',q="\\w+",g='".*?[^\\\\]"|[^;,]+';function l(x){return eval("("+x+")")}class h{constructor(Ce){this.type=Ce,this.attributes={}}}class L{constructor(Ce){this.stream=Ce}peek(Ce){var ne=new RegExp("^"+Ce,"i"),Zt=this.stream.match(ne);return Zt?Zt[0]:""}consume(Ce){var ne=new RegExp("^"+Ce,"i"),Zt=this.stream.match(ne);if(Zt)return this.stream=this.stream.substr(Zt[0].length).trimStart(),Zt[0];throw new Error("Unable to parse stream: "+this.stream.substr(0,10))}}class T extends L{parse(){return this._dataset()}_dataset(){var Ce=new h("Dataset");for(this.consume("dataset"),this.consume("{");!this.peek("}");){var ne=this._declaration();Ce[ne.name]=ne}return this.consume("}"),Ce.id=Ce.name=this.consume(e).trim(),this.consume(";"),function Zt(de,Et){for(var Dt in de){var Y=de[Dt];Y.type&&(Y.id=Y.name,Et&&(Y.id=de.id+"."+Y.id),Zt(Y,!0))}}(Ce,!1),Ce}_declaration(){switch(this.peek(H).toLowerCase()){case"grid":return this._grid();case"structure":return this._structure("Structure");case"sequence":return this._structure("Sequence");default:return this._base_declaration()}}_base_declaration(){var Ce=new h;for(Ce.type=this.consume(H).trim(),Ce.name=this.consume(P).trim(),Ce.dimensions=[],Ce.shape=[];!this.peek(";");){this.consume("\\[");var ne=this.consume(c).trim();this.peek("=")&&(Ce.dimensions.push(ne),this.consume("="),ne=this.consume(R).trim()),Ce.shape.push(parseInt(ne)),this.consume("\\]")}return this.consume(";"),Ce}_grid(){var Ce=new h("Grid");for(this.consume("grid"),this.consume("{"),this.consume("array"),this.consume(":"),Ce.array=this._base_declaration(),this.consume("maps"),this.consume(":"),Ce.maps={};!this.peek("}");){var ne=this._base_declaration();Ce.maps[ne.name]=ne}return this.consume("}"),Ce.name=this._name(),Ce}_structure(Ce){var ne=new h(Ce);for(this.consume(Ce),this.consume("{");!this.peek("}");){var Zt=this._declaration();ne[Zt.name]=Zt}return this.consume("}"),ne.name=this._name(),ne}_name(){var Ce=this.consume(v).trim();return this.consume(";"),Ce}}class B extends L{constructor(Ce,ne){super(Ce),this.dataset=ne}parse(){for(this._target=this.dataset,this.consume("attributes"),this.consume("{");!this.peek("}");)this._attr_container();return this.consume("}"),this.dataset}_attr_container(){if(Z.indexOf(this.peek(q).toLowerCase())!==-1){if(this._attribute(this._target.attributes),this._target.type==="Grid"){for(var Ce in this._target.maps)if(this.dataset[Ce]){var ne=this._target.maps[Ce];for(var Zt in ne.attributes)this.dataset[Ce].attributes[Zt]=ne.attributes[Zt]}}}else this._container()}_container(){var Ce,ne=this.consume(i).trim();if(this.consume("{"),ne.indexOf(".")>-1){var Zt=ne.split(".");Ce=this._target;for(var de=0;de<Zt.length;de++)this._target=this._target[Zt[de]];for(;!this.peek("}");)this._attr_container();this.consume("}"),this._target=Ce}else if(G.includes(this._target.type)&&this._target[ne]){for(Ce=this._target,this._target=Ce[ne];!this.peek("}");)this._attr_container();this.consume("}"),this._target=Ce}else this._target.attributes[ne]=this._metadata(),this.consume("}")}_metadata(){for(var Ce={};!this.peek("}");)if(Z.includes(this.peek(q).toLowerCase()))this._attribute(Ce);else{var ne=this.consume(D).trim();this.consume("{"),Ce[ne]=this._metadata(),this.consume("}")}return Ce}_attribute(Ce){for(var ne,Zt=this.consume(A).trim(),de=this.consume(O).trim(),Et=[];!this.peek(";");){if(Zt.toLowerCase()==="string")ne=(ne=this.consume(m).trim()).substr(1,ne.length-2);else if(Zt.toLowerCase()==="url")ne=this.consume(g).trim();else if(Zt.toLowerCase()==="alias"){var Dt,Y;(ne=this.consume(U).trim()).match(/^\\./)?(Y=ne.substring(1).split("."),Dt=this.dataset):(Y=ne.split("."),Dt=this._target);for(var I=0;I<Y.length;I++){var At=Y[I];ne=Dt=Dt[At]?Dt[At]:Dt.array.name===At?Dt.array:Dt.maps[At]?Dt.maps[At]:Dt.attributes[At]}}else ne=(ne=this.consume(W).trim()).toLowerCase()==="nan"?NaN:ne.toLowerCase()==="inf"?1/0:ne.toLowerCase()==="-inf"?-1/0:l(ne);Et.push(ne),this.peek(",")&&this.consume(",")}this.consume(";"),Et.length===1&&(Et=Et[0]),Ce[de]=Et}}},923:(Je,Ce,ne)=>{ne.d(Ce,{$V:()=>de,kg:()=>Et,qr:()=>Dt});var Zt=ne(838);class de{error(I,At=!0,Nt=void 0,ft=void 0){ft&&ft(I);const at=Nt&&Nt.name?"["+Nt.name+"]":"";if(typeof I=="object"?console.log(I):console.error("%c[error]"+at+" "+I,de.DefaultStyles.errorStyle),At)throw new Error(I)}warn(I,At=void 0,Nt=void 0){Nt&&Nt(I);const ft=At&&At.name?"["+At.name+"]":"";console.warn("%c[warn]"+ft+" "+I,de.DefaultStyles.warnStyle)}log(I,At=void 0,Nt=void 0){Nt&&Nt(I);const ft=At&&At.name?"["+At.name+"]":"";typeof I=="object"?(console.log("%c[info]",de.DefaultStyles.logStyle),console.log(I)):console.log("%c[info]"+ft+" "+I,de.DefaultStyles.logStyle)}debug(I,At=void 0,Nt=void 0){Nt&&Nt(I);const ft=At&&At.name?"["+At.name+"]":"",at="[debug]["+new Date().toLocaleString()+"]";typeof I=="object"?(console.log(""+at),console.log(I)):console.log(""+at+ft+" "+I)}note(I,At=void 0,Nt=void 0){Nt&&Nt(I);const ft=At&&At.name?"["+At.name+"]":"",at="[note]["+new Date().toLocaleString()+"]";typeof I=="object"?(console.log("%c"+at),console.log(I)):console.log("%c"+at+ft+" ******"+I+"******",de.DefaultStyles.noteStyle)}custom(I,At,Nt=void 0,ft=void 0){ft&&ft(I);const at=Nt&&Nt.name?"["+Nt.name+"]":"",dt="[custom]["+new Date().toLocaleString()+"]";typeof I=="object"?(console.log("%c"+dt,At||"color:black"),console.log(I)):console.log("%c"+dt+at+" "+I,At||"color:black")}}de.DefaultStyles={logStyle:"color:blue",warnStyle:"color:orange",errorStyle:"color:red",noteStyle:"color:green;font:bold"};const Et=new de,Dt=()=>{Zt.v.Debug||(Et.debug=(Y,I=void 0)=>{})}},316:(Je,Ce,ne)=>{ne.d(Ce,{GB:()=>rt,I$:()=>_t,MM:()=>at,Xf:()=>dt,Zc:()=>lt,gD:()=>St,pQ:()=>et,qg:()=>Pt,xR:()=>yt,zc:()=>gt});var Zt=ne(838),de=ne(915),Et=ne(413),Dt=ne(608),Y=ne(1),I=ne(923),At=ne(378),Nt=ne.n(At),ft=function(F,pt,ht,mt){return new(ht||(ht=Promise))(function(bt,ut){function Mt(Ut){try{tt(mt.next(Ut))}catch(nt){ut(nt)}}function st(Ut){try{tt(mt.throw(Ut))}catch(nt){ut(nt)}}function tt(Ut){var nt;Ut.done?bt(Ut.value):(nt=Ut.value,nt instanceof ht?nt:new ht(function(ue){ue(nt)})).then(Mt,st)}tt((mt=mt.apply(F,pt||[])).next())})};const at={images:"images",stopRules:"stopRules",featureStyles:"featureStyles",gridStyles:"gridStyles",jsonFiles:"jsonFiles",rawFiles:"rawFiles",texts:"texts",colorScales:"colorScales"},dt=F=>ft(void 0,void 0,void 0,function*(){let{resourceType:pt,requestInfo:ht,init:mt,key:bt}=F;const ut={source:F,resourceType:pt};return F instanceof HTMLImageElement||F instanceof HTMLCanvasElement||F instanceof HTMLVideoElement?(ut.instance=F,Promise.resolve(ut)):new Promise((Mt,st)=>{if(typeof ht=="string"){const tt=document.createElement("img");tt.crossOrigin="",tt.onload=()=>{ut.instance=tt,Mt(ut)},tt.onerror=Ut=>{st(Ut)},tt.src=ht}else I.kg.error("不支持的图片资源构建器参数："+ht,!0,void 0,st)})}),et=(F,pt,ht,mt=!0)=>ft(void 0,void 0,void 0,function*(){let{resourceType:bt,requestInfo:ut,init:Mt,key:st}=F;const tt={source:F,resourceType:bt};return pt(ut)?(tt.instance=ut,I.kg.warn("当前资源存放的是实例而不是实例的构造参数！"+st),Promise.resolve(tt)):ht(ut)?(tt.instance=ut,Promise.resolve(tt)):fetch(ut).then(Ut=>typeof ut=="string"&&ut.endsWith("zip")||ut instanceof Request&&ut.url.endsWith("zip")?Ut.arrayBuffer().then(nt=>new(Nt())().loadAsync(nt).then(ue=>ft(void 0,void 0,void 0,function*(){Object.keys(ue.files).length;for(let re in ue.files){let ee=re;if(!(ee.indexOf("MACOSX")>=0))return ue.files[ee].async(mt?"text":"arraybuffer").then(Qt=>Promise.resolve(mt?JSON.parse(Qt):Qt))}})).catch(I.kg.debug)).catch(I.kg.debug):mt?Ut.json():Ut.arrayBuffer()).then(Ut=>(tt.instance=Ut,Promise.resolve(tt))).catch(I.kg.debug)}),_t=F=>ft(void 0,void 0,void 0,function*(){return et(F,pt=>!1,pt=>typeof pt=="object")}),rt=F=>ft(void 0,void 0,void 0,function*(){return et(F,pt=>pt instanceof ArrayBuffer,pt=>!1,!1)}),Pt=F=>ft(void 0,void 0,void 0,function*(){return et(F,pt=>pt instanceof Dt.NB,pt=>typeof pt=="object"&&pt.stops)}),St=F=>ft(void 0,void 0,void 0,function*(){return et(F,pt=>pt instanceof Et.sC,pt=>typeof pt=="object"&&(pt.point||pt.polygon||pt.polyline||Object.keys(pt).length===0))}),yt=F=>ft(void 0,void 0,void 0,function*(){return et(F,pt=>(pt==null?void 0:pt.styleName)==="gridStyle",pt=>typeof pt=="object")});class gt extends de.c{constructor(){super(...arguments),this.registerCreator=gt.registerCreator,this.creators=gt.creators,this.resources={}}static registerCreator(pt,ht){gt.creators[pt]&&I.kg.warn("名为"+pt+"的资源构建器已经存在，将使用新的替换！"),gt.creators[pt]=ht}get allResources(){return this.resources}addResource(pt,ht,mt=!1){if(!pt||!this.hasResource(pt)||mt){if(ht&&ht.instance&&ht.resourceType||I.kg.error("资源信息中的实例、类型不能为空！"),this.hasResource(pt)){const bt=this.getResource(pt);this.resources[pt]=ht,this.fire(gt.EventTypes.resUpdated,{firer:this,msg:{oldResource:bt,newResource:ht}}),this.fire(gt.EventTypes.resUpdated+":"+pt,{firer:this,msg:{oldResource:bt,newResource:ht}}),I.kg.debug("资源"+pt+"已更新！")}else this.resources[pt]=ht,this.fire(gt.EventTypes.resAdd,{firer:this,msg:ht}),this.fire(gt.EventTypes.resAdd+":"+pt,{firer:this,msg:ht});this.fire(gt.EventTypes.resLoaded,{firer:this,msg:ht}),this.fire(gt.EventTypes.resLoaded+":"+pt,{firer:this,msg:ht}),I.kg.debug("资源"+pt+"已增加！")}}loadResource(pt,ht=!1){return ft(this,void 0,void 0,function*(){if(pt.key&&this.hasResource(pt.key)&&!ht)return Promise.resolve(this.getResource(pt.key));const mt=this.creators[pt.resourceType];if(!mt)return I.kg.error("尚未注册类型为"+pt.resourceType+"的资源构建器！"),Promise.reject("尚未注册类型为"+pt.resourceType+"的资源构建器！");typeof pt.requestInfo=="string"&&(pt.requestInfo.startsWith("http")||pt.requestInfo.startsWith("/")||(pt.requestInfo=Zt.v.resourcePath+"/"+pt.requestInfo));const bt=yield mt(pt).catch(I.kg.debug);if(!bt)throw I.kg.error("构建资源实例失败"),"构建资源实例失败！";return bt.resourceType||(bt.resourceType=pt.resourceType),this.addResource(pt.key,bt,ht),bt})}loadResources(pt){return ft(this,void 0,void 0,function*(){if(!pt||pt.length===0)return Promise.resolve([]);const ht=[];for(const mt of pt){const bt=yield this.loadResource(mt).catch(I.kg.debug);ht.push(bt)}return Promise.resolve(ht)})}loadResourceFromConfig(pt,ht=!1){return ft(this,void 0,void 0,function*(){if(!pt||Object.keys(pt).length===0)return Promise.resolve([]);const mt=(Lt,pe)=>ft(this,void 0,void 0,function*(){if(!Lt)return Promise.resolve([]);const be=[];for(const se in Lt){const Fe=Lt[se],Pe={resourceType:pe,requestInfo:Fe,key:se},It=yield this.loadResource(Pe,ht).catch(I.kg.debug);be.push(It)}return Promise.resolve(be)}),bt=Object.assign({},pt),ut=pt,Mt=[];if(ut.texts)for(const Lt in ut.texts){const pe={resourceType:at.texts,source:{resourceType:at.texts,requestInfo:void 0,key:Lt},instance:ut.texts[Lt]};this.addResource(Lt,pe,!0),Mt.push(pe)}const st=yield mt(ut.jsonFiles,at.jsonFiles).catch(I.kg.debug);delete bt.jsonFiles;const tt=yield mt(ut.rawFiles,at.rawFiles).catch(I.kg.debug);delete bt.rawObjs;const Ut=yield mt(ut.images,at.images).catch(I.kg.debug);delete bt.images;const nt=yield mt(ut.colorScales,at.colorScales).catch(I.kg.debug);delete bt.colorScales;const ue=yield mt(ut.stopRules,at.stopRules).catch(I.kg.debug);delete bt.stopRules;const re=yield mt(ut.featureStyles,at.featureStyles).catch(I.kg.debug);delete bt.featureStyles;const ee=yield mt(ut.gridStyles,at.gridStyles).catch(I.kg.debug);delete bt.gridStyles;const Qt=[...Mt,...st,...tt,...Ut,...ue,...re,...ee,...nt];for(const Lt in bt){const pe=yield mt(bt[Lt],Lt).catch(I.kg.debug);Qt.push(...pe)}return Qt})}loadResourceFromConfigPath(pt,ht,mt=!1){return ft(this,void 0,void 0,function*(){return typeof pt=="string"&&(pt.startsWith("http")||pt.startsWith("/")||(pt=Zt.v.resourcePath+"/"+pt)),(0,Y.TN)(pt,ht).then(bt=>bt.json()).then(bt=>this.loadResourceFromConfig(bt,mt)).catch(I.kg.debug)})}getResource(pt){return this.resources[pt]?this.resources[pt]:(I.kg.warn("ID为"+pt+"的资源不存在，请先使用资源管理器进行加载！"),{instance:void 0})}removeResource(pt){const ht=this.resources[pt],mt=delete this.resources[pt];return ht&&this.fire(gt.EventTypes.resRemoved,{firer:this,msg:ht}),mt}hasResource(pt){return this.resources[pt]!==void 0}whenResourceAdded(pt,ht){let mt=this.getResource(pt);if(mt)return Promise.resolve(mt);this.on(gt.EventTypes.resLoaded+":"+pt,bt=>{ht(bt.msg)})}whenResourceUpdated(pt,ht){this.on(gt.EventTypes.resUpdated+":"+pt,mt=>{ht(mt.msg.oldResource,mt.msg.newResource)})}whenResourceLoaded(pt,ht){this.on(gt.EventTypes.resLoaded+":"+pt,mt=>{ht(mt.msg)})}whenResourceRemoved(pt,ht){this.on(gt.EventTypes.resRemoved+":"+pt,mt=>{ht(mt.msg)})}}gt.creators={},gt.EventTypes={resAdd:"res:add",resRemoved:"res:remove",resUpdated:"res:update",resLoaded:"res:load"},gt.registerCreator(at.images,dt),gt.registerCreator(at.stopRules,Pt),gt.registerCreator(at.featureStyles,St),gt.registerCreator(at.gridStyles,yt),gt.registerCreator(at.jsonFiles,_t),gt.registerCreator(at.rawFiles,rt),gt.registerCreator(at.colorScales,dt);const lt=new gt},149:(Je,Ce,ne)=>{ne.d(Ce,{Ao:()=>rt,H$:()=>gt,Tz:()=>mt,fV:()=>St,jr:()=>lt,lS:()=>bt,sU:()=>ut,tq:()=>F});var Zt=ne(923),de=ne(1),Et=function(Mt,st,tt,Ut){return new(tt||(tt=Promise))(function(nt,ue){function re(Lt){try{Qt(Ut.next(Lt))}catch(pe){ue(pe)}}function ee(Lt){try{Qt(Ut.throw(Lt))}catch(pe){ue(pe)}}function Qt(Lt){var pe;Lt.done?nt(Lt.value):(pe=Lt.value,pe instanceof tt?pe:new tt(function(be){be(pe)})).then(re,ee)}Qt((Ut=Ut.apply(Mt,st||[])).next())})};let Dt=window.orientation!==void 0;class Y{constructor(st,tt,Ut){this.name=st,this.version=tt,this.os=Ut,this.type="browser"}}class I{constructor(st){this.version=st,this.type="node",this.name="node",this.os=process.platform}}class At{constructor(st,tt,Ut,nt){this.name=st,this.version=tt,this.os=Ut,this.bot=nt,this.type="bot-device"}}class Nt{constructor(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}}class ft{constructor(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}}const at=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,dt=3,et=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],_t=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows 11",/(Windows NT 11.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function rt(Mt){return Mt?Pt(Mt):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ft:typeof navigator<"u"?Pt(navigator.userAgent):typeof process<"u"&&process.version?new I(process.version.slice(1)):null}function Pt(Mt){const st=function(Qt){return Qt!==""&&et.reduce((Lt,[pe,be])=>{if(Lt)return Lt;const se=be.exec(Qt);return!!se&&[pe,se]},!1)}(Mt);if(!st)return null;const[tt,Ut]=st;if(tt==="searchbot")return new Nt;let nt=Ut[1]&&Ut[1].split(/[._]/).slice(0,3);nt?nt.length<dt&&(nt=[...nt,...yt(dt-nt.length)]):nt=[];const ue=nt.join("."),re=St(Mt),ee=at.exec(Mt);return ee&&ee[1]?new At(tt,ue,re,ee[1]):new Y(tt,nt.join("."),re)}function St(Mt){for(let st=0,tt=_t.length;st<tt;st++){const[Ut,nt]=_t[st];if(nt.exec(Mt))return Ut}return null}function yt(Mt){const st=[];for(let tt=0;tt<Mt;tt++)st.push("0");return st}function gt(){const Mt=rt(),st=Mt.name&&Mt.name.toLowerCase();let tt=Mt.version||"00";const Ut=parseFloat(tt.slice(0,2));return!!(st&&(st.indexOf("chrome")>=0||st.indexOf("chromium")>=0)&&Ut>60)}function lt(Mt){var st,tt=document.createElement("img");Object.defineProperty(tt,"id",{get:function(){st="on"}}),requestAnimationFrame(function Ut(){st="off",requestAnimationFrame(Ut),st==="on"&&(location.href=Mt||"http://www.mlogcn.com")})}const F=mt;let pt,ht;function mt(Mt=!0){const st=function(){var tt=new Object,Ut=location.search.substring(1);if(!Ut||Ut.trim().length===0){const Lt=location.hash.indexOf("?");Ut=location.hash.substring(Lt+1)}for(var nt=Ut.split("&"),ue=0;ue<nt.length;ue++){var re=nt[ue].indexOf("=");if(re!=-1){var ee=nt[ue].substring(0,re),Qt=nt[ue].substring(re+1);tt[ee]=unescape(Qt)}}return tt}();return!(!window.force_mobile&&st.mobile!="true")||(Mt?((0,de.ri)(pt)||(pt=function(){var tt;let Ut=!1;var nt;return nt=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(nt)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(nt.substr(0,4)))&&(Ut=!0),Ut||((tt=navigator.userAgent)===null||tt===void 0?void 0:tt.toLowerCase().indexOf("mobile"))>=0}()),pt):Dt)}function bt(){try{const Mt=document.createElement("canvas");if((0,de.ri)(Mt.getContext("webgl2")))return 2;const st=Mt.getContext("webgl");return(0,de.ri)(st)||Zt.kg.error("当前系统不支持WebGL！"),st.getExtension("OES_texture_float")||Zt.kg.warn("当前系统不支持WebGL1的float扩展，将无法渲染非byte类型数据！"),1}catch{Zt.kg.error("当前系统不支持WebGL，无法使用本渲染引擎！")}}function ut(){return Et(this,void 0,void 0,function*(){return(0,de.ri)(ht)?ht:new Promise((Mt,st)=>{const tt=new Image;tt.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",tt.onload=tt.onerror=()=>{ht=tt.height===2,Mt(ht)}})})}},251:(Je,Ce,ne)=>{ne.d(Ce,{EO:()=>ft,OE:()=>_t,Qs:()=>at,c0:()=>rt,ke:()=>dt,nA:()=>Pt,y$:()=>Nt});var Zt=ne(858),de=ne(787),Et=ne(608),Dt=ne(307),Y=ne(923),I=ne(316),At=ne(1);function Nt(St){if((St=parseFloat(St))!==void 0&&St<9999){++St;let yt=Math.floor(St/20),gt=Math.floor((St-20*yt)/4),lt=10*yt+2*gt+Math.floor((St-20*yt-4*gt)/2);if(lt===0)return;let F=lt+32;return F>61&&(F=61),String.fromCharCode(F)}}function ft(St){return(St=parseFloat(St))===void 0||St<9999&&(St>=100&&(St-=100),St<4?St=void 0:St+=St<66?61:St<78?95:96),St}function at(St){return(St=parseFloat(St))===void 0?St:St<9999?St*Math.PI/180:void 0}const dt={wind:"wind",weather:"weather",degree2arc:"degree2arc",res:"res",anaVals:"anaVals",decimal:"decimal",subImage:"subImage",transform:"transform",cs:"cs",all:"all"},et={wind:Nt,weather:ft,degree2arc:at,res:(St,yt)=>{const gt=I.Zc.getResource(St).instance;if(gt&&gt.stops&&yt){const lt=Object.assign({},gt);return yt.field&&(lt.fieldName=yt.field),yt.action&&(lt.action=yt.action),lt}return gt},anaVals:(St,yt)=>{var gt;const lt=I.Zc.getResource(St).instance;if(lt){const F=new Et.NB(lt).getVals();if(yt){const pt=(gt=yt.start)!==null&&gt!==void 0?gt:0,ht=yt.end;return F.slice(pt,ht)}return F}return Y.kg.warn("资源"+St+"没有找到！"),[]},decimal:(St,yt)=>{const gt=yt&&yt.len||1;return parseFloat(St).toFixed(parseInt(gt))},subImage:(St,yt)=>{const gt=St+"_sub_"+yt.x+"_"+yt.y+"_"+yt.w+"_"+yt.h;if(I.Zc.hasResource(gt))return I.Zc.getResource(gt).instance;const lt=I.Zc.getResource(St).instance;if(lt&&(lt instanceof HTMLImageElement||lt instanceof HTMLCanvasElement||lt instanceof HTMLVideoElement)){const F=document.createElement("canvas");return F.width=yt.w,F.height=yt.h,F.getContext("2d").drawImage(lt,yt.x,yt.y,yt.w,yt.h,0,0,yt.w,yt.h),I.Zc.addResource(gt,{resourceType:I.MM.images,instance:F},!1),F}return Y.kg.warn("当前资源不存在或者不是图片类型！"+St),lt},transform:(St,yt)=>{var gt,lt;const F=(gt=yt.scale)!==null&&gt!==void 0?gt:1,pt=(lt=yt.offset)!==null&&lt!==void 0?lt:0;return yt.scaleFirst==0?(St+pt)*F:St*F+pt},cs:(St,yt)=>(typeof St=="string"&&(St=de.xS[St]?(0,de.dO)(de.xS[St],yt.min,yt.max,yt.gradient!=="false"):(0,Dt.it)(St)),(0,At.ri)(St.min)&&(0,At.ri)(St.max)&&(0,At.ri)(St.colorScale)?St:(0,At.ri)(St==null?void 0:St.width)&&(0,At.ri)(St==null?void 0:St.height)?new Zt.Xm({colorScale:St,min:(0,At.ri)(yt.min)?parseFloat(yt.min):void 0,max:(0,At.ri)(yt.max)?parseFloat(yt.max):void 0}):((0,At.ri)(St.colorScale)||Y.kg.warn("不能识别的colorScale配置！"),St)),all:(St,yt)=>{const gt=yt.__order,lt={initial:St};return gt.reduce((F,pt)=>{if((pt=pt.trim())==="all")return Y.kg.warn("all loader不支持嵌套！"),F;const ht=Pt(pt);if(!(0,At.ri)(ht))return Y.kg.warn("loader "+pt+"不存在！"),F;const mt=yt[pt];if(!(0,At.ri)(mt)||!mt.trim().length)return ht(F,lt);const bt=(0,Dt.vl)(mt,",",":"),ut=ht(F,Object.assign(Object.assign({},lt),bt));return lt[pt]=ut,ut},St)}};function _t(St,yt){et[St]=yt}function rt(St,yt){for(const gt of St)_t(gt,yt)}function Pt(St){return et[St]}},1:(Je,Ce,ne)=>{ne.d(Ce,{BR:()=>Rt,f0:()=>Kt,VS:()=>Ox,pj:()=>je,U2:()=>X0,ZS:()=>W0,Ef:()=>lx,cM:()=>yx,f8:()=>F,En:()=>gt,ri:()=>Fe,GN:()=>Ne,l7:()=>re,vY:()=>Me,p6:()=>l0,K0:()=>tt,j$:()=>st,BG:()=>I0,tr:()=>pe,xA:()=>bt,lC:()=>Mt,vi:()=>se,Fp:()=>be,oT:()=>Ut,C8:()=>ht,Q:()=>ut,Hn:()=>mt,$k:()=>Lt,kJ:()=>xe,eP:()=>me,J_:()=>Te,xb:()=>Tt,mf:()=>Jt,Ft:()=>Vt,hj:()=>Ge,Kn:()=>Yt,HD:()=>De,JY:()=>Se,EX:()=>cx,d$:()=>J0,ve:()=>y0,Wd:()=>ke,Tc:()=>$x,ft:()=>$e,TN:()=>nt,wO:()=>kx,r_:()=>ri,Zu:()=>H0,XG:()=>U0,Ov:()=>lt,uw:()=>pt,nf:()=>Qt,Rc:()=>ee,LG:()=>yt,hQ:()=>St,Rf:()=>ue,_6:()=>Oe});var Zt=ne(378),de=ne.n(Zt),Et=ne(824),Dt=ne(576),Y=ne(478),I=ne(96),At=ne(458),Nt=ne(923),ft=ne(204),at=ne(75);const dt=function(he,Ae,Ve){Ve===void 0&&(Ve={});for(var x0=Ve.steps||64,n0=Ve.properties?Ve.properties:!Array.isArray(he)&&he.type==="Feature"&&he.properties?he.properties:{},t0=[],f0=0;f0<x0;f0++)t0.push((0,ft.Z)(he,Ae,-360*f0/x0,Ve).geometry.coordinates);return t0.push(t0[0]),(0,at.yu)([t0],n0)};function et(he,Ae,Ve,x0,n0){n0===void 0&&(n0={});var t0=n0.steps||64,f0=_t(Ve),c0=_t(x0),r0=Array.isArray(he)||he.type!=="Feature"?{}:he.properties;if(f0===c0)return(0,at.Tu)(dt(he,Ae,n0).geometry.coordinates[0],r0);for(var _0=f0,z0=f0<c0?c0:c0+360,Q0=_0,_x=[],ix=0;Q0<z0;)_x.push((0,ft.Z)(he,Ae,Q0,n0).geometry.coordinates),Q0=_0+360*++ix/t0;return Q0>z0&&_x.push((0,ft.Z)(he,Ae,z0,n0).geometry.coordinates),(0,at.Tu)(_x,r0)}function _t(he){var Ae=he%360;return Ae<0&&(Ae+=360),Ae}var rt=function(he,Ae,Ve,x0){return new(Ve||(Ve=Promise))(function(n0,t0){function f0(_0){try{r0(x0.next(_0))}catch(z0){t0(z0)}}function c0(_0){try{r0(x0.throw(_0))}catch(z0){t0(z0)}}function r0(_0){var z0;_0.done?n0(_0.value):(z0=_0.value,z0 instanceof Ve?z0:new Ve(function(Q0){Q0(z0)})).then(f0,c0)}r0((x0=x0.apply(he,Ae||[])).next())})};let Pt=0;function St(){return"qe_uid_"+Pt++}function yt(he){let Ae=[];for(let Ve of he)for(let x0 of Ve)Ae.push(x0);return Ae}function gt(he,Ae){return he??Ae}function lt(he,Ae,Ve){if(he=he||{},Ve)for(let x0 in Ve)he[x0]=Ve[x0];if(Ae)for(let x0 in Ae)he[x0]=Ae[x0];return he}function F(he,Ae){const Ve=(f0,c0,r0)=>{const _0=f0[r0];_0 instanceof Array?(Fe(c0[r0])||(c0[r0]=[]),n0(_0,c0[r0])):typeof _0=="object"?(Fe(c0[r0])||(c0[r0]={}),x0(_0,c0[r0])):c0[r0]=_0},x0=(f0,c0)=>{const r0=Object.keys(f0);for(const _0 of r0)Ve(f0,c0,_0)},n0=(f0,c0)=>{for(let r0=0;r0<f0.length;r0++)Ve(f0,c0,r0)};let t0=Ae;return he instanceof Array?(!t0||t0 instanceof Array?Fe(t0)||(t0=[]):(Nt.kg.warn("提供的拷贝目标和拷贝源（数组）不是一个类型，将生成新的拷贝目标返回！"),t0=[]),n0(he,t0)):typeof he=="object"?(t0&&typeof t0!="object"?(Nt.kg.warn("提供的拷贝目标和拷贝源（Object）不是一个类型，将生成新的拷贝目标返回！"),t0={}):Fe(t0)||(t0={}),x0(he,t0)):(t0=he,Nt.kg.debug("拷贝源非数组和对象，将直接返回拷贝源！")),t0}function pt(he,Ae,Ve){return he=he||{},Ve&&(he=F(Ve)),Ae&&(he=F(Ae,he)),he}function ht(he){let Ae=Math.sqrt(he[0]*he[0]+he[1]*he[1]),Ve=270-180*Math.atan2(he[1],he[0])/Math.PI;return Ve%=360,[Ae,Ve]}function mt(he){let Ae=(270-he[1])*Math.PI/180;return[he[0]*Math.cos(Ae),he[0]*Math.sin(Ae)]}function bt(he){return rt(this,void 0,void 0,function*(){return nt(he).then(Ae=>Ae.json()).catch(Nt.kg.debug)})}function ut(he,Ae=!1){return rt(this,void 0,void 0,function*(){let Ve;return he.endsWith("zip")||Ae?Ve=(yield st(he,void 0,"text",!0))[0]:Ve=yield(yield nt(he)).text(),Ve})}function Mt(he){return rt(this,void 0,void 0,function*(){return st(he,void 0,"text",!0).then(Ae=>JSON.parse(Ae[0])).catch(Nt.kg.debug)})}function st(he,Ae,Ve="arraybuffer",x0=!1,n0){return rt(this,void 0,void 0,function*(){let t0;return t0=typeof Ve=="function"?Ve:f0=>Ve,Ut(he).then(f0=>{if(!he.endsWith("zip")&&!x0)return[f0];const c0=[];let r0=performance.now();return new(de())().loadAsync(f0).then(_0=>rt(this,void 0,void 0,function*(){const z0=Object.keys(_0.files).length;for(let Q0 in _0.files){let _x=Q0;if(_x.indexOf("MACOSX")>=0)continue;let ix=_0.files[_x];Ae&&!Ae(ix)||(yield ix.async(t0(ix)).then(h0=>{Nt.kg.debug("unzip "+_x+" costs "+(performance.now()-r0)+"ms"),r0=performance.now(),n0&&n0(h0,ix,z0),c0.push(h0)}).catch(Nt.kg.debug))}return c0})).catch(Nt.kg.debug)}).catch(Nt.kg.debug)})}function tt(he,Ae,Ve,x0="arraybuffer",n0=!1){return rt(this,void 0,void 0,function*(){const t0=[];for(const f0 of he){const c0=yield st(f0,Ve,x0,n0).catch(Nt.kg.debug);Ae&&Ae(c0),t0.push(...c0)}return t0})}function Ut(he){return rt(this,void 0,void 0,function*(){return nt(he).then(Ae=>Ae.arrayBuffer()).catch(Nt.kg.debug)})}let nt=fetch.bind(window);function ue(he,Ae,Ve){return he==null?Ae:Ve?Ve(he):he}function re(he,...Ae){var Ve,x0,n0,t0;for(x0=1,n0=arguments.length;x0<n0;x0++)for(Ve in t0=arguments[x0])he[Ve]=t0[Ve];return he}function ee(he){return he._qe_id=he._leaflet_id||St(),he._qe_id}function Qt(he){return he.trim().split(/\s+/)}function Lt(he,Ae,Ve){var x0=((2*Ve-1)/1+1)/2,n0=1-x0,t0=gt(he.a,1),f0=gt(Ae.a,1);return t0===0&&(t0=.001),f0===0&&(f0=.001),{r:Math.round(he.r*x0+Ae.r*n0),g:Math.round(he.g*x0+Ae.g*n0),b:Math.round(he.b*x0+Ae.b*n0),a:t0*x0+f0*n0}}function pe(he,Ae,Ve){return Math.floor((Ve-he)/Ae)}function be(he,Ae){return{x:he%Ae,y:Math.floor(he/Ae)}}function se(he,Ae,Ve){return Ae*Ve+he}function Fe(he){return he!=null&&(typeof he!="number"||!isNaN(he))}Array.isArray||(Array.isArray=function(he){return Object.prototype.toString.call(he)==="[object Array]"}),typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(he,Ae){if(he==null)throw new TypeError("Cannot convert undefined or null to object");let Ve=Object(he);for(let x0=1;x0<arguments.length;x0++){const n0=arguments[x0];if(n0!=null)for(let t0 in n0)Object.prototype.hasOwnProperty.call(n0,t0)&&(Ve[t0]=n0[t0])}return Ve},writable:!0,configurable:!0});const Pe=Object.prototype.hasOwnProperty,It=typeof Symbol<"u"?Symbol.toStringTag:void 0;function Rt(he){return Object.prototype.toString.call(he).slice(8,-1).toLowerCase()}function Jt(he){if(!Yt(he))return!1;const Ae=function(Ve){if(Ve===null)return Ve===void 0?"[object Undefined]":"[object Null]";if(!It||!(It in Object(Ve)))return toString.call(Ve);const x0=Pe.call(Ve,It),n0=Ve[It];let t0=!1;try{Ve[It]=void 0,t0=!0}catch{}const f0=Object.prototype.toString.call(Ve);return t0&&(x0?Ve[It]=n0:delete Ve[It]),f0}(he);return Ae==="[object Function]"||Ae==="[object AsyncFunction]"||Ae==="[object GeneratorFunction]"||Ae==="[object Proxy]"}function Yt(he){const Ae=typeof he;return he!==null&&(Ae==="object"||Ae==="function")}function Te(he){return Object.prototype.toString.call(he)==="[object Date]"}function me(he){return Object.prototype.toString.call(he)==="[object ArrayBuffer]"}function De(he){return he!=null&&(typeof he=="string"||he.constructor!==null&&he.constructor===String)}function Ge(he){return Object.prototype.toString.call(he)==="[object Number]"&&!isNaN(he)}function Tt(he){let Ae;for(Ae in he)return!1;return!Ae}function Vt(he){return he==null}function xe(he){return Array.isArray(he)}function Kt(he,...Ae){return Object.assign(he,...Ae)}function Me(he,Ae){return he-Ae*Math.floor(he/Ae)}function Se(he){return he!=null&&(typeof he!="number"||!isNaN(he))}function ke(he,Ae,Ve){let x0;const n0=t0=>{Ae&&Ae(),x0?clearTimeout(x0):Ve&&Ve(),x0=setTimeout(()=>{he(),x0=void 0},300)};return window.addEventListener("resize",n0),{remove:()=>window.removeEventListener("resize",n0)}}function Ne(he,Ae){var Ve=document.createElement("a");Ve.setAttribute("href",he),Ve.setAttribute("download",Ae),Ve.click()}function Oe(he){return he<0?he+360:he}function $e(he,Ae,Ve,x0){if(Ae.alpha()===0)return he;var n0=((2*Ve-1)/1+1)/2,t0=1-n0;return new Y.t({r:Math.round(he.red()*n0+Ae.red()*t0),g:Math.round(he.green()*n0+Ae.green()*t0),b:Math.round(he.blue()*n0+Ae.blue()*t0),a:x0})}const l0=(he,Ae)=>Ae.replace(/\\?{.*?}/g,Ve=>{if(Ve.startsWith("\\"))return Ve.slice(1);switch(Ve){case"{yyyy}":return""+he.getFullYear();case"{yy}":return(""+he.getFullYear()).slice(-2);case"{MM}":return(""+(he.getMonth()+1)).padStart(2,"0");case"{dd}":return(""+he.getDate()).padStart(2,"0");case"{HH}":return(""+he.getHours()).padStart(2,"0");case"{mm}":return(""+he.getMinutes()).padStart(2,"0");case"{ss}":return(""+he.getSeconds()).padStart(2,"0");case"{SSS}":return(""+he.getMilliseconds()).padStart(3,"0");default:return""}});function je(he){const Ae=performance.now();let Ve=1/0,x0=-1/0;return he.forEachYx(n0=>{he.isUndef(n0)||(n0<Ve&&(Ve=n0),n0>x0&&(x0=n0))}),Nt.kg.debug("calc max min costs "+(performance.now()-Ae)+"ms"),{min:Ve,max:x0}}function I0(he,Ae,Ve=!0,x0=!0,n0){let t0=he.getGrid(),f0=-999999,c0=0;const r0=(_x,ix)=>{let h0=new Et.P(t0.dataType,t0.xSize,t0.ySize);h0.undef=t0.undef;let Wi=he.allGrids()[n0||0];for(let bi=_x;bi<ix;bi++){let qx=Wi[bi];for(let Ex=0;Ex<qx.raw.length;Ex++){const Mx=qx.read1D(Ex);Mx!==h0.undef&&h0.raw[Ex]<Mx&&(h0.raw[Ex]=Mx),f0<Mx&&(f0=Mx,c0=Ex)}}return f0===-999999&&(f0=h0.undef),new At.o([[h0]],{gridOptions:he.gridOptions})},_0=he.allGrids()[0].length;let z0,Q0;return Ve&&(z0=r0(Ae,_0)),x0&&(Q0=r0(0,Ae+1)),{upper:z0,lower:Q0,maxPos:c0,maxVal:f0}}function X0(he,Ae,Ve,x0,n0){const t0=Ve-Ae+1,f0=n0-x0+1,c0=new Et.P(he.dataType,t0,f0,void 0,he.undef,he.algo,he.dataScale,he.dataOffset),r0=[];for(let _0=x0;_0<=n0;_0++){const z0=_0*he.xSize;for(let Q0=Ae;Q0<=Ve;Q0++){const _x=z0+Q0,ix=he.raw[_x];r0.push(ix)}}return c0.update(r0),c0}function W0(he,Ae){const Ve=(0,Dt.Z)(he.gridOptions);if(Ae.maxLat>Ve.maxLat||Ae.minLat<Ve.minLat||Ae.maxLon>Ve.maxLon||Ae.minLon<Ve.minLon)return Nt.kg.warn("提供的裁切范围不在格点范围之内！"),he;const x0=he.gridOptions.xDelta>0?Ae.minLon:Ae.maxLon,n0=he.gridOptions.yDelta>0?Ae.minLat:Ae.maxLat,t0=he.gridOptions.xDelta>0?Ae.maxLon:Ae.minLon,f0=he.gridOptions.yDelta>0?Ae.maxLat:Ae.minLat,c0=pe(he.gridOptions.xStart,he.gridOptions.xDelta,x0),r0=pe(he.gridOptions.yStart,he.gridOptions.yDelta,n0),_0=pe(he.gridOptions.xStart,he.gridOptions.xDelta,t0),z0=pe(he.gridOptions.yStart,he.gridOptions.yDelta,f0),Q0=_0-c0+1,_x=z0-r0+1,ix={xStart:he.gridOptions.xStart+c0*he.gridOptions.xDelta,yStart:he.gridOptions.yStart+r0*he.gridOptions.yDelta,xSize:Q0,ySize:_x,xDelta:he.gridOptions.xDelta,yDelta:he.gridOptions.yDelta};(0,Dt.T)(ix);const h0=he.allGrids(),Wi=h0.length;if(Wi===0)return console.warn("格点中没有数据！"),he;const bi=h0[0].length,qx=[];for(let Ex=0;Ex<Wi;Ex++){const Mx=[];for(let di=0;di<bi;di++){const Xx=X0(he.getGrid(Ex,di),c0,_0,r0,z0);Mx.push(Xx)}qx.push(Mx)}return new At.o(qx,{gridOptions:ix})}function U0(he,Ae="grid.mesh"){const Ve=performance.now(),x0=new Float32Array(he.xSize*he.ySize);for(let r0=0;r0<x0.length;r0++)x0[r0]=r0;let n0=0;const t0=(he.xSize-1)*(he.ySize-1)*6,f0=new Uint32Array(t0);for(let r0=0;r0<he.xSize*he.ySize-he.xSize;r0++){if((r0+1)%he.xSize==0)continue;const _0=r0,z0=r0+he.xSize,Q0=z0+1,_x=_0+1;f0[n0++]=_0,f0[n0++]=z0,f0[n0++]=Q0,f0[n0++]=_0,f0[n0++]=Q0,f0[n0++]=_x}const c0=new Blob([x0,f0]);Ne(window.URL.createObjectURL(c0),Ae),Nt.kg.debug("cache mesh costs "+(performance.now()-Ve)+"ms")}function J0(he,Ae){return rt(this,void 0,void 0,function*(){const Ve=yield(yield nt(Ae)).arrayBuffer(),x0=he.xSize*he.ySize*4;return{ids:new Float32Array(Ve,0,x0),indices:new Uint32Array(Ve,x0)}})}function yx(he,Ae){switch(he){case I.U.UInt8:return new Uint8Array(Ae);case I.U.Int8:return new Int8Array(Ae);case I.U.UInt16:return new Uint16Array(Ae);case I.U.Int16:return new Int16Array(Ae);case I.U.UInt32:return new Uint32Array(Ae);case I.U.Int32:return new Int32Array(Ae);case I.U.Float32:return new Float32Array(Ae);case I.U.Float64:return new Float64Array(Ae);default:throw new Error("not supported grid data type "+he)}}function cx(he){return rt(this,void 0,void 0,function*(){return new Promise((Ae,Ve)=>{const x0=he.length;let n0=0;const t0={},f0=()=>{n0++,n0===x0&&Ae(t0)};for(const c0 of he){const r0=new Image;r0.onerror=()=>{t0[c0]=void 0,f0()},r0.onload=()=>{t0[c0]=r0,f0()},r0.src=c0}})})}function H0(he,Ae){return he+Math.random()*(Ae-he)}function kx(he,Ae=!0){const Ve=H0(he.minLon,he.maxLon),x0=H0(he.minLat,he.maxLat);return Ae?Fe(he.minHeight)&&Fe(he.maxHeight)?[Ve,x0,H0(he.minHeight,he.maxHeight)]:[Ve,x0,0]:[Ve,x0]}function ri(he,Ae=!0){const Ve=Math.min(he.xStart,he.xEnd),x0=Math.max(he.xStart,he.xEnd),n0=Math.min(he.yStart,he.yEnd),t0=Math.max(he.yStart,he.yEnd),f0=H0(Ve,x0),c0=H0(n0,t0);return Ae?he.zValues.length>1?[f0,c0,H0(he.zValues[0],he.zValues[he.zValues.length-1])]:[f0,c0,0]:[f0,c0]}function Ox(he,Ae,Ve,x0){const n0=x0/2,t0=Ve/2;return{minLat:he-n0,maxLat:he+n0,minLon:Ae-t0,maxLon:Ae+t0}}function $x(he,Ae=1013.225){return 44331*(1-Math.pow(he/1013.225,.1903))}function lx(he,Ae,Ve=[0,45,90,135],x0=void 0,n0=90){x0||(x0=Ae.map(r0=>({distance:r0,angle:90,value:r0.toString()}))),Ae=Ae.sort((r0,_0)=>r0-_0),n0=Math.max(n0,10);const t0=[];Ae.forEach(r0=>{const _0=dt(he,r0,{units:"kilometers",steps:n0});_0.properties.value=r0,t0.push(_0)});const f0=[];Ve.forEach(r0=>{const _0=et(he,Ae[Ae.length-1],r0,r0+10,{steps:n0,units:"kilometers"}),z0=et(he,Ae[Ae.length-1],r0+180,r0+180+10,{steps:n0,units:"kilometers"});f0.push({type:"Feature",geometry:{type:"LineString",coordinates:[_0.geometry.coordinates[0],z0.geometry.coordinates[0]]},properties:{value:r0}})});const c0=[];return x0.forEach(r0=>{var _0;const z0=et(he,r0.distance,r0.angle,r0.angle+10,{steps:n0,units:"kilometers"});c0.push({type:"Feature",geometry:{type:"Point",coordinates:z0.geometry.coordinates[0]},properties:{value:(_0=r0.value)!==null&&_0!==void 0?_0:r0.distance,distance:r0.distance,angle:r0.angle}})}),{type:"FeatureCollection",features:[...t0,...f0,...c0]}}const y0=(he,Ae,Ve)=>rt(void 0,void 0,void 0,function*(){return new Promise((x0,n0)=>{try{if(document.getElementById(Ae)){if(window[Ve])return x0(null);let t0=0;const f0=setInterval(()=>{if(window[Ve]||!(t0<5))return t0++,clearInterval(f0),x0(null)},500)}else{const t0=document.createElement("script");t0.setAttribute("type","text/javascript"),t0.setAttribute("id",Ae),t0.onload=x0,t0.onerror=n0,t0.src=he,t0.async=!0,document.body.appendChild(t0)}}catch(t0){n0(t0)}})})},204:(Je,Ce,ne)=>{ne.d(Ce,{Z:()=>Et});var Zt=ne(75),de=ne(811);function Et(Dt,Y,I,At){At===void 0&&(At={});var Nt=(0,de.c9)(Dt),ft=(0,Zt.Ht)(Nt[0]),at=(0,Zt.Ht)(Nt[1]),dt=(0,Zt.Ht)(I),et=(0,Zt.lF)(Y,At.units),_t=Math.asin(Math.sin(at)*Math.cos(et)+Math.cos(at)*Math.sin(et)*Math.cos(dt)),rt=ft+Math.atan2(Math.sin(dt)*Math.sin(et)*Math.cos(at),Math.cos(et)-Math.sin(at)*Math.sin(_t)),Pt=(0,Zt.vi)(rt),St=(0,Zt.vi)(_t);return(0,Zt.xm)([Pt,St],At.properties)}},75:(Je,Ce,ne)=>{ne.d(Ce,{DL:()=>At,Ht:()=>at,Tu:()=>I,lF:()=>Nt,vi:()=>ft,xm:()=>Dt,yu:()=>Y,zL:()=>Et});var Zt=63710088e-1,de={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260511392e-6,inches:39.37*Zt,kilometers:6371.0088,kilometres:6371.0088,meters:Zt,metres:Zt,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:Zt/1852,radians:1,yards:6967335223679999e-9};function Et(et,_t,rt){rt===void 0&&(rt={});var Pt={type:"Feature"};return(rt.id===0||rt.id)&&(Pt.id=rt.id),rt.bbox&&(Pt.bbox=rt.bbox),Pt.properties=_t||{},Pt.geometry=et,Pt}function Dt(et,_t,rt){if(rt===void 0&&(rt={}),!et)throw new Error("coordinates is required");if(!Array.isArray(et))throw new Error("coordinates must be an Array");if(et.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!dt(et[0])||!dt(et[1]))throw new Error("coordinates must contain numbers");return Et({type:"Point",coordinates:et},_t,rt)}function Y(et,_t,rt){rt===void 0&&(rt={});for(var Pt=0,St=et;Pt<St.length;Pt++){var yt=St[Pt];if(yt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var gt=0;gt<yt[yt.length-1].length;gt++)if(yt[yt.length-1][gt]!==yt[0][gt])throw new Error("First and last Position are not equivalent.")}return Et({type:"Polygon",coordinates:et},_t,rt)}function I(et,_t,rt){if(rt===void 0&&(rt={}),et.length<2)throw new Error("coordinates must be an array of two or more positions");return Et({type:"LineString",coordinates:et},_t,rt)}function At(et,_t){_t===void 0&&(_t="kilometers");var rt=de[_t];if(!rt)throw new Error(_t+" units is invalid");return et*rt}function Nt(et,_t){_t===void 0&&(_t="kilometers");var rt=de[_t];if(!rt)throw new Error(_t+" units is invalid");return et/rt}function ft(et){return et%(2*Math.PI)*180/Math.PI}function at(et){return et%360*Math.PI/180}function dt(et){return!isNaN(et)&&et!==null&&!Array.isArray(et)}},811:(Je,Ce,ne)=>{function Zt(Et){if(!Et)throw new Error("coord is required");if(!Array.isArray(Et)){if(Et.type==="Feature"&&Et.geometry!==null&&Et.geometry.type==="Point")return Et.geometry.coordinates;if(Et.type==="Point")return Et.coordinates}if(Array.isArray(Et)&&Et.length>=2&&!Array.isArray(Et[0])&&!Array.isArray(Et[1]))return Et;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function de(Et){return Et.type==="Feature"?Et.geometry:Et}ne.d(Ce,{c9:()=>Zt,wA:()=>de}),ne(75)}},X={};function t(Je){var Ce=X[Je];if(Ce!==void 0)return Ce.exports;var ne=X[Je]={exports:{}};return Q[Je](ne,ne.exports,t),ne.exports}t.n=Je=>{var Ce=Je&&Je.__esModule?()=>Je.default:()=>Je;return t.d(Ce,{a:Ce}),Ce},t.d=(Je,Ce)=>{for(var ne in Ce)t.o(Ce,ne)&&!t.o(Je,ne)&&Object.defineProperty(Je,ne,{enumerable:!0,get:Ce[ne]})},t.o=(Je,Ce)=>Object.prototype.hasOwnProperty.call(Je,Ce),t.r=Je=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(Je,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Je,"__esModule",{value:!0})};var p={};return(()=>{function Je(z,r,s){s=s||2;var o,f,b,u,w,C,M,K=r&&r.length,j=K?r[0]*s:z.length,$=Ce(z,0,j,s,!0),ot=[];if(!$||$.next===$.prev)return ot;if(K&&($=function(wt,Ct,qt,kt){var $t,ie,oe,ae=[];for($t=0,ie=Ct.length;$t<ie;$t++)(oe=Ce(wt,Ct[$t]*kt,$t<ie-1?Ct[$t+1]*kt:wt.length,kt,!1))===oe.next&&(oe.steiner=!0),ae.push(at(oe));for(ae.sort(I),$t=0;$t<ae.length;$t++)At(ae[$t],qt),qt=ne(qt,qt.next);return qt}(z,r,$,s)),z.length>80*s){o=b=z[0],f=u=z[1];for(var ct=s;ct<j;ct+=s)(w=z[ct])<o&&(o=w),(C=z[ct+1])<f&&(f=C),w>b&&(b=w),C>u&&(u=C);M=(M=Math.max(b-o,u-f))!==0?1/M:0}return Zt($,ot,s,o,f,M),ot}function Ce(z,r,s,o,f){var b,u;if(f===function(w,C,M,K){for(var j=0,$=C,ot=M-K;$<M;$+=K)j+=(w[ot]-w[$])*(w[$+1]+w[ot+1]),ot=$;return j}(z,r,s,o)>0)for(b=r;b<s;b+=o)u=F(b,z[b],z[b+1],u);else for(b=s-o;b>=r;b-=o)u=F(b,z[b],z[b+1],u);return u&&rt(u,u.next)&&(pt(u),u=u.next),u}function ne(z,r){if(!z)return z;r||(r=z);var s,o=z;do if(s=!1,o.steiner||!rt(o,o.next)&&_t(o.prev,o,o.next)!==0)o=o.next;else{if(pt(o),(o=r=o.prev)===o.next)break;s=!0}while(s||o!==r);return r}function Zt(z,r,s,o,f,b,u){if(z){!u&&b&&function(K,j,$,ot){var ct=K;do ct.z===null&&(ct.z=ft(ct.x,ct.y,j,$,ot)),ct.prevZ=ct.prev,ct.nextZ=ct.next,ct=ct.next;while(ct!==K);ct.prevZ.nextZ=null,ct.prevZ=null,function(wt){var Ct,qt,kt,$t,ie,oe,ae,fe,le=1;do{for(qt=wt,wt=null,ie=null,oe=0;qt;){for(oe++,kt=qt,ae=0,Ct=0;Ct<le&&(ae++,kt=kt.nextZ);Ct++);for(fe=le;ae>0||fe>0&&kt;)ae!==0&&(fe===0||!kt||qt.z<=kt.z)?($t=qt,qt=qt.nextZ,ae--):($t=kt,kt=kt.nextZ,fe--),ie?ie.nextZ=$t:wt=$t,$t.prevZ=ie,ie=$t;qt=kt}ie.nextZ=null,le*=2}while(oe>1)}(ct)}(z,o,f,b);for(var w,C,M=z;z.prev!==z.next;)if(w=z.prev,C=z.next,b?Et(z,o,f,b):de(z))r.push(w.i/s),r.push(z.i/s),r.push(C.i/s),pt(z),z=C.next,M=C.next;else if((z=C)===M){u?u===1?Zt(z=Dt(ne(z),r,s),r,s,o,f,b,2):u===2&&Y(z,r,s,o,f,b):Zt(ne(z),r,s,o,f,b,1);break}}}function de(z){var r=z.prev,s=z,o=z.next;if(_t(r,s,o)>=0)return!1;for(var f=z.next.next;f!==z.prev;){if(dt(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&_t(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Et(z,r,s,o){var f=z.prev,b=z,u=z.next;if(_t(f,b,u)>=0)return!1;for(var w=f.x<b.x?f.x<u.x?f.x:u.x:b.x<u.x?b.x:u.x,C=f.y<b.y?f.y<u.y?f.y:u.y:b.y<u.y?b.y:u.y,M=f.x>b.x?f.x>u.x?f.x:u.x:b.x>u.x?b.x:u.x,K=f.y>b.y?f.y>u.y?f.y:u.y:b.y>u.y?b.y:u.y,j=ft(w,C,r,s,o),$=ft(M,K,r,s,o),ot=z.prevZ,ct=z.nextZ;ot&&ot.z>=j&&ct&&ct.z<=$;){if(ot!==z.prev&&ot!==z.next&&dt(f.x,f.y,b.x,b.y,u.x,u.y,ot.x,ot.y)&&_t(ot.prev,ot,ot.next)>=0||(ot=ot.prevZ,ct!==z.prev&&ct!==z.next&&dt(f.x,f.y,b.x,b.y,u.x,u.y,ct.x,ct.y)&&_t(ct.prev,ct,ct.next)>=0))return!1;ct=ct.nextZ}for(;ot&&ot.z>=j;){if(ot!==z.prev&&ot!==z.next&&dt(f.x,f.y,b.x,b.y,u.x,u.y,ot.x,ot.y)&&_t(ot.prev,ot,ot.next)>=0)return!1;ot=ot.prevZ}for(;ct&&ct.z<=$;){if(ct!==z.prev&&ct!==z.next&&dt(f.x,f.y,b.x,b.y,u.x,u.y,ct.x,ct.y)&&_t(ct.prev,ct,ct.next)>=0)return!1;ct=ct.nextZ}return!0}function Dt(z,r,s){var o=z;do{var f=o.prev,b=o.next.next;!rt(f,b)&&Pt(f,o,o.next,b)&&gt(f,b)&&gt(b,f)&&(r.push(f.i/s),r.push(o.i/s),r.push(b.i/s),pt(o),pt(o.next),o=z=b),o=o.next}while(o!==z);return ne(o)}function Y(z,r,s,o,f,b){var u=z;do{for(var w=u.next.next;w!==u.prev;){if(u.i!==w.i&&et(u,w)){var C=lt(u,w);return u=ne(u,u.next),C=ne(C,C.next),Zt(u,r,s,o,f,b),void Zt(C,r,s,o,f,b)}w=w.next}u=u.next}while(u!==z)}function I(z,r){return z.x-r.x}function At(z,r){if(r=function(o,f){var b,u=f,w=o.x,C=o.y,M=-1/0;do{if(C<=u.y&&C>=u.next.y&&u.next.y!==u.y){var K=u.x+(C-u.y)*(u.next.x-u.x)/(u.next.y-u.y);if(K<=w&&K>M){if(M=K,K===w){if(C===u.y)return u;if(C===u.next.y)return u.next}b=u.x<u.next.x?u:u.next}}u=u.next}while(u!==f);if(!b)return null;if(w===M)return b;var j,$=b,ot=b.x,ct=b.y,wt=1/0;u=b;do w>=u.x&&u.x>=ot&&w!==u.x&&dt(C<ct?w:M,C,ot,ct,C<ct?M:w,C,u.x,u.y)&&(j=Math.abs(C-u.y)/(w-u.x),gt(u,o)&&(j<wt||j===wt&&(u.x>b.x||u.x===b.x&&Nt(b,u)))&&(b=u,wt=j)),u=u.next;while(u!==$);return b}(z,r),r){var s=lt(r,z);ne(r,r.next),ne(s,s.next)}}function Nt(z,r){return _t(z.prev,z,r.prev)<0&&_t(r.next,z,z.next)<0}function ft(z,r,s,o,f){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z=32767*(z-s)*f)|z<<8))|z<<4))|z<<2))|z<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-o)*f)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function at(z){var r=z,s=z;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==z);return s}function dt(z,r,s,o,f,b,u,w){return(f-u)*(r-w)-(z-u)*(b-w)>=0&&(z-u)*(o-w)-(s-u)*(r-w)>=0&&(s-u)*(b-w)-(f-u)*(o-w)>=0}function et(z,r){return z.next.i!==r.i&&z.prev.i!==r.i&&!function(s,o){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==o.i&&f.next.i!==o.i&&Pt(f,f.next,s,o))return!0;f=f.next}while(f!==s);return!1}(z,r)&&(gt(z,r)&&gt(r,z)&&function(s,o){var f=s,b=!1,u=(s.x+o.x)/2,w=(s.y+o.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&u<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next;while(f!==s);return b}(z,r)&&(_t(z.prev,z,r.prev)||_t(z,r.prev,r))||rt(z,r)&&_t(z.prev,z,z.next)>0&&_t(r.prev,r,r.next)>0)}function _t(z,r,s){return(r.y-z.y)*(s.x-r.x)-(r.x-z.x)*(s.y-r.y)}function rt(z,r){return z.x===r.x&&z.y===r.y}function Pt(z,r,s,o){var f=yt(_t(z,r,s)),b=yt(_t(z,r,o)),u=yt(_t(s,o,z)),w=yt(_t(s,o,r));return f!==b&&u!==w||!(f!==0||!St(z,s,r))||!(b!==0||!St(z,o,r))||!(u!==0||!St(s,z,o))||!(w!==0||!St(s,r,o))}function St(z,r,s){return r.x<=Math.max(z.x,s.x)&&r.x>=Math.min(z.x,s.x)&&r.y<=Math.max(z.y,s.y)&&r.y>=Math.min(z.y,s.y)}function yt(z){return z>0?1:z<0?-1:0}function gt(z,r){return _t(z.prev,z,z.next)<0?_t(z,r,z.next)>=0&&_t(z,z.prev,r)>=0:_t(z,r,z.prev)<0||_t(z,z.next,r)<0}function lt(z,r){var s=new ht(z.i,z.x,z.y),o=new ht(r.i,r.x,r.y),f=z.next,b=r.prev;return z.next=r,r.prev=z,s.next=f,f.prev=s,o.next=s,s.prev=o,b.next=o,o.prev=b,o}function F(z,r,s,o){var f=new ht(z,r,s);return o?(f.next=o.next,f.prev=o,o.next.prev=f,o.next=f):(f.prev=f,f.next=f),f}function pt(z){z.next.prev=z.prev,z.prev.next=z.next,z.prevZ&&(z.prevZ.nextZ=z.nextZ),z.nextZ&&(z.nextZ.prevZ=z.prevZ)}function ht(z,r,s){this.i=z,this.x=r,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mt(z){for(var r=z[0][0].length,s={vertices:[],holes:[],dimensions:r},o=0,f=0;f<z.length;f++){for(var b=0;b<z[f].length;b++)for(var u=0;u<r;u++)s.vertices.push(z[f][b][u]);f>0&&(o+=z[f-1].length,s.holes.push(o))}return s}t.r(p),t.d(p,{Array2DGridDataProvider:()=>Wn,BinaryGridDataProvider:()=>Zn,BinaryReader:()=>Ie,BitmapColorScaleGL:()=>ax.Xm,CSStyle:()=>m0.NX,CSStyle3D:()=>xi,CimissGridDataProvider:()=>gs,CimissStationFeatureProvider:()=>un,CollisionDetectMode:()=>Vn,CollisonDetector:()=>Ys,DAPParserType:()=>L0.ko,DAPService:()=>Fi,DASParser:()=>L0.Bn,DDSParser:()=>L0.cF,DODSUnpacker:()=>ox,DataAnimationService:()=>ui,DataAnimationType:()=>Bi,Evented:()=>Br.c,FeatureBaseClass:()=>m0.rJ,FeatureBooleanField2FeatureBooleanFunc:()=>m0.pd,FeatureColorField2FeatureColorFunc:()=>m0.Jf,FeatureDataProviderBase:()=>Fr,FeatureImageField2FeatureImageFunc:()=>m0.cQ,FeatureImageStyle:()=>m0.Tw,FeatureLabelStyle:()=>m0.PE,FeatureLabelStyle3D:()=>$s,FeatureNumberArrayField2FeatureNumberArrayFunc:()=>m0.q$,FeatureNumberField2FeatureNumberFunc:()=>m0.JW,FeatureStringField2FeatureStringFunc:()=>m0.Fj,FeatureStyle:()=>m0.sC,FeatureStyle3D:()=>Xs,FeatureTextStyle:()=>m0.oL,FeatureVolumeStyle:()=>ei,FrameDrawService:()=>ii,GeoJSONFeatureProvider:()=>zi,Geometry3DLayerStyle:()=>ax.Yv,Geometry3DSectionMode:()=>ax.vS,GeometryStyle:()=>m0.CI,GrayImageGridData:()=>it.K,GrayImageGridDataProvider:()=>S0,GridBaseStyle:()=>ir.W6,GridBooleanField2GridBooleanFunc:()=>ir.se,GridColorField2GridColorFunc:()=>ir.vX,GridData:()=>it.P,GridDataGLFillMode:()=>ax.sW,GridDataProviderBase:()=>qe.r,GridDataType:()=>Ot.U,GridGLBaseStyle:()=>ax.$n,GridImageField2GridImageFunc:()=>ir.CN,GridImageFieldGL2TexImage:()=>ax.Rd,GridImageStyle:()=>ir.$f,GridLabelStyle:()=>ir.dl,GridNumberArrayField2GridNumberArrayFunc:()=>ir.UZ,GridNumberArrayFieldGL2GridNumberArray:()=>ax.ce,GridNumberField2GridNumberFunc:()=>ir.Dg,GridStringField2GridStringFunc:()=>ir.no,GridTextStyle:()=>ir.x1,IDWScatterInterpolator:()=>Hs,LayerCreator:()=>Qs,LegendService:()=>B0,LogService:()=>Bt.$V,MCBDefaults:()=>va,MapToolService:()=>$0,MemoryGridDataProvider:()=>zr.o,MemoryWindDataProvider:()=>hi,MicapsDiamond131GridDataProvider:()=>rr,MicapsDiamond14FeatureProvider:()=>cn,MicapsDiamond2WindGridProvider:()=>Ni,MicapsDiamond4GridDataProvider:()=>qn,PixelLayerStyle:()=>ax.lj,PixelLayerStyle3D:()=>ax._E,PlainNumberArrayField2PlainNumberArrayFunc:()=>m0.M,PlotConstants:()=>u0,PlotLineBase:()=>pr,PlotPointBase:()=>Hn,PlotPolygonBase:()=>Wx,PlotShapeBase:()=>Wr,PlotTypes:()=>E0,PointArrayFeatureProvider:()=>Mi,PointImageStyle3D:()=>hn,PointStyle:()=>m0.SC,PointStyle3D:()=>ms,PolygonStyle:()=>m0._7,PolygonStyle3D:()=>Ur,PolylineStyle:()=>m0.Xx,PolylineStyle3D:()=>Ci,QEGridDataProvider:()=>dn,Quadtree:()=>bt,RandomFeatureProvider:()=>Gr,ResourceService:()=>li.zc,SimpleDapInfoParser:()=>L0.b_,Spectra:()=>Cx.t,StopRuleActionMode:()=>Nr.Mg,StopRuleItemFilterMode:()=>Nr.DY,StopRules:()=>Nr.NB,StyleBaseClass:()=>fx.Uw,TifGridDataProvider:()=>Ui,TracingService:()=>D0,TypeOf:()=>jt.BR,VectorMapTool:()=>vn,VectorMapToolPointerButtonType:()=>fa,VolumeLayerStyle:()=>ax.IW,Wind3DLayerStyle:()=>ax.we,WindArrowLayerStyle:()=>ax.S2,WindInterpMethodType:()=>ax.Lh,WindLayerStyle:()=>ax.SR,addCustomImageTileRules:()=>Io,antiDebug:()=>s0.jr,array2Spectra:()=>fx.LH,assign:()=>jt.f0,auth:()=>Ja,authInfo:()=>Ua,bitmapColorScaleFieldGL2BitmapColorScaleGL:()=>ax.sC,bufferExtent:()=>jt.VS,calcMaxMin:()=>jt.pj,clipGridData:()=>jt.U2,clipGridProvider:()=>jt.ZS,colorStopRuleItemConverter:()=>fx.$k,consts:()=>k.v,createBoxGeometry:()=>Po,createDrawPlot:()=>ka,createGLTypedArray:()=>cs,createRadarRangeRingGeoJSON:()=>jt.Ef,createTypeArr:()=>jt.cM,deepCopyLiteral:()=>jt.f8,defaultLoaderNames:()=>vs.ke,defaultVal:()=>jt.En,defined:()=>jt.ri,degreeToArc:()=>vs.Qs,detectBrowser:()=>s0.Ao,detectOS:()=>s0.fV,downloadImage:()=>jt.GN,drawCustomGridSection:()=>To,drawGridSection:()=>Ao,drawRoundRect:()=>Oo,earcut:()=>Je,earcutFlatten:()=>mt,ensureFloatString:()=>C0,ensureGridDataOptions:()=>ce.T,extend:()=>jt.l7,featureStyleResourceCreator:()=>li.gD,floorMod:()=>jt.vY,formatDate:()=>jt.p6,getAlgoConstsAndUniforms:()=>qs,getBinaries:()=>jt.K0,getBinary:()=>jt.j$,getCR:()=>jt.BG,getFieldLoader:()=>vs.nA,getGridPosIndex:()=>jt.tr,getHeightAlgoConstsAndUniforms:()=>Ws,getHeightUniforms:()=>ln,getImageTileUrls:()=>Eo,getJSON:()=>jt.xA,getJSONZip:()=>jt.lC,getPos1DFrom2D:()=>jt.vi,getPos2DFrom1D:()=>jt.Fp,getPredefinedBitmapScale:()=>js.K9,getPredefinedBitmapScaleSync:()=>js.dO,getPredefinedStopRules:()=>js.uD,getProperlyWebGLVersion:()=>s0.lS,getQueryParams:()=>fx.vl,getRGBA2FloatConsts:()=>cr,getRaw:()=>jt.oT,getSDFromUV:()=>jt.C8,getText:()=>jt.Q,getTiltPathOfGridDatas:()=>Ma,getUVFromSD:()=>jt.Hn,glNames:()=>K0,gridColorFieldGL2StopRules:()=>ax.m_,gridNumberFieldGL2GridNumberStopRules:()=>ax.m3,gridOptionsToExtent:()=>ce.Z,gridStaticColorFieldGL2NumberArray:()=>ax.hM,gridStaticColorFieldGL2Spectra:()=>ax.uI,gridStyleResourceCreator:()=>li.xR,imageResourceCreator:()=>li.Xf,init:()=>ko,injectBuiltInShaderFunctions:()=>xr,interpColor:()=>jt.$k,isArray:()=>jt.kJ,isArrayBuffer:()=>jt.eP,isDate:()=>jt.J_,isEmpty:()=>jt.xb,isFunction:()=>jt.mf,isMobile:()=>s0.tq,isMoblie:()=>s0.Tz,isNull:()=>jt.Ft,isNumber:()=>jt.hj,isObject:()=>jt.Kn,isString:()=>jt.HD,isSupportedBrowser:()=>s0.H$,isValid:()=>jt.JY,jsonFileResourceCreator:()=>li.I$,layerCreator:()=>ki,loadAllImages:()=>jt.EX,loadGridMesh:()=>jt.d$,loadResourcesAndLayers:()=>Oa,loadScript:()=>jt.ve,logger:()=>Bt.kg,mcb:()=>La,mergeShaderLib:()=>ps,number2Spectra:()=>fx.lW,onWindowSizeChanged:()=>jt.Wd,p2h:()=>jt.Tc,pickColor:()=>jt.ft,preDeinfedImageTileTokens:()=>Gi,predefinedColorNames:()=>Cx.m,predefinedImageTiles:()=>Z0,predefinedLegendNames:()=>js.xS,processFieldWithLoaders:()=>fx.it,qeFetch:()=>jt.TN,qeGLFuncs:()=>Ue,randomPointInExtent:()=>jt.wO,randomPointInGrid:()=>jt.r_,randomValueInRange:()=>jt.Zu,rawFileResourceCreator:()=>li.GB,registerDrawPlotCreator:()=>_o,registerFieldLoader:()=>vs.OE,registerFieldLoaders:()=>vs.c0,resourceCreatorBase:()=>li.pQ,resourceService:()=>li.Zc,resourceTypePreDefined:()=>li.MM,saveGridMesh:()=>jt.XG,scaleGridProvider:()=>Gn,setAlgoUniforms:()=>Bx,setDirectAlgoUniforms:()=>Zs,setGLNames:()=>Js,setHeightAlgoUniforms:()=>Dx,setOptions:()=>jt.Ov,setOptionsDeep:()=>jt.uw,setShaders:()=>pa,shaderLib:()=>G0,splitWords:()=>jt.nf,stamp:()=>jt.Rc,stopRuleResouceCreator:()=>li.qg,string2Spectra:()=>fx.$P,supportWebP:()=>s0.sU,toOneDim:()=>jt.LG,uid:()=>jt.hQ,updateLoggerDebugMode:()=>Bt.qr,whenValid:()=>jt.Rf,windSpeed2ttf:()=>vs.y$,wrapLon:()=>jt._6,ww2ttf:()=>vs.EO});class bt{constructor(r,s,o,f){this.max_objects=s||10,this.max_levels=o||4,this.level=f||0,this.bounds=r,this.objects=[],this.nodes=[]}split(){var r=this.level+1,s=this.bounds.width/2,o=this.bounds.height/2,f=this.bounds.x,b=this.bounds.y;this.nodes[0]=new bt({x:f+s,y:b,width:s,height:o},this.max_objects,this.max_levels,r),this.nodes[1]=new bt({x:f,y:b,width:s,height:o},this.max_objects,this.max_levels,r),this.nodes[2]=new bt({x:f,y:b+o,width:s,height:o},this.max_objects,this.max_levels,r),this.nodes[3]=new bt({x:f+s,y:b+o,width:s,height:o},this.max_objects,this.max_levels,r)}getIndex(r){var s=[],o=this.bounds.x+this.bounds.width/2,f=this.bounds.y+this.bounds.height/2,b=r.y<f,u=r.x<o,w=r.x+r.width>o,C=r.y+r.height>f;return b&&w&&s.push(0),u&&b&&s.push(1),u&&C&&s.push(2),w&&C&&s.push(3),s}insert(r){var s,o=0;if(this.nodes.length)for(s=this.getIndex(r),o=0;o<s.length;o++)this.nodes[s[o]].insert(r);else if(this.objects.push(r),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),o=0;o<this.objects.length;o++){s=this.getIndex(this.objects[o]);for(var f=0;f<s.length;f++)this.nodes[s[f]].insert(this.objects[o])}this.objects=[]}}retrieve(r,s=!0){var o=this.getIndex(r),f=this.objects;if(this.nodes.length)for(var b=0;b<o.length;b++)f=f.concat(this.nodes[o[b]].retrieve(r));return s||(f=f.filter(function(u,w){return f.indexOf(u)>=w})),f}clear(){this.objects=[];for(var r=0;r<this.nodes.length;r++)this.nodes.length&&this.nodes[r].clear();this.nodes=[]}}const ut=5120,Mt=5121,st=5122,tt=5123,Ut=5124,nt=5125,ue=5126,re={};{const z=re;z[ut]=Int8Array,z[Mt]=Uint8Array,z[st]=Int16Array,z[tt]=Uint16Array,z[Ut]=Int32Array,z[nt]=Uint32Array,z[ue]=Float32Array,z[32819]=Uint16Array,z[32820]=Uint16Array,z[33635]=Uint16Array,z[5131]=Uint16Array,z[33640]=Uint32Array,z[35899]=Uint32Array,z[35902]=Uint32Array,z[36269]=Uint32Array,z[34042]=Uint32Array}function ee(z){if(z instanceof Int8Array)return ut;if(z instanceof Uint8Array||z instanceof Uint8ClampedArray)return Mt;if(z instanceof Int16Array)return st;if(z instanceof Uint16Array)return tt;if(z instanceof Int32Array)return Ut;if(z instanceof Uint32Array)return nt;if(z instanceof Float32Array)return ue;throw new Error("unsupported typed array type")}function Qt(z){if(z===Int8Array)return ut;if(z===Uint8Array||z===Uint8ClampedArray)return Mt;if(z===Int16Array)return st;if(z===Uint16Array)return tt;if(z===Int32Array)return Ut;if(z===Uint32Array)return nt;if(z===Float32Array)return ue;throw new Error("unsupported typed array type")}function Lt(z){const r=re[z];if(!r)throw new Error("unknown gl type");return r}const pe=typeof SharedArrayBuffer<"u"?function(z){return z&&z.buffer&&(z.buffer instanceof ArrayBuffer||z.buffer instanceof SharedArrayBuffer)}:function(z){return z&&z.buffer&&z.buffer instanceof ArrayBuffer};function be(...z){console.error(...z)}function se(...z){console.warn(...z)}const Fe=new Map;function Pe(z,r){if(!z||typeof z!="object")return!1;let s=Fe.get(r);s||(s=new WeakMap,Fe.set(r,s));let o=s.get(z);if(o===void 0){const f=Object.prototype.toString.call(z);o=f.substring(8,f.length-1)===r,s.set(z,o)}return o}function It(z,r){return typeof WebGLTexture<"u"&&Pe(r,"WebGLTexture")}const Rt=35044,Jt=34962,Yt=34963,Te=34660,me=5120,De=5121,Ge=5122,Tt=5123,Vt=5124,xe=5125,Kt=5126,Me={attribPrefix:""};function Se(z,r,s,o){if(typeof WebGLBuffer<"u"&&Pe(r,"WebGLBuffer"))return r;s=s||Jt;const f=z.createBuffer();return function(b,u,w,C,M){b.bindBuffer(u,w),b.bufferData(u,C,M||Rt)}(z,s,f,r,o),f}function ke(z){return z==="indices"}function Ne(z){return z.length?z:z.data}const Oe=/coord|texture/i,$e=/color|colour/i;function l0(z,r,s){return z.numComponents||z.size||function(o,f){let b;if(b=Oe.test(o)?2:$e.test(o)?4:3,f%b>0)throw new Error("Can not guess numComponents for attribute '"+o+"'. Tried "+b+" but "+f+" values is not evenly divisible by "+b+". You should specify it.");return b}(r,s||Ne(z).length)}function je(z,r){if(pe(z))return z;if(pe(z.data))return z.data;Array.isArray(z)&&(z={data:z});let s=z.type?I0(z.type):void 0;return s||(s=ke(r)?Uint16Array:Float32Array),new s(z.data)}function I0(z){return typeof z=="number"?Lt(z):z||Float32Array}function X0(z,r){return{buffer:r.buffer,numValues:24,type:(s=r.type,typeof s=="number"?s:s?Qt(s):Kt),arrayType:I0(r.type)};var s}function W0(z,r){const s=r.data||r,o=I0(r.type),f=s*o.BYTES_PER_ELEMENT,b=z.createBuffer();return z.bindBuffer(Jt,b),z.bufferData(Jt,f,r.drawType||Rt),{buffer:b,numValues:s,type:Qt(o),arrayType:o}}function U0(z,r,s){const o=je(r,s);return{arrayType:o.constructor,buffer:Se(z,o,void 0,r.drawType),type:ee(o),numValues:0}}const J0=["position","positions","a_position"];function yx(z,r,s){const o=function(u,w){const C={};return Object.keys(w).forEach(function(M){if(!ke(M)){const j=w[M],$=j.attrib||j.name||j.attribName||Me.attribPrefix+M;if(j.value){if(!Array.isArray(j.value)&&!pe(j.value))throw new Error("array.value is not array or typedarray");C[$]={value:j.value}}else{let ot;ot=j.buffer&&j.buffer instanceof WebGLBuffer?X0:typeof j=="number"||typeof j.data=="number"?W0:U0;const{buffer:ct,type:wt,numValues:Ct,arrayType:qt}=ot(u,j,M),kt=j.normalize!==void 0?j.normalize:(K=qt)===Int8Array||K===Uint8Array,$t=l0(j,M,Ct);C[$]={buffer:ct,numComponents:$t,type:wt,normalize:kt,stride:j.stride||0,offset:j.offset||0,divisor:j.divisor===void 0?void 0:j.divisor,drawType:j.drawType}}}var K}),u.bindBuffer(Jt,null),C}(z,r),f=Object.assign({},s||{});f.attribs=Object.assign({},s?s.attribs:{},o);const b=r.indices;if(b){const u=je(b,"indices");f.indices=Se(z,u,Yt),f.numElements=u.length,f.elementType=ee(u)}else f.numElements||(f.numElements=function(u,w){let C,M;for(M=0;M<J0.length&&(C=J0[M],!(C in w))&&(C=Me.attribPrefix+C,!(C in w));++M);M===J0.length&&(C=Object.keys(w)[0]);const K=w[C];if(!K.buffer)return 1;u.bindBuffer(Jt,K.buffer);const j=u.getBufferParameter(Jt,Te);var $;u.bindBuffer(Jt,null);const ot=j/(($=K.type)===me||$===De?1:$===Ge||$===Tt?2:$===Vt||$===xe||$===Kt?4:0),ct=K.numComponents||K.size,wt=ot/ct;if(wt%1!=0)throw new Error("numComponents "+ct+" not correct for length "+length);return wt}(z,f.attribs));return f}function cx(z){return!!z.texStorage2D}const H0=function(){const z={},r={};return function(s,o){return function(f){const b=f.constructor.name;if(!z[b]){for(const u in f)if(typeof f[u]=="number"){const w=r[f[u]];r[f[u]]=w?w+" | "+u:u}z[b]=!0}}(s),r[o]||(typeof o=="number"?"0x"+o.toString(16):o)}}(),kx={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},ri=pe,Ox=function(){let z;return function(){return z=z||(typeof document<"u"&&document.createElement?document.createElement("canvas").getContext("2d"):null),z}}(),$x=6406,lx=6407,y0=6408,he=6409,Ae=6410,Ve=6402,x0=34041,n0=33071,t0=9728,f0=9729,c0=3553,r0=34067,_0=32879,z0=35866,Q0=34069,_x=34070,ix=34071,h0=34072,Wi=34073,bi=34074,qx=10241,Ex=10240,Mx=10242,di=10243,Xx=32882,$n=33082,yn=33083,bs=33084,fi=33085,ia=34892,ws=34893,Xn=3317,Zr=3314,Ps=32878,Ss=3316,Ls=3315,Os=32877,Ts=37443,_n=37441,gr=37440,Qn=33321,jn=36756,Jr=33325,q0=33326,hx=33330,bn=33329,qi=33338,Zi=33337,ts=33340,k0=33339,dx=33323,Hr=36757,vr=33327,px=33328,Kr=33336,nr=33335,Ux=33332,rx=33331,Ji=33334,yr=33333,Nx=32849,j0=35905,_r=36194,wn=36758,sr=35898,Yr=35901,br=34843,es=34837,Pn=36221,ci=36239,ni=36215,Hi=36233,P0=36209,Zx=36227,tx=32856,As=35907,xs=36759,is=32855,rs=32854,wi=32857,$r=34842,Ki=34836,mx=36220,Yi=36238,Is=36975,Es=36214,ra=36232,Rs=36226,ns=36208,na=33189,Sn=33190,N0=36012,Ds=36013,Qx=35056,Jx=5120,ex=5121,Ln=5122,$i=5123,On=5124,Xi=5125,Rx=5126,Cs=32819,Tn=32820,ks=33635,gx=5131,Xr=36193,An=33640,Qi=35899,Ms=35902,zs=36269,ss=34042,In=33319,ar=33320,Qr=6403,wr=36244,Pr=36248,Pi=36249;let as;function jr(z){if(!as){const r={};r[$x]={textureFormat:$x,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[ex,gx,Xr,Rx]},r[he]={textureFormat:he,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[ex,gx,Xr,Rx]},r[Ae]={textureFormat:Ae,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[ex,gx,Xr,Rx]},r[lx]={textureFormat:lx,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[ex,gx,Xr,Rx,ks]},r[y0]={textureFormat:y0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[ex,gx,Xr,Rx,Cs,Tn]},r[Ve]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[Xi,$i]},r[Qn]={textureFormat:Qr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[ex]},r[jn]={textureFormat:Qr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[Jx]},r[Jr]={textureFormat:Qr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[Rx,gx]},r[q0]={textureFormat:Qr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[Rx]},r[hx]={textureFormat:wr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[ex]},r[bn]={textureFormat:wr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Jx]},r[Ux]={textureFormat:wr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[$i]},r[rx]={textureFormat:wr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Ln]},r[Ji]={textureFormat:wr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Xi]},r[yr]={textureFormat:wr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[On]},r[dx]={textureFormat:In,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[ex]},r[Hr]={textureFormat:In,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[Jx]},r[vr]={textureFormat:In,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[Rx,gx]},r[px]={textureFormat:In,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[Rx]},r[Kr]={textureFormat:ar,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[ex]},r[nr]={textureFormat:ar,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Jx]},r[qi]={textureFormat:ar,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[$i]},r[Zi]={textureFormat:ar,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ln]},r[ts]={textureFormat:ar,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Xi]},r[k0]={textureFormat:ar,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[On]},r[Nx]={textureFormat:lx,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[ex]},r[j0]={textureFormat:lx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[ex]},r[_r]={textureFormat:lx,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[ex,ks]},r[wn]={textureFormat:lx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Jx]},r[sr]={textureFormat:lx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[Rx,gx,Qi]},r[Yr]={textureFormat:lx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[Rx,gx,Ms]},r[br]={textureFormat:lx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[Rx,gx]},r[es]={textureFormat:lx,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Rx]},r[Pn]={textureFormat:Pr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[ex]},r[ci]={textureFormat:Pr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Jx]},r[ni]={textureFormat:Pr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[$i]},r[Hi]={textureFormat:Pr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Ln]},r[P0]={textureFormat:Pr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Xi]},r[Zx]={textureFormat:Pr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[On]},r[tx]={textureFormat:y0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[ex]},r[As]={textureFormat:y0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[ex]},r[xs]={textureFormat:y0,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[Jx]},r[is]={textureFormat:y0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[ex,Tn,An]},r[rs]={textureFormat:y0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[ex,Cs]},r[wi]={textureFormat:y0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[An]},r[$r]={textureFormat:y0,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[Rx,gx]},r[Ki]={textureFormat:y0,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[Rx]},r[mx]={textureFormat:Pi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ex]},r[Yi]={textureFormat:Pi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Jx]},r[Is]={textureFormat:Pi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[An]},r[Es]={textureFormat:Pi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[$i]},r[ra]={textureFormat:Pi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ln]},r[Rs]={textureFormat:Pi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[On]},r[ns]={textureFormat:Pi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Xi]},r[na]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[$i,Xi]},r[Sn]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Xi]},r[N0]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Rx]},r[Qx]={textureFormat:x0,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ss]},r[Ds]={textureFormat:x0,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[zs]},Object.keys(r).forEach(function(s){const o=r[s];o.bytesPerElementMap={},o.bytesPerElement.forEach(function(f,b){const u=o.type[b];o.bytesPerElementMap[u]=f})}),as=r}return as[z]}function Sr(z){const r=jr(z);if(!r)throw"unknown internal format";return{format:r.textureFormat,type:r.type[0]}}function tn(z){return(z&z-1)==0}function pi(z,r,s,o,f){if(f%1!=0)throw"can't guess dimensions";if(s||o){if(o){if(!s&&(s=f/o)%1)throw"can't guess dimensions"}else if((o=f/s)%1)throw"can't guess dimensions"}else{const b=Math.sqrt(f/(r===r0?6:1));b%1==0?(s=b,o=b):(s=f,o=1)}return{width:s,height:o}}function Lr(z,r){r.colorspaceConversion!==void 0&&z.pixelStorei(Ts,r.colorspaceConversion),r.premultiplyAlpha!==void 0&&z.pixelStorei(_n,r.premultiplyAlpha),r.flipY!==void 0&&z.pixelStorei(gr,r.flipY)}function Or(z){z.pixelStorei(Xn,4),cx(z)&&(z.pixelStorei(Zr,0),z.pixelStorei(Ps,0),z.pixelStorei(Ss,0),z.pixelStorei(Ls,0),z.pixelStorei(Os,0))}function Hx(z,r,s){const o=s.target||c0;z.bindTexture(o,r),function(f,b,u,w){w.minMag&&(u.call(f,b,qx,w.minMag),u.call(f,b,Ex,w.minMag)),w.min&&u.call(f,b,qx,w.min),w.mag&&u.call(f,b,Ex,w.mag),w.wrap&&(u.call(f,b,Mx,w.wrap),u.call(f,b,di,w.wrap),(b===_0||typeof WebGLSampler<"u"&&Pe(b,"WebGLSampler"))&&u.call(f,b,Xx,w.wrap)),w.wrapR&&u.call(f,b,Xx,w.wrapR),w.wrapS&&u.call(f,b,Mx,w.wrapS),w.wrapT&&u.call(f,b,di,w.wrapT),w.minLod!==void 0&&u.call(f,b,$n,w.minLod),w.maxLod!==void 0&&u.call(f,b,yn,w.maxLod),w.baseLevel!==void 0&&u.call(f,b,bs,w.baseLevel),w.maxLevel!==void 0&&u.call(f,b,fi,w.maxLevel),w.compareFunc!==void 0&&u.call(f,b,ws,w.compareFunc),w.compareMode!==void 0&&u.call(f,b,ia,w.compareMode)}(z,o,z.texParameteri,s)}function En(z,r,s,o,f,b){s=s||kx.textureOptions,b=b||y0;const u=s.target||c0;if(o=o||s.width,f=f||s.height,z.bindTexture(u,r),function(w,C,M,K){if(!cx(w))return tn(C)&&tn(M);const j=jr(K);if(!j)throw"unknown internal format";return j.colorRenderable&&j.textureFilterable}(z,o,f,b))z.generateMipmap(u);else{const w=function(C){const M=jr(C);if(!M)throw"unknown internal format";return M.textureFilterable}(b)?f0:t0;z.texParameteri(u,qx,w),z.texParameteri(u,Ex,w),z.texParameteri(u,Mx,n0),z.texParameteri(u,di,n0)}}function Tr(z){return z.auto===!0||z.auto===void 0&&z.level===void 0}function os(z,r){return(r=r||{}).cubeFaceOrder||[Q0,_x,ix,h0,Wi,bi]}function en(z,r){const s=os(0,r).map(function(o,f){return{face:o,ndx:f}});return s.sort(function(o,f){return o.face-f.face}),s}function Rn(z,r,s,o){const f=(o=o||kx.textureOptions).target||c0,b=o.level||0;let u=s.width,w=s.height;const C=o.internalFormat||o.format||y0,M=Sr(C),K=o.format||M.format,j=o.type||M.type;if(Lr(z,o),z.bindTexture(f,r),f===r0){const $=s.width,ot=s.height;let ct,wt;if($/6===ot)ct=ot,wt=[0,0,1,0,2,0,3,0,4,0,5,0];else if(ot/6===$)ct=$,wt=[0,0,0,1,0,2,0,3,0,4,0,5];else if($/3==ot/2)ct=$/3,wt=[0,0,1,0,2,0,0,1,1,1,2,1];else{if($/2!=ot/3)throw"can't figure out cube map from element: "+(s.src?s.src:s.nodeName);ct=$/2,wt=[0,0,1,0,0,1,1,1,0,2,1,2]}const Ct=Ox();Ct?(Ct.canvas.width=ct,Ct.canvas.height=ct,u=ct,w=ct,en(0,o).forEach(function(qt){const kt=wt[2*qt.ndx+0]*ct,$t=wt[2*qt.ndx+1]*ct;Ct.drawImage(s,kt,$t,ct,ct,0,0,ct,ct),z.texImage2D(qt.face,b,C,K,j,Ct.canvas)}),Ct.canvas.width=1,Ct.canvas.height=1):typeof createImageBitmap<"u"&&(u=ct,w=ct,en(0,o).forEach(function(qt){const kt=wt[2*qt.ndx+0]*ct,$t=wt[2*qt.ndx+1]*ct;z.texImage2D(qt.face,b,C,ct,ct,0,K,j,null),createImageBitmap(s,kt,$t,ct,ct,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(ie){Lr(z,o),z.bindTexture(f,r),z.texImage2D(qt.face,b,C,K,j,ie),Tr(o)&&En(z,r,o,u,w,C)})}))}else if(f===_0||f===z0){const $=Math.min(s.width,s.height),ot=Math.max(s.width,s.height),ct=ot/$;if(ct%1!=0)throw"can not compute 3D dimensions of element";const wt=s.width===ot?1:0,Ct=s.height===ot?1:0;z.pixelStorei(Xn,1),z.pixelStorei(Zr,s.width),z.pixelStorei(Ps,0),z.pixelStorei(Os,0),z.texImage3D(f,b,C,$,$,$,0,K,j,null);for(let qt=0;qt<ct;++qt){const kt=qt*$*wt,$t=qt*$*Ct;z.pixelStorei(Ss,kt),z.pixelStorei(Ls,$t),z.texSubImage3D(f,b,0,0,qt,$,$,1,K,j,s)}Or(z)}else z.texImage2D(f,b,C,K,j,s);Tr(o)&&En(z,r,o,u,w,C),Hx(z,r,o)}function xn(){}function Bs(z){return typeof ImageBitmap<"u"&&z instanceof ImageBitmap||typeof ImageData<"u"&&z instanceof ImageData||typeof HTMLElement<"u"&&z instanceof HTMLElement}function Dn(z,r,s){return Bs(z)?(setTimeout(function(){s(null,z)}),z):function(o,f,b){let u;if(b=b||xn,f=f!==void 0?f:kx.crossOrigin,f=function(w,C){return C!==void 0||function(M){if(typeof document<"u"){const K=document.createElement("a");return K.href=M,K.hostname===location.hostname&&K.port===location.port&&K.protocol===location.protocol}{const K=new URL(location.href).origin;return new URL(M,location.href).origin===K}}(w)?C:"anonymous"}(o,f),typeof Image<"u"){u=new Image,f!==void 0&&(u.crossOrigin=f);const w=function(){u.removeEventListener("error",C),u.removeEventListener("load",M),u=null},C=function(){const K="couldn't load image: "+o;be(K),b(K,u),w()},M=function(){b(null,u),w()};return u.addEventListener("error",C),u.addEventListener("load",M),u.src=o,u}if(typeof ImageBitmap<"u"){let w,C;const M=function(){b(w,C)},K={};f&&(K.mode="cors"),fetch(o,K).then(function(j){if(!j.ok)throw j;return j.blob()}).then(function(j){return createImageBitmap(j,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(j){C=j,setTimeout(M)}).catch(function(j){w=j,setTimeout(M)}),u=null}return u}(z,r,s)}function ls(z,r,s){const o=(s=s||kx.textureOptions).target||c0;if(z.bindTexture(o,r),s.color===!1)return;const f=function(b){return b=b||kx.textureColor,ri(b)?b:new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}(s.color);if(o===r0)for(let b=0;b<6;++b)z.texImage2D(Q0+b,0,y0,1,1,0,y0,ex,f);else o===_0||o===z0?z.texImage3D(o,0,y0,1,1,1,0,y0,ex,f):z.texImage2D(o,0,y0,1,1,0,y0,ex,f)}function si(z,r,s,o){const f=(o=o||kx.textureOptions).target||c0;z.bindTexture(f,r);let b=o.width,u=o.height,w=o.depth;const C=o.level||0,M=o.internalFormat||o.format||y0,K=Sr(M),j=o.format||K.format,$=o.type||function(Ct,qt,kt){return ri(qt)?ee(qt):kt||ex}(0,s,K.type);if(ri(s))s instanceof Uint8ClampedArray&&(s=new Uint8Array(s.buffer));else{const Ct=Lt($);s=new Ct(s)}const ot=function(Ct,qt){const kt=jr(Ct);if(!kt)throw"unknown internal format";const $t=kt.bytesPerElementMap[qt];if($t===void 0)throw"unknown internal format";return $t}(M,$),ct=s.byteLength/ot;if(ct%1)throw"length wrong size for format: "+H0(z,j);let wt;if(f===_0||f===z0)if(b||u||w)!b||u&&w?!u||b&&w?(wt=pi(0,f,b,u,ct/w),b=wt.width,u=wt.height):(wt=pi(0,f,b,w,ct/u),b=wt.width,w=wt.height):(wt=pi(0,f,u,w,ct/b),u=wt.width,w=wt.height);else{const Ct=Math.cbrt(ct);if(Ct%1!=0)throw"can't guess cube size of array of numElements: "+ct;b=Ct,u=Ct,w=Ct}else wt=pi(0,f,b,u,ct),b=wt.width,u=wt.height;if(Or(z),z.pixelStorei(Xn,o.unpackAlignment||1),Lr(z,o),f===r0){const Ct=ct/6*(ot/s.BYTES_PER_ELEMENT);en(0,o).forEach(qt=>{const kt=Ct*qt.ndx,$t=s.subarray(kt,kt+Ct);z.texImage2D(qt.face,C,M,b,u,0,j,$,$t)})}else f===_0||f===z0?z.texImage3D(f,C,M,b,u,w,0,j,$,s):z.texImage2D(f,C,M,b,u,0,j,$,s);return{width:b,height:u,depth:w,type:$}}function or(z,r,s){s=s||xn,r=r||kx.textureOptions;const o=z.createTexture(),f=r.target||c0;let b=r.width||1,u=r.height||1;const w=r.internalFormat||y0;z.bindTexture(f,o),f===r0&&(z.texParameteri(f,Mx,n0),z.texParameteri(f,di,n0));let C=r.src;if(C)if(typeof C=="function"&&(C=C(z,r)),typeof C=="string")(function(M,K,j,$){$=$||xn,j=j||kx.textureOptions,ls(M,K,j),Dn((j=Object.assign({},j)).src,j.crossOrigin,function(ot,ct){ot?$(ot,K,ct):(Rn(M,K,ct,j),$(null,K,ct))})})(z,o,r,s);else if(ri(C)||Array.isArray(C)&&(typeof C[0]=="number"||Array.isArray(C[0])||ri(C[0]))){const M=si(z,o,C,r);b=M.width,u=M.height}else Array.isArray(C)&&(typeof C[0]=="string"||Bs(C[0]))?f===r0?function(M,K,j,$){$=$||xn;const ot=j.src;if(ot.length!==6)throw"there must be 6 urls for a cubemap";const ct=j.level||0,wt=j.internalFormat||j.format||y0,Ct=Sr(wt),qt=j.format||Ct.format,kt=j.type||ex,$t=j.target||c0;if($t!==r0)throw"target must be TEXTURE_CUBE_MAP";ls(M,K,j),j=Object.assign({},j);let ie=6;const oe=[],ae=os(0,j);let fe;fe=ot.map(function(le,ge){return Dn(le,j.crossOrigin,(_e=ae[ge],function(Le,Re){--ie,Le?oe.push(Le):Re.width!==Re.height?oe.push("cubemap face img is not a square: "+Re.src):(Lr(M,j),M.bindTexture($t,K),ie===5?os().forEach(function(Ke){M.texImage2D(Ke,ct,wt,qt,kt,Re)}):M.texImage2D(_e,ct,wt,qt,kt,Re),Tr(j)&&M.generateMipmap($t)),ie===0&&$(oe.length?oe:void 0,K,fe)}));var _e})}(z,o,r,s):function(M,K,j,$){$=$||xn;const ot=j.src,ct=j.internalFormat||j.format||y0,wt=Sr(ct),Ct=j.format||wt.format,qt=j.type||ex,kt=j.target||z0;if(kt!==_0&&kt!==z0)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";ls(M,K,j),j=Object.assign({},j);let $t=ot.length;const ie=[];let oe;const ae=j.level||0;let fe=j.width,le=j.height;const ge=ot.length;let _e=!0;oe=ot.map(function(Le,Re){return Dn(Le,j.crossOrigin,(Ke=Re,function(i0,We){if(--$t,i0)ie.push(i0);else{if(Lr(M,j),M.bindTexture(kt,K),_e){_e=!1,fe=j.width||We.width,le=j.height||We.height,M.texImage3D(kt,ae,ct,fe,le,ge,0,Ct,qt,null);for(let Xe=0;Xe<ge;++Xe)M.texSubImage3D(kt,ae,0,0,Xe,fe,le,1,Ct,qt,We)}else{let Xe,Ze=We;We.width===fe&&We.height===le||(Xe=Ox(),Ze=Xe.canvas,Xe.canvas.width=fe,Xe.canvas.height=le,Xe.drawImage(We,0,0,fe,le)),M.texSubImage3D(kt,ae,0,0,Ke,fe,le,1,Ct,qt,Ze),Xe&&Ze===Xe.canvas&&(Xe.canvas.width=0,Xe.canvas.height=0)}Tr(j)&&M.generateMipmap(kt)}$t===0&&$(ie.length?ie:void 0,K,oe)}));var Ke})}(z,o,r,s):(Rn(z,o,C,r),b=C.width,u=C.height);else(function(M,K,j){const $=j.target||c0;M.bindTexture($,K);const ot=j.level||0,ct=j.internalFormat||j.format||y0,wt=Sr(ct),Ct=j.format||wt.format,qt=j.type||wt.type;if(Lr(M,j),$===r0)for(let kt=0;kt<6;++kt)M.texImage2D(Q0+kt,ot,ct,j.width,j.height,0,Ct,qt,null);else $===_0||$===z0?M.texImage3D($,ot,ct,j.width,j.height,j.depth,0,Ct,qt,null):M.texImage2D($,ot,ct,j.width,j.height,0,Ct,qt,null)})(z,o,r);return Tr(r)&&En(z,o,r,b,u,w),Hx(z,o,r),o}const hs=be;function mi(z){return typeof document<"u"&&document.getElementById?document.getElementById(z):null}const Cn=33984,Si=34962,sa=35713,rn=35714,Us=35632,kn=35633,aa=35981,Li=35718,Mn=35721,oa=35971,us=35382,la=35396,Oi=35398,ha=35392,Ar=35395,gi=5124,F0=3553,vi=34067,Ti=32879,Ai=35866,w0={};function bx(z,r){return w0[r].bindPoint}function Ir(z,r){return function(s){z.uniform1i(r,s)}}function ji(z,r){return function(s){z.uniform1iv(r,s)}}function Er(z,r){return function(s){z.uniform2iv(r,s)}}function Fx(z,r){return function(s){z.uniform3iv(r,s)}}function lr(z,r){return function(s){z.uniform4iv(r,s)}}function Tx(z,r,s,o){const f=bx(0,r);return cx(z)?function(b){let u,w;!b||It(0,b)?(u=b,w=null):(u=b.texture,w=b.sampler),z.uniform1i(o,s),z.activeTexture(Cn+s),z.bindTexture(f,u),z.bindSampler(s,w)}:function(b){z.uniform1i(o,s),z.activeTexture(Cn+s),z.bindTexture(f,b)}}function Sx(z,r,s,o,f){const b=bx(0,r),u=new Int32Array(f);for(let w=0;w<f;++w)u[w]=s+w;return cx(z)?function(w){z.uniform1iv(o,u),w.forEach(function(C,M){let K,j;z.activeTexture(Cn+u[M]),!C||It(0,C)?(K=C,j=null):(K=C.texture,j=C.sampler),z.bindSampler(s,j),z.bindTexture(b,K)})}:function(w){z.uniform1iv(o,u),w.forEach(function(C,M){z.activeTexture(Cn+u[M]),z.bindTexture(b,C)})}}function zn(z,r){return function(s){if(s.value)switch(z.disableVertexAttribArray(r),s.value.length){case 4:z.vertexAttrib4fv(r,s.value);break;case 3:z.vertexAttrib3fv(r,s.value);break;case 2:z.vertexAttrib2fv(r,s.value);break;case 1:z.vertexAttrib1fv(r,s.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else z.bindBuffer(Si,s.buffer),z.enableVertexAttribArray(r),z.vertexAttribPointer(r,s.numComponents||s.size,s.type||5126,s.normalize||!1,s.stride||0,s.offset||0),z.vertexAttribDivisor&&z.vertexAttribDivisor(r,s.divisor||0)}}function Ii(z,r){return function(s){if(s.value){if(z.disableVertexAttribArray(r),s.value.length!==4)throw new Error("The length of an integer constant value must be 4!");z.vertexAttrib4iv(r,s.value)}else z.bindBuffer(Si,s.buffer),z.enableVertexAttribArray(r),z.vertexAttribIPointer(r,s.numComponents||s.size,s.type||gi,s.stride||0,s.offset||0),z.vertexAttribDivisor&&z.vertexAttribDivisor(r,s.divisor||0)}}function Bn(z,r){return function(s){if(s.value){if(z.disableVertexAttribArray(r),s.value.length!==4)throw new Error("The length of an unsigned integer constant value must be 4!");z.vertexAttrib4uiv(r,s.value)}else z.bindBuffer(Si,s.buffer),z.enableVertexAttribArray(r),z.vertexAttribIPointer(r,s.numComponents||s.size,s.type||5125,s.stride||0,s.offset||0),z.vertexAttribDivisor&&z.vertexAttribDivisor(r,s.divisor||0)}}function hr(z,r,s){const o=s.size,f=s.count;return function(b){z.bindBuffer(Si,b.buffer);const u=b.size||b.numComponents||o,w=u/f,C=b.type||5126,M=w0[C].size*u,K=b.normalize||!1,j=b.offset||0,$=M/f;for(let ot=0;ot<f;++ot)z.enableVertexAttribArray(r+ot),z.vertexAttribPointer(r+ot,w,C,K,M,j+$*ot),z.vertexAttribDivisor&&z.vertexAttribDivisor(r+ot,b.divisor||0)}}w0[5126]={Type:Float32Array,size:4,setter:function(z,r){return function(s){z.uniform1f(r,s)}},arraySetter:function(z,r){return function(s){z.uniform1fv(r,s)}}},w0[35664]={Type:Float32Array,size:8,setter:function(z,r){return function(s){z.uniform2fv(r,s)}},cols:2},w0[35665]={Type:Float32Array,size:12,setter:function(z,r){return function(s){z.uniform3fv(r,s)}},cols:3},w0[35666]={Type:Float32Array,size:16,setter:function(z,r){return function(s){z.uniform4fv(r,s)}},cols:4},w0[gi]={Type:Int32Array,size:4,setter:Ir,arraySetter:ji},w0[35667]={Type:Int32Array,size:8,setter:Er,cols:2},w0[35668]={Type:Int32Array,size:12,setter:Fx,cols:3},w0[35669]={Type:Int32Array,size:16,setter:lr,cols:4},w0[5125]={Type:Uint32Array,size:4,setter:function(z,r){return function(s){z.uniform1ui(r,s)}},arraySetter:function(z,r){return function(s){z.uniform1uiv(r,s)}}},w0[36294]={Type:Uint32Array,size:8,setter:function(z,r){return function(s){z.uniform2uiv(r,s)}},cols:2},w0[36295]={Type:Uint32Array,size:12,setter:function(z,r){return function(s){z.uniform3uiv(r,s)}},cols:3},w0[36296]={Type:Uint32Array,size:16,setter:function(z,r){return function(s){z.uniform4uiv(r,s)}},cols:4},w0[35670]={Type:Uint32Array,size:4,setter:Ir,arraySetter:ji},w0[35671]={Type:Uint32Array,size:8,setter:Er,cols:2},w0[35672]={Type:Uint32Array,size:12,setter:Fx,cols:3},w0[35673]={Type:Uint32Array,size:16,setter:lr,cols:4},w0[35674]={Type:Float32Array,size:32,setter:function(z,r){return function(s){z.uniformMatrix2fv(r,!1,s)}},rows:2,cols:2},w0[35675]={Type:Float32Array,size:48,setter:function(z,r){return function(s){z.uniformMatrix3fv(r,!1,s)}},rows:3,cols:3},w0[35676]={Type:Float32Array,size:64,setter:function(z,r){return function(s){z.uniformMatrix4fv(r,!1,s)}},rows:4,cols:4},w0[35685]={Type:Float32Array,size:32,setter:function(z,r){return function(s){z.uniformMatrix2x3fv(r,!1,s)}},rows:2,cols:3},w0[35686]={Type:Float32Array,size:32,setter:function(z,r){return function(s){z.uniformMatrix2x4fv(r,!1,s)}},rows:2,cols:4},w0[35687]={Type:Float32Array,size:48,setter:function(z,r){return function(s){z.uniformMatrix3x2fv(r,!1,s)}},rows:3,cols:2},w0[35688]={Type:Float32Array,size:48,setter:function(z,r){return function(s){z.uniformMatrix3x4fv(r,!1,s)}},rows:3,cols:4},w0[35689]={Type:Float32Array,size:64,setter:function(z,r){return function(s){z.uniformMatrix4x2fv(r,!1,s)}},rows:4,cols:2},w0[35690]={Type:Float32Array,size:64,setter:function(z,r){return function(s){z.uniformMatrix4x3fv(r,!1,s)}},rows:4,cols:3},w0[35678]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:F0},w0[35680]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:vi},w0[35679]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:Ti},w0[35682]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:F0},w0[36289]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:Ai},w0[36292]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:Ai},w0[36293]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:vi},w0[36298]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:F0},w0[36299]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:Ti},w0[36300]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:vi},w0[36303]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:Ai},w0[36306]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:F0},w0[36307]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:Ti},w0[36308]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:vi},w0[36311]={Type:null,size:0,setter:Tx,arraySetter:Sx,bindPoint:Ai};const nx={};nx[5126]={size:4,setter:zn},nx[35664]={size:8,setter:zn},nx[35665]={size:12,setter:zn},nx[35666]={size:16,setter:zn},nx[gi]={size:4,setter:Ii},nx[35667]={size:8,setter:Ii},nx[35668]={size:12,setter:Ii},nx[35669]={size:16,setter:Ii},nx[5125]={size:4,setter:Bn},nx[36294]={size:8,setter:Bn},nx[36295]={size:12,setter:Bn},nx[36296]={size:16,setter:Bn},nx[35670]={size:4,setter:Ii},nx[35671]={size:8,setter:Ii},nx[35672]={size:12,setter:Ii},nx[35673]={size:16,setter:Ii},nx[35674]={size:4,setter:hr,count:2},nx[35675]={size:9,setter:hr,count:3},nx[35676]={size:16,setter:hr,count:4};const Kx=/ERROR:\s*\d+:(\d+)/gi,yi=/^[ \t]*\n/;function ur(z){let r=0;return yi.test(z)&&(r=1,z=z.replace(yi,"")),{lineOffset:r,shaderSource:z}}function jx(z,r,s){let o,f,b;if(typeof r=="function"&&(s=r,r=void 0),typeof z=="function")s=z,z=void 0;else if(z&&!Array.isArray(z)){const M=z;s=M.errorCallback,z=M.attribLocations,o=M.transformFeedbackVaryings,f=M.transformFeedbackMode,b=M.callback}const u=s||hs,w=[],C={errorCallback(M,...K){w.push(M),u(M,...K)},transformFeedbackVaryings:o,transformFeedbackMode:f,callback:b,errors:w};{let M={};Array.isArray(z)?z.forEach(function(K,j){M[K]=r?r[j]:j}):M=z||{},C.attribLocations=M}return C}const ds=["VERTEX_SHADER","FRAGMENT_SHADER"],nn=(z=0)=>new Promise(r=>setTimeout(r,z));function Rr(z,r,s){const o=z.createProgram(),{attribLocations:f,transformFeedbackVaryings:b,transformFeedbackMode:u}=jx(s);for(let C=0;C<r.length;++C){let M=r[C];if(typeof M=="string"){const K=mi(M),j=K?K.text:M;let $=z[ds[C]];K&&K.type&&($=((w=K.type).indexOf("frag")>=0?Us:w.indexOf("vert")>=0?kn:void 0)||$),M=z.createShader($),z.shaderSource(M,ur(j).shaderSource),z.compileShader(M),z.attachShader(o,M)}}var w;Object.entries(f).forEach(([C,M])=>z.bindAttribLocation(o,M,C));{let C=b;C&&(C.attribs&&(C=C.attribs),Array.isArray(C)||(C=Object.keys(C)),z.transformFeedbackVaryings(o,C,u||aa))}return z.linkProgram(o),o}function Dr(z,r,s,o,f){const b=jx(s,o,f),u=new Set(r),w=Rr(z,r,b);function C(M,K){const j=Ei(M,K,b.errorCallback);return j&&function($,ot,ct){const wt=$.getAttachedShaders(ot);for(const Ct of wt)ct.has(Ct)&&$.deleteShader(Ct);$.deleteProgram(ot)}(M,K,u),j}if(!b.callback)return C(z,w)?void 0:w;Ns(z,w).then(()=>{const M=C(z,w);b.callback(M,M?void 0:w)})}async function Ns(z,r){const s=z.getExtension("KHR_parallel_shader_compile"),o=s?(b,u)=>b.getProgramParameter(u,s.COMPLETION_STATUS_KHR):()=>!0;let f=0;do await nn(f),f=1e3/60;while(!o(z,r))}function Ei(z,r,s){if(s=s||hs,!z.getProgramParameter(r,rn)){const o=z.getProgramInfoLog(r);return s("Error in program linking: "+o),o+`
`+z.getAttachedShaders(r).map(f=>function(b,u,w,C){if(C=C||hs,!b.getShaderParameter(w,sa)){const M=b.getShaderInfoLog(w),{lineOffset:K,shaderSource:j}=ur(b.getShaderSource(w)),$=function(ot,ct="",wt=0){const Ct=[...ct.matchAll(Kx)],qt=new Map(Ct.map((kt,$t)=>{const ie=parseInt(kt[1]),oe=Ct[$t+1],ae=oe?oe.index:ct.length;return[ie-1,ct.substring(kt.index,ae)]}));return ot.split(`
`).map((kt,$t)=>{const ie=qt.get($t);return $t+1+wt+": "+kt+(ie?`

^^^ `+ie:"")}).join(`
`)}(j,M,K)+`
Error compiling `+H0(b,u)+": "+M;return C($),$}return""}(z,z.getShaderParameter(f,z.SHADER_TYPE),f,s)).filter(f=>f).join(`
`)}}function tr(z){const r=z.name;return r.startsWith("gl_")||r.startsWith("webgl_")}const fs=/(\.|\[|]|\w+)/g,Fs=z=>z>="0"&&z<="9";function ai(z,r,s,o){const f=z.split(fs).filter(w=>w!=="");let b=0,u="";for(;;){const w=f[b++];u+=w;const C=Fs(w[0]),M=C?parseInt(w):w;if(C&&(u+=f[b++]),b===f.length){s[M]=r;break}{const K=f[b++],j=K==="[",$=s[M]||(j?[]:{});s[M]=$,s=$,o[u]=o[u]||function(ot){return function(ct){sn(ot,ct)}}($),u+=K}}}function Cr(z,r){let s=0;function o(w,C,M){const K=C.name.endsWith("[0]"),j=C.type,$=w0[j];if(!$)throw new Error("unknown type: 0x"+j.toString(16));let ot;if($.bindPoint){const ct=s;s+=C.size,ot=K?$.arraySetter(z,j,ct,M,C.size):$.setter(z,j,ct,M,C.size)}else ot=$.arraySetter&&K?$.arraySetter(z,M):$.setter(z,M);return ot.location=M,ot}const f={},b={},u=z.getProgramParameter(r,Li);for(let w=0;w<u;++w){const C=z.getActiveUniform(r,w);if(tr(C))continue;let M=C.name;M.endsWith("[0]")&&(M=M.substr(0,M.length-3));const K=z.getUniformLocation(r,C.name);if(K){const j=o(0,C,K);f[M]=j,ai(M,j,b,f)}}return f}function sn(z,r){for(const s in r){const o=z[s];typeof o=="function"?o(r[s]):sn(z[s],r[s])}}function er(z,...r){const s=z.uniformSetters||z,o=r.length;for(let f=0;f<o;++f){const b=r[f];if(Array.isArray(b)){const u=b.length;for(let w=0;w<u;++w)er(s,b[w])}else for(const u in b){const w=s[u];w&&w(b[u])}}}function Un(z,r){const s={},o=z.getProgramParameter(r,Mn);for(let f=0;f<o;++f){const b=z.getActiveAttrib(r,f);if(tr(b))continue;const u=z.getAttribLocation(r,b.name),w=nx[b.type],C=w.setter(z,u,w);C.location=u,s[b.name]=C}return s}function Ri(z,r){const s={program:r,uniformSetters:Cr(z,r),attribSetters:Un(z,r)};return cx(z)&&(s.uniformBlockSpec=function(o,f){const b=o.getProgramParameter(f,Li),u=[],w=[];for(let K=0;K<b;++K){w.push(K),u.push({});const j=o.getActiveUniform(f,K);u[K].name=j.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(K){const j=K[0],$=K[1];o.getActiveUniforms(f,w,o[j]).forEach(function(ot,ct){u[ct][$]=ot})});const C={},M=o.getProgramParameter(f,us);for(let K=0;K<M;++K){const j=o.getActiveUniformBlockName(f,K),$={index:o.getUniformBlockIndex(f,j),usedByVertexShader:o.getActiveUniformBlockParameter(f,K,la),usedByFragmentShader:o.getActiveUniformBlockParameter(f,K,Oi),size:o.getActiveUniformBlockParameter(f,K,ha),uniformIndices:o.getActiveUniformBlockParameter(f,K,Ar)};$.used=$.usedByVertexShader||$.usedByFragmentShader,C[j]=$}return{blockSpecs:C,uniformData:u}}(z,r),s.transformFeedbackInfo=function(o,f){const b={},u=o.getProgramParameter(f,oa);for(let w=0;w<u;++w){const C=o.getTransformFeedbackVarying(f,w);b[C.name]={index:w,type:C.type,size:C.size}}return b}(z,r)),s}const kr=/\s|{|}|;/;function Nn(z,r,s,o,f){const b=jx(s,o,f),u=[];if(r=r.map(function(M){if(!kr.test(M)){const K=mi(M);if(K)M=K.text;else{const j="no element with id: "+M;b.errorCallback(j),u.push(j)}}return M}),u.length)return function(M,K){return M.errorCallback(K),M.callback&&setTimeout(()=>{M.callback(K+`
`+M.errors.join(`
`))}),null}(b,"");const w=b.callback;w&&(b.callback=(M,K)=>{w(M,M?void 0:Ri(z,K))});const C=function(M,K,j,$,ot){return Dr(M,K,j,$,ot)}(z,r,b);return C?Ri(z,C):null}const dr=36161,Fn=36064,Di=36096,Mr=33306,an=33071,fr=9729,on=[{format:6408,type:5121,min:fr,wrap:an},{format:34041}],oi={};oi[34041]=Mr,oi[6401]=36128,oi[36168]=36128,oi[6402]=Di,oi[33189]=Di,oi[33190]=Di,oi[36012]=Di,oi[35056]=Mr,oi[36013]=Mr;const Gs={32854:!0,32855:!0,36194:!0,34041:!0,33189:!0,6401:!0,36168:!0};function Vs(z,r,s,o){const b=z.createFramebuffer();z.bindFramebuffer(36160,b),s=s||z.drawingBufferWidth,o=o||z.drawingBufferHeight;const u=[],w={framebuffer:b,attachments:[],width:s,height:o};return(r=r||on).forEach(function(C,M){let K=C.attachment;const j=C.samples,$=C.format;let ot=C.attachmentPoint||function(wt,Ct){return oi[wt]||oi[Ct]}($,C.internalFormat);if(ot||(ot=Fn+M),function(wt){return wt>=Fn&&wt<36096}(ot)&&u.push(ot),!K)if(j!==void 0||function(wt){return Gs[wt]}($))K=z.createRenderbuffer(),z.bindRenderbuffer(dr,K),j>1?z.renderbufferStorageMultisample(dr,j,$,s,o):z.renderbufferStorage(dr,$,s,o);else{const wt=Object.assign({},C);wt.width=s,wt.height=o,wt.auto===void 0&&(wt.auto=!1,wt.min=wt.min||wt.minMag||fr,wt.mag=wt.mag||wt.minMag||fr,wt.wrapS=wt.wrapS||wt.wrap||an,wt.wrapT=wt.wrapT||wt.wrap||an),K=or(z,wt)}if(ct=K,typeof WebGLRenderbuffer<"u"&&Pe(ct,"WebGLRenderbuffer"))z.framebufferRenderbuffer(36160,ot,dr,K);else{if(!It(0,K))throw new Error("unknown attachment type");C.layer!==void 0?z.framebufferTextureLayer(36160,ot,K,C.level||0,C.layer):z.framebufferTexture2D(36160,ot,C.target||3553,K,C.level||0)}var ct;w.attachments.push(K)}),z.drawBuffers&&z.drawBuffers(u),w}const ua=/^(.*?)_/;function n(z,r){H0(z,0);const s=z.getExtension(r);if(s){const o={},f=ua.exec(r)[1],b="_"+f;for(const u in s){const w=s[u],C=typeof w=="function",M=C?f:b;let K=u;u.endsWith(M)&&(K=u.substring(0,u.length-M.length)),z[K]!==void 0?C||z[K]===w||se(K,z[K],w,u):C?z[K]=function(j){return function(){return j.apply(s,arguments)}}(w):(z[K]=w,o[K]=w)}o.constructor={name:s.constructor.name},H0(o,0)}return s}const d=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];var k=t(838),it=t(824),Ot=t(96),Bt=t(923),ce=t(576),jt=t(1);class Ie{constructor(r,s=!0){this._buffer=r,this.littleEndian=s,this._view=new DataView(r),this._offset=0}get offset(){return this._offset}get buffer(){return this._buffer}get dataView(){return this._view}reset(){this._offset=0}seek(r){this._offset=r}skip(r){this._offset+=r}readUint8(){const r=this._view.getUint8(this._offset);return this._offset+=1,r}readUint16(){const r=this._view.getUint16(this._offset,this.littleEndian);return this._offset+=2,r}readUint32(){const r=this._view.getUint32(this._offset,this.littleEndian);return this._offset+=4,r}readInt8(){const r=this._view.getInt8(this._offset);return this._offset+=1,r}readInt16(){const r=this._view.getInt16(this._offset,this.littleEndian);return this._offset+=2,r}readInt32(){const r=this._view.getInt32(this._offset,this.littleEndian);return this._offset+=4,r}readFloat32(){const r=this._view.getFloat32(this._offset,this.littleEndian);return this._offset+=4,r}readFloat64(){const r=this._view.getFloat64(this._offset,this.littleEndian);return this._offset+=8,r}readBuffer(r){const s=this._buffer.slice(this._offset,this._offset+r);return this._offset+=r,s}readString(r){return String.fromCharCode.apply(null,new Uint8Array(this.readBuffer(r)))}}var qe=t(589),s0=t(149),g0=function(z,r,s,o){return new(s||(s=Promise))(function(f,b){function u(M){try{C(o.next(M))}catch(K){b(K)}}function w(M){try{C(o.throw(M))}catch(K){b(K)}}function C(M){var K;M.done?f(M.value):(K=M.value,K instanceof s?K:new s(function(j){j(K)})).then(u,w)}C((o=o.apply(z,r||[])).next())})};class S0 extends qe.r{constructor(r,s){super(s),this.options={},this.options=(0,jt.Ov)(this.options,s),this.gridOptions=this.options.gridOptions,this.load(r)}load(r){this.grids.push([new it.K(this.gridOptions.xSize,this.gridOptions.ySize,r,this.options.undef,this.options.autoLoadToMemory,this.options.algo,this.options.scale,this.options.offset,this.options.dataType)])}static loadVideo(r){return g0(this,void 0,void 0,function*(){return new Promise((s,o)=>{const f=document.createElement("video");f.autoplay=!0,f.loop=!1,f.crossOrigin="anonymous",f.muted=!0,f.setAttribute("playsinline",""),f.setAttribute("webkit-playsinline",""),f.oncanplay=b=>{f.play().then(u=>{s(f)},u=>{o(u)}).catch(Bt.kg.debug)},f.addEventListener("error",b=>{Bt.kg.debug(f.error),o(b)}),f.src=r})})}static loadImage(r){return g0(this,void 0,void 0,function*(){return new Promise((s,o)=>{const f=new Image;f.crossOrigin="anonymous",f.onload=b=>{s(f)},f.onerror=b=>{o(b)},f.src=r})})}static extractHeaderFromBuffer(r){const s=new Ie(r),o=s.readFloat32(),f=s.readFloat32(),b=s.readFloat32(),u=s.readFloat32(),w=s.readFloat32(),C=s.readFloat32(),M=s.readFloat32(),K=s.readFloat32(),j={gridOptions:{xStart:f,yStart:o,xSize:C,ySize:w,xDelta:u,yDelta:b,tCount:1,zValues:[0]},dataType:s.readUint8()===0?Ot.U.UInt8:Ot.U.UInt16,scale:M,offset:K,algo:M===1&&K===0?0:1,undef:s.readFloat32()};return(0,ce.T)(j.gridOptions),{options:j,data:s.readBuffer(r.byteLength-s.offset+1)}}static decodeWebp(r){return g0(this,void 0,void 0,function*(){return new Promise((s,o)=>g0(this,void 0,void 0,function*(){try{const f=performance.now();window.wasm_webp({onRuntimeInitialized(){}}).then(b=>{const u=new Uint8Array(r),w=b.decode(u,u.length,!0);b.free(),s(w),Bt.kg.debug("decode webp cost "+(performance.now()-f)+"ms")})}catch(f){Bt.kg.error(f),s(void 0)}}))})}static fromBuffer(r,s,o){return g0(this,void 0,void 0,function*(){if(o.withHeader){const u=this.extractHeaderFromBuffer(r);o.gridOptions&&(u.options.gridOptions=Object.assign(Object.assign({},u.options.gridOptions),o.gridOptions)),o=(0,jt.Ov)({},o,u.options),r=u.data,delete o.withHeader}if(o.compatibleOldDevice&&!(yield(0,s0.sU)())){if(Bt.kg.debug("原生不支持webp的设备，动态转换格式"),typeof window.wasm_webp!="function")try{yield(0,jt.ve)(k.v.resourcePath+"/libs/webp/wasm_webp.min.js","dynamic_script_webp","wasm_webp")}catch(u){Bt.kg.error("加载webp_wasm失败！"),Bt.kg.error(u)}if(typeof window.wasm_webp=="function"){let u=yield S0.decodeWebp(r);if(u){const w=Object.assign({},o.gridOptions);if(w.xSize>1024||w.ySize>1024){let K,j;w.xSize>w.ySize?(K=1014,j=parseInt(K*(1*w.ySize/w.xSize))):(j=1014,K=parseInt(j*(1*w.xSize/w.ySize)));const $=Math.max(parseInt(w.xSize/K),1),ot=Math.max(parseInt(w.ySize/j),1);w.xDelta=w.xDelta*$,w.yDelta=w.yDelta*ot;const ct=[];K=j=0;for(let wt=0;wt<w.ySize;wt+=ot){const Ct=wt*w.xSize;j++,K=0;for(let qt=0;qt<w.xSize;qt+=$){const kt=4*(Ct+qt);ct.push(u[kt],u[kt+1],u[kt+2],u[kt+3]),K++}}w.xSize=K,w.ySize=j,w.xEnd=w.yEnd=void 0,(0,ce.T)(w),o.gridOptions=w,u=new Uint8Array(ct)}const C=document.createElement("canvas");C.width=o.gridOptions.xSize,C.height=o.gridOptions.ySize;const M=new ImageData(new Uint8ClampedArray(u),C.width,C.height);return C.getContext("2d").putImageData(M,0,0),new S0(C,o)}}}else(0,s0.sU)()||Bt.kg.warn("当前系统版本低于IOS14，且设置了不兼容旧版，可能造成数据无法渲染，您可以反馈给您的程序提供商！");const f=new Blob([r]),b=URL.createObjectURL(f);return S0.fromURL(b,s,o)})}static fromURL(r,s,o){return g0(this,void 0,void 0,function*(){if(o.withHeader){const b=yield(yield fetch(r)).arrayBuffer();return S0.fromBuffer(b,s,o)}let f=this.loadImage;return s&&(f=this.loadVideo),f(r).then(b=>new S0(b,o)).catch(b=>{})})}}function wx(z){return(z=z.replace(/\/\/.*/g,"")).replace(/\/\*\*[\s\S]*?\*\//gm,function(r){for(var s=r.match(/\n/gm).length,o="",f=0;f<s;++f)o+=`
`;return o})}function p0(z,r,s){for(var o,f=0;f<s.length;++f)s[f].name===z&&(o=s[f]);return(0,jt.ri)(o)||(o={name:z,glslSource:r=wx(r),dependsOn:[],requiredBy:[],evaluated:!1},s.push(o)),o}function Gx(z,r,s){if(!z.evaluated){z.evaluated=!0;var o=z.glslSource.match(/\bqe_[a-zA-Z0-9_]*/g);(0,jt.ri)(o)&&o!==null&&(o=o.filter(function(f,b){return o.indexOf(f)===b})).forEach(function(f){if(f!==z.name&&s.hasOwnProperty(f)){var b=p0(f,s[f],r);z.dependsOn.push(b),b.requiredBy.push(z),Gx(b,r,s)}})}}function zx(z,r="main"){wx(z);var s=[],o=p0(r,z,s);Gx(o,s,G0),function(u){for(var w=[],C=[];u.length>0;){var M=u.pop();C.push(M),M.requiredBy.length===0&&w.push(M)}for(;w.length>0;){var K=w.shift();u.push(K);for(var j=0;j<K.dependsOn.length;++j){var $=K.dependsOn[j],ot=$.requiredBy.indexOf(K);$.requiredBy.splice(ot,1),$.requiredBy.length===0&&w.push($)}}for(var ct=[],wt=0;wt<C.length;++wt)C[wt].requiredBy.length!==0&&ct.push(C[wt]);if(ct.length!==0){for(var Ct=`A circular dependency was found in the following built-in functions/structs/constants: 
`,qt=0;qt<ct.length;++qt)Ct=Ct+ct[qt].name+`
`;throw new Error(Ct)}}(s);for(var f="",b=s.length-1;b>=0;--b)f=f+s[b].glslSource+`
`;return f.replace(o.glslSource,"")}function xr(z,r="$inject"){let s=z;if(z.indexOf("qe_")>=0){const o=zx(z,"main");s=z.indexOf(r)>=0?z.replace(r,o):z.replace(/void\s+main\s*\(\s*\)\s*{/gm,function(f,b){return o+`
`+f})}else s=z.replace(r,"");return s}function Ws(z,r=!1){let s="";switch(z.dataType===Ot.U.UInt8?s+="const float baseScaleH=255.;":s+="const float baseScaleH=1.;",s+=r?`
        const float undefH=`+C0(z.undef===void 0?k.v.defaultUndef:z.undef)+`;
        `:"uniform float undefH;",z.algo){case void 0:case null:case 0:case 1:case 2:s+=`
                uniform float dataOffsetH;
                uniform float dataScaleH;
                uniform mediump int dataAlgoH;
            `;break;default:Bt.kg.error("不能识别的算法类型！",!0)}return z instanceof it.K&&(z.dataType===Ot.U.UInt8?s+=`
            #define IMAGE_SOURCE_H
            `:z.dataType===Ot.U.Float32?s+=`
            #define IMAGE_SOURCE_FLOAT_H
            `:s+=`
            #define IMAGE_SOURCE_USHORT_H
            `),s}function qs(z,r=!1,s=!0){let o="";switch(z.dataType===Ot.U.UInt8?o+="const float baseScale=255.;":o+="const float baseScale=1.;",r&&(o+=`
        const float undef=`+C0(z.undef===void 0?k.v.defaultUndef:z.undef)+`;
        `),z.algo){case void 0:case null:case 0:case 1:case 2:o+=`
                uniform float dataOffset;
                uniform float dataScale;
                uniform float dataAlgo;
            `;break;default:Bt.kg.error("不能识别的算法类型！",!0)}return z instanceof it.K&&s&&(z.dataType===Ot.U.UInt8?o+=`
            #define IMAGE_SOURCE
            `:z.dataType===Ot.U.Float32?o+=`
            #define IMAGE_SOURCE_FLOAT
            `:o+=`
            #define IMAGE_SOURCE_USHORT
            `),o}function Zs(z,r={}){const s=(0,jt.En)(z.undef,999999);r.undef=s;let o=z.algo;switch((o==null||isNaN(o))&&(o=0),o=parseInt(o.toString()),o){case 0:case 1:case 2:r.dataOffset=z.dataOffset,r.dataScale=z.dataScale,r.dataAlgo=o}return r}function Dx(z,r={}){const s=(0,jt.En)(z.undef,999999);r.undefH=()=>s;let o=z.algo;switch((o==null||isNaN(o))&&(o=0),o=parseInt(o.toString()),o){case 0:case 1:case 2:r.dataOffsetH=()=>z.dataOffset,r.dataScaleH=()=>z.dataScale,r.dataAlgoH=()=>o}return r}function Bx(z,r={}){const s=(0,jt.En)(z.undef,999999);r.undef=()=>s;let o=z.algo;switch((o==null||isNaN(o))&&(o=0),o=parseInt(o.toString()),o){case 0:case 1:case 2:r.dataOffset=()=>z.dataOffset,r.dataScale=()=>z.dataScale,r.dataAlgo=()=>o}return r}function ln(){return`
    uniform float currentHeight;
    uniform float preHeight;
    uniform sampler2D heightTexture;
    uniform float zScale;
    uniform float extrudeScale;
    uniform float extrudeOffset;
    uniform bool noHeight;
    `}function C0(z){return(z=z.toString&&z.toString()).indexOf(".")<0?z+".":z}function cr(){return`
    const vec4 bitEnc = vec4(1.,255.,65025.,16581375.);
    const vec4 bitDec = 1./bitEnc;
    `}function cs(z,r){return z===Ot.U.UInt8?new Uint8Array(Uint8Array.BYTES_PER_ELEMENT*r):new Float32Array(Float32Array.BYTES_PER_ELEMENT*r)}S0.qeName="g_gray";let K0={attrIn:"in",varIn:"in",varOut:"out",outColorDefine:"out vec4 qe_FragColor;",outColorName:"qe_FragColor",textureFunc:"texture",header:"#version 300 es"};function Js(){k.v.useWebGL2||(K0={attrIn:"attribute",varIn:"varying",varOut:"varying",outColorDefine:"",outColorName:"gl_FragColor",textureFunc:"texture2D",header:""})}function Gn(z,r=3,s=4096){if(z.gridOptions.xSize>s||z.gridOptions.ySize>s){z.gridOptions=Object.assign({},z.gridOptions);const o=document.createElement("canvas"),f=z.getGrid().imageSource;o.width=f.width/r,o.height=f.height/r;const b={xStart:z.gridOptions.xStart,xEnd:z.gridOptions.xEnd,xSize:parseInt(z.gridOptions.xSize/r),yStart:z.gridOptions.yStart,yEnd:z.gridOptions.yEnd,ySize:parseInt(z.gridOptions.ySize/r)};return(0,ce.T)(b),o.getContext("2d").drawImage(f,0,0,f.width,f.height,0,0,o.width,o.height),new S0(o,Object.assign(Object.assign({},z.options),{gridOptions:b}))}return z}const G0={};function ps(z){for(const r in z)G0[r]&&Bt.kg.warn("shaderLib中已经存在该key："+r+`
 `+z[r]),G0[r]=z[r]}const Ue={qe_getGridOneDimPos:"qe_getGridOneDimPos",qe_getLonLatTexPos:"qe_getLonLatTexPos",qe_isUndef:"qe_isUndef",qe_readGrid2DRawVal:"qe_readGrid2DRawVal",qe_readHeight2DRawVal:"qe_readHeight2DRawVal",qe_readGrid3DRawVal:"qe_readGrid3DRawVal",qe_readGridValByUV:"qe_readGridValByUV",qe_readHeightValByUV:"qe_readHeightValByUV",qe_readGridVal3DByUV:"qe_readGridVal3DByUV",qe_interpGridValByUV:"qe_interpGridValByUV",qe_interpGridVal3DByUV:"qe_interpGridVal3DByUV",qe_geo2cartesian:"qe_geo2cartesian",qe_deg2cartesian:"qe_deg2cartesian",qe_deg2cartesianV2:"qe_deg2cartesianV2",qe_cartesian2deg:"qe_cartesian2deg",qe_getColor:"qe_getColor",qe_interpColor:"qe_interpColor",qe_getColorByScale:"qe_getColorByScale",qe_getHeightByPreAndCurrent:"qe_getHeightByPreAndCurrent",qe_texture2DFloat:"qe_texture2DFloat",qe_idx2LonLat:"qe_idx2LonLat",qe_idx2LonLatTexPos:"qe_idx2LonLatTexPos",qe_rgba2float:"qe_rgba2float",qe_float2rgba:"qe_float2rgba",qe_maskout:"qe_maskout",qe_encodeFloat:"qe_encodeFloat",qe_geoDistance:"qe_geoDistance",qe_decodeFloat:"qe_decodeFloat"};let ca=!1;function pa(){ca||(G0[Ue.qe_texture2DFloat]=`
    float qe_texture2DFloat(sampler2D tex,vec2 uv){
        return `+(k.v.useWebGL2?"texture2D(tex,uv).r":"texture2D(tex,uv).w")+`;
    }
`,G0[Ue.qe_rgba2float]=`
    float qe_rgba2float (vec4 v) {
        return dot(v, bitDec);
    }
`,G0[Ue.qe_float2rgba]=`
    vec4 qe_float2rgba(float v){
        vec4 enc = bitEnc * v;
        enc = fract(enc);
        enc -= enc.yzww * vec2(1./255., 0.).xxxy;
        return enc;
    }
    
`,G0[Ue.qe_decodeFloat]=`
    
    ivec4 decodeFloat_floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
          littleEndian
          ? bytes.abgr
          : bytes
        );
      }
      
      // Break the four bytes down into an array of 32 bits.
      void decodeFloat_bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
          float acc = float(bytes[channelIndex]);
          for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
            float powerOfTwo = exp2(float(indexInByte));
            bool bit = acc >= powerOfTwo;
            bits[channelIndex * 8 + (7 - indexInByte)] = bit;
            acc = mod(acc, powerOfTwo);
          }
        }
      }
      
      // Compute the exponent of the 32-bit float.
      float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
          acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
      }
      
      // Compute the mantissa of the 32-bit float.
      float decodeFloat_getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
          acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
      }
      
      // Parse the float from its 32 bits.
      float decodeFloat_bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = decodeFloat_getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
      }
      
      // Decode a 32-bit float from the RGBA color channels of a texel.
      float qe_decodeFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = decodeFloat_floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        decodeFloat_bytesToBits(rgbaBytes, bits);
        return decodeFloat_bitsToFloat(bits);
      }

    `,function(){const z=C0(6378137),r=57.29577951308232;G0[Ue.qe_geoDistance]=`
    float qe_geoDistance(vec2 pt1,vec2 pt2){
        return `+C0(z)+`*acos(cos(pt1.y)*cos(pt2.y)*cos(pt1.x-pt2.x)+sin(pt1.y)*sin(pt2.y));
    }

    `,G0[Ue.qe_geo2cartesian]=`
    vec3 `+Ue.qe_geo2cartesian+`(vec3 geo){
        float cosLat=cos(geo.y);
        float snX=cosLat*cos(geo.x);
        float snY=cosLat*sin(geo.x);
        float snZ=sin(geo.y);
        vec3 sn=normalize(vec3(snX,snY,snZ));
        vec3 radiiSquared=vec3(40680631.59076899*1000000.,40680631.59076899*1000000.,40408299.98466144*1000000.);
        vec3 sk=radiiSquared*sn;
        float gamma=sqrt(dot(sn,sk));
        sk=sk/gamma;
        sn=sn*geo.z;
        return sk+sn;
    }
`,G0[Ue.qe_deg2cartesian]=`
    vec3 `+Ue.qe_deg2cartesian+`(vec3 deg){
        vec2 radGeo=radians(deg.xy);
        vec3 geo=vec3(radGeo.xy,deg.z);
        return `+Ue.qe_geo2cartesian+`(geo);
    }
`,G0[Ue.qe_deg2cartesianV2]=`
    vec3 `+Ue.qe_deg2cartesianV2+`(vec3 pos){
        float g = `+z+` +pos.z;
        float e = radians(pos.y);
        float b =radians(pos.x);
        float a = cos(e);
        float x = cos(b)*a*g;
        float y = sin(b)*a*g;
        float z = sin(e)*g;
        return vec3(x,y,z);
    }
`,G0[Ue.qe_cartesian2deg]=`
    vec3 `+Ue.qe_cartesian2deg+`(vec3 pos,bool global)
    {
        if(global){
            float z = length(pos);
            float h = z - `+z+`;
            float latRad = asin(pos.z/z);
            float lat = latRad * `+r+`;
            float lon = 0.;
            if(pos.y>0.){
                lon = acos(pos.x/(cos(latRad)*z)) * `+r+`;
            }else{
                lon = -acos(pos.x/(cos(latRad)*z)) * `+r+`;
            }
            return vec3(lon,lat,h); 
        }else{
            float lon=degrees(pos.x/`+z+`);
            float lat=degrees(3.141592653589793/2.-2.*atan(exp(-1.*pos.y/`+z+`)));
            return vec3(lon,lat,pos.z);
        }

    }
`}(),function(){G0[Ue.qe_getGridOneDimPos]=`
    float `+Ue.qe_getGridOneDimPos+`(float pos,vec4 attr){
        return (pos-attr.x)/(attr.y-attr.x+attr.z);
    }
`,G0[Ue.qe_getLonLatTexPos]=`
    vec2 `+Ue.qe_getLonLatTexPos+`(vec2 pos,vec4 xAttr,vec4 yAttr){
        float xPos=`+Ue.qe_getGridOneDimPos+`(pos.x,xAttr);
        float yPos=`+Ue.qe_getGridOneDimPos+`(pos.y,yAttr);
        return vec2(xPos,yPos);
    }
`,G0[Ue.qe_isUndef]=`
    bool `+Ue.qe_isUndef+`(float val,float undef){
        if(undef<=0.){
            return val<=undef;
        }
        return val>=undef;
    }
`;let z=`
    #ifdef IMAGE_SOURCE
        val=texture2D(grid,uv).r*baseScale;
    #elif defined(IMAGE_SOURCE_FLOAT)
        val=`+Ue.qe_decodeFloat+`(texture2D(grid,uv),true);
    #elif defined(IMAGE_SOURCE_USHORT)
        vec4 r_c=texture2D(grid,uv);
        val=r_c.r*255.*255.+r_c.g*255.;
    #else
        val=texture2D(grid,uv).w*baseScale;
    #endif
    `;k.v.useWebGL2&&(z=`
    if(baseScale!=1.){
        //uint8
        #ifdef IMAGE_SOURCE
            val=texture(grid,uv).r*baseScale;
        #else
            val=texture(grid,uv).w*baseScale;
        #endif
    }else{
        #ifdef IMAGE_SOURCE_FLOAT
            val=`+Ue.qe_decodeFloat+`(texture(grid,uv),true);   
        #elif defined(IMAGE_SOURCE_USHORT) 
            vec4 r_c=texture(grid,uv);
            val=r_c.r*255.*255.+r_c.g*255.;
        #else
            val=texture(grid,uv).r;
        #endif
    }
    `);let r=`
    #ifdef IMAGE_SOURCE_H
        val=texture2D(grid,uv).r*baseScaleH;
    #elif defined(IMAGE_SOURCE_FLOAT_H)
        val=`+Ue.qe_decodeFloat+`(texture2D(grid,uv),true);
    #elif defined(IMAGE_SOURCE_USHORT_H)
        vec4 r_c=texture2D(grid,uv);
        val=r_c.r*255.*255.+r_c.g*255.;
    #else
        val=texture2D(grid,uv).w*baseScaleH;
    #endif
    `;k.v.useWebGL2&&(r=`
    if(baseScaleH!=1.){
        //uint8
        #ifdef IMAGE_SOURCE_H
            val=texture(grid,uv).r*baseScaleH;
        #else
            val=texture(grid,uv).w*baseScaleH;
        #endif
    }else{
        #ifdef IMAGE_SOURCE_FLOAT_H
            val=`+Ue.qe_decodeFloat+`(texture(grid,uv),true);   
        #elif defined(IMAGE_SOURCE_USHORT_H) 
            vec4 r_c=texture(grid,uv);
            val=r_c.r*255.*255.+r_c.g*255.;
        #else
            val=texture(grid,uv).r;
        #endif
    }
    `);let s=`
    #ifdef IMAGE_SOURCE
        val=texture2D(grid,p).r*baseScale;
    #elif defined(IMAGE_SOURCE_FLOAT)
        val=`+Ue.qe_decodeFloat+`(texture2D(grid,p),true);
    #elif defined(IMAGE_SOURCE_USHORT)
        vec4 r_c=texture2D(grid,p);
        val=r_c.r*255.*255.+r_c.g*255.;
    #else
        val=texture2D(grid,p).w*baseScale;
    #endif
    
    `;k.v.useWebGL2&&(s=`
    if(baseScale!=1.){
        //uint8
        #ifdef IMAGE_SOURCE
            val=texture(grid,p).r*baseScale;
        #else
            val=texture(grid,p).w*baseScale;
        #endif
    }else{
        #ifdef IMAGE_SOURCE_FLOAT
            val=`+Ue.qe_decodeFloat+`(texture(grid,p),true);   
        #elif defined(IMAGE_SOURCE_USHORT) 
            vec4 r_c=texture(grid,p);
            val=r_c.r*255.*255.+r_c.g*255.;
        #else
            val=texture(grid,p).r;
        #endif
    }
    `),G0[Ue.qe_readHeight2DRawVal]=`
    float `+Ue.qe_readHeight2DRawVal+`(sampler2D grid,vec2 uv,float undefH){
        float val;
        `+r+`
        if(`+Ue.qe_isUndef+`(val,undefH)){
            return undefH;
        }
        if(dataAlgoH==2){
            val = (val+dataOffsetH)*dataScaleH;
        }else{ //current 0 1
            val = val*dataScaleH+dataOffsetH;
        }
        return val;
    }
`,G0[Ue.qe_readHeightValByUV]=`

vec2 `+Ue.qe_readHeightValByUV+`(sampler2D grid,vec2 uv,vec4 xAttr,vec4 yAttr,float undefH,int interpMethod){
    float rawVal= `+Ue.qe_readHeight2DRawVal+`(grid,uv,undefH);
    if(interpMethod==0 || `+Ue.qe_isUndef+`(rawVal,undefH)){
        return vec2(rawVal);
    }
    vec2 dataSize=vec2(xAttr.w,yAttr.w);
    vec2 pos=uv*dataSize;
    vec2 prePos = floor(pos); //i,j p22
    vec2 nextPos = ceil(pos); //i+1,j+1 p33
    vec2 preUv = prePos /dataSize;
    vec2 nextUv = nextPos /dataSize;
    //weight
    vec2 weight = fract(pos);
    vec2 lbUv = preUv;
    vec2 ltUv = vec2(preUv.x,nextUv.y);
    vec2 rbUv = vec2(nextUv.x,preUv.y);
    vec2 rtUv = nextUv;
    float lbVal = `+Ue.qe_readHeight2DRawVal+`(grid,lbUv,undefH); //p(i,j) p22
    float ltVal = `+Ue.qe_readHeight2DRawVal+`(grid,ltUv,undefH); //p(i,j+1) p23
    float rbVal = `+Ue.qe_readHeight2DRawVal+`(grid,rbUv,undefH); //p(i+1,j) p32
    float rtVal = `+Ue.qe_readHeight2DRawVal+`(grid,rtUv,undefH); //p(i+1,j+1) p33
    if(`+Ue.qe_isUndef+"(lbVal,undefH) || "+Ue.qe_isUndef+"(ltVal,undefH) || "+Ue.qe_isUndef+"(rbVal,undefH) || "+Ue.qe_isUndef+`(rtVal,undefH)){
        return vec2(rawVal);
    }
    float upVal= ltVal * (1.-weight.x) + rtVal * weight.x;
    float downVal = lbVal * (1.-weight.x) + rbVal * weight.x;
    float interpVal= downVal * (1.-weight.y) + upVal * weight.y;
    return vec2(rawVal,interpVal);
}
`,G0[Ue.qe_readGrid2DRawVal]=`
    float `+Ue.qe_readGrid2DRawVal+`(sampler2D grid,vec2 uv,float undef){
        float val;
        `+z+`
        if(`+Ue.qe_isUndef+`(val,undef)){
            return undef;
        }
        if(dataAlgo==2.0){
            val = (val+dataOffset)*dataScale;
        }else{ //current 0 1
            val = val*dataScale+dataOffset;
        }
        return val;
    }
`,G0[Ue.qe_readGrid3DRawVal]=`
    float `+Ue.qe_readGrid3DRawVal+`(highp sampler3D grid,vec3 p,float undef){
        float val;
        `+s+`
        if(`+Ue.qe_isUndef+`(val,undef)){
            return undef;
        }
        if(dataAlgo==2.0){
            val = (val+dataOffset)*dataScale;
        }else{ //current 0 1
            val = val*dataScale+dataOffset;
        }
        return val;
    }
`,G0[Ue.qe_interpGridValByUV]=`
    vec2 `+Ue.qe_interpGridValByUV+`(sampler2D grid,vec2 uv,vec4 xAttr,vec4 yAttr,float undef,int interpMethod,sampler2D nextGrid,float percent){
        vec2 val=`+Ue.qe_readGridValByUV+`(grid,uv,xAttr,yAttr,undef,interpMethod);
        vec2 nextVal=`+Ue.qe_readGridValByUV+`(nextGrid,uv,xAttr,yAttr,undef,interpMethod);
        if(`+Ue.qe_isUndef+`(val.y,undef)){
            if(percent<=0.5){
                return val;
            }else{
                return nextVal;
            }
            // return val;
        }
        if(`+Ue.qe_isUndef+`(nextVal.y,undef)){
            if(percent>0.5){
                return nextVal;
            }else{
                return val;
            }
            // return val;
        }
        return mix(val,nextVal,percent);
    }
`,G0[Ue.qe_interpGridVal3DByUV]=`
    vec2 `+Ue.qe_interpGridVal3DByUV+`(highp sampler3D grid,vec3 p,vec4 xAttr,vec4 yAttr,vec3 zAttr,float undef,int interpMethod,highp sampler3D nextGrid,float percent){
        vec2 val=`+Ue.qe_readGridVal3DByUV+`(grid,p,xAttr,yAttr,zAttr,undef,interpMethod);
        vec2 nextVal=`+Ue.qe_readGridVal3DByUV+`(nextGrid,p,xAttr,yAttr,zAttr,undef,interpMethod);
        if(`+Ue.qe_isUndef+`(val.y,undef)){
            if(percent<=0.5){
                return val;
            }else{
                return nextVal;
            }
        }
        if(`+Ue.qe_isUndef+`(nextVal.y,undef)){
            if(percent>0.5){
                return nextVal;
            }else{
                return val;
            }
        }
        return mix(val,nextVal,percent);
    }
`,G0[Ue.qe_readGridValByUV]=`
    float cardinalSpline(vec4 colVal,vec4 uvec){
        return dot(uvec,cardinalSplineMat*colVal);
    }

    vec2 `+Ue.qe_readGridValByUV+`(sampler2D grid,vec2 uv,vec4 xAttr,vec4 yAttr,float undef,int interpMethod){
        float rawVal= `+Ue.qe_readGrid2DRawVal+`(grid,uv,undef);
        if(interpMethod==0 || `+Ue.qe_isUndef+`(rawVal,undef)){
            return vec2(rawVal);
        }
        vec2 dataSize=vec2(xAttr.w,yAttr.w);
        vec2 pos=uv*dataSize;
        vec2 prePos = floor(pos); //i,j p22
        vec2 nextPos = ceil(pos); //i+1,j+1 p33
        vec2 preUv = prePos /dataSize;
        vec2 nextUv = nextPos /dataSize;
        //weight
        vec2 weight = fract(pos);
        vec2 lbUv = preUv;
        vec2 ltUv = vec2(preUv.x,nextUv.y);
        vec2 rbUv = vec2(nextUv.x,preUv.y);
        vec2 rtUv = nextUv;
        float lbVal = `+Ue.qe_readGrid2DRawVal+`(grid,lbUv,undef); //p(i,j) p22
        float ltVal = `+Ue.qe_readGrid2DRawVal+`(grid,ltUv,undef); //p(i,j+1) p23
        float rbVal = `+Ue.qe_readGrid2DRawVal+`(grid,rbUv,undef); //p(i+1,j) p32
        float rtVal = `+Ue.qe_readGrid2DRawVal+`(grid,rtUv,undef); //p(i+1,j+1) p33
        if(`+Ue.qe_isUndef+"(lbVal,undef) || "+Ue.qe_isUndef+"(ltVal,undef) || "+Ue.qe_isUndef+"(rbVal,undef) || "+Ue.qe_isUndef+`(rtVal,undef)){
            return vec2(rawVal);
        }
        float upVal= ltVal * (1.-weight.x) + rtVal * weight.x;
        float downVal = lbVal * (1.-weight.x) + rbVal * weight.x;
        float interpVal= downVal * (1.-weight.y) + upVal * weight.y;
        if(interpMethod==1){
            return vec2(rawVal,interpVal);
        }
        vec4 xWeight=vec4(weight.x*weight.x*weight.x,weight.x*weight.x,weight.x,1.);
        vec4 yWeight=vec4(weight.y*weight.y*weight.y,weight.y*weight.y,weight.y,1.);
        //use Cardinal spline
        //col1->p(i-1,j-1)
        vec2 p11=prePos+vec2(-1.,-1.);
        vec2 uv11=p11/dataSize;
        float v11=`+Ue.qe_readGrid2DRawVal+`(grid,uv11,undef);
        if(`+Ue.qe_isUndef+`(v11,undef)){
            return vec2(rawVal);
        }
        //p(i-1,j)
        vec2 p12=prePos+vec2(-1.,0.);
        vec2 uv12=p12/dataSize;
        float v12=`+Ue.qe_readGrid2DRawVal+`(grid,uv12,undef);
        if(`+Ue.qe_isUndef+`(v12,undef)){
            return vec2(rawVal);
        }
        //p(i-1,j+1)
        vec2 p13=prePos+vec2(-1.,1.);
        vec2 uv13=p13/dataSize;
        float v13=`+Ue.qe_readGrid2DRawVal+`(grid,uv13,undef);
        if(`+Ue.qe_isUndef+`(v13,undef)){
            return vec2(rawVal);
        }
        //p(i-1,j+2)
        vec2 p14=prePos+vec2(-1.,2.);
        vec2 uv14=p14/dataSize;
        float v14=`+Ue.qe_readGrid2DRawVal+`(grid,uv14,undef);
        if(`+Ue.qe_isUndef+`(v14,undef)){
            return vec2(rawVal);
        }
        float col1Val=cardinalSpline(vec4(v11,v12,v13,v14),yWeight);
        //col2->p(i,j-1)
        vec2 p21=prePos+vec2(0.,-1.);
        vec2 uv21=p21/dataSize;
        float v21=`+Ue.qe_readGrid2DRawVal+`(grid,uv21,undef);
        if(`+Ue.qe_isUndef+`(v21,undef)){
            return vec2(rawVal);
        }
        //p(i,j) p22 exist
        //p(i,j+1) p23 exist
        //p(i,j+2)
        vec2 p24=prePos+vec2(0.,2.);
        vec2 uv24=p24/dataSize;
        float v24=`+Ue.qe_readGrid2DRawVal+`(grid,uv24,undef);
        if(`+Ue.qe_isUndef+`(v24,undef)){
            return vec2(rawVal);
        }
        float col2Val=cardinalSpline(vec4(v21,lbVal,ltVal,v24),yWeight);

        //col3->p(i+1,j-1)
        vec2 p31=prePos+vec2(1.,-1.);
        vec2 uv31=p31/dataSize;
        float v31=`+Ue.qe_readGrid2DRawVal+`(grid,uv31,undef);
        if(`+Ue.qe_isUndef+`(v31,undef)){
            return vec2(rawVal);
        }
        //p(i+1,j) p32 exist
        //p(i+1,j+1) p33 exist
        //p(i+1,j+2)
        vec2 p34=prePos+vec2(1.,2.);
        vec2 uv34=p34/dataSize;
        float v34=`+Ue.qe_readGrid2DRawVal+`(grid,uv34,undef);
        if(`+Ue.qe_isUndef+`(v34,undef)){
            return vec2(rawVal);
        }
        float col3Val=cardinalSpline(vec4(v31,rbVal,rtVal,v34),yWeight);

        //col4->p(i+2,j-1)
        vec2 p41=prePos+vec2(2.,-1.);
        vec2 uv41=p41/dataSize;
        float v41=`+Ue.qe_readGrid2DRawVal+`(grid,uv41,undef);
        if(`+Ue.qe_isUndef+`(v41,undef)){
            return vec2(rawVal);
        }
        //p(i+2,j)
        vec2 p42=prePos+vec2(2.,0.);
        vec2 uv42=p42/dataSize;
        float v42=`+Ue.qe_readGrid2DRawVal+`(grid,uv42,undef);
        if(`+Ue.qe_isUndef+`(v42,undef)){
            return vec2(rawVal);
        }
        //p(i+2,j+1)
        vec2 p43=prePos+vec2(2.,1.);
        vec2 uv43=p43/dataSize;
        float v43=`+Ue.qe_readGrid2DRawVal+`(grid,uv43,undef);
        if(`+Ue.qe_isUndef+`(v43,undef)){
            return vec2(rawVal);
        }
        //p(i+2,j+2)
        vec2 p44=prePos+vec2(2.,2.);
        vec2 uv44=p44/dataSize;
        float v44=`+Ue.qe_readGrid2DRawVal+`(grid,uv44,undef);
        if(`+Ue.qe_isUndef+`(v44,undef)){
            return vec2(rawVal);
        }
        float col4Val=cardinalSpline(vec4(v41,v42,v43,v44),yWeight);
        //calc row val
        interpVal=cardinalSpline(vec4(col1Val,col2Val,col3Val,col4Val),xWeight);
        return vec2(rawVal,interpVal);
    }
`,G0[Ue.qe_readGridVal3DByUV]=`

    float readPlaneGridVal(highp sampler3D grid,vec2 preUv,vec2 nextUv,float z,vec2 weight,float undef){
        vec3 lbUv = vec3(preUv,z);
        vec3 ltUv = vec3(preUv.x,nextUv.y,z);
        vec3 rbUv = vec3(nextUv.x,preUv.y,z);
        vec3 rtUv = vec3(nextUv,z);
        float lbVal = `+Ue.qe_readGrid3DRawVal+`(grid,lbUv,undef);
        float ltVal = `+Ue.qe_readGrid3DRawVal+`(grid,ltUv,undef);
        float rbVal = `+Ue.qe_readGrid3DRawVal+`(grid,rbUv,undef);
        float rtVal = `+Ue.qe_readGrid3DRawVal+`(grid,rtUv,undef);
        if(`+Ue.qe_isUndef+"(lbVal,undef) || "+Ue.qe_isUndef+"(ltVal,undef) ||"+Ue.qe_isUndef+"(rbVal,undef) ||"+Ue.qe_isUndef+`(rtVal,undef)){
            return undef;
        }
        float upVal= ltVal * (1.-weight.x) + rtVal * weight.x;
        float downVal = lbVal * (1.-weight.x) + rbVal * weight.x;
        float interpVal= downVal * (1.-weight.y) + upVal * weight.y;
        return interpVal;
    }

    vec2 `+Ue.qe_readGridVal3DByUV+`(highp sampler3D grid,vec3 uv,vec4 xAttr,vec4 yAttr,vec3 zAttr,float undef,int interpMethod){
        float rawVal= `+Ue.qe_readGrid3DRawVal+`(grid,uv,undef);
        if(interpMethod==0 || `+Ue.qe_isUndef+`(rawVal,undef)){
            return vec2(rawVal);
        }
        vec3 dataSize=vec3(xAttr.w,yAttr.w,zAttr.z);
        vec3 pos=uv*dataSize;
        vec3 prePos = floor(pos); //i,j p22
        vec3 nextPos = ceil(pos); //i+1,j+1 p33
        vec3 preUv = prePos /dataSize;
        vec3 nextUv = nextPos /dataSize;
        //weight
        vec3 weight = fract(pos);
        float downVal=readPlaneGridVal(grid,preUv.xy,nextUv.xy,preUv.z,weight.xy,undef);
        if(`+Ue.qe_isUndef+`(downVal,undef)){
            return vec2(rawVal,rawVal);
        }
        float upVal=readPlaneGridVal(grid,preUv.xy,nextUv.xy,nextUv.z,weight.xy,undef);
        if(`+Ue.qe_isUndef+`(upVal,undef)){
            return vec2(rawVal,rawVal);
        }
        return vec2(rawVal,mix(downVal,upVal,weight.z));
    }
`,G0[Ue.qe_getColor]=`
    vec4 qe_getColor(float val){
        if(`+Ue.qe_isUndef+`(val,undef)){
            return vec4(0.);
        }
        vec4 col;
        for(int i=0;i<stepCount;i++){
            col=colors[i];
            if(val<=steps[i]){
                break;
            }
        }
        return col;
    }
`,G0[Ue.qe_interpColor]=`
    vec4 qe_interpColor(float val){
        if(`+Ue.qe_isUndef+`(val,undef)){
            return vec4(0.);
        }
        float weight=0.;
        vec4 col;
        for(int i=0;i<stepCount;i++){
            col=colors[i];
            if(val<=steps[i]){
                if(i==0||(i==stepCount-1)){
                    break;
                }
                weight=(val-steps[i-1])/(steps[i]-steps[i-1]);
                vec4 colorPre=colors[i-1];
                vec4 colorCur=colors[i];
                col = mix(colorPre,colorCur,weight);
                break;
            }
        }
        return col;
    }
`,G0[Ue.qe_getHeightByPreAndCurrent]=`
    float qe_getHeightByPreAndCurrent(vec2 uv,bool useTexture,float percent){
        float height=0.;
        // if(useTexture){
        //     height=`+Ue.qe_texture2DFloat+`(heightTexture,uv);
        // }
        height=height+mix(preHeight,currentHeight,percent);
        return height*zScale;
    }
`,G0[Ue.qe_idx2LonLat]=`
    vec2 qe_idx2LonLat(float idx,vec4 xAttr,vec4 yAttr){
        float rowIdx=floor(idx/xAttr.w);
        float colIdx=mod(idx,xAttr.w);
        float lon=xAttr.x+colIdx*xAttr.z;
        float lat=yAttr.x+rowIdx*yAttr.z;
        return vec2(lon,lat);
    }
`,G0[Ue.qe_idx2LonLatTexPos]=`
    vec2 qe_idx2LonLatTexPos(float idx,float xSize,float ySize){
        float pos1d=idx / xSize;
        return vec2(
            fract(pos1d),
            floor(pos1d)/ySize
        );
    }
`,G0[Ue.qe_maskout]=`
    bool qe_maskout(vec2 reso,sampler2D maskTexture){
        vec2 sUv=gl_FragCoord.xy/reso;
        vec4 maskInfo=`+K0.textureFunc+`(maskTexture,vec2(sUv.x,sUv.y));
        if(maskInfo.a<0.1){
            return false;
        }
        return true;
    }

    `,G0[Ue.qe_encodeFloat]=`
    float encodeFloat_shift_right (float v, float amt) { 
        v = floor(v) + 0.5; 
        return floor(v / exp2(amt)); 
    }
    float encodeFloat_shift_left (float v, float amt) { 
        return floor(v * exp2(amt) + 0.5); 
    }
    float encodeFloat_mask_last (float v, float bits) { 
        return mod(v, encodeFloat_shift_left(1.0, bits)); 
    }
    float encodeFloat_extract_bits (float num, float from, float to) { 
        from = floor(from + 0.5); to = floor(to + 0.5); 
        return encodeFloat_mask_last(encodeFloat_shift_right(num, from), to - from); 
    }
    vec4 qe_encodeFloat (float val) { 
        if (val == 0.0) return vec4(0, 0, 0, 0); 
        float sign = val > 0.0 ? 0.0 : 1.0; 
        val = abs(val); 
        float exponent = floor(log2(val)); 
        float biased_exponent = exponent + 127.0; 
        float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0; 
        float t = biased_exponent / 2.0; 
        float last_bit_of_biased_exponent = fract(t) * 2.0; 
        float remaining_bits_of_biased_exponent = floor(t); 
        float byte4 = encodeFloat_extract_bits(fraction, 0.0, 8.0) / 255.0; 
        float byte3 = encodeFloat_extract_bits(fraction, 8.0, 16.0) / 255.0; 
        float byte2 = (last_bit_of_biased_exponent * 128.0 + encodeFloat_extract_bits(fraction, 16.0, 23.0)) / 255.0; 
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
        return vec4(byte4, byte3, byte2, byte1); 
    }
    
    `,G0[Ue.qe_getColorByScale]=`
    vec4 qe_getColorByScale(float val){
        if(`+Ue.qe_isUndef+`(val,undef) || val<csMin){
            return vec4(0.);
        }
        float u=(val-csMin)/(csMax-csMin);
        vec2 uv=vec2(u,0.5);
        return `+K0.textureFunc+`(csTexture,uv);
    }

    `}(),ca=!0)}var zr=t(458);class Hs{constructor(){this.interpUniforms={}}init(r){if(this.destroyShaders(),this.options=(0,jt.Ov)({},r,Hs.DefaultOptions),!this.gl){const f=document.createElement("canvas");this.gl=k.v.useWebGL2?f.getContext("webgl2"):f.getContext("webgl"),function(b){for(let u=0;u<d.length;++u)n(b,d[u])}(this.gl)}this.gl.canvas.width=r.gridOptions.xSize,this.gl.canvas.height=r.gridOptions.ySize;const s=K0.header+`
            precision highp float;
            `+K0.attrIn+` vec2 position;
            `+K0.attrIn+` vec2 uv;

            `+K0.varOut+` vec2 vUv;

            void main(){
                vUv=uv;
                gl_Position=vec4(position,0.,1.);
            }
        `,o=K0.header+`
            precision highp sampler2D;
            precision highp float;

            const float dataOffset=0.;
            const float dataScale=1.;
            // const int maxCount=`+{}+`;
            const int maxRadius=`+parseInt(this.options.maxSearchGridSpan)+`;
            const float xi=`+C0(this.options.gridOptions.xDelta)+`;
            //todo:使用xAttr和yAttr结合位置进行球面距离计算
            const vec4 xAttr=vec4(`+C0(this.options.gridOptions.xStart)+","+C0(this.options.gridOptions.xEnd)+","+C0(this.options.gridOptions.xDelta)+","+C0(this.options.gridOptions.xSize)+`);
            const vec4 yAttr=vec4(`+C0(this.options.gridOptions.yStart)+","+C0(this.options.gridOptions.yEnd)+","+C0(this.options.gridOptions.yDelta)+","+C0(this.options.gridOptions.ySize)+`);
            const float uDelta=`+1/this.options.gridOptions.xSize+`;
            const float vDelta=`+1/this.options.gridOptions.ySize+`;
            const mediump int dataAlgo=0;
            const float baseScale=1.;
            uniform sampler2D staTexture;
            uniform float undef;
            
            `+K0.varIn+` vec2 vUv;

            `+K0.outColorDefine+`

            $inject

            //todo:改遍历方式，现在一次性遍历的上下所有y点，导致y方向占比过高
            float idw(vec2 uv){
                float wAll=0.; //所有的距离幂指数的累加
                float vAll=0.; //数据值乘以w的累加
                int ptCount=0;
                vec2 dataSize=vec2(xAttr.w,yAttr.w);
                vec2 pos=floor(uv*dataSize);
                vec2 center=vec2(xAttr.x+ uv.x*xAttr.w,yAttr.x+uv.y*yAttr.w);
                for(int i=0;i<maxRadius;i++){
                    float fi=float(i);
                    float lu=(pos.x-fi)/(dataSize.x); 
                    // float lu=uv.x-fi*uDelta;
                    if(lu<0.){
                        continue;
                    }
                    float ru=(pos.x+fi)/(dataSize.x);
                    // float ru=uv.x+fi*uDelta;
                    if(ru>1.){
                        continue;
                    }
                    float cLon=center.x+xAttr.z;
                    for(int j=0;j<maxRadius;j++){
                        float fj=float(j);
                        float upV=(pos.y-fj)/(dataSize.y); 
                        // float upV=uv.y-fj*vDelta;
                        if(upV<0.){
                            continue;
                        }
                        float downV=(pos.y+fj)/(dataSize.y);
                        // float downV=uv.y+fj*vDelta;
                        if(downV>1.){
                            continue;
                        }
                        float cLat=center.y+yAttr.z;
                        vec2 currentPos=vec2(cLon,cLat);
                        float h=`+Ue.qe_geoDistance+`(center,currentPos);
                        float w=1./pow(h,`+C0(this.options.p)+`);
                        //left side,up val
                        float lUpVal=`+Ue.qe_readGrid2DRawVal+`(staTexture,vec2(lu,upV),undef);
                        if(!`+Ue.qe_isUndef+`(lUpVal,undef)){
                            wAll=wAll+w;
                            vAll=vAll+w*lUpVal;
                            ptCount=ptCount+1;
                        }
                        float lDownVal=`+Ue.qe_readGrid2DRawVal+`(staTexture,vec2(lu,downV),undef);
                        if(!`+Ue.qe_isUndef+`(lDownVal,undef)){
                            wAll=wAll+w;
                            vAll=vAll+w*lDownVal;
                            ptCount=ptCount+1;
                        }
                        float rUpVal=`+Ue.qe_readGrid2DRawVal+`(staTexture,vec2(ru,upV),undef);
                        if(!`+Ue.qe_isUndef+`(rUpVal,undef)){
                            wAll=wAll+w;
                            vAll=vAll+w*rUpVal;
                            ptCount=ptCount+1;
                        }
                        float rDownVal=`+Ue.qe_readGrid2DRawVal+`(staTexture,vec2(ru,downV),undef);
                        if(!`+Ue.qe_isUndef+`(rDownVal,undef)){
                            wAll=wAll+w;
                            vAll=vAll+w*rDownVal;
                            ptCount=ptCount+1;
                            // if(ptCount>=`+{}+`){
                            //     return vAll/wAll;
                            // }
                        }
                    }
                }
                if(ptCount==0){
                    return undef;
                }else{
                    return vAll/wAll;
                }
            }

            void main(){
                vec2 uv=vec2(vUv.x,1.-vUv.y); //vec2(gl_FragCoord.xy);
                float val=`+Ue.qe_readGrid2DRawVal+`(staTexture,uv,undef);
                //if not undef,use exact value
                if(`+Ue.qe_isUndef+`(val,undef)){
                    val=idw(uv);
                }
                vec4 color=`+Ue.qe_encodeFloat+`(val);
                `+K0.outColorName+`=color;
            }

        `;return this.interpProgram=Nn(this.gl,[s,xr(o)]),this.interpBuffer=yx(this.gl,{position:{numComponents:2,data:[-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]},uv:{numComponents:2,data:[0,0,0,1,1,1,0,0,1,1,1,0]}}),this.interpFramebuffer=Vs(this.gl,[{width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight,src:new Uint8Array(this.gl.drawingBufferWidth*this.gl.drawingBufferHeight*4),format:this.gl.RGBA,type:this.gl.UNSIGNED_BYTE,wrap:this.gl.CLAMP_TO_EDGE,minMag:this.gl.NEAREST}]),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this}interpToProvider(r,s,o){const f=this.interp(r,s,o);return new zr.o([[f]],{gridOptions:this.options.gridOptions})}interp(r,s,o){(this.options.p<0||this.options.maxSearchGridSpan<=0)&&Bt.kg.error("p值不能小于0，maxSearchGridSpan需要大于0！"),Bt.kg.debug("begin interp");const f=performance.now();var b,u,w;this.gl.useProgram(this.interpProgram.program),b=this.gl,u=this.interpFramebuffer,w=w||36160,u?(b.bindFramebuffer(w,u.framebuffer),b.viewport(0,0,u.width,u.height)):(b.bindFramebuffer(w,null),b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight)),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT),function(j,$,ot){ot.vertexArrayObject?j.bindVertexArray(ot.vertexArrayObject):(function(ct,wt){for(const Ct in wt){const qt=ct[Ct];qt&&qt(wt[Ct])}}($.attribSetters||$,ot.attribs),ot.indices&&j.bindBuffer(34963,ot.indices))}(this.gl,this.interpProgram,this.interpBuffer),this.interpUniforms.staTexture=this.createStaTexture(r,s,o),this.interpUniforms.undef=s,er(this.interpProgram,this.interpUniforms),function(j,$,ot,ct,wt,Ct){ot=ot===void 0?4:ot;const qt=$.indices,kt=$.elementType,$t=ct===void 0?$.numElements:ct;wt=wt===void 0?0:wt,kt||qt?Ct!==void 0?j.drawElementsInstanced(ot,$t,kt===void 0?5123:$.elementType,wt,Ct):j.drawElements(ot,$t,kt===void 0?5123:$.elementType,wt):Ct!==void 0?j.drawArraysInstanced(ot,wt,$t,Ct):j.drawArrays(ot,wt,$t)}(this.gl,this.interpBuffer),this.gl.finish();const C=performance.now(),M=new Uint8Array(this.options.gridOptions.xSize*this.options.gridOptions.ySize*4);this.gl.readPixels(0,0,this.options.gridOptions.xSize,this.options.gridOptions.ySize,this.gl.RGBA,this.gl.UNSIGNED_BYTE,M);const K=new it.P(Ot.U.Float32,this.options.gridOptions.xSize,this.options.gridOptions.ySize,M.buffer,s);return Bt.kg.debug("read pixels costs "+(performance.now()-C)+"ms"),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),Bt.kg.debug("interp total costs "+(performance.now()-f)+"ms"),K}getGLDataInfo(r){const s=r.dataType!==Ot.U.UInt8&&this.gl instanceof WebGL2RenderingContext?this.gl.RED:this.gl.ALPHA;let o=r.dataType===Ot.U.UInt8?this.gl.UNSIGNED_BYTE:this.gl.FLOAT,f=s,b=r.dataType===Ot.U.UInt8||r.dataType===Ot.U.Float32?r.raw:new Float32Array(r.raw);return s===this.gl.RED&&(f=this.gl.R32F),{rawData:b,dataType:o,innerFormat:f,pixelFormat:s}}getValReplaceFunc(){return this.options.pointInSameGridStrategy==="first"?(r,s)=>r:this.options.pointInSameGridStrategy==="last"?(r,s)=>s:this.options.pointInSameGridStrategy==="max"?(r,s)=>Math.max(r,s):this.options.pointInSameGridStrategy==="min"?(r,s)=>Math.min(r,s):this.options.pointInSameGridStrategy==="negMinPosMax"?(r,s)=>r<0?Math.min(r,s):Math.max(r,s):(r,s)=>(r+s)/2}createStaTexture(r,s,o){var f;const b=performance.now(),u=new Float32Array(this.options.gridOptions.xSize*this.options.gridOptions.ySize);u.fill(s);const w=new it.P(Ot.U.Float32,this.options.gridOptions.xSize,this.options.gridOptions.ySize,u.buffer,s),C=r.getFeatures().features,M=this.getValReplaceFunc();for(const $ of C){const ot=$.geometry.coordinates;if(!(0,jt.ri)($.properties[o]))continue;const ct=(0,jt.tr)(this.options.gridOptions.xStart,this.options.gridOptions.xDelta,ot[0]);if(ct<0||ct>=this.options.gridOptions.xSize)continue;const wt=(0,jt.tr)(this.options.gridOptions.yStart,this.options.gridOptions.yDelta,ot[1]);if(wt<0||wt>=this.options.gridOptions.ySize)continue;let Ct=(f=parseFloat($.properties[o]))!==null&&f!==void 0?f:s;const qt=w.getPos(wt,ct),kt=w.read1D(qt);Ct==s?Ct=kt:kt!=s&&(Ct=M(kt,Ct)),w.write2D(wt,ct,Ct)}const K=this.getGLDataInfo(w),j=or(this.gl,{width:w.xSize,height:w.ySize,min:this.gl.NEAREST,mag:this.gl.NEAREST,format:K.pixelFormat,internalFormat:K.innerFormat,type:K.dataType,src:K.rawData,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,flipY:0});return Bt.kg.debug("create "+C.length+" station texutre costs "+(performance.now()-b)+"ms"),j}deleteBufferInfo(r,s){if(s){for(const o of Object.values(s.attribs))r.deleteBuffer(o.buffer);s.indices&&r.deleteBuffer(s.indices)}}deleteFrameBufferInfo(r,s){if(s){r.deleteFramebuffer(s.framebuffer);for(const o of s.attachments)o instanceof WebGLRenderbuffer?r.deleteRenderbuffer(o):r.deleteTexture(o)}}destroyShaders(){this.gl&&(this.interpProgram&&this.gl.deleteProgram(this.interpProgram.program),this.interpProgram=void 0,this.interpBuffer&&this.deleteBufferInfo(this.gl,this.interpBuffer),this.interpBuffer=void 0,this.interpFramebuffer&&this.deleteFrameBufferInfo(this.gl,this.interpFramebuffer),this.interpFramebuffer=void 0)}destroy(){if(this.destroyShaders(),!this.gl)return;const r=this.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this.gl=void 0}}Hs.DefaultOptions={gridOptions:void 0,p:2,maxSearchGridSpan:5,pointInSameGridStrategy:"mean"};var Br=t(915);class Ks extends Br.c{constructor(r,s,o="",f=void 0){super(),this.workerPath=r,this.maxWorkerNumber=s,this.name=o,this.workerOptions=f,this.workersCount=0,this.startTime=void 0,this.taskPosted=0,this.taskProcessed=0,this.maxWorkerNumber=this.maxWorkerNumber||4,this.exeQueues=[],this.workers=[]}push(r){this.exeQueues.push(r),this.execNext()}destroy(){this.workers.forEach(r=>r.terminate()),this.workers.length=0,this.workersCount=0}execNext(){if(this.exeQueues.length===0)return void(this.taskPosted===this.taskProcessed&&(Bt.kg.debug("["+this.name+"] complete "+this.taskPosted+" task(s) cost "+(new Date().getTime()-this.startTime.getTime())+"ms"),this.startTime=void 0,this.taskPosted=0,this.taskProcessed=0,this.fire("completed",{firer:this,msg:this})));if(this.workersCount>=this.maxWorkerNumber&&this.workers.length===0)return;let r;this.startTime===void 0&&(this.startTime=new Date),this.workers.length>0?r=this.workers.shift():(r=new Worker(this.workerPath,this.workerOptions),this.workersCount++);var s=this.exeQueues.shift();s.beforeExec&&s.beforeExec(s),r.onerror=s.onError,r.onmessage=o=>{this.workers.push(r),this.taskProcessed++,s.onCompleted(o.data),this.execNext()},s.transffers&&s.transffers.length>0?r.postMessage(s.data,s.transffers):r.postMessage(s.data),this.taskPosted++}}class ma extends Br.c{constructor(r,s){super(),this.eventNames={tChanged:"tChanged",zChanged:"zChanged",tzChanged:"tzChanged",iTChanged:"iTChanged",iZChanged:"iZChanged",iTZChanged:"iTZChanged",activeTZDataUpated:"activeTZDataUpated"},this.meta={},this._currentTIdx=0,this._currentZIdx=0,this.mc=[],this.options=(0,jt.Ov)(this.options,s,{maxTimeCount:0}),this.mc=r,this.meshOptions={tCount:r.length,zValues:r.length>0?r[0].length:[]},this.gridOptions=s==null?void 0:s.gridOptions}allMeshes(){return this.mc}addMeshTo(r,s,o,f,b,u){s=parseInt(s),o=parseInt(o);const w=this.getIntTIdx(),C=this.getIntZIdx();return u[s]=u[s]||[],u[s][o]=r,this.meshOptions.tCount=u.length,(0,jt.ri)(f)&&this.meshOptions.zValues&&(this.meshOptions.zValues[o]=f),s===w&&o===C?this.fire(this.eventNames.activeTZDataUpated,{firer:this,msg:this}):b&&(this.lock(),this.currentTIdx=s,this.currentZIdx=o,this.unlock()),this}get currentTIdx(){return this._currentTIdx}set currentTIdx(r){if(this.mc&&r>=this.mc.length||r===this.currentTIdx)return;const s=this.getIntTIdx();this._currentTIdx=r,s!==this.getIntTIdx()?(this.fire(this.eventNames.iTChanged,{firer:this,msg:this}),this.fire(this.eventNames.iTZChanged,{firer:this,msg:this})):(this.fire(this.eventNames.tChanged,{firer:this,msg:this}),this.fire(this.eventNames.tzChanged,{firer:this,msg:this}))}get currentZIdx(){return this._currentZIdx}set currentZIdx(r){if(this.mc&&r>=this.mc[this.getIntTIdx()].length||r===this.currentZIdx)return;const s=this.getIntZIdx();this._currentZIdx=r,s!==this.getIntZIdx()?(this.fire(this.eventNames.iZChanged,{firer:this,msg:this}),this.fire(this.eventNames.iTZChanged,{firer:this,msg:this})):(this.fire(this.eventNames.zChanged,{firer:this,msg:this}),this.fire(this.eventNames.tzChanged,{firer:this,msg:this}))}getGrid(r,s){return r===void 0&&(r=this.getIntTIdx()),s===void 0&&(s=this.getIntZIdx()),this.mc[r][s]}allGrids(){return this.mc}updateMesh(r,s,o,f,b){return this.addMeshTo(r,s,o,f,b,this.allMeshes())}getIntTIdx(){return parseInt(this._currentTIdx)}getIntZIdx(){return parseInt(this._currentZIdx)}onTChanged(r){return this.on(this.eventNames.tChanged,r),this}onZChanged(r){return this.on(this.eventNames.zChanged,r),this}onTZChanged(r){return this.on(this.eventNames.tzChanged,r),this}onIntTChanged(r){return this.on(this.eventNames.iTChanged,r),this}onIntZChanged(r){return this.on(this.eventNames.iZChanged,r),this}onIntTZChanged(r){return this.on(this.eventNames.iTZChanged,r),this}offTChanged(r){return this.off(this.eventNames.tChanged,r),this}offZChanged(r){return this.off(this.eventNames.zChanged,r),this}offTZChanged(r){return this.off(this.eventNames.tzChanged,r),this}offIntTChanged(r){return this.off(this.eventNames.iTChanged,r),this}offIntZChanged(r){return this.off(this.eventNames.iZChanged,r),this}offIntTZChanged(r){return this.off(this.eventNames.iTZChanged,r),this}onActiveGridUpdated(r){return this.on(this.eventNames.activeTZDataUpated,r),this}offActiveGridUpdated(r){return this.off(this.eventNames.activeTZDataUpated,r),this}}var ga=function(z,r,s,o){return new(s||(s=Promise))(function(f,b){function u(M){try{C(o.next(M))}catch(K){b(K)}}function w(M){try{C(o.throw(M))}catch(K){b(K)}}function C(M){var K;M.done?f(M.value):(K=M.value,K instanceof s?K:new s(function(j){j(K)})).then(u,w)}C((o=o.apply(z,r||[])).next())})};const va={threadCount:4};function La(z){var r,s,o;return ga(this,void 0,void 0,function*(){const f=z.wasm?k.v.wasmPath+"/mcb.js":k.v.workerPath+"/mcb.worker.js",b=new Ks(f,(r=z.threadCount)!==null&&r!==void 0?r:va.threadCount,"mcb_"+(0,jt.hQ)(),{type:"module"});if(!(z!=null&&z.analysisValues.length))return void Bt.kg.error("未提供三维等值面分析值！");if(z.dataSource.gridOptions.zValues.length<=1)return void Bt.kg.error("单层数据无法分析三维等值面！");const u=z.dataSource;let w,C=u.gridOptions;const M=u.getGrid(),K=(s=M.dataScale)!==null&&s!==void 0?s:1,j=(o=M.dataOffset)!==null&&o!==void 0?o:0,$=M.undef,ot=M.dataType;if(z.visibleExtent){const ie=Math.min(z.visibleExtent.maxLon,Math.max(C.xStart,C.xEnd)),oe=Math.max(z.visibleExtent.minLon,Math.min(C.xStart,C.xEnd)),ae=Math.min(z.visibleExtent.maxLat,Math.max(C.yStart,C.yEnd)),fe=Math.max(z.visibleExtent.minLat,Math.min(C.yStart,C.yEnd)),le=C.xDelta<0?ie:oe,ge=C.yDelta<0?ae:fe,_e=C.xDelta<0?oe:ie,Le=C.yDelta<0?fe:ae,Re=Math.floor((_e-le)/C.xDelta)+1,Ke=Math.floor((Le-ge)/C.yDelta)+1,i0=Ke*Re,We=C.zValues.length*i0;w=new ArrayBuffer(We*u.getGrid().raw.BYTES_PER_ELEMENT);const Xe=(0,jt.cM)(u.getGrid().dataType,w);let Ze=(0,jt.tr)(C.xStart,C.xDelta,le),Qe=(0,jt.tr)(C.yStart,C.yDelta,ge),v0=0;const o0=u.allGrids()[u.getIntTIdx()];for(let A0=0;A0<C.zValues.length;A0++){let sx=o0[A0];for(let Y0=Qe;Y0<Ke+Qe;Y0++){let xx=Y0*C.xSize+Ze,V0=sx.raw.subarray(xx,xx+Re);Xe.set(V0,v0*Re),v0++}}C={xStart:le,xEnd:_e,yStart:ge,yEnd:Le,xSize:Re,ySize:Ke,tCount:1,zValues:C.zValues},(0,ce.T)(C)}else{w=new ArrayBuffer(u.getGrid().raw.byteLength*u.gridOptions.zValues.length);const ie=(0,jt.cM)(u.getGrid().dataType,w);let oe=0;u.allGrids()[u.getIntTIdx()].forEach(ae=>{ie.set(ae.raw,oe),oe+=ae.raw.length})}const ct=[],wt=[],Ct=z.analysisValues.map(ie=>function(oe,ae,fe,le,ge,_e,Le,Re,Ke,i0){return ga(this,void 0,void 0,function*(){return new Promise((We,Xe)=>{const Ze={data:{raw:void 0,dataType:_e,algo:Ke,gridOptions:fe,levels:fe.zValues.length,xSize:fe.xSize,ySize:fe.ySize,scale:Le??1,offset:Re??0,scaleFirst:Ke!==2,outerScale:1,outerOffset:0,hasOuter:!1,noShared:!0,undef:i0,undef_fill:0,anaValue:oe,anaType:">="},beforeExec:()=>{let Qe;Qe=ge.length===0?ae.slice(0):ge.pop(),Ze.data.raw=Qe,Ze.transffers=[Qe]},onCompleted:Qe=>{let v0=new Float32Array(Qe.vertices);ge.push(Qe.source),We(new ma([[{meshes:[{vertices:v0,properties:{value:oe},indices:Qe.indices}]}]],{gridOptions:fe}))}};le.push(Ze)})})}(ie,w,C,b,ct,ot,K,j,M.algo,$).then(oe=>{if(z.completeOne){const ae=z.layerCreator(oe);z.completeOne(ae,oe),wt.push(ae)}return oe})),qt=yield Promise.all(Ct),kt={meshes:[]};qt.forEach(ie=>{ie.allMeshes()[0][0].meshes.forEach(oe=>{kt.meshes.push(oe)})});const $t=new ma([[kt]],{gridOptions:C});return z.completeOne?{dataSource:$t,layer:wt}:{dataSource:$t,layer:z.layerCreator($t)}})}var Vn;(function(z){z[z.Hide_All_When_Any=0]="Hide_All_When_Any",z[z.Hide_Only_Self=1]="Hide_Only_Self"})(Vn||(Vn={}));class ti{constructor(r,s,o,f){this.minX=r,this.minY=s,this.maxX=o,this.maxY=f}intersects(r){const s=r.maxX>=this.minX&&r.minX<=this.maxX,o=r.maxY>=this.minY&&r.minY<=this.maxY;return s&&o}}class Ys{constructor(r){r.width&&r.height||Bt.kg.error("碰撞检测类需要提供宽高属性！"),this.options=(0,jt.Ov)({},r,Ys.DefaultOptions),this.collisionTree=new bt({x:this.options.x,y:this.options.y,width:this.options.width,height:this.options.height},this.options.maxNodeItems),this.batchInsert(this.options.objs)}_collisionDetectByFeature(r){const s={};for(const b of r)b.feature.id=b.feature.id||(0,jt.hQ)(),s[b.feature.id]?s[b.feature.id].push(b):s[b.feature.id]=[b];const o=[];for(const b in s){const u=s[b];if(!u.some(w=>w.hidden)){o.push(b);for(const w of u){const C=this.collisionTree.retrieve(w);if(!C||C.length===0)continue;let M=w.bounds;M||(M=w.bounds=new ti(w.x,w.y,w.x+w.width,w.y+w.height));let K=0;C.forEach(j=>{if(j.hidden||j===w||j.feature===w.feature)return;let $=j.bounds;$||($=j.bounds=new ti(j.x,j.y,j.x+j.width,j.y+j.height)),M.intersects($)?j.hidden=!0:K++})}}}const f=[];for(const b of o)for(const u of s[b])f.push(u);return f}insert(r){this.collisionTree.insert(r)}batchInsert(r){r&&r.length!==0&&r.forEach(s=>{this.insert(s)})}collisionDectect(r){if(!r||r.length===0)return[];if(this.options.collisonMode===Vn.Hide_All_When_Any)return this._collisionDetectByFeature(r);let s=[];for(const o of r){if(o.hidden)continue;s.push(o);const f=this.collisionTree.retrieve(o);if(!f||f.length===0)continue;let b=o.bounds;b||(b=o.bounds=new ti(o.x,o.y,o.x+o.width,o.y+o.height));let u=0;f.forEach(w=>{if(w.hidden||w===o||w.feature===o.feature)return;let C=w.bounds;C||(C=w.bounds=new ti(w.x,w.y,w.x+w.width,w.y+w.height)),b.intersects(C)?w.hidden=!0:u++})}return s}clear(){this.collisionTree.clear()}}Ys.DefaultOptions={x:0,y:0,width:void 0,height:void 0,maxNodeItems:10,collisonMode:Vn.Hide_Only_Self};var m0=t(413),ax=t(858),ir=t(537),Cx=t(478),fx=t(307);class ei extends m0.rJ{constructor(r){super(r),(0,jt.JY)(r.height)||Bt.kg.error("配置的点的高度值无效！"),this._update(r,!0)}_update(r,s){s?(this.xDelta=(0,m0.JW)((0,jt.En)(r.xDelta,ei.DefaultOptions.xDelta)),this.yDelta=(0,m0.JW)((0,jt.En)(r.yDelta,ei.DefaultOptions.yDelta)),this.color=(0,m0.Jf)((0,jt.En)(r.color,ei.DefaultOptions.color)),this.visible=(0,m0.pd)((0,jt.En)(r.visible,ei.DefaultOptions.visible))):(this.xDelta=(0,jt.Rf)(r.xDelta,this.xDelta,m0.JW),this.yDelta=(0,jt.Rf)(r.yDelta,this.yDelta,m0.JW),this.color=(0,jt.Rf)(r.color,this.color,m0.Jf),this.visible=(0,jt.Rf)(r.visible,this.visible,m0.pd)),this.height=(0,jt.Rf)(r.height,this.height,m0.JW)}}ei.DefaultOptions={xDelta:.1,yDelta:.1,color:Cx.m.aliceblue,visible:!0,height:void 0};class $s extends m0.PE{_update(r,s){super._update(r,s),r.volume&&(this.volume&&!s?this.volume.update(r.volume):this.volume=new ei(r.volume))}}class ms extends m0.SC{constructor(r){super(r)}updateLabels(r){const s=[];if(r.label&&r.label.length>0)for(const o of r.label)s.push(new $s(o));this.label=s}}class Ci extends m0.Xx{constructor(r){super(r)}_update(r,s){super._update(r,s),s?(this.simpleLine=(0,m0.pd)((0,jt.En)(r.simpleLine,Ci.DefaultOptions.simpleLine)),this.glowPower=(0,m0.JW)((0,jt.En)(r.glowPower,Ci.DefaultOptions.glowPower)),this.taperPower=(0,m0.JW)((0,jt.En)(r.taperPower,Ci.DefaultOptions.taperPower)),this.strokeWidth=(0,m0.JW)((0,jt.En)(r.strokeWidth,Ci.DefaultOptions.strokeWidth))):(this.simpleLine=(0,jt.Rf)(r.simpleLine,this.simpleLine,m0.pd),this.glowPower=(0,jt.Rf)(r.glowPower,this.glowPower,m0.JW),this.taperPower=(0,jt.Rf)(r.taperPower,this.taperPower,m0.JW),this.strokeWidth=(0,jt.Rf)(r.strokeWidth,this.strokeWidth,m0.JW)),this.glowColor=(0,jt.Rf)(r.glowColor,this.glowColor,m0.Jf),this.dashColor=(0,jt.Rf)(r.dashColor,this.dashColor,m0.Jf),this.strokeColor=(0,jt.Rf)(r.strokeColor,this.strokeColor,m0.Jf)}}Ci.DefaultOptions=Object.assign(Object.assign({},m0.Xx.DefaultOptions),{simpleLine:!1,glowPower:.5,taperPower:.5,strokeWidth:2});class Ur extends m0._7{constructor(r){super(r)}_update(r,s){super._update(r,s),s?(this.closeTop=(0,m0.pd)((0,jt.En)(r.closeTop,Ur.DefaultOptions.closeTop)),this.closeBottom=(0,m0.pd)((0,jt.En)(r.closeBottom,Ur.DefaultOptions.closeBottom))):(this.closeTop=(0,jt.Rf)(r.closeTop,this.closeTop,m0.pd),this.closeBottom=(0,jt.Rf)(r.closeBottom,this.closeBottom,m0.pd)),this.extrudeHeight=(0,jt.Rf)(r.extrudeHeight,this.extrudeHeight,m0.JW),this.strokeColor=(0,jt.Rf)(r.strokeColor,this.strokeColor,m0.Jf)}updateLineStyle(r){this.lineStyle=r.lineStyle&&new Ci(r.lineStyle)}updateLabels(r){const s=[];if(r.label&&r.label.length>0)for(const o of r.label)s.push(new $s(o));this.label=s}}Ur.DefaultOptions=Object.assign(Object.assign({},m0._7.DefaultOptions),{closeTop:!0,closeBottom:!0});class Xs extends m0.sC{constructor(r){super(r)}_update(r,s){r&&(r.point&&(this.point&&!s?this.point.update(r.point):this.point=new ms(r.point)),r.polyline&&(this.polyline&&!s?this.polyline.update(r.polyline):this.polyline=new Ci(r.polyline)),r.polygon&&(this.polygon&&!s?this.polygon.update(r.polygon):this.polygon=new Ur(r.polygon)))}}class hn extends fx.Uw{constructor(r){super(r),r||Bt.kg.error("PointImageStyle3D缺少构造参数！",!0),this._update(r,!0)}_update(r,s){s?(this.textureDim=(0,ax.ce)((0,jt.En)(r.textureDim,hn.DefaultOptions.textureDim)),this.size=(0,jt.En)(r.size,hn.DefaultOptions.size),this.scaleMax=(0,jt.En)(r.scaleMax,hn.DefaultOptions.scaleMax)):(this.textureDim=(0,jt.Rf)(r.textureDim,this.textureDim,ax.ce),this.size=(0,jt.Rf)(r.size,this.size,ax.ce)),this.texture=(0,jt.Rf)(r.texture,this.texture,ax.Rd)}_createCacheId(r){return"0"}}hn.DefaultOptions={textureDim:[1,1],texture:void 0,size:32,scaleMax:1};class xi extends Xs{constructor(r){r.analysisValues?super(r):Bt.kg.error("分析值analysisValues必须配置！",!0)}_update(r,s){s?(this.analysisValues=(0,m0.M)(r.analysisValues),this.withShaded=(0,jt.En)(r.withShaded,xi.DefaultOptions.withShaded)):(this.analysisValues=(0,jt.Rf)(r.analysisValues,this.analysisValues,m0.M),this.withShaded=(0,jt.Rf)(r.withShaded,this.withShaded)),this.interpField=(0,jt.Rf)(r.interpField,this.interpField),this.interpGridOptions=(0,jt.Rf)(r.interpGridOptions,this.interpGridOptions),this.interpGridOptions&&(0,ce.T)(this.interpGridOptions),this.undef=(0,jt.Rf)(r.undef,this.undef),super._update(r,s)}}xi.DefaultOptions=Object.assign(Object.assign({},m0.sC.DefaultOptions),{withShaded:!0,analysisValues:void 0});var li=t(316);class Qs{constructor(){this.creators={},this.providerCreators={}}create(r){const s=new this.creators[r.type](r.options);s.setDrawOptions((0,fx.it)(r.style));const o=this.createProvider(r.data);return s.setDataSource(o),s.id=r.name||(0,jt.hQ)(),s}createProvider(r){if(!r||!r.source||!r.type)return;let s;if(r.source2){const o=r,f=new this.providerCreators[o.source.type]((0,fx.it)(o.source.source),o.source.options),b=new this.providerCreators[o.source2.type]((0,fx.it)(o.source2.source),o.source2.options);s=new this.providerCreators[o.type](f,b,o.options)}else{const o=(0,fx.it)(r.source);s=new this.providerCreators[r.type](o,r.options)}return s}registerProviderCreator(r,s){(s=s||r.qeName)||Bt.kg.error("注册的图层创建器没有指明类型！"),this.providerCreators[s]=r}register(r,s){(s=s||r.qeName)||Bt.kg.error("注册的图层创建器没有指明类型！"),this.creators[s]=r}}function Oa(z,r,s){const o=b=>{var u;const w=(u=b.layerCreator)!==null&&u!==void 0?u:ki,C=[];if(b.layers)for(const M of b.layers){const K=w.create(M);K&&(r(K),C.push(K))}s&&s(C)},f=b=>{var u;const w=(u=b.resourceService)!==null&&u!==void 0?u:li.Zc;b.resources?typeof b.resources=="string"||b.resources instanceof Request?w.loadResourceFromConfigPath(b.resources).then(C=>{o(b)}).catch(Bt.kg.debug):w.loadResourceFromConfig(b.resources).then(C=>{o(b)}).catch(Bt.kg.debug):o(b)};typeof z=="string"?(0,jt.xA)(z).then(b=>{f(b)}).catch(Bt.kg.debug):f(z)}const ki=new Qs;var Nr=t(608),js=t(787);class Wn extends qe.r{constructor(r,s){super(s),this.gridOptions=this.options.gridOptions,typeof r=="function"&&(r=r()),r||Bt.kg.error("数据源为空！");let o=0;this.options.dataScale===void 0&&this.options.dataOffset===void 0||(this.options.dataScale=(0,jt.En)(this.options.dataScale,1),this.options.dataOffset=(0,jt.En)(this.options.dataOffset,0),o=this.options.scaleFirst===void 0||this.options.scaleFirst?1:2);const f=new it.P(Ot.U.Float32,this.gridOptions.xSize,this.gridOptions.ySize,r,this.options.undef,o,this.options.dataScale||1,this.options.dataOffset||0);this.grids=[[f]]}}Wn.qeName="g_array2d",ki.registerProviderCreator(Wn);class gs extends Wn{constructor(r,s){typeof r=="string"&&(r=JSON.parse(r)),super(r.DS,Object.assign({gridOptions:{xStart:r.startLon,yStart:r.startLat,xDelta:r.lonStep,yDelta:r.latStep,xSize:r.lonCount,ySize:r.latCount,xEnd:r.endLon,yEnd:r.endLat,zValues:[0],tCount:1}},s||{}))}}gs.qeName="g_cimiss",ki.registerProviderCreator(gs);class Fr extends Br.c{constructor(){super(...arguments),this.eventNames={dataUpdated:"dataUpdated"},this.meta={}}updateFeatures(r){this._updateFeatures(r),this.fire(this.eventNames.dataUpdated,{firer:this,msg:this})}onFeaturesUpdate(r){return this.on(this.eventNames.dataUpdated,r),this}offFeaturesUpdate(r){return this.off(this.eventNames.dataUpdated,r),this}getMaxMin(r,s,o=!0){s=s??k.v.defaultUndef;const f=this.getFeatures().features;if(!(f!=null&&f.length))return{min:void 0,max:void 0};let b=1/0,u=-1/0,w=C=>!1;o&&(w=s>0?C=>C>=s:C=>C<=s);for(const C of f){const M=C.properties[r];w(M)||(M>u&&(u=M),M<b&&(b=M))}return{min:b,max:u}}}class Mi extends Fr{constructor(r,s){super(),this.featuresMap={},r||Bt.kg.error("数据源为空！"),this.options=(0,jt.Ov)(this.options,s,Mi.DefaultOptions),typeof r=="function"&&(r=r()),this.parseFeatures(r)}_updateFeatures(r){this.features=void 0,this.featuresMap={},this.parseFeatures(r)}parseFeatures(r){let s=new Array;const o=this.options.prefix&&this.options.prefix.length>0||this.options.suffix&&this.options.suffix.length>0?(f,b,u)=>{f[b]=this.options.prefix+u+this.options.suffix}:(f,b,u)=>{f[b]=u};for(let f of r){let b,u=f[this.options.idField];if(u===void 0&&(u=(0,jt.hQ)()),this.featuresMap[u]!==void 0)b=this.featuresMap[u];else{let w;if(f[this.options.latField]&&f[this.options.lonField])w={type:"Point",coordinates:[parseFloat(f[this.options.lonField]),parseFloat(f[this.options.latField])]};else{if(!this.options.stationInfoMap)throw new Error("无法获取站点经纬度信息！请确保数据中存在经纬度字段且设置了正确的名称！");w={type:"Point",coordinates:[this.options.stationInfoMap[u][this.options.lonField],this.options.stationInfoMap[u][this.options.latField]]}}b={id:u,type:"Feature",geometry:w,properties:{}},s.push(b)}for(let w in f)b.properties[w]!==void 0&&this.options.mergeFunc!==void 0?b.properties[w]=this.options.mergeFunc(w,b.properties[w],f[w]):o(b.properties,w,f[w]);this.featuresMap[u]=b}this.features={type:"FeatureCollection",features:s}}getFeatures(){return this.features}getFeature(r){return this.featuresMap[r]}}Mi.DefaultOptions={lonField:"Lon",latField:"Lat",idField:"Station_Id_C"},Mi.qeName="v_array",ki.registerProviderCreator(Mi);class un extends Mi{constructor(r,s){super(()=>(typeof r=="string"&&(r=JSON.parse(r)),r.DS),s),this.headers={};for(const o in r)o!=="DS"&&(this.headers[o]=r[o]);this.meta=this.headers}_updateFeatures(r){typeof r=="string"&&(r=JSON.parse(r));for(const s in r)s!=="DS"&&(this.headers[s]=r[s]);super._updateFeatures(r.DS)}}un.qeName="v_cimiss",ki.registerProviderCreator(un);class dn extends qe.r{constructor(r,s){super(s),this.load(r)}getDataType(r,s){switch(r){case"Int8":return s?Ot.U.UInt8:Ot.U.Int8;case"Int16":return s?Ot.U.UInt16:Ot.U.Int16;case"Int32":return s?Ot.U.UInt32:Ot.U.Int32;case"Int64":return console.log("Int64 currently not supported,use Int32 instead!"),s?Ot.U.UInt32:Ot.U.Int32;case"Float32":return Ot.U.Float32;case"Float64":return Ot.U.Float64;default:throw new Error("不支持的数据类型："+r)}}load(r){const s=new Ie(r,!0),o=s.readInt32(),f=String.fromCharCode.apply(null,new Uint8Array(s.readBuffer(o)));this.meta=JSON.parse(f),this.options.meta&&(this.meta=Object.assign(Object.assign({},this.meta),this.options.meta)),this.meta.times=(0,jt.En)(this.meta.times,1),(this.meta.undef===void 0||isNaN(this.meta.undef)||this.meta.undef===null)&&(Bt.kg.warn("当前数据和数据解析器中均没有提供缺测值信息，将使用默认缺测值consts.defaultUndef="+k.v.defaultUndef+"！"),this.meta.undef=k.v.defaultUndef),this.grids=[],this.meta.algo!==void 0&&parseInt(this.meta.algo)===1?this.loadByteGrid(s):this.loadOriginalGrid(s),this.gridOptions={xStart:this.meta.xStart,xSize:this.meta.xSize,xEnd:this.meta.xEnd,yStart:this.meta.yStart,ySize:this.meta.ySize,yEnd:this.meta.yEnd,zValues:this.meta.levelList,tCount:this.meta.times},(0,ce.T)(this.gridOptions)}loadOriginalGrid(r){const s=(r.buffer.byteLength-r.offset)/(this.meta.times*this.meta.levels);let o=0;(this.meta.dataScale||this.meta.dataOffset)&&(o=1);for(let f=0;f<this.meta.times;f++){const b=[];for(let u=0;u<this.meta.levels;u++){const w=r.readBuffer(s),C=new it.P(this.getDataType(this.meta.dataType,this.meta.unsigned),this.meta.xSize,this.meta.ySize,w,1*this.meta.undef,o,this.meta.dataScale||1,this.meta.dataOffset||0);b.push(C)}this.grids.push(b)}}loadByteGrid(r){const s=(r.buffer.byteLength-r.offset)/(this.meta.times*this.meta.levels),o=this.meta.min||this.meta.vmin,f=this.meta.max||this.meta.vmax;for(let b=0;b<this.meta.times;b++){const u=[];for(let w=0;w<this.meta.levels;w++){const C=f[w]-o[w],M=r.readBuffer(s),K=new it.P(this.getDataType(this.meta.dataType,this.meta.unsigned),this.meta.xSize,this.meta.ySize,M,255,1,C/254,o[w]);K.undef=255,u.push(K)}this.grids.push(u)}}}dn.qeName="g_qe",ki.registerProviderCreator(dn);class zi extends Fr{constructor(r){super(),this.featuresMap={},r||Bt.kg.warn("数据为空！"),this._updateFeatures(r)}parseFeatures(r){if(!r)return;let s;switch(r.type){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":case"GeometryCollection":return this.parseFeatures({type:"Feature",geometry:r,properties:{}});case"Feature":s={type:"FeatureCollection",features:[r]};break;case"FeatureCollection":s=r}return s}_updateFeatures(r){this.featuresMap={},this.features=void 0,this.features=this.parseFeatures(r),this.features&&this.features.features&&this.features.features.forEach(s=>{s.id||(s.id=(0,jt.hQ)()),this.featuresMap[s.id]=s})}addFeature(r){r.id=r.id||(0,jt.hQ)(),this.features.features.push(r),this.featuresMap[r.id]=r}removeFeature(r){const s=this.getFeature(r);if(s){const o=this.features.features.indexOf(s);this.features.features.splice(o,1),delete this.featuresMap[r]}}getFeatures(){return this.features}getFeature(r){if(this.features)return this.featuresMap[r]}}zi.qeName="v_geojson",ki.registerProviderCreator(zi);class hi extends qe.r{constructor(r,s,o){var f;super((0,jt.Ov)({},o,hi.DefaultOptions)),this.gridOptions=(r==null?void 0:r.gridOptions)||o.gridOptions,this.defaultGrid=o==null?void 0:o.defaultGrid,this.meta=Object.assign(Object.assign(Object.assign({},(f=this.meta)!==null&&f!==void 0?f:{}),(r==null?void 0:r.meta)||{}),(s==null?void 0:s.meta)||{}),this.options.isUV?(this.u=(r==null?void 0:r.allGrids())||[],this.v=(s==null?void 0:s.allGrids())||[],this.speed=[],this.dir=[]):(this.speed=(r==null?void 0:r.allGrids())||[],this.dir=(s==null?void 0:s.allGrids())||[],this.u=[],this.v=[]),!this.options.lazyCalc&&r&&s&&(this.options.isUV?this.parseDataByUV():this.parseDataBySD()),this.grids=this[this.options.defaultGrid||"speed"]}get wProvider(){return this.options.wProvider}allU(){var r;return!((r=this.u)===null||r===void 0)&&r.length||this.parseDataBySD(),this.u}allV(){var r;return!((r=this.v)===null||r===void 0)&&r.length||this.parseDataBySD(),this.v}allW(){var r;return(r=this.options.wProvider)===null||r===void 0?void 0:r.allGrids()}allS(){var r;return!((r=this.speed)===null||r===void 0)&&r.length||this.parseDataByUV(),this.speed}allD(){var r;return!((r=this.dir)===null||r===void 0)&&r.length||this.parseDataByUV(),this.dir}addUV(r,s,o,f,b,u){if(this.lock(),this.addGridTo(r,o,f,b,u,this.u),this.addGridTo(s,o,f,b,u,this.v),!this.options.lazyCalc){const w=this.parseSingleGridByUV(r,s,r.xSize*r.ySize);this.addGridTo(w[0],o,f,b,u,this.speed),this.addGridTo(w[1],o,f,b,u,this.dir)}return this.unlock(),this}addSD(r,s,o,f,b,u){if(!this.options.lazyCalc){const w=this.parseSingleGridBySD(r,s,r.xSize*r.ySize);this.addGridTo(w[0],o,f,b,u,this.u),this.addGridTo(w[1],o,f,b,u,this.v)}this.lock(),this.addGridTo(r,o,f,b,u,this.speed),this.addGridTo(s,o,f,b,u,this.dir),this.unlock()}parseSingleGridByUV(r,s,o){const f=new it.P(Ot.U.Float32,this.gridOptions.xSize,this.gridOptions.ySize,void 0,r.undef),b=new it.P(Ot.U.Float32,this.gridOptions.xSize,this.gridOptions.ySize,void 0,r.undef);for(let u=0;u<o;u++){const w=r.read1D(u);if(r.isUndef(w)){f.write1D(u,r.undef),b.write1D(u,r.undef);continue}const C=s.read1D(u);if(s.isUndef(C)){f.write1D(u,r.undef),b.write1D(u,r.undef);continue}const M=(0,jt.C8)([r.read1D(u),s.read1D(u)]);f.write1D(u,M[0]),b.write1D(u,M[1])}return[f,b]}parseDataByUV(){const r=[],s=[],o=this.gridOptions.ySize*this.gridOptions.xSize;for(let f=0;f<this.u.length;f++){const b=this.u[f],u=this.v[f],w=[],C=[];for(let M=0;M<b.length;M++){const K=b[M],j=u[M],$=this.parseSingleGridByUV(K,j,o);w.push($[0]),C.push($[1])}r.push(w),s.push(C)}this.speed=r,this.dir=s}parseSingleGridBySD(r,s,o){const f=new it.P(Ot.U.Float32,this.gridOptions.xSize,this.gridOptions.ySize,void 0,r.undef),b=new it.P(Ot.U.Float32,this.gridOptions.xSize,this.gridOptions.ySize,void 0,r.undef);for(let u=0;u<o;u++){const w=r.read1D(u);if(r.isUndef(w)){f.write1D(u,r.undef),b.write1D(u,r.undef);continue}const C=s.read1D(u);if(s.isUndef(C)){f.write1D(u,r.undef),b.write1D(u,r.undef);continue}const M=(0,jt.Hn)([r.read1D(u),s.read1D(u)]);f.write1D(u,M[0]),b.write1D(u,M[1])}return[f,b]}parseDataBySD(){const r=[],s=[],o=this.gridOptions.ySize*this.gridOptions.xSize;for(let f=0;f<this.speed.length;f++){const b=this.speed[f],u=this.dir[f],w=[],C=[];for(let M=0;M<b.length;M++){const K=b[M],j=u[M],$=this.parseSingleGridBySD(K,j,o);w.push($[0]),C.push($[1])}r.push(w),s.push(C)}this.u=r,this.v=s}getDimLevel(r,s){return{dim:r===void 0?this.getIntTIdx():parseInt(r),level:s===void 0?this.getIntZIdx():parseInt(s)}}getUV(r,s,o,f){var b;!((b=this.u)===null||b===void 0)&&b.length||this.parseDataBySD();const u=this.getDimLevel(o,f),w=this.u[u.dim][u.level],C=this.v[u.dim][u.level];let M=this.speed[0][0].getPos(r,s);return[w.read1D(M),C.read1D(M)]}getSD(r,s,o,f){var b;!((b=this.speed)===null||b===void 0)&&b.length||this.parseDataByUV();const u=this.getDimLevel(o,f),w=this.speed[u.dim][u.level],C=this.dir[u.dim][u.level];let M=this.speed[0][0].getPos(r,s);return[w.read1D(M),C.read1D(M)]}getU(r,s){var o;!((o=this.u)===null||o===void 0)&&o.length||this.parseDataBySD();const f=this.getDimLevel(r,s);return this.u[f.dim][f.level]}getV(r,s){var o;!((o=this.v)===null||o===void 0)&&o.length||this.parseDataBySD();const f=this.getDimLevel(r,s);return this.v[f.dim][f.level]}getW(r,s){if(!this.options.wProvider)throw new Error("当前未提供垂直速度分量！");const o=this.getDimLevel(r,s);return this.options.wProvider.getGrid(o.dim,o.level)}getS(r,s){var o;!((o=this.speed)===null||o===void 0)&&o.length||this.parseDataByUV();const f=this.getDimLevel(r,s);return this.speed[f.dim][f.level]}getD(r,s){var o;!((o=this.dir)===null||o===void 0)&&o.length||this.parseDataByUV();const f=this.getDimLevel(r,s);return this.dir[f.dim][f.level]}getGrid(r,s){const o=this.getDimLevel(r,s);return this.allGrids()[o.dim][o.level]}allGrids(){var r,s,o,f,b;if(!(!((r=this.grids)===null||r===void 0)&&r.length)){let u;this.options.defaultGrid==="dir"?(!((s=this.dir)===null||s===void 0)&&s.length||this.parseDataByUV(),u=this.dir):this.options.defaultGrid==="speed"?(!((o=this.speed)===null||o===void 0)&&o.length||this.parseDataByUV(),u=this.speed):this.options.defaultGrid==="u"?(!((f=this.u)===null||f===void 0)&&f.length||this.parseDataBySD(),u=this.u):(!((b=this.v)===null||b===void 0)&&b.length||this.parseDataBySD(),u=this.v),this.grids=u}return this.grids}}hi.DefaultOptions={isUV:!0,lazyCalc:!1,meta:{},defaultGrid:"speed"},hi.qeName="g_wind",ki.registerProviderCreator(hi);class qn extends Wn{constructor(r,s){const o=(r=r.replaceAll(`
`," ").replaceAll("\r"," ")).split(/\s+/);for(;o[0].trim().length===0;)o.shift();for(;o[o.length-1].trim().length===0;)o.pop();const f={xStart:Number(o[11]),xEnd:Number(o[12]),yStart:Number(o[13]),yEnd:Number(o[14]),xDelta:Number(o[9]),yDelta:Number(o[10]),xSize:Number(o[15]),ySize:Number(o[16])},b=o.splice(0,22);super(o,Object.assign({gridOptions:f},s)),this.headers=b,this.meta=this.headers}}class rr extends qe.r{constructor(r,s){super((0,jt.Ov)({},s,rr.DefaultOptions)),this._decoder=new TextDecoder,this._load(r)}_readString(r,s){return this._decoder.decode(r.readBuffer(s)).replace(/\0/g,"").trim()}_load(r){const s=new Ie(r,!0);this.meta={},this.meta.zoneName=this._readString(s,12),this.meta.dataName=this._readString(s,38);let o=this._readString(s,8).toLowerCase(),f="1.5";o!=="swan"?(o="old",f="1.0",s.seek(s.offset-8)):f=this._readString(s,8),this.meta.version=f,this.meta.year=s.readUint16(),this.meta.month=s.readUint16(),this.meta.day=s.readUint16(),this.meta.hour=s.readUint16(),this.meta.minute=s.readUint16(),this.meta.interval=s.readUint16(),this.meta.xNumGrids=s.readUint16(),this.meta.yNumGrids=s.readUint16(),this.meta.zNumGrids=s.readUint16(),this.meta.radarCount=s.readInt32(),this.meta.startLon=Number(s.readFloat32().toPrecision(6)),this.meta.startLat=Number(s.readFloat32().toPrecision(6)),this.meta.centerLon=Number(s.readFloat32().toPrecision(6)),this.meta.centerLat=Number(s.readFloat32().toPrecision(6)),this.meta.xReso=Number(s.readFloat32().toPrecision(6)),this.meta.yReso=Number(s.readFloat32().toPrecision(6));let b=[];for(let ot=0;ot<40;ot++){const ct=s.readFloat32();ct>0&&b.push(ct)}b.length===0?b=[0]:this.options.isZUnitKM&&(b=b.map(ot=>1e3*ot));let u=0;o==="swan"&&(u=752),s.skip(u);const w=this.meta.xNumGrids*this.meta.yNumGrids,C=w*this.meta.zNumGrids,M=s.buffer.byteLength-C,K=(s.buffer.byteLength-M)/(w*this.meta.zNumGrids),j=w*K;this.gridOptions={xStart:this.meta.startLon,xSize:this.meta.xNumGrids,xDelta:this.meta.xReso,yStart:this.meta.startLat,ySize:this.meta.yNumGrids,yDelta:-this.meta.yReso,zValues:b,tCount:1},(0,ce.T)(this.gridOptions);const $=K===1?Ot.U.UInt8:Ot.U.Int16;this.grids=[[]];for(let ot=0;ot<b.length;ot++){const ct=s.readBuffer(j),wt=new it.P($,this.gridOptions.xSize,this.gridOptions.ySize,ct,K===1?255:9999,2,K===1?.5:1,K===1?-66:0);this.grids[0].push(wt)}}}rr.DefaultOptions={isZUnitKM:!0};class Zn extends qe.r{constructor(r,s){super(s),this.load(r)}load(r){let s=this.parseBinaryToGridDatas(r);this.gridOptions=this.getGridOptionsFromGridMetaInfo(s.metaInfo),this.grids=s.martixData}parseBinaryToGridDatas(r){if(r===void 0)return;let s=new Uint8Array(r.slice(0,12)),o=String.fromCharCode.apply(null,s),f=parseInt(String.fromCharCode.apply(null,new Uint8Array(r.slice(12,20)))),b=String.fromCharCode.apply(null,new Uint8Array(r.slice(20,f))).split(","),u={};for(let $ of b){let ot=$.split("=");u[ot[0]]=ot[1]}let w={productId:u.ProductId,productTitle:u.ProductTitle,year:parseInt(u.Year),month:parseInt(u.Month),day:parseInt(u.Day),hour:parseInt(u.Hour),minute:parseInt(u.Minute),second:parseInt(u.Second),forecast:u.Forecast,width:parseInt(u.Width),height:parseInt(u.Height),dimension:parseInt(u.Dimension),levels:parseInt(u.Levels),left:parseFloat(u.Left),right:parseFloat(u.Right),top:parseFloat(u.Top),bottom:parseFloat(u.Bottom),resolutionX:parseFloat(u.Resolution_x),resolutionY:parseFloat(u.Resolution_y),resolutionCell:parseFloat(u.ResolutionCell),dataType:parseInt(u.DataType),levelValue:u.LevelValue&&u.LevelValue.split(";"),levelUnit:u.LevelUnit,machine:u.Machine,storage:u.Storage,coordinateion:u.Coordination,palette:u.Palette,siteCode:u.SiteCode&&u.SiteCode.split(";"),invalid:parseFloat(u.Invalid),offset:parseFloat(u.Offset),ratio:parseFloat(u.Ratio)};this.meta=w;let C=this.getDataSizeFromBinaryType(w.dataType),M=w.width*w.height*C,K=f,j=[];for(let $=0;$<w.dimension;$++){j[$]=[];for(let ot=0;ot<w.levels;ot++){let ct=r.slice(K,K+M),wt=new it.P(this.getDataTypeFromBinaryType(w.dataType),w.width,w.height,ct,w.invalid,1,w.ratio,w.offset);wt.undef=w.invalid,K+=M,j[$][ot]=wt}}return{fileId:o,dataAddr:f,metaInfo:w,sourceMetaInfo:u,martixData:j}}getDataSizeFromBinaryType(r){switch(r){case 0:return console.warn("当前不支持char类型，会被当作uint8解析"),Uint8Array.BYTES_PER_ELEMENT;case 3:return Uint8Array.BYTES_PER_ELEMENT;case 1:return Int16Array.BYTES_PER_ELEMENT;case 2:return Int32Array.BYTES_PER_ELEMENT;case 4:return Uint16Array.BYTES_PER_ELEMENT;case 5:return Uint32Array.BYTES_PER_ELEMENT;case 6:return Float32Array.BYTES_PER_ELEMENT;case 7:return Float64Array.BYTES_PER_ELEMENT}}getDataTypeFromBinaryType(r){switch(r){case 0:return console.warn("当前不支持char类型，会被当作uint8解析"),Ot.U.UInt8;case 3:return Ot.U.UInt8;case 1:return Ot.U.Int16;case 2:return Ot.U.Int32;case 4:return Ot.U.UInt16;case 5:return Ot.U.UInt32;case 6:return Ot.U.Float32;case 7:return Ot.U.Float64}}getGridOptionsFromGridMetaInfo(r){var s;let o=[0];return r.levelValue&&(o=(s=r.levelValue)===null||s===void 0?void 0:s.map(f=>parseFloat(f))),{xStart:r.left,xEnd:r.right,yStart:r.top,yEnd:r.bottom,xSize:r.width,ySize:r.height,xDelta:r.left<r.right?Math.abs(r.resolutionX):-Math.abs(r.resolutionX),yDelta:r.bottom>r.top?Math.abs(r.resolutionY):-Math.abs(r.resolutionY),tCount:this.grids.length,zValues:o}}}var Bi,fn=function(z,r,s,o){return new(s||(s=Promise))(function(f,b){function u(M){try{C(o.next(M))}catch(K){b(K)}}function w(M){try{C(o.throw(M))}catch(K){b(K)}}function C(M){var K;M.done?f(M.value):(K=M.value,K instanceof s?K:new s(function(j){j(K)})).then(u,w)}C((o=o.apply(z,r||[])).next())})};window.GeoTIFF||(Bt.kg.debug("未能找到GeoTIFF库，GeoTIFF数据解析器将不可用！"),window.GeoTIFF={});class Ui extends qe.r{constructor(r,s){super(s),this.getDataType=o=>{switch(o.constructor.name){case"Int8Array":return Ot.U.Int8;case"Uint8Array":return Ot.U.UInt8;case"Int16Array":return Ot.U.Int16;case"Uint16Array":return Ot.U.UInt16;case"Int32Array":return Ot.U.Int32;case"Uint32Array":return Ot.U.UInt32;case"Float32Array":return Ot.U.Float32;case"Float64Array":return Ot.U.Float64;default:throw new Error("不支持的数据类型："+o.constructor.name)}},this.load=(o,f)=>{var b;this.gridOptions=f.gridOptions,(0,ce.T)(this.gridOptions);let u=[];const w=this.getDataType(o[0]),C=f.undef?f.undef:k.v.defaultUndef,M=new it.P(w,this.gridOptions.xSize,this.gridOptions.ySize,o[0],C);M.useAccurateUndef=(b=f.useAccurateUndef)!==null&&b!==void 0&&b,u.push(M),this.grids.push(u)},this.load(r,s)}static fromUrl(r,s={}){return fn(this,void 0,void 0,function*(){const o=yield(0,jt.oT)(r);return Ui.fromBuffer(o,s)})}}Ui.readTifBuffer=z=>fn(void 0,void 0,void 0,function*(){const r=yield window.GeoTIFF.fromArrayBuffer(z),s=yield r.getImage(),o=s.getResolution(),f=s.getOrigin(),b=s.getWidth(),u=s.getHeight();return{options:{xStart:f[0],yStart:f[1],xDelta:o[0],yDelta:o[1],xSize:b,ySize:u},data:yield s.readRasters()}}),Ui.fromBuffer=(z,r={})=>fn(void 0,void 0,void 0,function*(){return Ui.readTifBuffer(z).then(s=>(r.gridOptions=r.gridOptions||s.options,new Ui(s.data,r))).catch(s=>{})}),Ui.qeName="g_tif";class cn extends Fr{constructor(r,s){super(),this.featuresMap={},this._parseFeatures(r)}_updateFeature(r){this.features.features.push(r),this.featuresMap[r.id]=r}_parseClosedContours(r){let s=r.indexOf("CLOSED_CONTOURS:");if(s<0)return;s++;const o=parseInt(r[s++]);for(let f=0;f<o;f++){const b=r[s++],u=parseInt(r[s++]);if(u===0)continue;const w=[];for(let j=0;j<u;j++){const $=parseFloat(r[s++]),ot=parseFloat(r[s++]);w.push([$,ot]),s++}const C=r[s++],M={type:"Feature",geometry:{type:"Polygon",coordinates:[w]},properties:{value:C,width:b},id:(0,jt.hQ)()};this._updateFeature(M);const K=parseInt(r[s++]);if(K>0)for(let j=0;j<K;j++){const $=parseFloat(r[s++]),ot=parseFloat(r[s++]);s++;const ct={type:"Feature",geometry:{type:"Point",coordinates:[$,ot]},properties:{value:C},id:(0,jt.hQ)()};this._updateFeature(ct)}}}_parseFeatures(r){this.features={type:"FeatureCollection",features:[]},this.featuresMap={};const s=(r=r.replaceAll(`
`," ").replaceAll("\r"," ")).split(/\s+/);for(;s[0].trim().length===0;)s.shift();for(;s[s.length-1].trim().length===0;)s.pop();if(s.length<8||s[0]!=="diamond"||s[1]!=="14")throw new Error("当前文件不是Micaps 14类数据！");this.meta.title=s[2],this.meta.year=s[3].length===2?parseInt(s[3])+2e3:parseInt(s[3]),this.meta.mon=parseInt(s[4]),this.meta.day=parseInt(s[5]),this.meta.hour=parseInt(s[6]),this.meta.time=new Date(this.meta.year,this.meta.mon-1,this.meta.day,this.meta.hour),this.meta.period=parseInt(s[7]),this._parseClosedContours(s)}_updateFeatures(r){this._parseFeatures(r)}getFeatures(){return this.features}getFeature(r){return this.featuresMap[r]}}cn.qeName="v_diamond14";class Gr extends Fr{constructor(r){super(),this.featuresMap={},this.options=(0,jt.Ov)({},r,Gr.DefaultOptions),this._generateFeatures()}_generateFeatures(){const r=this.options;r.extent||Bt.kg.error("需要提供随机数的生成范围！",!0);let s=()=>[(0,jt.Zu)(r.extent.minLon,r.extent.maxLon),(0,jt.Zu)(r.extent.minLat,r.extent.maxLat)];(0,jt.ri)(r.extent.minHeight)&&(0,jt.ri)(r.extent.maxHeight)&&(s=()=>[(0,jt.Zu)(r.extent.minLon,r.extent.maxLon),(0,jt.Zu)(r.extent.minLat,r.extent.maxLat),(0,jt.Zu)(r.extent.minHeight,r.extent.maxHeight)]),this.featuresMap={},this.features={type:"FeatureCollection",features:[]},r.fields&&r.fields.forEach(o=>{var f,b,u;o.randomMax=(f=o.randomMax)!==null&&f!==void 0?f:100,o.randomMin=(b=o.randomMin)!==null&&b!==void 0?b:0,o.valueMode=(u=o.valueMode)!==null&&u!==void 0?u:"random"});for(let o=0;o<r.count;o++){const f=s(),b={fid:"qe_"+o};if(r.fields)for(let w=0;w<r.fields.length;w++)this._updateField(o,r.fields[w],b);const u={type:"Feature",geometry:{type:"Point",coordinates:f},properties:b};this.featuresMap[b.fid]=u,this.features.features.push(u)}}_updateField(r,s,o){var f;let b;if(s.valueMode==="list"){!((f=s.valueList)===null||f===void 0)&&f.length||Bt.kg.error("随时数生成模式为list时，需要提供valueList候选项！",!0);const u=parseInt(Math.random()*s.valueList.length);b=s.valueList[u]}else b=(0,jt.Zu)(s.randomMin,s.randomMax);s.postProcessor&&(b=s.postProcessor(b,r)),o[s.name]=b}_updateFeatures(r){this.options=(0,jt.Ov)({},r,Gr.DefaultOptions),this._generateFeatures()}getFeatures(){return this.features}getFeature(r){return this.featuresMap[r]}}Gr.DefaultOptions={count:1e3,extent:void 0};class Ni extends hi{constructor(r,s){if(!(s!=null&&s.gridOptions))throw new Error("该provider必须传入格点参数信息");(0,ce.T)(s.gridOptions);const{s:o,d:f}=Ni._getSDProvider(r,s.gridOptions);super(o,f,Object.assign({isUV:!1},s))}static _getSDProvider(r,s){const o=r.replaceAll(`
`," ").replaceAll("\r"," ").split(/\s+/);for(;o[0].trim().length===0;)o.shift();for(;o[o.length-1].trim().length===0;)o.pop();const f=o.splice(0,9),b=new it.P(Ot.U.Float32,s.xSize,s.ySize,void 0,9999),u=new it.P(Ot.U.Float32,s.xSize,s.ySize,void 0,9999),w=Number(f[f.length-1]);for(let C=0;C<w;C++)b.write1D(C,Number(o[10*C+9])),u.write1D(C,Number(o[10*C+8]));return{s:new zr.o([[b]],{gridOptions:s}),d:new zr.o([[u]],{gridOptions:s})}}}(function(z){z[z.Time=0]="Time",z[z.Level=1]="Level"})(Bi||(Bi={}));class ui extends Br.c{constructor(r,s){super(),this.paused=0,s.all===void 0&&Bt.kg.error("动画的最大长度未设置！"),this.dataSources=r instanceof Array?r:[r],this.options=(0,jt.Ov)({},s,ui.DefaultOptions),!this.options.layer||this.options.layer instanceof Array||(this.options.layer=[this.options.layer]),this.setAnimationFunc()}setAnimationFunc(){this.options.useTimer?(this.startFunc=setInterval.bind(window),this.stopFunc=clearInterval.bind(window)):(this.startFunc=requestAnimationFrame.bind(window),this.stopFunc=cancelAnimationFrame.bind(window))}setInterval(r){this.options.useTimer?this.animationId?Bt.kg.warn("当前正在动画中，无法设置动画间隔！"):this.options.timerInterval=r:Bt.kg.warn("当前没有使用间隔方式渲染！")}setLoop(r){this.options.loop=r}setDelta(r){this.options.delta=r}start(){var r;if(this.animationId)return void Bt.kg.warn("当前处于动画中，请先停止播放！");let s=this.options.all-this.options.delta;const o=Math.min(Math.max((r=this.options.fromIdx)!==null&&r!==void 0?r:0,0),this.options.all-2);(0,jt.ri)(this.options.toIdx)&&(this.options.toIdx<=o&&Bt.kg.error("暂不支持toIdx<=fromIdx的播放模式"),s=Math.max(Math.min(this.options.toIdx+1,this.options.all),2)-this.options.delta);const f=this.options.type===Bi.Level?"currentZIdx":"currentTIdx",b=()=>{if(!(this.paused>0)){if(this.dataSources[0][f]<o&&this.dataSources.forEach(u=>u[f]=o),this.dataSources[0][f]>=s){if(this.options.loop)return this.dataSources.forEach(u=>{u[f]=o}),this.options.layer&&this.options.layer.forEach(u=>u.clearPreDataSource&&u.clearPreDataSource()),this.options.clearPreSource&&this.options.clearPreSource(),void this.fire(ui.EventTypes.backUpdate,{firer:this,msg:0});this.stop()}this.dataSources.forEach(u=>{u[f]+=this.options.delta}),this.fire(ui.EventTypes.idxUpdate,{firer:this,msg:this.dataSources[0][f]})}};if(this.options.useTimer)this.animationId=this.startFunc(b,this.options.timerInterval);else{let u=performance.now();const w=()=>{if(!this.animationId)return;const C=performance.now();C-u>=this.options.timerInterval&&(b(),u=C),this.animationId=this.startFunc(w)};this.animationId=this.startFunc(w)}return this}pause(){return this.paused++,this}resume(){return this.paused--,this.paused<0&&(this.paused=0),this}stop(){return this.animationId?(this.stopFunc(this.animationId),this.animationId=void 0,this.paused=0,this.fire(ui.EventTypes.stopped,{firer:this,msg:this}),this):this}}ui.DefaultOptions={timerInterval:30,loop:!0,autoStart:!1,useTimer:!0,all:void 0,type:Bi.Time,layer:void 0,delta:.05},ui.EventTypes={idxUpdate:"update:idx",backUpdate:"update:back",stopped:"stopped"};var Lx=t(75);function ya(z,r,s){if(z!==null)for(var o,f,b,u,w,C,M,K,j=0,$=0,ot=z.type,ct=ot==="FeatureCollection",wt=ot==="Feature",Ct=ct?z.features.length:1,qt=0;qt<Ct;qt++){w=(K=!!(M=ct?z.features[qt].geometry:wt?z.geometry:z)&&M.type==="GeometryCollection")?M.geometries.length:1;for(var kt=0;kt<w;kt++){var $t=0,ie=0;if((u=K?M.geometries[kt]:M)!==null){C=u.coordinates;var oe=u.type;switch(j=!s||oe!=="Polygon"&&oe!=="MultiPolygon"?0:1,oe){case null:break;case"Point":if(r(C,$,qt,$t,ie)===!1)return!1;$++,$t++;break;case"LineString":case"MultiPoint":for(o=0;o<C.length;o++){if(r(C[o],$,qt,$t,ie)===!1)return!1;$++,oe==="MultiPoint"&&$t++}oe==="LineString"&&$t++;break;case"Polygon":case"MultiLineString":for(o=0;o<C.length;o++){for(f=0;f<C[o].length-j;f++){if(r(C[o][f],$,qt,$t,ie)===!1)return!1;$++}oe==="MultiLineString"&&$t++,oe==="Polygon"&&ie++}oe==="Polygon"&&$t++;break;case"MultiPolygon":for(o=0;o<C.length;o++){for(ie=0,f=0;f<C[o].length;f++){for(b=0;b<C[o][f].length-j;b++){if(r(C[o][f][b],$,qt,$t,ie)===!1)return!1;$++}ie++}$t++}break;case"GeometryCollection":for(o=0;o<u.geometries.length;o++)if(ya(u.geometries[o],r,s)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ta(z,r){(function(s,o){var f,b,u,w,C,M,K,j,$,ot,ct=0,wt=s.type==="FeatureCollection",Ct=s.type==="Feature",qt=wt?s.features.length:1;for(f=0;f<qt;f++){for(M=wt?s.features[f].geometry:Ct?s.geometry:s,j=wt?s.features[f].properties:Ct?s.properties:{},$=wt?s.features[f].bbox:Ct?s.bbox:void 0,ot=wt?s.features[f].id:Ct?s.id:void 0,C=(K=!!M&&M.type==="GeometryCollection")?M.geometries.length:1,u=0;u<C;u++)if((w=K?M.geometries[u]:M)!==null)switch(w.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(o(w,ct,j,$,ot)===!1)return!1;break;case"GeometryCollection":for(b=0;b<w.geometries.length;b++)if(o(w.geometries[b],ct,j,$,ot)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}else if(o(null,ct,j,$,ot)===!1)return!1;ct++}})(z,function(s,o,f,b,u){var w,C=s===null?null:s.type;switch(C){case null:case"Point":case"LineString":case"Polygon":return r((0,Lx.zL)(s,f,{bbox:b,id:u}),o,0)!==!1&&void 0}switch(C){case"MultiPoint":w="Point";break;case"MultiLineString":w="LineString";break;case"MultiPolygon":w="Polygon"}for(var M=0;M<s.coordinates.length;M++){var K={type:w,coordinates:s.coordinates[M]};if(r((0,Lx.zL)(K,f),o,M)===!1)return!1}})}function N(z,r,s){var o=s,f=!1;return function(b,u){ta(b,function(w,C,M){var K=0;if(w.geometry){var j=w.geometry.type;if(j!=="Point"&&j!=="MultiPoint"){var $,ot=0,ct=0,wt=0;return ya(w,function(Ct,qt,kt,$t,ie){if($===void 0||C>ot||$t>ct||ie>wt)return $=Ct,ot=C,ct=$t,wt=ie,void(K=0);var oe=(0,Lx.Tu)([$,Ct],w.properties);if(u(oe,C,M,ie,K)===!1)return!1;K++,$=Ct})!==!1&&void 0}}})}(z,function(b,u,w,C,M){o=f===!1&&s===void 0?b:r(o,b,u,w,C,M),f=!0}),o}class a{static createGridXY_Delt(r,s,o,f,b,u){let w,C,M;C=(o-r)/b+1,M=(f-s)/u+1;let K=[],j=[];for(w=0;w<C;w++)K[w]=r+w*b;for(w=0;w<M;w++)j[w]=s+w*u;let $=[];return $.push(K),$.push(j),$}static createGridXY_Num(r,s,o,f,b,u){let w,C,M,K=b.length,j=u.length;for(C=(o-r)/K,M=(f-s)/j,w=0;w<K;w++)b[w]=r+w*C;for(w=0;w<j;w++)u[w]=s+w*M}static interpolation_IDW_Neighbor(r,s,o,f){let b,u,w;u=s.length,b=o.length,w=r.length;let C,M,K,j,$,ot,ct,wt,Ct,qt,kt=[];qt=f;let $t=[];for($t[0]=[],$t[1]=[],C=0;C<b;C++)for(kt[C]=[],M=0;M<u;M++){for(kt[C][M]=-999,ct=0,wt=0,K=0;K<qt;K++){if(s[M]==r[K][0]&&o[C]==r[K][1]){kt[C][M]=r[K][2];break}ot=1/(Math.pow(s[M]-r[K][0],2)+Math.pow(o[C]-r[K][1],2)),$t[0][K]=ot,$t[1][K]=K}if(kt[C][M]==-999){for(K=qt;K<w;K++){if(Math.pow(s[M]-r[K][0],2)+Math.pow(o[C]-r[K][1],2)==0){kt[C][M]=r[K][2];break}for(ot=1/(Math.pow(s[M]-r[K][0],2)+Math.pow(o[C]-r[K][1],2)),Ct=parseFloat($t[0][0]),$=0,j=1;j<qt;j++)parseFloat($t[0][j])<Ct&&(Ct=parseFloat($t[0][j]),$=j);ot>Ct&&($t[0][$]=ot,$t[1][$]=K)}if(kt[C][M]==-999){for(K=0;K<qt;K++)ct+=parseFloat($t[0][K])*r[parseInt($t[1][K])][2],wt+=parseFloat($t[0][K]);kt[C][M]=ct/wt}}}for(C=1;C<b-1;C++)for(M=1;M<u-1;M++)kt[C][M]=kt[C][M]+.125*(kt[C+1][M]+kt[C-1][M]+kt[C][M+1]+kt[C][M-1]-4*kt[C][M]);return kt}static interpolation_IDW_Neighbor_Undef(r,s,o,f,b){let u,w,C;w=s.length,u=o.length,C=r.length;let M,K,j,$,ot,ct,wt,Ct,qt,kt,$t=[];kt=f;let ie,oe=[],ae=[];for(ae[0]=[],ae[1]=[],M=0;M<u;M++)for($t[M]=[],K=0;K<w;K++){for($t[M][K]=b,wt=0,Ct=0,ie=0,j=0;j<C;j++)if(r[j][2]!=b){if(s[K]==r[j][0]&&o[M]==r[j][1]){$t[M][K]=r[j][2];break}ct=1/(Math.pow(s[K]-r[j][0],2)+Math.pow(o[M]-r[j][1],2)),oe[j]=ct,ie<kt&&(ae[0][ie]=ct,ae[1][ie]=j),ie+=1}else oe[j]=-1;if($t[M][K]==b){for(j=0;j<C;j++)if(ct=oe[j],ct!=-1){for(qt=ae[0][0],ot=0,$=1;$<kt;$++)ae[0][$]<qt&&(qt=ae[0][$],ot=$);ct>qt&&(ae[0][ot]=ct,ae[1][ot]=j)}for(j=0;j<kt;j++)wt+=ae[0][j]*r[ae[1][j]][2],Ct+=ae[0][j];$t[M][K]=wt/Ct}}for(M=1;M<u-1;M++)for(K=1;K<w-1;K++)$t[M][K]=$t[M][K]+.125*($t[M+1][K]+$t[M-1][K]+$t[M][K+1]+$t[M][K-1]-4*$t[M][K]);return $t}static interpolation_IDW_Radius(r,s,o,f,b,u){let w,C,M;C=s.length,w=o.length,M=r.length;let K,j,$,ot,ct,wt,Ct,qt,kt=[];for(K=0;K<w;K++)for(kt[K]=[],j=0;j<C;j++){for(kt[K][j]=u,qt=!1,wt=0,Ct=0,ot=0,$=0;$<M;$++)if(r[$][2]!=u&&!(r[$][0]<s[j]-b||r[$][0]>s[j]+b||r[$][1]<o[K]-b||r[$][1]>o[K]+b)){if(s[j]==r[$][0]&&o[K]==r[$][1]){kt[K][j]=r[$][2],qt=!0;break}Math.sqrt(Math.pow(s[j]-r[$][0],2)+Math.pow(o[K]-r[$][1],2))<=b&&(ct=1/(Math.pow(s[j]-r[$][0],2)+Math.pow(o[K]-r[$][1],2)),Ct+=ct,wt+=r[$][2]*ct,ot+=1)}qt||ot>=f&&(kt[K][j]=wt/Ct)}for(K=1;K<w-1;K++)for(j=1;j<C-2;j++)kt[K][j]!=u&&kt[K+1][j]!=u&&kt[K-1][j]!=u&&kt[K][j+1]!=u&&kt[K][j-1]!=u&&(kt[K][j]=kt[K][j]+.125*(kt[K+1][j]+kt[K-1][j]+kt[K][j+1]+kt[K][j-1]-4*kt[K][j]));return kt}static interpolation_Grid(r,s,o,f,b,u){let w=2*s.length-1,C=2*o.length-1;b=[],u=[];let M,K,j,$,ot,ct,wt,Ct=[];for(M=0;M<w;M++)b[M]=M%2==0?s[M/2]:(s[(M-1)/2]+s[(M-1)/2+1])/2;for(M=0;M<C;M++)for(u[M]=M%2==0?o[M/2]:(o[(M-1)/2]+o[(M-1)/2+1])/2,K=0;K<w;K++)if(Ct[K]=[],M%2==0&&K%2==0)Ct[M][K]=r[M/2][K/2];else if(M%2==0&&K%2!=0)j=r[M/2][(K-1)/2],$=r[M/2][(K-1)/2+1],wt=[],j!=f&&wt.push(j),$!=f&&wt.push($),wt.length===0?Ct[M][K]=f:wt.length==1?Ct[M][K]=wt[0]:Ct[M][K]=(j+$)/2;else if(M%2!=0&&K%2==0)j=r[(M-1)/2][K/2],$=r[(M-1)/2+1][K/2],wt=[],j!=f&&wt.push(j),$!=f&&wt.push($),wt.length===0?Ct[M][K]=f:wt.length==1?Ct[M][K]=wt[0]:Ct[M][K]=(j+$)/2;else if(j=r[(M-1)/2][(K-1)/2],$=r[(M-1)/2][(K-1)/2+1],ot=r[(M-1)/2+1][(K-1)/2+1],ct=r[(M-1)/2+1][(K-1)/2],wt=[],j!=f&&wt.push(j),$!=f&&wt.push($),ot!=f&&wt.push(ot),ct!=f&&wt.push(ct),wt.length)Ct[M][K]=f;else if(wt.length==1)Ct[M][K]=wt[0];else{let qt=0;for(let kt of wt)qt+=kt;Ct[M][K]=qt/wt.length}return Ct}static cressman(r,s,o,f){let b=[];return b.push(10),b.push(7),b.push(4),b.push(2),b.push(1),a.cressman_rad(r,s,o,f,b)}static cressman_rad(r,s,o,f,b){let u,w,C,M,K=s.length,j=o.length,$=r.length,ot=[],ct=b.length,wt=s[0],Ct=s[s.length-1],qt=o[0],kt=o[o.length-1],$t=s[1]-s[0],ie=o[1]-o[0],oe=0,ae=0,fe=0,le=[];for(u=0;u<$;u++)le[u]=[],C=r[u][0],M=r[u][1],le[u][0]=Math.floor((C-wt)/$t),le[u][1]=Math.floor((M-qt)/ie),le[u][2]=r[u][2],le[u][2]!=f&&(ae+=le[u][2],fe+=1);ae/=fe;let ge,_e=[],Le=[];for(u=0;u<j;u++)for(_e[u]=[],Le[u]=[],w=0;w<K;w++)_e[u][w]=-9999e17,Le[u][w]=9999e17;for(ge=b.length>0?b[0]:4,u=0;u<j;u++)for(M=u,qt=M-ge,kt=M+ge,ot[u]=[],w=0;w<K;w++){C=w,wt=C-ge,Ct=C+ge,fe=0,oe=0;for(let Re=0;Re<$;Re++){let Ke=le[Re][2],i0=le[Re][0],We=le[Re][1];i0<0||i0>=K-1||We<0||We>=j-1||Ke==f||i0<wt||i0>Ct||We<qt||We>kt||Math.sqrt(Math.pow(i0-C,2)+Math.pow(We-M,2))>ge||(oe+=Ke,fe+=1,_e[u][w]<Ke&&(_e[u][w]=Ke),Le[u][w]>Ke&&(Le[u][w]=Ke))}ot[u][w]=fe==0?f:oe/fe}for(let Re=0;Re<ct;Re++)for(ge=b[Re],u=0;u<j;u++)for(M=u,qt=M-ge,kt=M+ge,w=0;w<K;w++){if(ot[u][w]==f)continue;C=w,wt=C-ge,Ct=C+ge,oe=0;let Ke=0;for(let i0=0;i0<$;i0++){let We=le[i0][2],Xe=le[i0][0],Ze=le[i0][1];if(Xe<0||Xe>=K-1||Ze<0||Ze>=j-1||We==f||Xe<wt||Xe>Ct||Ze<qt||Ze>kt)continue;let Qe=Math.sqrt(Math.pow(Xe-C,2)+Math.pow(Ze-M,2));if(Qe>ge)continue;let v0,o0=Ze,A0=Xe,sx=o0+1,Y0=A0+1,xx=ot[o0][A0],V0=ot[o0][Y0],Px=ot[sx][A0],Vi=ot[sx][Y0],Yx=[];if(xx!=f&&Yx.push(xx),V0!=f&&Yx.push(V0),Px!=f&&Yx.push(Px),Vi!=f&&Yx.push(Vi),Yx.length===0)continue;if(Yx.length==1)v0=Yx[0];else if(Yx.length<=3){let _i=0;for(let _s of Yx)_i+=_s;v0=_i/Yx.length}else{let _i=xx+(Px-xx)*(Ze-o0);v0=_i+(V0+(Vi-V0)*(Ze-o0)-_i)*(Xe-A0)}let Yn=(ge*ge-Qe*Qe)/(ge*ge+Qe*Qe);oe+=(We-v0)*Yn,Ke+=Yn}if(Ke<1e-6)ot[u][w]=f;else{let i0=ot[u][w]+oe/Ke;ot[u][w]=Math.max(Le[u][w],Math.min(_e[u][w],i0))}}return ot}static assignPointToGrid(r,s,o,f){let b,u,w;u=s.length,b=o.length,w=r.length;let C=[],M=s[1]-s[0],K=o[1]-o[0],j=[];for(let $=0;$<b;$++){j[$]=[],C[$]=[];for(let ot=0;ot<u;ot++)j[$][ot]=0,C[$][ot]=0}for(let $=0;$<w;$++){if(a.doubleEquals(r[$][2],f))continue;let ot=r[$][0],ct=r[$][1];if(ot<s[0]||ot>s[u-1]||ct<o[0]||ct>o[b-1])continue;let wt=((ot-s[0])/M).toFixed(0),Ct=((ct-o[0])/K).toFixed(0);j[Ct][wt]+=1,C[Ct][wt]+=r[$][2]}for(let $=0;$<b;$++)for(let ot=0;ot<u;ot++)j[$][ot]==0?C[$][ot]=f:C[$][ot]=C[$][ot]/j[$][ot];return C}static doubleEquals(r,s){return Math.abs(r/s-1)<1e-11}}class _{constructor(){this.LineList=[]}getLineNum(){return this.LineList.length}}class E{constructor(r,s,o,f){this.xMin=r,this.xMax=s,this.yMin=o,this.yMax=f}Include(r){return this.xMin<=r.xMin&&this.xMax>=r.xMax&&this.yMin<=r.yMin&&this.yMax>=r.yMax}}class V{constructor(){this.extent=new E,this.pointList=[],this.ijPointList=[]}}class xt{constructor(r,s){this.X=r||0,this.Y=s||0}clone(){return new xt(this.X,this.Y)}}class vt{constructor(){this.Point=new xt}clone(){let r=new vt;return r.Id=this.Id,r.BorderIdx=this.BorderIdx,r.BInnerIdx=this.BInnerIdx,r.Point=this.Point,r.Value=this.Value,r}}class Wt{constructor(){this.sPoint=new xt,this.Point=new xt}}class Ht{}class Gt{}class Xt{constructor(r,s){this.X=r,this.Y=s}}class Ft{constructor(){this.PointList=[]}}class te{constructor(){this.IsInnerBorder=!1,this.Extent=new E,this.OutLine=new Ft,this.HoleLines=[]}Clone(){let r=new te;r.IsBorder=this.IsBorder,r.LowValue=this.LowValue,r.HighValue=this.HighValue,r.IsClockWise=this.IsClockWise,r.StartPointIdx=this.StartPointIdx,r.IsHighCenter=this.IsHighCenter,r.Extent=this.Extent,r.Area=this.Area,r.OutLine=this.OutLine;for(let s of this.HoleLines)r.HoleLines.push(s);return r.HoleIndex=this.HoleIndex,r}HasHoles(){return this.HoleLines.length>0}AddHole(r){if(r instanceof te)this.HoleLines.push(r.OutLine);else{let s=r;zt.isClockwise(s)&&(s=s.reverse());let o=new Ft;o.PointList=s,this.HoleLines.push(o)}}}class zt{static tracingContourLines(r,s,o,f,b,u,w,C){return zt.createContourLines_UndefData(r,s,o,f,b,C,u,w)}static tracingBorders(r,s,o,f,b){let u,w,C,M,K,j,$,ot,ct,wt,Ct,qt,kt,$t=[];for(u=r.length,w=r[0].length,C=0;C<u;C++)for(f[C]=[],M=0;M<w;M++)zt.doubleEquals(r[C][M],b)?f[C][M]=0:f[C][M]=1;for(C=1;C<u-1;C++)for(M=1;M<w-1;M++)f[C][M]===1&&(K=f[C][M-1],j=f[C][M+1],$=f[C-1][M],ot=f[C+1][M],ct=f[C-1][M-1],wt=f[C-1][M+1],Ct=f[C+1][M-1],qt=f[C+1][M+1],K>0&&j>0&&$>0&&ot>0&&ct>0&&wt>0&&Ct>0&&qt>0&&(f[C][M]=2),K+j+$+ot+ct+wt+Ct+qt<=2&&(f[C][M]=0));for(;;){for(kt=!1,C=1;C<u-1;C++)for(M=1;M<w-1;M++)f[C][M]===1&&(K=f[C][M-1],j=f[C][M+1],$=f[C-1][M],ot=f[C+1][M],ct=f[C-1][M-1],wt=f[C-1][M+1],Ct=f[C+1][M-1],qt=f[C+1][M+1],(K===0&&j===0||$===0&&ot===0)&&(f[C][M]=0,kt=!0),(Ct===0&&j===0&&$===0||qt===0&&K===0&&$===0||ct===0&&j===0&&ot===0||wt===0&&K===0&&ot===0)&&(f[C][M]=0,kt=!0));if(!kt)break}for(M=0;M<w;M++)f[0][M]===1&&(f[1][M]===0?f[0][M]=0:M===0?f[0][M+1]===0&&(f[0][M]=0):M===w-1?f[0][w-2]===0&&(f[0][M]=0):f[0][M-1]===0&&f[0][M+1]===0&&(f[0][M]=0)),f[u-1][M]===1&&(f[u-2][M]===0?f[u-1][M]=0:M===0?f[u-1][M+1]===0&&(f[u-1][M]=0):M===w-1?f[u-1][w-2]===0&&(f[u-1][M]=0):f[u-1][M-1]===0&&f[u-1][M+1]===0&&(f[u-1][M]=0));for(C=0;C<u;C++)f[C][0]===1&&(f[C][1]===0?f[C][0]=0:C===0?f[C+1][0]===0&&(f[C][0]=0):C===u-1?f[u-2][0]===0&&(f[C][0]=0):f[C-1][0]===0&&f[C+1][0]===0&&(f[C][0]=0)),f[C][w-1]===1&&(f[C][w-2]===0?f[C][w-1]=0:C===0?f[C+1][w-1]===0&&(f[C][w-1]=0):C===u-1?f[u-2][w-1]===0&&(f[C][w-1]=0):f[C-1][w-1]===0&&f[C+1][w-1]===0&&(f[C][w-1]=0));let ie=[];for(C=0;C<u+2;C++)for(ie[C]=[],M=0;M<w+2;M++)ie[C][M]=C===0||C===u+1||M===0||M===w+1?0:f[C-1][M-1];let oe,ae,fe,le,ge,_e=[];for(C=0;C<u+2;C++)for(_e[C]=[],M=0;M<w+2;M++)ie[C][M]===1?(K=ie[C][M-1],j=ie[C][M+1],$=ie[C-1][M],ot=ie[C+1][M],ct=ie[C-1][M-1],wt=ie[C-1][M+1],Ct=ie[C+1][M-1],qt=ie[C+1][M+1],_e[C][M]=K===1&&j===1&&$===1&&ot===1&&(ct===0&&qt===0||wt===0&&Ct===0)?2:1):_e[C][M]=0;let Le,Re,Ke,i0,We,Xe,Ze=0,Qe=0;for(C=1;C<u+1;C++)for(M=1;M<w+1;M++)if(ie[C][M]===1){for(le=[],ge=[],oe=new xt,oe.X=s[M-1],oe.Y=o[C-1],ae=new Ht,ae.I=C-1,ae.J=M-1,le.push(oe),ge.push(ae),Le=C,Re=M,We=C,Xe=M,Ke=We,i0=-1;;){let xx=[];if(xx[0]=Ze,xx[1]=Qe,!zt.traceBorder(ie,Ke,We,i0,Xe,xx)||(Ze=xx[0],Qe=xx[1],Ke=We,i0=Xe,We=Ze,Xe=Qe,_e[Ze][Qe]=_e[Ze][Qe]-1,_e[Ze][Qe]===0&&(ie[Ze][Qe]=3),oe=new xt,oe.X=s[Qe-1],oe.Y=o[Ze-1],ae=new Ht,ae.I=Ze-1,ae.J=Qe-1,le.push(oe),ge.push(ae),Ze===Le&&Qe===Re))break}_e[C][M]=_e[C][M]-1,_e[C][M]===0&&(ie[C][M]=3),le.length>1&&(fe=new V,fe.area=zt.getExtentAndArea(le,fe.extent),fe.isOutLine=!0,fe.isClockwise=!0,fe.pointList=le,fe.ijPointList=ge,$t.push(fe))}let v0,o0,A0,sx,Y0=[];for(C=1;C<$t.length;C++)for(o0=$t[C],M=0;M<C;M++)if(A0=$t[C],o0.area>A0.area){$t.splice(C,1),$t.splice(M,0,o0);break}if($t.length===1)o0=$t[0],zt.isClockwise(o0.pointList)||(o0.pointList=o0.pointList.reverse(),o0.ijPointList.reverse()),o0.isClockwise=!0,sx=[],sx.push(o0),v0=new _,v0.LineList=sx,Y0.push(v0);else for(C=0;C<$t.length&&C!==$t.length;C++){for(o0=$t[C],zt.isClockwise(o0.pointList)||(o0.pointList.reverse(),o0.ijPointList.reverse()),o0.isClockwise=!0,sx=[],sx.push(o0),M=C+1;M<$t.length&&M!==$t.length;M++)A0=$t[C],A0.extent.xMin>o0.extent.xMin&&A0.extent.xMax<o0.extent.xMax&&A0.extent.yMin>o0.extent.yMin&&A0.extent.yMax<o0.extent.yMax&&(oe=A0.pointList[0],zt.pointInPolygonByPList(o0.pointList,oe)&&(A0.isOutLine=!1,zt.isClockwise(A0.pointList)&&(A0.pointList.reverse(),A0.ijPointList.reverse()),A0.isClockwise=!1,sx.push(A0),$t.splice(M,1),M-=1));v0=new _,v0.LineList=sx,Y0.push(v0)}return Y0}static createContourLines_UndefData(r,s,o,f,b,u,w,C){let M,K,j,$,ot,ct,wt=[];for(K=r.length,j=r[0].length,ct=1e-5*b[0],ct===0&&(ct=1e-5),$=0;$<K;$++)for(ot=0;ot<j;ot++)zt.doubleEquals(r[$][ot],w)||(r[$][ot]=r[$][ot]+ct);let Ct,qt,kt,$t,ie,oe,ae,fe,le=[],ge=[];for(le[0]=[],le[1]=[],ge[0]=[],ge[1]=[],$=0;$<K;$++)for(le[0][$]=[],le[1][$]=[],ge[0][$]=[],ge[1][$]=[],ot=0;ot<j;ot++)ot<j-1&&(le[0][$][ot]=-1,le[1][$][ot]=-1),$<K-1&&(ge[0][$][ot]=-1,ge[1][$][ot]=-1);for($=0;$<C.length;$++)for(Ct=C[$],ot=0;ot<Ct.getLineNum();ot++)for(qt=Ct.LineList[ot],kt=qt.ijPointList,$t=0;$t<kt.length-1;$t++)ae=kt[$t],fe=kt[$t+1],ae.I===fe.I?(ie=ae.I,oe=Math.min(ae.J,fe.J),le[0][ie][oe]=$,fe.J>ae.J?le[1][ie][oe]=1:le[1][ie][oe]=0):(oe=ae.J,ie=Math.min(ae.I,fe.I),ge[0][ie][oe]=$,fe.I>ae.I?ge[1][ie][oe]=0:ge[1][ie][oe]=1);let _e,Le,Re,Ke,i0=[],We=[];for(Le=0;Le<f;Le++){for(_e=b[Le],$=0;$<K;$++)for(i0[$]=[],We[$]=[],ot=0;ot<j;ot++)ot<j-1&&(u[$][ot]!==0&&u[$][ot+1]!==0&&(r[$][ot]-_e)*(r[$][ot+1]-_e)<0?i0[$][ot]=(_e-r[$][ot])/(r[$][ot+1]-r[$][ot]):i0[$][ot]=-2),$<K-1&&(u[$][ot]!==0&&u[$+1][ot]!==0&&(r[$][ot]-_e)*(r[$+1][ot]-_e)<0?We[$][ot]=(_e-r[$][ot])/(r[$+1][ot]-r[$][ot]):We[$][ot]=-2);M=zt.isoline_UndefData(r,s,o,_e,i0,We,le,ge,wt.length);for(let Xe of M)wt.push(Xe)}for($=0;$<C.length;$++)for(Ct=C[$],qt=Ct.LineList[0],ot=0;ot<wt.length;ot++)Re=wt[ot],Re.Type==="Close"&&(Ke=Re.PointList[0],zt.pointInPolygonByPList(qt.pointList,Ke)&&(Re.BorderIdx=$)),wt.splice(ot,1),wt.splice(ot,0,Re);return wt}static createContourLines(r,s,o,f,b,u,w){let C,M,K,j,$,ot,ct,wt,Ct,qt=[];ot=r.length,ct=r[0].length;let kt,$t,ie,oe=[],ae=[];for(kt=1e-5*b[0],kt===0&&(kt=1e-5),wt=0;wt<ot;wt++)for(Ct=0;Ct<ct;Ct++)r[wt][Ct]=r[wt][Ct]+kt;for(ie=0;ie<f;ie++){for($t=b[ie],wt=0;wt<ot;wt++)for(Ct=0;Ct<ct;Ct++)Ct<ct-1&&((r[wt][Ct]-$t)*(r[wt][Ct+1]-$t)<0?oe[wt][Ct]=($t-r[wt][Ct])/(r[wt][Ct+1]-r[wt][Ct]):oe[wt][Ct]=-2),wt<ot-1&&((r[wt][Ct]-$t)*(r[wt+1][Ct]-$t)<0?ae[wt][Ct]=($t-r[wt][Ct])/(r[wt+1][Ct]-r[wt][Ct]):ae[wt][Ct]=-2);C=zt.isoline_Bottom(r,s,o,$t,u,w,oe,ae),M=zt.isoline_Left(r,s,o,$t,u,w,oe,ae),K=zt.isoline_Top(r,s,o,$t,u,w,oe,ae),j=zt.isoline_Right(r,s,o,$t,u,w,oe,ae),$=zt.isoline_Close(r,s,o,$t,u,w,oe,ae),zt.addAll(C,qt),zt.addAll(M,qt),zt.addAll(K,qt),zt.addAll(j,qt),zt.addAll($,qt)}return qt}static addAll(r,s){s||console.log("������������֮ǰ��Ҫ�ȳ�ʼ��Ŀ�����飡");for(let o of r)s.push(o)}static cutContourWithPolygon(r,s){let o,f,b,u,w,C,M,K,j,$,ot,ct,wt,Ct,qt,kt=[],$t=new Ft,ie=new Wt;for(zt._endPointList=[],zt.isClockwise(s)||s.reverse(),o=0;o<r.length;o++){u=r[o],C=u.Value,M=u.Type,w=[],zt.addAll(u.PointList,w),K=!1;let oe=[];if(M==="Close"&&zt.pointInPolygonByPList(s,w[0])){let ae=!0,fe=0;for(f=0;f<w.length;f++)if(!zt.pointInPolygonByPList(s,w[f])){fe=f,ae=!1;break}if(!ae){let le=[];for(f=fe;f<w.length;f++)le.push(w[0]);for(f=1;f<fe;f++)le.push(w[0]);le.push(le[0]),w=le}}for(ot=new xt,f=0;f<w.length;f++){if(ct=w[f],zt.pointInPolygonByPList(s,ct)){if(!K&&f>0){for(Ct=new Gt,Ct.P1=ot,Ct.P2=ct,j=s[s.length-1],wt=new xt,b=0;b<s.length;b++){if($=s[b],qt=new Gt,qt.P1=j,qt.P2=$,zt.isLineSegmentCross(Ct,qt)){wt=zt.getCrossPointD(Ct,qt),ie.sPoint=j,ie.Point=wt,ie.Index=kt.length,zt._endPointList.push(ie);break}j=$}oe.push(wt),M="Border"}oe.push(w[f]),K=!0}else if(K){for(Ct=new Gt,Ct.P1=ot,Ct.P2=ct,j=s[s.length-1],wt=new xt,b=0;b<s.length;b++){if($=s[b],qt=new Gt,qt.P1=j,qt.P2=$,zt.isLineSegmentCross(Ct,qt)){wt=zt.getCrossPointD(Ct,qt),ie.sPoint=j,ie.Point=wt,ie.Index=kt.length,zt._endPointList.push(ie);break}j=$}oe.push(wt),$t.Value=C,$t.Type=M,$t.PointList=oe,kt.push($t),K=!1,oe=[],M="Border"}ot=ct}K&&oe.length>1&&($t.Value=C,$t.Type=M,$t.PointList=oe,kt.push($t))}return kt}static cutContourLines(r,s){let o,f,b,u,w,C,M,K,j,$,ot,ct,wt,Ct,qt,kt,$t=s.LineList[0].pointList,ie=[],oe=new Wt;for(zt._endPointList=[],zt.isClockwise($t)||$t.reverse(),o=0;o<r.length;o++){u=r[o],M=u.Value,K=u.Type,C=[],zt.addAll(u.PointList,C),j=!1;let ae=[];if(K==="Close"&&zt.pointInPolygonByPList($t,C[0])){let fe=!0,le=0;for(f=0;f<C.length;f++)if(!zt.pointInPolygonByPList($t,C[f])){le=f,fe=!1;break}if(!fe){let ge=[];for(f=le;f<C.length;f++)ge.push(C[f]);for(f=1;f<le;f++)ge.push(C[f]);ge.push(ge[0]),C=ge}}for(ct=new xt,f=0;f<C.length;f++){if(wt=C[f],zt.pointInPolygonByPList($t,wt)){if(!j&&f>0){for(qt=new Gt,qt.P1=ct,qt.P2=wt,$=$t[$t.length-1],Ct=new xt,b=0;b<$t.length;b++){if(ot=$t[b],kt=new Gt,kt.P1=$,kt.P2=ot,zt.isLineSegmentCross(qt,kt)){Ct=zt.getCrossPointD(qt,kt),oe.sPoint=$,oe.Point=Ct,oe.Index=ie.length,zt._endPointList.push(oe);break}$=ot}ae.push(Ct),K="Border"}ae.push(C[f]),j=!0}else if(j){for(qt=new Gt,qt.P1=ct,qt.P2=wt,$=$t[$t.length-1],Ct=new xt,b=0;b<$t.length;b++){if(ot=$t[b],kt=new Gt,kt.P1=$,kt.P2=ot,zt.isLineSegmentCross(qt,kt)){Ct=zt.getCrossPointD(qt,kt),oe.sPoint=$,oe.Point=Ct,oe.Index=ie.length,zt._endPointList.push(oe);break}$=ot}ae.push(Ct),w=new Ft,w.Value=M,w.Type=K,w.PointList=ae,ie.push(w),j=!1,ae=[],K="Border"}ct=wt}j&&ae.length>1&&(w=new Ft,w.Value=M,w.Type=K,w.PointList=ae,ie.push(w))}return ie}static smoothLines(r){let s,o,f,b=[];for(s=0;s<r.length;s++)if(o=r[s],f=[],zt.addAll(o.PointList,f),!(f.length<=1)){if(f.length===2){let u=new xt,w=f[0],C=f[1];u.X=(C.X-w.X)/4+w.X,u.Y=(C.Y-w.Y)/4+w.Y,f.splice(1,0,u),u=new xt,u.X=(C.X-w.X)/4*3+w.X,u.Y=(C.Y-w.Y)/4*3+w.Y,f.splice(2,0,u)}if(f.length===3){let u=new xt,w=f[0],C=f[1];u.X=(C.X-w.X)/2+w.X,u.Y=(C.Y-w.Y)/2+w.Y,f.splice(1,0,u)}f=zt.BSplineScanning(f,f.length),o.PointList=f,b.push(o)}return b}static smoothPoints(r){return zt.BSplineScanning(r,r.length)}static tracingPolygons(r,s,o,f){let b,u,w,C,M,K,j,$,ot,ct,wt,Ct,qt=[],kt=[],$t=[],ie=[],oe=[],ae=0;for(j=0;j<o.length;j++){if(oe=[],$t=[],ie=[],qt=[],w=o[j],C=w.LineList[0],u=C.pointList,zt.isClockwise(u)||u.reverse(),w.getLineNum()===1){for($=0;$<u.length;$++)M=u[$],K=new vt,K.Id=-1,K.Point=M,K.Value=r[C.ijPointList[$].I][C.ijPointList[$].J],oe.push(K);for($=0;$<s.length;$++)ot=s[$],ot.BorderIdx===j&&(ie.push(ot),ot.Type==="Border"&&(M=ot.PointList[0],K=new vt,K.Id=ie.length-1,K.Point=M,K.Value=ot.Value,$t.push(K),M=ot.PointList[ot.PointList.length-1],K=new vt,K.Id=ie.length-1,K.Point=M,K.Value=ot.Value,$t.push(K)));if(ie.length===0){if(wt=C.ijPointList[0],ct=new te,r[wt.I][wt.J]<f[0])ae=f[0],ct.IsHighCenter=!1;else{for($=f.length-1;$>=0;$--)if(r[wt.I][wt.J]>f[$]){ae=f[$];break}ct.IsHighCenter=!0}u.length>0&&(ct.IsBorder=!0,ct.HighValue=ae,ct.LowValue=ae,ct.Extent=new E,ct.Area=zt.getExtentAndArea(u,ct.Extent),ct.StartPointIdx=0,ct.IsClockWise=!0,ct.OutLine.Type="Border",ct.OutLine.Value=ae,ct.OutLine.BorderIdx=j,ct.OutLine.PointList=u,ct.HoleLines=[],qt.push(ct))}else b=$t.length>0?zt.insertPoint2Border($t,oe):oe,qt=zt.tracingPolygons_Line_Border(ie,b);qt=zt.addPolygonHoles(qt)}else{for(C=w.LineList[0],$=0;$<s.length;$++)ot=s[$],ot.BorderIdx===j&&(ie.push(ot),ot.Type==="Border"&&(M=ot.PointList[0],K=new vt,K.Id=ie.length-1,K.Point=M,K.Value=ot.Value,$t.push(K),M=ot.PointList[ot.PointList.length-1],K=new vt,K.Id=ie.length-1,K.Point=M,K.Value=ot.Value,$t.push(K)));if(ie.length===0){if(wt=C.ijPointList[0],ct=new te,r[wt.I][wt.J]<f[0])ae=f[0],ct.IsHighCenter=!1;else{for($=f.length-1;$>=0;$--)if(r[wt.I][wt.J]>f[$]){ae=f[$];break}ct.IsHighCenter=!0}u.length>0&&(ct.IsBorder=!0,ct.HighValue=ae,ct.LowValue=ae,ct.Area=zt.getExtentAndArea(u,ct.Extent),ct.StartPointIdx=0,ct.IsClockWise=!0,ct.OutLine.Type="Border",ct.OutLine.Value=ae,ct.OutLine.BorderIdx=j,ct.OutLine.PointList=u,ct.HoleLines=[],qt.push(ct))}else{Ct=[],Ct.length=w.getLineNum(),b=zt.insertPoint2Border_Ring(r,$t,w,Ct),qt=zt.tracingPolygons_Ring(ie,b,w,f,Ct);let le=[];for(;qt.length>0;){let ge=!1;for($=0;$<le.length;$++)if(qt[0].Area>le[$].Area){le.push(qt[0]),ge=!0;break}ge||le.push(qt[0]),qt.splice(0,1)}qt=le}let fe=[];for($=0;$<w.getLineNum();$++)fe.push(w.LineList[$].pointList);fe.length>0&&zt.addHoles_Ring(qt,fe),qt=zt.addPolygonHoles_Ring(qt)}zt.addAll(qt,kt)}for(let fe of kt)zt.isClockwise(fe.OutLine.PointList)||fe.OutLine.PointList.reverse();return kt}static createContourPolygons(r,s,o){let f,b;return b=zt.insertPoint2RectangleBorder(r,s),f=zt.tracingPolygons_Extent(r,b,s,o),f}static createCutContourPolygons(r,s,o,f){let b,u,w,C,M,K=[];for(zt.isClockwise(s)||s.reverse(),M=0;M<s.length;M++)w=s[M],C=new vt,C.Id=-1,C.Point=w,K.push(C);return u=zt.insertEndPoint2Border(zt._endPointList,K),b=zt.tracingPolygons_Extent(r,u,o,f),b}static createBorderContourPolygons(r,s,o,f,b){let u,w,C,M,K,j,$,ot,ct,wt,Ct,qt=[],kt=[],$t=[],ie=[],oe=[],ae=[],fe=0;for(j=0;j<o.length;j++){if(ae=[],$t=[],oe=[],qt=[],w=o[j],w.getLineNum()===1){for(C=w.LineList[0],ie=C.pointList,zt.isClockwise(ie)||ie.reverse(),$=0;$<ie.length;$++)M=ie[$],K=new vt,K.Id=-1,K.Point=M,K.Value=r[C.ijPointList[$].I][C.ijPointList[$].J],ae.push(K);for($=0;$<s.length;$++)ot=s[$],ot.BorderIdx===j&&(oe.push(ot),ot.Type==="Border"&&(M=ot.PointList[0],K=new vt,K.Id=oe.length-1,K.Point=M,K.Value=ot.Value,$t.push(K),M=ot.PointList[ot.PointList.length-1],K=new vt,K.Id=oe.length-1,K.Point=M,K.Value=ot.Value,$t.push(K)));if(oe.length===0){if(wt=C.ijPointList[0],ct=new te,r[wt.I][wt.J]<b[0])fe=b[0],ct.IsHighCenter=!1;else{for($=b.length-1;$>=0;$--)if(r[wt.I][wt.J]>b[$]){fe=b[$];break}ct.IsHighCenter=!0}ie.length>0&&(ct.HighValue=fe,ct.LowValue=fe,ct.Extent=new E,ct.Area=zt.getExtentAndArea(ie,ct.Extent),ct.StartPointIdx=0,ct.IsClockWise=!0,ct.OutLine.Type="Border",ct.OutLine.Value=fe,ct.OutLine.BorderIdx=j,ct.OutLine.PointList=ie,qt.push(ct))}else u=zt.insertPoint2Border($t,ae),qt=zt.tracingPolygons_Line_Border(oe,u)}else{for(C=w.LineList[0],$=0;$<s.length;$++)ot=s[$],ot.BorderIdx===j&&(oe.push(ot),ot.Type==="Border"&&(M=ot.PointList[0],K=new vt,K.Id=oe.length-1,K.Point=M,K.Value=ot.Value,$t.push(K),M=ot.PointList[ot.PointList.length-1],K=new vt,K.Id=oe.length-1,K.Point=M,K.Value=ot.Value,$t.push(K)));if(oe.length===0){if(ct=new te,wt=C.ijPointList[0],r[wt.I][wt.J]<b[0])fe=b[0],ct.IsHighCenter=!1;else{for($=b.length-1;$>=0;$--)if(r[wt.I][wt.J]>b[$]){fe=b[$];break}ct.IsHighCenter=!0}ie.length>0&&(ct.HighValue=fe,ct.LowValue=fe,ct.Area=zt.getExtentAndArea(ie,ct.Extent),ct.StartPointIdx=0,ct.IsClockWise=!0,ct.OutLine.Type="Border",ct.OutLine.Value=fe,ct.OutLine.BorderIdx=j,ct.OutLine.PointList=ie,qt.push(ct))}else Ct=[],u=zt.insertPoint2Border_Ring(r,$t,w,Ct),qt=zt.tracingPolygons_Ring(oe,u,w,b,Ct)}zt.addAll(qt,kt)}return kt}static pointInPolygonByPList(r,s){let o,f,b,u,w,C,M,K,j,$=!1,ot=r.length;if(ot<3)return!1;for(b=r[ot-1].X,u=r[ot-1].Y,j=0;j<ot;j++)o=r[j].X,f=r[j].Y,o>b?(w=b,M=o,C=u,K=f):(w=o,M=b,C=f,K=u),o<s.X==s.X<=b&&(s.Y-C)*(M-w)<(K-C)*(s.X-w)&&($=!$),b=o,u=f;return $}static pointInPolygon(r,s){if(r.HasHoles()){let o=zt.pointInPolygonByPList(r.OutLine.PointList,s);if(o){for(let f of r.HoleLines)if(zt.pointInPolygonByPList(f.PointList,s)){o=!1;break}}return o}return zt.pointInPolygonByPList(r.OutLine.PointList,s)}static clipPolylines(r,s){let o=[];for(let f of r)zt.addAll(zt.cutPolyline(f,s),o);return o}static clipPolygons(r,s){let o=[];for(let u=0;u<r.length;u++){let w=r[u];w.HasHoles()?zt.addAll(zt.cutPolygon_Hole(w,s),o):zt.addAll(zt.cutPolygon(w,s),o)}let f,b=[];for(let u=0;u<o.length;u++){let w=o[u];f=!1;for(let C=0;C<b.length;C++)if(w.Area>b[C].Area){b.splice(C,0,w),f=!0;break}f||b.push(w)}return b}static traceBorder(r,s,o,f,b,u){let w,C,M,K,j=!0;return s<o?r[o][b-1]===1&&r[o][b+1]===1?(w=r[o-1][b-1],C=r[o+1][b],M=r[o+1][b-1],w!==0&&C===0||w===0&&C!==0&&M!==0?(u[0]=o,u[1]=b-1):(u[0]=o,u[1]=b+1)):r[o][b-1]===1&&r[o+1][b]===1?(w=r[o+1][b-1],C=r[o+1][b+1],M=r[o][b-1],K=r[o][b+1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o,u[1]=b-1):(u[0]=o+1,u[1]=b):(u[0]=o,u[1]=b-1)):r[o][b+1]===1&&r[o+1][b]===1?(w=r[o+1][b-1],C=r[o+1][b+1],M=r[o][b-1],K=r[o][b+1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o,u[1]=b+1):(u[0]=o+1,u[1]=b):(u[0]=o,u[1]=b+1)):r[o][b-1]===1?(u[0]=o,u[1]=b-1):r[o][b+1]===1?(u[0]=o,u[1]=b+1):r[o+1][b]===1?(u[0]=o+1,u[1]=b):j=!1:f<b?r[o+1][b]===1&&r[o-1][b]===1?(w=r[o+1][b-1],C=r[o][b+1],M=r[o+1][b+1],w!==0&&C===0||w===0&&C!==0&&M!==0?(u[0]=o+1,u[1]=b):(u[0]=o-1,u[1]=b)):r[o+1][b]===1&&r[o][b+1]===1?(M=r[o-1][b],K=r[o+1][b],w=r[o-1][b+1],C=r[o+1][b+1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o+1,u[1]=b):(u[0]=o,u[1]=b+1):(u[0]=o+1,u[1]=b)):r[o-1][b]===1&&r[o][b+1]===1?(M=r[o-1][b],K=r[o+1][b],w=r[o-1][b+1],C=r[o+1][b+1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o-1,u[1]=b):(u[0]=o,u[1]=b+1):(u[0]=o-1,u[1]=b)):r[o+1][b]===1?(u[0]=o+1,u[1]=b):r[o-1][b]===1?(u[0]=o-1,u[1]=b):r[o][b+1]===1?(u[0]=o,u[1]=b+1):j=!1:s>o?r[o][b-1]===1&&r[o][b+1]===1?(w=r[o+1][b-1],C=r[o-1][b],M=r[o-1][b+1],w!==0&&C===0||w===0&&C!==0&&M!==0?(u[0]=o,u[1]=b-1):(u[0]=o,u[1]=b+1)):r[o][b-1]===1&&r[o-1][b]===1?(w=r[o-1][b-1],C=r[o-1][b+1],M=r[o][b-1],K=r[o][b+1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o,u[1]=b-1):(u[0]=o-1,u[1]=b):(u[0]=o,u[1]=b-1)):r[o][b+1]===1&&r[o-1][b]===1?(w=r[o-1][b-1],C=r[o-1][b+1],M=r[o][b-1],K=r[o][b+1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o,u[1]=b+1):(u[0]=o-1,u[1]=b):(u[0]=o,u[1]=b+1)):r[o][b-1]===1?(u[0]=o,u[1]=b-1):r[o][b+1]===1?(u[0]=o,u[1]=b+1):r[o-1][b]===1?(u[0]=o-1,u[1]=b):j=!1:f>b&&(r[o+1][b]===1&&r[o-1][b]===1?(w=r[o+1][b+1],C=r[o][b-1],M=r[o-1][b-1],w!==0&&C===0||w===0&&C!==0&&M!==0?(u[0]=o+1,u[1]=b):(u[0]=o-1,u[1]=b)):r[o+1][b]===1&&r[o][b-1]===1?(M=r[o-1][b],K=r[o+1][b],w=r[o-1][b-1],C=r[o+1][b-1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o+1,u[1]=b):(u[0]=o,u[1]=b-1):(u[0]=o+1,u[1]=b)):r[o-1][b]===1&&r[o][b-1]===1?(M=r[o-1][b],K=r[o+1][b],w=r[o-1][b-1],C=r[o+1][b-1],w===0||C===0||M===0||K===0?w===0&&K===0||C===0&&M===0?(u[0]=o-1,u[1]=b):(u[0]=o,u[1]=b-1):(u[0]=o-1,u[1]=b)):r[o+1][b]===1?(u[0]=o+1,u[1]=b):r[o-1][b]===1?(u[0]=o-1,u[1]=b):r[o][b-1]===1?(u[0]=o,u[1]=b-1):j=!1),j}static traceIsoline_UndefData(r,s,o,f,b,u,w,C,M,K,j,$){let ot=!0,ct=0,wt=0,Ct=0,qt=0,kt=!0;return r<s?o[s][u]!==-2&&o[s][u+1]!==-2?o[s][u]<o[s][u+1]?(ct=w[u],wt=C[s]+o[s][u]*(C[s+1]-C[s]),Ct=s,qt=u,o[Ct][qt]=-2,kt=!1):(ct=w[u+1],wt=C[s]+o[s][u+1]*(C[s+1]-C[s]),Ct=s,qt=u+1,o[Ct][qt]=-2,kt=!1):o[s][u]!==-2&&o[s][u+1]===-2?(ct=w[u],wt=C[s]+o[s][u]*(C[s+1]-C[s]),Ct=s,qt=u,o[Ct][qt]=-2,kt=!1):o[s][u]===-2&&o[s][u+1]!==-2?(ct=w[u+1],wt=C[s]+o[s][u+1]*(C[s+1]-C[s]),Ct=s,qt=u+1,o[Ct][qt]=-2,kt=!1):f[s+1][u]!==-2?(ct=w[u]+f[s+1][u]*(w[u+1]-w[u]),wt=C[s+1],Ct=s+1,qt=u,f[Ct][qt]=-2,kt=!0):ot=!1:b<u?f[s][u]!==-2&&f[s+1][u]!==-2?f[s][u]<f[s+1][u]?(ct=w[u]+f[s][u]*(w[u+1]-w[u]),wt=C[s],Ct=s,qt=u,f[Ct][qt]=-2,kt=!0):(ct=w[u]+f[s+1][u]*(w[u+1]-w[u]),wt=C[s+1],Ct=s+1,qt=u,f[Ct][qt]=-2,kt=!0):f[s][u]!==-2&&f[s+1][u]===-2?(ct=w[u]+f[s][u]*(w[u+1]-w[u]),wt=C[s],Ct=s,qt=u,f[Ct][qt]=-2,kt=!0):f[s][u]===-2&&f[s+1][u]!==-2?(ct=w[u]+f[s+1][u]*(w[u+1]-w[u]),wt=C[s+1],Ct=s+1,qt=u,f[Ct][qt]=-2,kt=!0):o[s][u+1]!==-2?(ct=w[u+1],wt=C[s]+o[s][u+1]*(C[s+1]-C[s]),Ct=s,qt=u+1,o[Ct][qt]=-2,kt=!1):ot=!1:w[u]<M?o[s-1][u]!==-2&&o[s-1][u+1]!==-2?o[s-1][u]>o[s-1][u+1]?(ct=w[u],wt=C[s-1]+o[s-1][u]*(C[s]-C[s-1]),Ct=s-1,qt=u,o[Ct][qt]=-2,kt=!1):(ct=w[u+1],wt=C[s-1]+o[s-1][u+1]*(C[s]-C[s-1]),Ct=s-1,qt=u+1,o[Ct][qt]=-2,kt=!1):o[s-1][u]!==-2&&o[s-1][u+1]===-2?(ct=w[u],wt=C[s-1]+o[s-1][u]*(C[s]-C[s-1]),Ct=s-1,qt=u,o[Ct][qt]=-2,kt=!1):o[s-1][u]===-2&&o[s-1][u+1]!==-2?(ct=w[u+1],wt=C[s-1]+o[s-1][u+1]*(C[s]-C[s-1]),Ct=s-1,qt=u+1,o[Ct][qt]=-2,kt=!1):f[s-1][u]!==-2?(ct=w[u]+f[s-1][u]*(w[u+1]-w[u]),wt=C[s-1],Ct=s-1,qt=u,f[Ct][qt]=-2,kt=!0):ot=!1:f[s+1][u-1]!==-2&&f[s][u-1]!==-2?f[s+1][u-1]>f[s][u-1]?(ct=w[u-1]+f[s+1][u-1]*(w[u]-w[u-1]),wt=C[s+1],Ct=s+1,qt=u-1,f[Ct][qt]=-2,kt=!0):(ct=w[u-1]+f[s][u-1]*(w[u]-w[u-1]),wt=C[s],Ct=s,qt=u-1,f[Ct][qt]=-2,kt=!0):f[s+1][u-1]!==-2&&f[s][u-1]===-2?(ct=w[u-1]+f[s+1][u-1]*(w[u]-w[u-1]),wt=C[s+1],Ct=s+1,qt=u-1,f[Ct][qt]=-2,kt=!0):f[s+1][u-1]===-2&&f[s][u-1]!==-2?(ct=w[u-1]+f[s][u-1]*(w[u]-w[u-1]),wt=C[s],Ct=s,qt=u-1,f[Ct][qt]=-2,kt=!0):o[s][u-1]!==-2?(ct=w[u-1],wt=C[s]+o[s][u-1]*(C[s+1]-C[s]),Ct=s,qt=u-1,o[Ct][qt]=-2,kt=!1):ot=!1,K[0]=Ct,K[1]=qt,j[0]=ct,j[1]=wt,$[0]=kt,ot}static isoline_UndefData(r,s,o,f,b,u,w,C,M){let K,j,$,ot,ct=[];K=r.length,j=r[0].length;let wt,Ct,qt,kt,$t,ie,oe,ae,fe,le,ge,_e=0,Le=0,Re=0,Ke=0,i0=!0,We=new Wt;for($=0;$<K;$++)for(ot=0;ot<j;ot++){if(ot<j-1&&w[0][$][ot]>-1&&b[$][ot]!==-2){for(ge=[],Ct=$,kt=ot,$t=s[kt]+b[Ct][kt]*(s[kt+1]-s[kt]),ie=o[Ct],w[1][$][ot]===0?(wt=-1,We.sPoint.X=s[ot+1],We.sPoint.Y=o[$]):(wt=Ct,We.sPoint.X=s[ot],We.sPoint.Y=o[$]),qt=kt,fe=new xt,fe.X=$t,fe.Y=ie,ge.push(fe),We.Index=M+ct.length,We.Point=fe,We.BorderIdx=w[0][$][ot],zt._endPointList.push(We),le=new Ft,le.Type="Border",le.BorderIdx=w[0][$][ot];;){let Xe=[_e,Le],Ze=[Re,Ke],Qe=[i0];if(!zt.traceIsoline_UndefData(wt,Ct,u,b,qt,kt,s,o,$t,Xe,Ze,Qe)){le.Type="Error";break}if(_e=Xe[0],Le=Xe[1],Re=Ze[0],Ke=Ze[1],i0=Qe[0],fe=new xt,fe.X=Re,fe.Y=Ke,ge.push(fe),i0){if(w[0][_e][Le]>-1){w[1][_e][Le]===0?(We.sPoint.X=s[Le+1],We.sPoint.Y=o[_e]):(We.sPoint.X=s[Le],We.sPoint.Y=o[_e]);break}}else if(C[0][_e][Le]>-1){C[1][_e][Le]===0?(We.sPoint.X=s[Le],We.sPoint.Y=o[_e]):(We.sPoint.X=s[Le],We.sPoint.Y=o[_e+1]);break}$t=Re,wt=Ct,qt=kt,Ct=_e,kt=Le}b[$][ot]=-2,ge.length>1&&le.Type!=="Error"?(We.Point=fe,zt._endPointList.push(We),le.Value=f,le.PointList=ge,ct.push(le)):zt._endPointList.pop()}if($<K-1&&C[0][$][ot]>-1&&u[$][ot]!==-2){for(ge=[],Ct=$,kt=ot,$t=s[kt],ie=o[Ct]+u[Ct][kt]*(o[Ct+1]-o[Ct]),wt=Ct,C[1][$][ot]===0?(qt=-1,We.sPoint.X=s[ot],We.sPoint.Y=o[$]):(qt=kt,We.sPoint.X=s[ot],We.sPoint.Y=o[$+1]),fe=new xt,fe.X=$t,fe.Y=ie,ge.push(fe),We.Index=M+ct.length,We.Point=fe,We.BorderIdx=C[0][$][ot],zt._endPointList.push(We),le=new Ft,le.Type="Border",le.BorderIdx=C[0][$][ot];;){let Xe=[_e,Le],Ze=[Re,Ke],Qe=[i0];if(!zt.traceIsoline_UndefData(wt,Ct,u,b,qt,kt,s,o,$t,Xe,Ze,Qe)){le.Type="Error";break}if(_e=Xe[0],Le=Xe[1],Re=Ze[0],Ke=Ze[1],i0=Qe[0],fe=new xt,fe.X=Re,fe.Y=Ke,ge.push(fe),i0){if(w[0][_e][Le]>-1){w[1][_e][Le]===0?(We.sPoint.X=s[Le+1],We.sPoint.Y=o[_e]):(We.sPoint.X=s[Le],We.sPoint.Y=o[_e]);break}}else if(C[0][_e][Le]>-1){C[1][_e][Le]===0?(We.sPoint.X=s[Le],We.sPoint.Y=o[_e]):(We.sPoint.X=s[Le],We.sPoint.Y=o[_e+1]);break}$t=Re,wt=Ct,qt=kt,Ct=_e,kt=Le}u[$][ot]=-2,ge.length>1&&le.Type!=="Error"?(We.Point=fe,zt._endPointList.push(We),le.Value=f,le.PointList=ge,ct.push(le)):zt._endPointList.pop()}}for(ot=0;ot<j-1;ot++)b[0][ot]!==-2&&(b[0][ot]=-2),b[K-1][ot]!==-2&&(b[K-1][ot]=-2);for($=0;$<K-1;$++)u[$][0]!==-2&&(u[$][0]=-2),u[$][j-1]!==-2&&(u[$][j-1]=-2);for($=1;$<K-2;$++)for(ot=1;ot<j-1;ot++)if(u[$][ot]!==-2){let Xe=[];for(Ct=$,kt=ot,$t=s[kt],ie=o[$]+u[$][kt]*(o[$+1]-o[$]),qt=-1,wt=Ct,oe=$t,ae=ie,fe=new xt,fe.X=$t,fe.Y=ie,Xe.push(fe),le=new Ft,le.Type="Close";;){let Ze=[],Qe=[],v0=[];if(!zt.traceIsoline_UndefData(wt,Ct,u,b,qt,kt,s,o,$t,Ze,Qe,v0)){le.Type="Error";break}if(_e=Ze[0],Le=Ze[1],Re=Qe[0],Ke=Qe[1],fe=new xt,fe.X=Re,fe.Y=Ke,Xe.push(fe),Math.abs(Ke-ae)<1e-6&&Math.abs(Re-oe)<1e-6)break;$t=Re,wt=Ct,qt=kt,Ct=_e,kt=Le}u[$][ot]=-2,Xe.length>1&&le.Type!=="Error"&&(le.Value=f,le.PointList=Xe,ct.push(le))}for($=1;$<K-1;$++)for(ot=1;ot<j-2;ot++)if(b[$][ot]!==-2){let Xe=[];for(Ct=$,kt=ot,$t=s[kt]+b[$][ot]*(s[kt+1]-s[kt]),ie=o[$],qt=kt,wt=-1,oe=$t,ae=ie,fe=new xt,fe.X=$t,fe.Y=ie,Xe.push(fe),le=new Ft,le.Type="Close";;){let Ze=[],Qe=[],v0=[];if(!zt.traceIsoline_UndefData(wt,Ct,u,b,qt,kt,s,o,$t,Ze,Qe,v0)){le.Type="Error";break}if(_e=Ze[0],Le=Ze[1],Re=Qe[0],Ke=Qe[1],fe=new xt,fe.X=Re,fe.Y=Ke,Xe.push(fe),Math.abs(Ke-ae)<1e-6&&Math.abs(Re-oe)<1e-6)break;$t=Re,wt=Ct,qt=kt,Ct=_e,kt=Le}b[$][ot]=-2,Xe.length>1&&le.Type!=="Error"&&(le.Value=f,le.PointList=Xe,ct.push(le))}return ct}static traceIsoline(r,s,o,f,b,u,w,C,M,K,j){let $,ot,ct,wt;return r<s?o[s][u]!==-2&&o[s][u+1]!==-2?o[s][u]<o[s][u+1]?(ct=w[u],wt=C[s]+o[s][u]*K,$=s,ot=u,o[$][ot]=-2):(ct=w[u+1],wt=C[s]+o[s][u+1]*K,$=s,ot=u+1,o[$][ot]=-2):o[s][u]!==-2&&o[s][u+1]===-2?(ct=w[u],wt=C[s]+o[s][u]*K,$=s,ot=u,o[$][ot]=-2):o[s][u]===-2&&o[s][u+1]!==-2?(ct=w[u+1],wt=C[s]+o[s][u+1]*K,$=s,ot=u+1,o[$][ot]=-2):(ct=w[u]+f[s+1][u]*M,wt=C[s+1],$=s+1,ot=u,f[$][ot]=-2):b<u?f[s][u]!==-2&&f[s+1][u]!==-2?f[s][u]<f[s+1][u]?(ct=w[u]+f[s][u]*M,wt=C[s],$=s,ot=u,f[$][ot]=-2):(ct=w[u]+f[s+1][u]*M,wt=C[s+1],$=s+1,ot=u,f[$][ot]=-2):f[s][u]!==-2&&f[s+1][u]===-2?(ct=w[u]+f[s][u]*M,wt=C[s],$=s,ot=u,f[$][ot]=-2):f[s][u]===-2&&f[s+1][u]!==-2?(ct=w[u]+f[s+1][u]*M,wt=C[s+1],$=s+1,ot=u,f[$][ot]=-2):(ct=w[u+1],wt=C[s]+o[s][u+1]*K,$=s,ot=u+1,o[$][ot]=-2):w[u]<j?o[s-1][u]!==-2&&o[s-1][u+1]!==-2?o[s-1][u]>o[s-1][u+1]?(ct=w[u],wt=C[s-1]+o[s-1][u]*K,$=s-1,ot=u,o[$][ot]=-2):(ct=w[u+1],wt=C[s-1]+o[s-1][u+1]*K,$=s-1,ot=u+1,o[$][ot]=-2):o[s-1][u]!==-2&&o[s-1][u+1]===-2?(ct=w[u],wt=C[s-1]+o[s-1][u]*K,$=s-1,ot=u,o[$][ot]=-2):o[s-1][u]===-2&&o[s-1][u+1]!==-2?(ct=w[u+1],wt=C[s-1]+o[s-1][u+1]*K,$=s-1,ot=u+1,o[$][ot]=-2):(ct=w[u]+f[s-1][u]*M,wt=C[s-1],$=s-1,ot=u,f[$][ot]=-2):f[s+1][u-1]!==-2&&f[s][u-1]!==-2?f[s+1][u-1]>f[s][u-1]?(ct=w[u-1]+f[s+1][u-1]*M,wt=C[s+1],$=s+1,ot=u-1,f[$][ot]=-2):(ct=w[u-1]+f[s][u-1]*M,wt=C[s],$=s,ot=u-1,f[$][ot]=-2):f[s+1][u-1]!==-2&&f[s][u-1]===-2?(ct=w[u-1]+f[s+1][u-1]*M,wt=C[s+1],$=s+1,ot=u-1,f[$][ot]=-2):f[s+1][u-1]===-2&&f[s][u-1]!==-2?(ct=w[u-1]+f[s][u-1]*M,wt=C[s],$=s,ot=u-1,f[$][ot]=-2):(ct=w[u-1],wt=C[s]+o[s][u-1]*K,$=s,ot=u-1,o[$][ot]=-2),[$,ot,ct,wt]}static isoline_Bottom(r,s,o,f,b,u,w,C){let M,K,j,$=[];M=r.length,K=r[0].length;let ot,ct,wt,Ct,qt,kt,$t,ie,oe,ae,fe=0,le=new xt,ge=new Ft;for(j=0;j<K-1;j++)if(w[0][j]!==-2){let _e=[];for(ct=0,wt=j,kt=s[j]+w[0][j]*b,$t=o[0],ot=-1,le.X=kt,le.Y=$t,_e.push(le);ae=zt.traceIsoline(ot,ct,C,w,fe,wt,s,o,b,u,kt),Ct=parseInt(ae[0]),qt=parseInt(ae[1]),ie=parseFloat(ae[2].toString()),oe=parseFloat(ae[3].toString()),le.X=ie,le.Y=oe,_e.push(le),Ct!==M-1&&qt!==K-1&&oe!==o[0]&&ie!==s[0];)kt=ie,ot=ct,fe=wt,ct=Ct,wt=qt;w[0][j]=-2,_e.length>4&&(ge.Value=f,ge.Type="Bottom",ge.PointList=[],zt.addAll(_e,ge.PointList),$.push(ge))}return $}static isoline_Left(r,s,o,f,b,u,w,C){let M,K,j,$,ot,ct,wt,Ct,qt,kt,$t,ie,oe,ae,fe=[];M=r.length,K=r[0].length;let le=new xt,ge=new Ft;for(j=0;j<M-1;j++)if(C[j][0]!==-2){let _e=[];for(ot=j,wt=0,kt=s[0],$t=o[j]+C[j][0]*u,ct=-1,$=ot,le.X=kt,le.Y=$t,_e.push(le);ae=zt.traceIsoline($,ot,C,w,ct,wt,s,o,b,u,kt),Ct=parseInt(ae[0]),qt=parseInt(ae[1]),ie=parseFloat(ae[2]),oe=parseFloat(ae[3]),le.X=ie,le.Y=oe,_e.push(le),Ct!==M-1&&qt!==K-1&&oe!==o[0]&&ie!==s[0];)kt=ie,$=ot,ct=wt,ot=Ct,wt=qt;_e.length>4&&(ge.Value=f,ge.Type="Left",ge.PointList=[],zt.addAll(_e,ge.PointList),fe.push(ge))}return fe}static isoline_Top(r,s,o,f,b,u,w,C){let M,K,j,$,ot,ct,wt,Ct,qt,kt,$t,ie,oe,ae,fe=[];M=r.length,K=r[0].length;let le=new xt,ge=new Ft;for(j=0;j<K-1;j++)if(w[M-1][j]!==-2){let _e=[];for(ot=M-1,wt=j,kt=s[j]+w[ot][j]*b,$t=o[ot],$=ot,ct=wt,le.X=kt,le.Y=$t,_e.push(le);ae=zt.traceIsoline($,ot,C,w,ct,wt,s,o,b,u,kt),Ct=parseInt(ae[0]),qt=parseInt(ae[1]),ie=parseFloat(ae[2]),oe=parseFloat(ae[3]),le.X=ie,le.Y=oe,_e.push(le),Ct!==M-1&&qt!==K-1&&oe!==o[0]&&ie!==s[0];)kt=ie,$=ot,ct=wt,ot=Ct,wt=qt;w[M-1][j]=-2,_e.length>4&&(ge.Value=f,ge.Type="Top",ge.PointList=[],zt.addAll(_e,ge.PointList),fe.push(ge))}return fe}static isoline_Right(r,s,o,f,b,u,w,C){let M,K,j,$,ot,ct,wt,Ct,qt,kt,$t,ie,oe,ae,fe=[];M=r.length,K=r[0].length;let le=new xt,ge=new Ft;for(j=0;j<M-1;j++)if(C[j][K-1]!==-2){let _e=[];for(ot=j,wt=K-1,kt=s[wt],$t=o[j]+C[j][wt]*u,ct=wt,$=ot,le.X=kt,le.Y=$t,_e.push(le);ae=zt.traceIsoline($,ot,C,w,ct,wt,s,o,b,u,kt),Ct=parseInt(ae[0]),qt=parseInt(ae[1]),ie=parseFloat(ae[2]),oe=parseFloat(ae[3]),le.X=ie,le.Y=oe,_e.push(le),Ct!==M-1&&qt!==K-1&&oe!==o[0]&&ie!==s[0];)kt=ie,$=ot,ct=wt,ot=Ct,wt=qt;_e.length>4&&(ge.Value=f,ge.Type="Right",ge.PointList=[],zt.addAll(_e,ge.PointList),fe.push(ge))}return fe}static isoline_Close(r,s,o,f,b,u,w,C){let M,K,j,$,ot,ct,wt,Ct,qt,kt,$t,ie,oe,ae,fe,le,ge,_e=[];M=r.length,K=r[0].length;let Le=new xt,Re=new Ft;for(j=1;j<M-2;j++)for($=1;$<K-1;$++)if(C[j][$]!==-2){let Ke=[];for(ct=j,Ct=$,$t=s[Ct],ie=o[j]+C[j][Ct]*u,wt=0,ot=ct,fe=$t,le=ie,Le.X=$t,Le.Y=ie,Ke.push(Le);ge=zt.traceIsoline(ot,ct,C,w,wt,Ct,s,o,b,u,$t),qt=parseInt(ge[0]),kt=parseInt(ge[1]),oe=parseFloat(ge[2]),ae=parseFloat(ge[3]),!(qt===0&&kt===0||(Le.X=oe,Le.Y=ae,Ke.push(Le),Math.abs(ae-le)<1e-6&&Math.abs(oe-fe)<1e-6)||($t=oe,ot=ct,wt=Ct,ct=qt,Ct=kt,ct===M-1||Ct===K-1)););C[j][$]=-2,Ke.length>4&&(Re.Value=f,Re.Type="Close",Re.PointList=[],zt.addAll(Ke,Re.PointList),_e.push(Re))}for(j=1;j<M-1;j++)for($=1;$<K-2;$++)if(w[j][$]!==-2){let Ke=[];for(ct=j,Ct=$,$t=s[Ct]+w[j][$]*b,ie=o[j],wt=Ct,ot=0,fe=$t,le=ie,Le.X=$t,Le.Y=ie,Ke.push(Le);ge=zt.traceIsoline(ot,ct,C,w,wt,Ct,s,o,b,u,$t),qt=parseInt(ge[0]),kt=parseInt(ge[1]),oe=parseFloat(ge[2]),ae=parseFloat(ge[3]),Le.X=oe,Le.Y=ae,Ke.push(Le),!(Math.abs(ae-le)<1e-6&&Math.abs(oe-fe)<1e-6||($t=oe,ot=ct,wt=Ct,ct=qt,Ct=kt,ct===M-1||Ct===K-1)););w[j][$]=-2,Ke.length>4&&(Re.Value=f,Re.Type="Close",Re.PointList=[],zt.addAll(Ke,Re.PointList),_e.push(Re))}return _e}static tracingPolygons_Extent(r,s,o,f){if(r.length===0)return[];let b,u,w,C,M,K,j,$=[],ot=[];zt.addAll(r,ot);let ct,wt,Ct,qt,kt=[],$t=[];for($t.length=s.length-1,M=0;M<$t.length;M++)$t[M]=0;let ie=0,oe=0,ae=[];for(Ct=s.length-1,M=0;M<Ct;M++)if(s[M].Id!==-1){if(wt=M,j=[],ae.push(s[M]),$t[wt]<2)for(j.push(s[wt].Point),wt+=1,wt===Ct&&(wt=0),qt=0;;){if(ct=s[wt],ct.Id===-1){if($t[wt]===1)break;j.push(ct.Point),$t[wt]+=1}else{if($t[wt]===2)break;for($t[wt]+=1,b=ot[ct.Id],qt===0?(ie=b.Value,oe=b.Value,qt+=1):ie===oe&&(b.Value>ie?oe=b.Value:b.Value<ie&&(ie=b.Value),qt+=1),kt=[],zt.addAll(b.PointList,kt),u=kt[0],ct.Point.X===u.X&&ct.Point.Y===u.Y||kt.reverse(),zt.addAll(kt,j),K=0;K<s.length-1;K++)if(K!==wt&&s[K].Id===ct.Id){wt=K,$t[wt]+=1;break}}if(wt===M){j.length>0&&(w=new te,w.LowValue=ie,w.HighValue=oe,C=new E,w.Area=zt.getExtentAndArea(j,C),w.IsClockWise=!0,w.StartPointIdx=ae.length-1,w.Extent=C,w.OutLine.PointList=j,w.OutLine.Value=ie,w.IsHighCenter=!0,w.OutLine.Type="Border",$.push(w));break}wt+=1,wt===Ct&&(wt=0)}if(wt=M,$t[wt]<2)for(j=[],j.push(s[wt].Point),wt+=-1,wt===-1&&(wt=Ct-1),qt=0;;){if(ct=s[wt],ct.Id===-1){if($t[wt]===1)break;j.push(ct.Point),$t[wt]+=1}else{if($t[wt]===2)break;for($t[wt]+=1,b=ot[ct.Id],qt===0?(ie=b.Value,oe=b.Value,qt+=1):ie===oe&&(b.Value>ie?oe=b.Value:b.Value<ie&&(ie=b.Value),qt+=1),kt=[],zt.addAll(b.PointList,kt),u=kt[0],ct.Point.X===u.X&&ct.Point.Y===u.Y||kt.reverse(),zt.addAll(kt,j),K=0;K<s.length-1;K++)if(K!==wt&&s[K].Id===ct.Id){wt=K,$t[wt]+=1;break}}if(wt===M){j.length>0&&(w=new te,w.LowValue=ie,w.HighValue=oe,C=new E,w.Area=zt.getExtentAndArea(j,C),w.IsClockWise=!1,w.StartPointIdx=ae.length-1,w.Extent=C,w.OutLine.PointList=j,w.OutLine.Value=ie,w.IsHighCenter=!0,w.OutLine.Type="Border",$.push(w));break}wt+=-1,wt===-1&&(wt=Ct-1)}}let fe,le,ge,_e,Le=[];for(M=0;M<ot.length;M++)if(b=ot[M],b.Type==="Close"&&b.PointList.length>0){for(w=new te,w.LowValue=b.Value,w.HighValue=b.Value,C=new E,w.Area=zt.getExtentAndArea(b.PointList,C),w.IsClockWise=zt.isClockwise(b.PointList),w.Extent=C,w.OutLine=b,w.IsHighCenter=!0,fe=!1,K=0;K<Le.length;K++)if(w.Area>Le[K].Area){Le.splice(K,0,w),fe=!0;break}fe||Le.push(w)}if($.length>0){let Re,Ke,i0=!1;if(w=$[0],w.LowValue===w.HighValue)for(Re=w.StartPointIdx;;){if(w.IsClockWise?(Re-=1,Re===-1&&(Re=ae.length-1)):(Re+=1,Re===ae.length&&(Re=0)),ct=ae[Re],b=ot[ct.Id],b.Value!==w.LowValue){i0=!1;break}if(Re===w.StartPointIdx){i0=!0;break}}if(i0)if(Le.length>0)for(le=Le[0].Extent,M=0;M<$.length;M++)w=$[M],ge=w.Extent,le.xMin>ge.xMin&&le.yMin>ge.yMin&&le.xMax<ge.xMax&&le.yMax<ge.yMax?w.IsHighCenter=!1:w.IsHighCenter=!0;else{let We=!0;for(M=0;M<$.length;M++)w=$[M],We=!We,w.IsHighCenter=We}else for(M=0;M<$.length;M++)if(w=$[M],w.LowValue===w.HighValue)for(Ke=!1,Re=w.StartPointIdx;;){if(w.IsClockWise?(Re-=1,Re===-1&&(Re=ae.length-1)):(Re+=1,Re===ae.length&&(Re=0)),ct=ae[Re],b=ot[ct.Id],b.Value!==w.LowValue){Ke?b.Value<w.LowValue&&(w.IsHighCenter=!1):b.Value>w.LowValue&&(w.IsHighCenter=!1);break}if(Re===w.StartPointIdx)break;Ke=!Ke}}else{let Re=ot[0].Value,Ke=ot[0].Value;for(let i0 of ot)i0.Value>Re&&(Re=i0.Value),i0.Value<Ke&&(Ke=i0.Value);w=new te,b=new Ft,b.Type="Border",b.Value=f[0],w.IsHighCenter=!1,Le.length>0&&Le[0].LowValue===Re&&(b.Value=f[f.length-1],w.IsHighCenter=!0),kt=[],u=new xt,u.X=o.xMin,u.Y=o.yMin,kt.push(u),u=new xt,u.X=o.xMin,u.Y=o.yMax,kt.push(u),u=new xt,u.X=o.xMax,u.Y=o.yMax,kt.push(u),u=new xt,u.X=o.xMax,u.Y=o.yMin,kt.push(u),kt.push(kt[0]),b.PointList=[],zt.addAll(kt,b.PointList),b.PointList.length>0&&(w.LowValue=b.Value,w.HighValue=b.Value,C=new E,w.Area=zt.getExtentAndArea(b.PointList,C),w.IsClockWise=zt.isClockwise(b.PointList),w.Extent=C,w.OutLine=b,$.push(w))}for(zt.addAll(Le,$),M=$.length-1;M>=0;M--)if(w=$[M],w.OutLine.Type==="Close"){for(le=w.Extent,ie=w.LowValue,u=w.OutLine.PointList[0],K=M-1;K>=0;K--)if(_e=$[K],ge=_e.Extent,oe=_e.LowValue,kt=[],zt.addAll(_e.OutLine.PointList,kt),zt.pointInPolygonByPList(kt,u)&&le.xMin>ge.xMin&&le.yMin>ge.yMin&&le.xMax<ge.xMax&&le.yMax<ge.yMax){(ie<oe||ie===oe&&_e.IsHighCenter)&&(w.IsHighCenter=!1);break}}return $}static tracingPolygons_Line_Border(r,s){if(r.length===0)return[];let o,f,b,u,w,C,M,K,j,$=[],ot=[];zt.addAll(r,ot);let ct,wt,Ct,qt,kt=[];for(kt.length=s.length-1,w=0;w<kt.length;w++)kt[w]=0;let $t=0,ie=0,oe=0,ae=[];for(wt=s.length-1,w=0;w<wt;w++)if(s[w].Id!==-1){if(ct=w,M=[],ae.push(s[w]),kt[ct]<2)for(M.push(s[ct].Point),ct+=1,ct===wt&&(ct=0),Ct=0,qt=0;;){if(j=s[ct],j.Id===-1){if(kt[ct]===1)break;oe=j.Value,qt+=1,M.push(j.Point),kt[ct]+=1}else{if(kt[ct]===2)break;for(kt[ct]+=1,o=ot[j.Id],Ct===0?($t=o.Value,ie=o.Value,Ct+=1):(o.Value>$t?ie=o.Value:o.Value<$t&&($t=o.Value),Ct+=1),K=[],zt.addAll(o.PointList,K),f=K[0],j.Point.X===f.X&&j.Point.Y===f.Y||K.reverse(),zt.addAll(K,M),C=0;C<s.length-1;C++)if(C!==ct&&s[C].Id===j.Id){ct=C,kt[ct]+=1;break}}if(ct===w){M.length>0&&(b=new te,b.IsBorder=!0,b.LowValue=$t,b.HighValue=ie,u=new E,b.Area=zt.getExtentAndArea(M,u),b.IsClockWise=!0,b.StartPointIdx=ae.length-1,b.Extent=u,b.OutLine.PointList=M,b.OutLine.Value=$t,b.IsHighCenter=!0,b.HoleLines=[],qt>0&&oe<$t&&(b.IsHighCenter=!1,b.HighValue=$t),b.OutLine.Type="Border",$.push(b));break}ct+=1,ct===wt&&(ct=0)}if(ct=w,kt[ct]<2)for(M=[],M.push(s[ct].Point),ct+=-1,ct===-1&&(ct=wt-1),Ct=0,qt=0;;){if(j=s[ct],j.Id===-1){if(kt[ct]===1)break;oe=j.Value,qt+=1,M.push(j.Point),kt[ct]+=1}else{if(kt[ct]===2)break;for(kt[ct]+=1,o=ot[j.Id],Ct===0?($t=o.Value,ie=o.Value,Ct+=1):(o.Value>$t?ie=o.Value:o.Value<$t&&($t=o.Value),Ct+=1),K=[],zt.addAll(o.PointList,K),f=K[0],j.Point.X===f.X&&j.Point.Y===f.Y||K.reverse(),zt.addAll(K,M),C=0;C<s.length-1;C++)if(C!==ct&&s[C].Id===j.Id){ct=C,kt[ct]+=1;break}}if(ct===w){M.length>0&&(b=new te,b.IsBorder=!0,b.LowValue=$t,b.HighValue=ie,u=new E,b.Area=zt.getExtentAndArea(M,u),b.IsClockWise=!1,b.StartPointIdx=ae.length-1,b.Extent=u,b.OutLine.PointList=M,b.OutLine.Value=$t,b.IsHighCenter=!0,b.HoleLines=[],qt>0&&oe<$t&&(b.IsHighCenter=!1,b.HighValue=$t),b.OutLine.Type="Border",$.push(b));break}ct+=-1,ct===-1&&(ct=wt-1)}}let fe,le=[];for(w=0;w<ot.length;w++)if(o=ot[w],o.Type==="Close"&&o.PointList.length>0){for(b=new te,b.IsBorder=!1,b.LowValue=o.Value,b.HighValue=o.Value,u=new E,b.Area=zt.getExtentAndArea(o.PointList,u),b.IsClockWise=zt.isClockwise(o.PointList),b.Extent=u,b.OutLine=o,b.IsHighCenter=!0,b.HoleLines=[],fe=!1,C=0;C<le.length;C++)if(b.Area>le[C].Area){le.splice(C,0,b),fe=!0;break}fe||le.push(b)}return $=zt.judgePolygonHighCenter($,le,ot,s),$}static tracingClipPolygons(r,s,o){if(s.length===0)return[];let f,b,u,w,C,M,K,j=[],$=[];zt.addAll(s,$);let ot,ct,wt,Ct=[],qt=[];for(qt.length=o.length-1,C=0;C<qt.length;C++)qt[C]=0;let kt,$t,ie=[];for(wt=o.length-1,C=0;C<wt;C++)if(o[C].Id!==-1){if(ct=C,ie.push(o[C]),$t=o[ct].Point,qt[ct]<1){if(K=[],K.push(o[ct].Point),ct+=1,ct===wt&&(ct=0),kt=o[ct].Point.clone(),o[ct].Id===-1){let oe=ct+10;for(let ae=1;ae<=10;ae++)if(o[ct+ae].Id>-1){oe=ct+ae-1;break}kt=o[oe].Point.clone()}else kt.X=(kt.X+$t.X)/2,kt.Y=(kt.Y+$t.Y)/2;if(zt.pointInPolygon(r,kt))for(;;){if(ot=o[ct],ot.Id===-1){if(qt[ct]===1)break;K.push(ot.Point),qt[ct]+=1}else{if(qt[ct]===1)break;for(qt[ct]+=1,f=$[ot.Id],Ct=[],zt.addAll(f.PointList,Ct),b=Ct[0],zt.doubleEquals(ot.Point.X,b.X)&&zt.doubleEquals(ot.Point.Y,b.Y)||Ct.reverse(),zt.addAll(Ct,K),M=0;M<o.length-1;M++)if(M!==ct&&o[M].Id===ot.Id){ct=M,qt[ct]+=1;break}}if(ct===C){K.length>0&&(u=new te,u.IsBorder=!0,u.LowValue=r.LowValue,u.HighValue=r.HighValue,w=new E,u.Area=zt.getExtentAndArea(K,w),u.IsClockWise=!0,u.StartPointIdx=ie.length-1,u.Extent=w,u.OutLine.PointList=K,u.OutLine.Value=r.LowValue,u.IsHighCenter=r.IsHighCenter,u.OutLine.Type="Border",u.HoleLines=[],j.push(u));break}ct+=1,ct===wt&&(ct=0)}}if(ct=C,qt[ct]<1){if(K=[],K.push(o[ct].Point),ct+=-1,ct===-1&&(ct=wt-1),kt=o[ct].Point.clone(),o[ct].Id===-1){let oe=ct+10;for(let ae=1;ae<=10;ae++)if(o[ct+ae].Id>-1){oe=ct+ae-1;break}kt=o[oe].Point.clone()}else kt.X=(kt.X+$t.X)/2,kt.Y=(kt.Y+$t.Y)/2;if(zt.pointInPolygon(r,kt))for(;;){if(ot=o[ct],ot.Id===-1){if(qt[ct]===1)break;K.push(ot.Point),qt[ct]+=1}else{if(qt[ct]===1)break;for(qt[ct]+=1,f=$[ot.Id],Ct=[],zt.addAll(f.PointList,Ct),b=Ct[0],zt.doubleEquals(ot.Point.X,b.X)&&zt.doubleEquals(ot.Point.Y,b.Y)||Ct.reverse(),zt.addAll(Ct,K),M=0;M<o.length-1;M++)if(M!==ct&&o[M].Id===ot.Id){ct=M,qt[ct]+=1;break}}if(ct===C){K.length>0&&(u=new te,u.IsBorder=!0,u.LowValue=r.LowValue,u.HighValue=r.HighValue,w=new E,u.Area=zt.getExtentAndArea(K,w),u.IsClockWise=!1,u.StartPointIdx=ie.length-1,u.Extent=w,u.OutLine.PointList=K,u.OutLine.Value=r.LowValue,u.IsHighCenter=r.IsHighCenter,u.OutLine.Type="Border",u.HoleLines=[],j.push(u));break}ct+=-1,ct===-1&&(ct=wt-1)}}}return j}static judgePolygonHighCenter(r,s,o,f){let b,u,w,C,M,K,j,$,ot,ct=[];if(r.length===0){let qt=o[0].Value,kt=o[0].Value;for(let $t of o)$t.Value>qt&&(qt=$t.Value),$t.Value<kt&&(kt=$t.Value);w=new te,K=f[0].Value,K<kt?(qt=kt,kt=K,w.IsHighCenter=!0):K>qt&&(kt=qt,qt=K,w.IsHighCenter=!1),C=new Ft,C.Type="Border",C.Value=K,ct=[];for(let $t of f)ct.push($t.Point);C.PointList=[],zt.addAll(ct,C.PointList),C.PointList.length>0&&(w.IsBorder=!0,w.LowValue=kt,w.HighValue=qt,M=new E,w.Area=zt.getExtentAndArea(C.PointList,M),w.IsClockWise=zt.isClockwise(C.PointList),w.Extent=M,w.OutLine=C,w.HoleLines=[],r.push(w))}zt.addAll(s,r);let wt,Ct=r.length;for(b=1;b<Ct;b++)if(w=r[b],w.OutLine.Type==="Close"){for($=w.Extent,j=w.OutLine.PointList[0],u=b-1;u>=0;u--)if(wt=r[u],ot=wt.Extent,ct=[],zt.addAll(wt.OutLine.PointList,ct),zt.pointInPolygonByPList(ct,j)&&$.xMin>ot.xMin&&$.yMin>ot.yMin&&$.xMax<ot.xMax&&$.yMax<ot.yMax){wt.IsHighCenter?w.IsHighCenter=w.HighValue!==wt.LowValue:w.IsHighCenter=w.LowValue===wt.HighValue;break}}return r}static judgePolygonHighCenter_old(r,s,o,f){let b,u,w,C,M,K,j,$,ot,ct,wt=[];if(r.length===0){let kt=o[0].Value,$t=o[0].Value;for(let ie of o)ie.Value>kt&&(kt=ie.Value),ie.Value<$t&&($t=ie.Value);w=new te,C=new Ft,C.Type="Border",C.Value=$t,w.IsHighCenter=!1,s.length>0&&f[0].Value>=s[0].LowValue&&(C.Value=kt,w.IsHighCenter=!0),wt=[];for(let ie of f)wt.push(ie.Point);C.PointList=[],zt.addAll(wt,C.PointList),C.PointList.length>0&&(w.IsBorder=!0,w.LowValue=C.Value,w.HighValue=C.Value,M=new E,w.Area=zt.getExtentAndArea(C.PointList,M),w.IsClockWise=zt.isClockwise(C.PointList),w.Extent=M,w.OutLine=C,w.HoleLines=[],r.push(w))}zt.addAll(s,r);let Ct,qt=r.length;for(b=1;b<qt;b++)if(w=r[b],w.OutLine.Type==="Close"){for(ot=w.Extent,K=w.LowValue,$=w.OutLine.PointList[0],u=b-1;u>=0;u--)if(Ct=r[u],ct=Ct.Extent,j=Ct.LowValue,wt=[],zt.addAll(Ct.OutLine.PointList,wt),zt.pointInPolygonByPList(wt,$)&&ot.xMin>ct.xMin&&ot.yMin>ct.yMin&&ot.xMax<ct.xMax&&ot.yMax<ct.yMax){(K<j||K===j&&Ct.IsHighCenter)&&(w.IsHighCenter=!1);break}}return r}static tracingPolygons_Ring(r,s,o,f,b){let u,w,C,M,K,j,$,ot,ct,wt,Ct,qt=[];u=[],zt.addAll(r,u);let kt,$t,ie,oe=[];for(oe.length=s.length-1,j=0;j<oe.length;j++)oe[j]=0;let ae,fe,le,ge=0,_e=0,Le=0,Re=[];for($t=s.length,j=0;j<$t;j++){if(s[j].Id===-1)continue;kt=j,Re.push(s[j]);let Qe=!1;if(oe[kt]<2){wt=s[kt],le=wt.BInnerIdx,ot=[];let v0=[];for(ot.push(wt.Point),v0.push(kt),ae=wt.BorderIdx,fe=ae,kt+=1,le+=1,le===b[ae]-1&&(kt-=b[ae]-1),ie=0;;){if(wt=s[kt],wt.Id===-1){if(oe[kt]===1)break;Le=wt.Value,ot.push(wt.Point),oe[kt]+=1,v0.push(kt)}else{if(oe[kt]===2)break;for(oe[kt]+=1,v0.push(kt),w=u[wt.Id],ie===0?(ge=w.Value,_e=w.Value,ie+=1):ge===_e&&(w.Value>ge?_e=w.Value:w.Value<ge&&(ge=w.Value),ie+=1),ct=[],zt.addAll(w.PointList,ct),C=ct[0],wt.Point.X===C.X&&wt.Point.Y===C.Y||ct.reverse(),zt.addAll(ct,ot),$=0;$<s.length;$++)if($!==kt&&(Ct=s[$],Ct.Id===wt.Id)){kt=$,le=Ct.BInnerIdx,oe[kt]+=1,v0.push(kt),fe=Ct.BorderIdx,wt.BorderIdx>0&&wt.BorderIdx===Ct.BorderIdx&&(Qe=!0);break}}if(kt===j){if(ot.length>0){if(Qe){let o0=!1,A0=0;for(let V0=0;V0<wt.BorderIdx;V0++)A0+=b[V0];let sx=A0,Y0=A0+b[wt.BorderIdx],xx=sx;for(let V0=sx;V0<Y0;V0++)if(v0.indexOf(V0)<0){xx=V0;break}if(zt.pointInPolygonByPList(ot,s[xx].Point)&&(o0=!0),o0)break}M=new te,M.IsBorder=!0,M.IsInnerBorder=Qe,M.LowValue=ge,M.HighValue=_e,K=new E,M.Area=zt.getExtentAndArea(ot,K),M.IsClockWise=!0,M.StartPointIdx=Re.length-1,M.Extent=K,M.OutLine.PointList=ot,M.OutLine.Value=ge,M.IsHighCenter=!0,ge===_e&&Le<ge&&(M.IsHighCenter=!1),M.OutLine.Type="Border",M.HoleLines=[],qt.push(M)}break}kt+=1,le+=1,ae!==fe&&(ae=fe),le===b[ae]-1&&(kt-=b[ae]-1,le=0)}}if(Qe=!1,kt=j,oe[kt]<2){ot=[];let v0=[];for(wt=s[kt],le=wt.BInnerIdx,ot.push(wt.Point),v0.push(kt),ae=wt.BorderIdx,fe=ae,kt+=-1,le+=-1,le===-1&&(kt+=b[ae]-1),ie=0;;){if(wt=s[kt],wt.Id===-1){if(oe[kt]===1)break;Le=wt.Value,ot.push(wt.Point),v0.push(kt),oe[kt]+=1}else{if(oe[kt]===2)break;for(oe[kt]+=1,v0.push(kt),w=u[wt.Id],ie===0?(ge=w.Value,_e=w.Value,ie+=1):ge===_e&&(w.Value>ge?_e=w.Value:w.Value<ge&&(ge=w.Value),ie+=1),ct=[],zt.addAll(w.PointList,ct),C=ct[0],wt.Point.X===C.X&&wt.Point.Y===C.Y||ct.reverse(),zt.addAll(ct,ot),$=0;$<s.length;$++)if($!==kt&&(Ct=s[$],Ct.Id===wt.Id)){kt=$,le=Ct.BInnerIdx,oe[kt]+=1,v0.push(kt),fe=Ct.BorderIdx,wt.BorderIdx>0&&wt.BorderIdx===Ct.BorderIdx&&(Qe=!0);break}}if(kt===j){if(ot.length>0){if(Qe){let o0=!1,A0=0;for(let V0=0;V0<wt.BorderIdx;V0++)A0+=b[V0];let sx=A0,Y0=A0+b[wt.BorderIdx],xx=sx;for(let V0=sx;V0<Y0;V0++)if(v0.indexOf(V0)<0){xx=V0;break}if(zt.pointInPolygonByPList(ot,s[xx].Point)&&(o0=!0),o0)break}M=new te,M.IsBorder=!0,M.IsInnerBorder=Qe,M.LowValue=ge,M.HighValue=_e,K=new E,M.Area=zt.getExtentAndArea(ot,K),M.IsClockWise=!1,M.StartPointIdx=Re.length-1,M.Extent=K,M.OutLine.PointList=ot,M.OutLine.Value=ge,M.IsHighCenter=!0,ge===_e&&Le<ge&&(M.IsHighCenter=!1),M.OutLine.Type="Border",M.HoleLines=[],qt.push(M)}break}kt+=-1,le+=-1,ae!==fe&&(ae=fe),le===-1&&(kt+=b[ae],le=b[ae]-1)}}}let Ke,i0,We,Xe,Ze=[];for(j=0;j<u.length;j++)if(w=u[j],w.Type==="Close"){for(M=new te,M.IsBorder=!1,M.LowValue=w.Value,M.HighValue=w.Value,K=new E,M.Area=zt.getExtentAndArea(w.PointList,K),M.IsClockWise=zt.isClockwise(w.PointList),M.Extent=K,M.OutLine=w,M.IsHighCenter=!0,M.HoleLines=[],Ke=!1,$=0;$<Ze.length;$++)if(M.Area>Ze[$].Area){Ze.splice($,0,M),Ke=!0;break}Ke||Ze.push(M)}for(qt.length===0&&(w=new Ft,w.Type="Border",w.Value=f[0],w.PointList=[],zt.addAll(o.LineList[0].pointList,w.PointList),w.PointList.length>0&&(M=new te,M.LowValue=w.Value,M.HighValue=w.Value,K=new E,M.Area=zt.getExtentAndArea(w.PointList,K),M.IsClockWise=zt.isClockwise(w.PointList),M.Extent=K,M.OutLine=w,M.IsHighCenter=!1,qt.push(M))),zt.addAll(Ze,qt),j=qt.length-1;j>=0;j+=-1)if(M=qt[j],M.OutLine.Type==="Close"){for(i0=M.Extent,ge=M.LowValue,C=M.OutLine.PointList[0],$=j-1;$>=0;$+=-1)if(Xe=qt[$],We=Xe.Extent,_e=Xe.LowValue,ct=[],zt.addAll(Xe.OutLine.PointList,ct),zt.pointInPolygonByPList(ct,C)&&i0.xMin>We.xMin&&i0.yMin>We.yMin&&i0.xMax<We.xMax&&i0.yMax<We.yMax){(ge<_e||ge===_e&&Xe.IsHighCenter)&&(M.IsHighCenter=!1);break}}return qt}static addPolygonHoles(r){let s,o,f=[];for(s=0;s<r.length;s++){let b=r[s];b.IsBorder||(b.HoleIndex=1,f.push(b))}if(f.length===0)return r;{let b=[];for(s=1;s<f.length;s++){let w=f[s];for(o=s-1;o>=0;o--){let C=f[o];if(C.Extent.Include(w.Extent)&&zt.pointInPolygonByPList(C.OutLine.PointList,w.OutLine.PointList[0])){w.HoleIndex=C.HoleIndex+1,C.AddHole(w);break}}}let u=[];for(s=0;s<f.length;s++)f[s].HoleIndex===1&&u.push(f[s]);for(s=0;s<r.length;s++){let w=r[s];if(w.IsBorder===!0){for(o=0;o<u.length;o++){let C=u[o];w.Extent.Include(C.Extent)&&zt.pointInPolygonByPList(w.OutLine.PointList,C.OutLine.PointList[0])&&w.AddHole(C)}b.push(w)}}return zt.addAll(f,b),b}}static addPolygonHoles_Ring(r){let s,o,f=[];for(s=0;s<r.length;s++){let b=r[s];b.IsBorder&&!b.IsInnerBorder||(b.HoleIndex=1,f.push(b))}if(f.length===0)return r;{let b=[];for(s=1;s<f.length;s++){let w=f[s];for(o=s-1;o>=0;o--){let C=f[o];if(C.Extent.Include(w.Extent)&&zt.pointInPolygonByPList(C.OutLine.PointList,w.OutLine.PointList[0])){w.HoleIndex=C.HoleIndex+1,C.AddHole(w);break}}}let u=[];for(s=0;s<f.length;s++)f[s].HoleIndex===1&&u.push(f[s]);for(s=0;s<r.length;s++){let w=r[s];if(w.IsBorder&&!w.IsInnerBorder){for(o=0;o<u.length;o++){let C=u[o];w.Extent.Include(C.Extent)&&zt.pointInPolygonByPList(w.OutLine.PointList,C.OutLine.PointList[0])&&w.AddHole(C)}b.push(w)}}return zt.addAll(f,b),b}}static addHoles_Ring(r,s){let o,f;for(o=0;o<s.length;o++){let b=s[o],u=zt.getExtent(b);for(f=r.length-1;f>=0;f--){let w=r[f];if(w.Extent.Include(u)){let C=!0;for(let M of b)if(!zt.pointInPolygonByPList(w.OutLine.PointList,M)){C=!1;break}if(C){w.AddHole(b);break}}}}}static cutPolyline(r,s){let o,f,b=[],u=r.PointList,w=zt.getExtent(u),C=zt.getExtent(s);if(!zt.isExtentCross(w,C))return b;if(zt.isClockwise(s)||s.reverse(),zt.pointInPolygonByPList(s,u[0])){let $t=!0,ie=0;for(o=0;o<u.length;o++)if(!zt.pointInPolygonByPList(s,u[o])){ie=o,$t=!1;break}if($t)return b.push(r),b;if(r.Type==="Close"){let oe=[];for(o=ie;o<u.length;o++)oe.push(u[o]);for(o=1;o<ie;o++)oe.push(u[o]);oe.push(oe[0]),u=[],zt.addAll(oe,u)}else u.reverse()}let M,K,j,$,ot,ct,wt,Ct,qt=zt.pointInPolygonByPList(s,u[0]),kt=[];for(j=u[0],o=1;o<u.length;o++){if($=u[o],zt.pointInPolygonByPList(s,$)){if(!qt){for(ot=new xt,ct=new Gt,ct.P1=j,ct.P2=$,M=s[s.length-1],f=0;f<s.length;f++){if(K=s[f],wt=new Gt,wt.P1=M,wt.P2=K,zt.isLineSegmentCross(ct,wt)){ot=zt.getCrossPointD(ct,wt);break}M=K}kt.push(ot)}kt.push(u[o]),qt=!0}else if(qt){for(ot=new xt,ct=new Gt,ct.P1=j,ct.P2=$,M=s[s.length-1],f=0;f<s.length;f++){if(K=s[f],wt=new Gt,wt.P1=M,wt.P2=K,zt.isLineSegmentCross(ct,wt)){ot=zt.getCrossPointD(ct,wt);break}M=K}kt.push(ot),Ct=new Ft,Ct.Value=r.Value,Ct.Type=r.Type,Ct.PointList=kt,b.push(Ct),qt=!1,kt=[]}j=$}return qt&&kt.length>1&&(Ct=new Ft,Ct.Value=r.Value,Ct.Type=r.Type,Ct.PointList=kt,b.push(Ct)),b}static cutPolygon_Hole(r,s){let o,f,b=[],u=[],w=r.OutLine.PointList,C=zt.getExtent(w),M=zt.getExtent(s);if(!zt.isExtentCross(C,M))return b;zt.isClockwise(s)||s.reverse();let K=[];if(zt.pointInPolygonByPList(s,w[0])){let ct=!0,wt=0;for(o=0;o<w.length;o++)if(!zt.pointInPolygonByPList(s,w[o])){wt=o,ct=!1;break}if(ct)return b.push(r),b;{let Ct=[];for(o=wt;o<w.length;o++)Ct.push(w[o]);for(o=1;o<wt;o++)Ct.push(w[o]);Ct.push(Ct[0]),K.push(Ct)}}else K.push(w);let j=[];for(let ct=0;ct<r.HoleLines.length;ct++){let wt=r.HoleLines[ct].PointList;if(C=zt.getExtent(wt),zt.isExtentCross(C,M))if(zt.pointInPolygonByPList(s,wt[0])){let Ct=!0,qt=0;for(o=0;o<wt.length;o++)if(!zt.pointInPolygonByPList(s,wt[o])){qt=o,Ct=!1;break}if(Ct)j.push(wt);else{let kt=[];for(o=qt;o<wt.length;o++)kt.push(wt[o]);for(o=1;o<qt;o++)kt.push(wt[o]);kt.push(kt[0]),K.push(kt)}}else K.push(wt)}let $=[],ot=new vt;for(let ct of s)ot=new vt,ot.Point=ct,ot.Id=-1,$.push(ot);for(let ct=0;ct<K.length;ct++){w=K[ct];let wt,Ct,qt,kt,$t,ie,oe,ae,fe=!1,le=[];qt=w[0];let ge=-1,_e=-1,Le=!0,Re=0;for(o=1;o<w.length;o++){if(kt=w[o],zt.pointInPolygonByPList(s,kt)){if(!fe){for(ie=new Gt,ie.P1=qt,ie.P2=kt,wt=$[$.length-1].Point,$t=new xt,f=0;f<$.length;f++){if(Ct=$[f].Point,oe=new Gt,oe.P1=wt,oe.P2=Ct,zt.isLineSegmentCross(ie,oe)){$t=zt.getCrossPointD(ie,oe),ot=new vt,ot.Id=u.length,ot.Point=$t,$.splice(f,0,ot),ge=f;break}wt=Ct}le.push($t)}le.push(w[o]),fe=!0}else if(fe){for(ie=new Gt,ie.P1=qt,ie.P2=kt,wt=$[$.length-1].Point,$t=new xt,f=0;f<$.length;f++){if(Ct=$[f].Point,oe=new Gt,oe.P1=wt,oe.P2=Ct,zt.isLineSegmentCross(ie,oe)){Le||(ge-_e>=1&&ge-_e<=10?zt.twoPointsInside(Re,_e,ge,f)||($.splice(ge,1),$.splice(_e,0,ot)):ge-_e<=-1&&ge-_e>=-10?zt.twoPointsInside(Re,_e,ge,f)||($.splice(ge,1),$.splice(_e+1,0,ot)):ge===_e&&(zt.twoPointsInside(Re,_e,ge,f)||($.splice(ge,1),$.splice(ge+1,0,ot)))),$t=zt.getCrossPointD(ie,oe),ot=new vt,ot.Id=u.length,ot.Point=$t,$.splice(f,0,ot),_e=f,Re=ge,Le=!1;break}wt=Ct}le.push($t),ae=new Ft,ae.Value=r.OutLine.Value,ae.Type=r.OutLine.Type,ae.PointList=le,u.push(ae),fe=!1,le=[]}qt=kt}}if(u.length>0)b=zt.tracingClipPolygons(r,u,$);else if(zt.pointInPolygonByPList(w,s[0])){let ct=new E,wt=new te;wt.IsBorder=!0,wt.LowValue=r.LowValue,wt.HighValue=r.HighValue,wt.Area=zt.getExtentAndArea(s,ct),wt.IsClockWise=!0,wt.Extent=ct,wt.OutLine.PointList=s,wt.OutLine.Value=r.LowValue,wt.IsHighCenter=r.IsHighCenter,wt.OutLine.Type="Border",wt.HoleLines=[],b.push(wt)}return j.length>0&&zt.addHoles_Ring(b,j),b}static cutPolygon(r,s){let o,f,b=[],u=[],w=r.OutLine.PointList,C=zt.getExtent(w),M=zt.getExtent(s);if(!zt.isExtentCross(C,M))return b;if(zt.isClockwise(s)||s.reverse(),zt.pointInPolygonByPList(s,w[0])){let _e=!0,Le=0;for(o=0;o<w.length;o++)if(!zt.pointInPolygonByPList(s,w[o])){Le=o,_e=!1;break}if(_e)return b.push(r),b;{let Re=[];for(o=Le;o<w.length;o++)Re.push(w[o]);for(o=1;o<Le;o++)Re.push(w[o]);Re.push(Re[0]),w=[],zt.addAll(Re,w)}}let K=[],j=new vt;for(let _e of s)j=new vt,j.Point=_e,j.Id=-1,K.push(j);let $,ot,ct,wt,Ct,qt,kt,$t,ie=!1,oe=[];ct=w[0];let ae=-1,fe=-1,le=0,ge=!0;for(o=1;o<w.length;o++){if(wt=w[o],zt.pointInPolygonByPList(s,wt)){if(!ie){for(qt=new Gt,qt.P1=ct,qt.P2=wt,$=K[K.length-1].Point,Ct=new xt,f=0;f<K.length;f++){if(ot=K[f].Point,kt=new Gt,kt.P1=$,kt.P2=ot,zt.isLineSegmentCross(qt,kt)){Ct=zt.getCrossPointD(qt,kt),j=new vt,j.Id=u.length,j.Point=Ct,K.splice(f,0,j),ae=f;break}$=ot}oe.push(Ct)}oe.push(w[o]),ie=!0}else if(ie){for(qt=new Gt,qt.P1=ct,qt.P2=wt,$=K[K.length-1].Point,Ct=new xt,f=0;f<K.length;f++){if(ot=K[f].Point,kt=new Gt,kt.P1=$,kt.P2=ot,zt.isLineSegmentCross(qt,kt)){ge||(ae-fe>=1&&ae-fe<=10?zt.twoPointsInside(le,fe,ae,f)||(K.splice(ae,1),K.splice(fe,0,j)):ae-fe<=-1&&ae-fe>=-10?zt.twoPointsInside(le,fe,ae,f)||(K.splice(ae,1),K.splice(fe+1,0,j)):ae===fe&&(zt.twoPointsInside(le,fe,ae,f)||(K.splice(ae,1),K.splice(ae+1,0,j)))),Ct=zt.getCrossPointD(qt,kt),j=new vt,j.Id=u.length,j.Point=Ct,K.splice(f,0,j),fe=f,le=ae,ge=!1;break}$=ot}oe.push(Ct),$t=new Ft,$t.Value=r.OutLine.Value,$t.Type=r.OutLine.Type,$t.PointList=oe,u.push($t),ie=!1,oe=[]}ct=wt}if(u.length>0)b=zt.tracingClipPolygons(r,u,K);else if(zt.pointInPolygonByPList(w,s[0])){let _e=new E,Le=new te;Le.IsBorder=!0,Le.LowValue=r.LowValue,Le.HighValue=r.HighValue,Le.Area=zt.getExtentAndArea(s,_e),Le.IsClockWise=!0,Le.Extent=_e,Le.OutLine.PointList=s,Le.OutLine.Value=r.LowValue,Le.IsHighCenter=r.IsHighCenter,Le.OutLine.Type="Border",Le.HoleLines=[],b.push(Le)}return b}static twoPointsInside(r,s,o,f){if(s<r&&(r+=1),o<r&&(r+=1),o<s&&(s+=1),s<r){let b=r;r=s,s=b}return o>r&&o<=s?f>r&&f<=s:!(f>r&&f<=s)}static BSplineScanning(r,s){let o,f,b,u,w,C=[];if(s<4)return null;let M=!1;w=r[0];let K=r[s-1];for(w.X===K.X&&w.Y===K.Y&&(r.splice(0,1),r.push(r[0]),r.push(r[1]),r.push(r[2]),r.push(r[3]),r.push(r[4]),r.push(r[5]),r.push(r[6]),M=!0),s=r.length,f=0;f<s-3;f++)for(o=0;o<=1;o+=.05){let j=zt.BSpline(r,o,f);b=j[0],u=j[1],M?f>3&&(w=new xt,w.X=b,w.Y=u,C.push(w)):(w=new xt,w.X=b,w.Y=u,C.push(w))}return M?C.push(C[0]):(C.splice(0,0,r[0]),C.push(r[r.length-1])),C}static BSpline(r,s,o){let f,b=[];zt.fb(s,b);let u,w=0,C=0;for(f=0;f<4;f++)u=r[o+f],w+=b[f]*u.X,C+=b[f]*u.Y;let M=[];return M[0]=w,M[1]=C,M}static f0(r){return 1/6*(1-r)*(1-r)*(1-r)}static f1(r){return 1/6*(3*r*r*r-6*r*r+4)}static f2(r){return 1/6*(-3*r*r*r+3*r*r+3*r+1)}static f3(r){return 1/6*r*r*r}static fb(r,s){s[0]=zt.f0(r),s[1]=zt.f1(r),s[2]=zt.f2(r),s[3]=zt.f3(r)}static tracingStreamline(r,s,o,f,b,u){let w=[],C=r[1].length,M=r.length,K=[],j=[],$=o[1]-o[0],ot=f[1]-f[0];u===0&&(u=1);let ct,wt,Ct=$/Math.pow(u,2),qt=1.5*Ct;for(ct=0;ct<M;ct++)for(K[ct]=[],j[ct]=[],wt=0;wt<C;wt++)if(Math.abs(r[ct][wt]/b-1)<.01)K[ct][wt]=.1,j[ct][wt]=.1;else{let fe=Math.sqrt(r[ct][wt]*r[ct][wt]+s[ct][wt]*s[ct][wt]);fe===0&&(fe=1),K[ct][wt]=r[ct][wt]/fe*$/u,j[ct][wt]=s[ct][wt]/fe*ot/u}let kt,$t,ie=[],oe=[];for(ct=0;ct<M-1;ct++)for(ie[ct]=[],oe[ct]=[],wt=0;wt<C-1;wt++)oe[ct][wt]=ct%2==0&&wt%2==0?0:1,ie[ct][wt]=[];let ae=0;for(ct=0;ct<M-1;ct++)for(wt=0;wt<C-1;wt++)if(oe[ct][wt]===0){let fe,le,ge,_e=[],Le=new xt,Re=new Ft;Le.X=o[wt]+$/2,Le.Y=f[ct]+ot/2,_e.push(Le.clone()),$t=new vt,$t.Point=Le.clone(),$t.Id=ae,ie[ct][wt].push($t),oe[ct][wt]=1,fe=ct,le=wt;let Ke=500;for(ge=0;ge<Ke;){let i0=[];i0[0]=fe,i0[1]=le;let We=zt.tracingStreamlinePoint(Le,K,j,o,f,i0,!0);if(fe=i0[0],le=i0[1],!We||Math.abs(r[fe][le]/b-1)<.01||Math.abs(r[fe][le+1]/b-1)<.01||Math.abs(r[fe+1][le]/b-1)<.01||Math.abs(r[fe+1][le+1]/b-1)<.01)break;{let Xe=!1;for(let Ze of ie[fe][le])if(Math.sqrt((Le.X-Ze.Point.X)*(Le.X-Ze.Point.X)+(Le.Y-Ze.Point.Y)*(Le.Y-Ze.Point.Y))<Ct){Xe=!0;break}if(!Xe&&ie[fe][le].length>1){let Ze=ie[fe][le][0],Qe=ie[fe][le][1];ae===Ze.Id&&ae===Qe.Id||(kt=zt.distance_point2line(Ze.Point,Qe.Point,Le),kt<qt&&(Xe=!0))}if(Xe)break;_e.push(Le.clone()),$t=new vt,$t.Point=Le.clone(),$t.Id=ae,ie[fe][le].push($t),oe[fe][le]=1}ge+=1}for(Le.X=o[wt]+$/2,Le.Y=f[ct]+ot/2,fe=ct,le=wt,ge=0;ge<Ke;){let i0=[];i0[0]=fe,i0[1]=le;let We=zt.tracingStreamlinePoint(Le,K,j,o,f,i0,!1);if(fe=i0[0],le=i0[1],!We||Math.abs(r[fe][le]/b-1)<.01||Math.abs(r[fe][le+1]/b-1)<.01||Math.abs(r[fe+1][le]/b-1)<.01||Math.abs(r[fe+1][le+1]/b-1)<.01)break;{let Xe=!1;for(let Ze of ie[fe][le])if(Math.sqrt((Le.X-Ze.Point.X)*(Le.X-Ze.Point.X)+(Le.Y-Ze.Point.Y)*(Le.Y-Ze.Point.Y))<Ct){Xe=!0;break}if(!Xe&&ie[fe][le].length>1){let Ze=ie[fe][le][0],Qe=ie[fe][le][1];ae===Ze.Id&&ae===Qe.Id||(kt=zt.distance_point2line(Ze.Point,Qe.Point,Le),kt<qt&&(Xe=!0))}if(Xe)break;_e.splice(0,0,Le.clone()),$t=new vt,$t.Point=Le.clone(),$t.Id=ae,ie[fe][le].push($t),oe[fe][le]=1}ge+=1}_e.length>1&&(Re.PointList=_e,w.push(Re),ae+=1)}return w}static tracingStreamlinePoint(r,s,o,f,b,u,w){let C,M,K,j,$,ot,ct,wt,Ct=f.length,qt=b.length,kt=f[1]-f[0],$t=b[1]-b[0],ie=u[0],oe=u[1];if(C=s[ie][oe],M=s[ie][oe+1],K=s[ie+1][oe],j=s[ie+1][oe+1],$=C+(K-C)*((r.Y-b[ie])/$t),ot=M+(j-M)*((r.Y-b[ie])/$t),ct=$+(ot-$)*((r.X-f[oe])/kt),C=o[ie][oe],M=o[ie][oe+1],K=o[ie+1][oe],j=o[ie+1][oe+1],$=C+(K-C)*((r.Y-b[ie])/$t),ot=M+(j-M)*((r.Y-b[ie])/$t),wt=$+(ot-$)*((r.X-f[oe])/kt),w?(r.X+=ct,r.Y+=wt):(r.X-=ct,r.Y-=wt),!(r.X>=f[oe]&&r.X<=f[oe+1]&&r.Y>=b[ie]&&r.Y<=b[ie+1])){if(r.X<f[0]||r.X>f[f.length-1]||r.Y<b[0]||r.Y>b[b.length-1])return!1;for(let ae=ie-2;ae<ie+3;ae++)if(ae>=0&&ae<qt&&r.Y>=b[ae]&&r.Y<=b[ae+1]){ie=ae;for(let fe=oe-2;fe<oe+3;fe++)if(fe>=0&&fe<Ct&&r.X>=f[fe]&&r.X<=f[fe+1]){oe=fe;break}break}}return u[0]=ie,u[1]=oe,!0}static distance_point2line(r,s,o){let f=(s.Y-r.Y)/(s.X-r.X),b=(f*f*r.X+f*(o.Y-r.Y)+o.X)/(f*f+1),u=f*(b-r.X)+r.Y;return Math.sqrt((o.Y-u)*(o.Y-u)+(o.X-b)*(o.X-b))}static getExtent(r){let s,o,f,b,u,w=r[0];for(s=w.X,f=w.X,o=w.Y,b=w.Y,u=1;u<r.length;u++)w=r[u],w.X<s&&(s=w.X),w.X>f&&(f=w.X),w.Y<o&&(o=w.Y),w.Y>b&&(b=w.Y);let C=new E;return C.xMin=s,C.yMin=o,C.xMax=f,C.yMax=b,C}static getExtentAndArea(r,s){let o,f,b,u,w,C,M=r[0];for(f=M.X,u=M.X,b=M.Y,w=M.Y,C=1;C<r.length;C++)M=r[C],M.X<f&&(f=M.X),M.X>u&&(u=M.X),M.Y<b&&(b=M.Y),M.Y>w&&(w=M.Y);return s.xMin=f,s.yMin=b,s.xMax=u,s.yMax=w,o=(u-f)*(w-b),o}static isClockwise(r){let s,o,f,b,u,w,C,M,K=0,j=0;for(s=0;s<r.length-1;s++)o=r[s],s===0?(K=o.Y,j=0):K<o.Y&&(K=o.Y,j=s);return w=j-1,C=j,M=j+1,j===0&&(w=r.length-2),f=r[w],b=r[C],u=r[M],(u.X-f.X)*(b.Y-f.Y)-(b.X-f.X)*(u.Y-f.Y)>0}static isLineSegmentCross(r,s){let o=new E,f=new E,b=[],u=[];return b.push(r.P1),b.push(r.P2),u.push(s.P1),u.push(s.P2),zt.getExtentAndArea(b,o),zt.getExtentAndArea(u,f),!!zt.isExtentCross(o,f)&&!(((s.P1.X-r.P1.X)*(r.P2.Y-r.P1.Y)-(r.P2.X-r.P1.X)*(s.P1.Y-r.P1.Y))*((s.P2.X-r.P1.X)*(r.P2.Y-r.P1.Y)-(r.P2.X-r.P1.X)*(s.P2.Y-r.P1.Y))>0)}static isExtentCross(r,s){return!(r.xMin>s.xMax||r.xMax<s.xMin||r.yMin>s.yMax||r.yMax<s.yMin)}static getCrossPointF(r,s,o,f){let b,u,w,C,M,K,j=new Xt(0,0),$=(o.X-r.X)*(s.Y-r.Y)-(s.X-r.X)*(o.Y-r.Y),ot=(f.X-r.X)*(s.Y-r.Y)-(s.X-r.X)*(f.Y-r.Y);return $===0?j=o:ot===0?j=f:(b=r,u=s,w=o,C=f,M=(C.X-w.X)*(b.Y-u.Y)-(u.X-b.X)*(w.Y-C.Y),K=(b.Y-w.Y)*(u.X-b.X)*(C.X-w.X)+w.X*(C.Y-w.Y)*(u.X-b.X)-b.X*(u.Y-b.Y)*(C.X-w.X),j.X=K/M,M=(b.X-u.X)*(C.Y-w.Y)-(u.Y-b.Y)*(w.X-C.X),K=u.Y*(b.X-u.X)*(C.Y-w.Y)+(C.X-u.X)*(C.Y-w.Y)*(b.Y-u.Y)-C.Y*(w.X-C.X)*(u.Y-b.Y),j.Y=K/M),j}static getCrossPointD(r,s){let o,f,b,u,w,C,M=new xt,K=(s.P1.X-r.P1.X)*(r.P2.Y-r.P1.Y)-(r.P2.X-r.P1.X)*(s.P1.Y-r.P1.Y),j=(s.P2.X-r.P1.X)*(r.P2.Y-r.P1.Y)-(r.P2.X-r.P1.X)*(s.P2.Y-r.P1.Y);return K===0?M=s.P1:j===0?M=s.P2:(o=r.P1,f=r.P2,b=s.P1,u=s.P2,w=(u.X-b.X)*(o.Y-f.Y)-(f.X-o.X)*(b.Y-u.Y),C=(o.Y-b.Y)*(f.X-o.X)*(u.X-b.X)+b.X*(u.Y-b.Y)*(f.X-o.X)-o.X*(f.Y-o.Y)*(u.X-b.X),M.X=C/w,w=(o.X-f.X)*(u.Y-b.Y)-(f.Y-o.Y)*(b.X-u.X),C=f.Y*(o.X-f.X)*(u.Y-b.Y)+(u.X-f.X)*(u.Y-b.Y)*(o.Y-f.Y)-u.Y*(b.X-u.X)*(f.Y-o.Y),M.Y=C/w),M}static insertPoint2Border(r,s){let o,f,b,u,w,C,M,K=[];for(zt.addAll(s,K),b=0;b<r.length;b++)for(f=r[b],M=f.Point,o=K[0],w=o.Point,u=1;u<K.length;u++){if(o=K[u],C=o.Point,(M.X-w.X)*(M.X-C.X)<=0&&(M.Y-w.Y)*(M.Y-C.Y)<=0&&(M.X-w.X)*(C.Y-w.Y)-(C.X-w.X)*(M.Y-w.Y)==0){K.splice(u,0,f);break}w=C}return K}static insertPoint2RectangleBorder(r,s){let o,f,b,u,w,C,M,K,j,$=[],ot=[],ct=[],wt=[],Ct=[];for(w=0;w<r.length;w++)if(b=r[w],b.Type!=="Close"){for(K=[],zt.addAll(b.PointList,K),f=new vt,f.Id=w,M=0;M<=1;M++)if(u=M===0?K[0]:K[K.length-1],f.Point=u,j=!1,u.X===s.xMin){for(C=0;C<$.length;C++)if(o=$[C],u.Y<o.Point.Y){$.splice(C,0,f),j=!0;break}j||$.push(f)}else if(u.X===s.xMax){for(C=0;C<ct.length;C++)if(o=ct[C],u.Y>o.Point.Y){ct.splice(C,0,f),j=!0;break}j||ct.push(f)}else if(u.Y===s.yMin){for(C=0;C<wt.length;C++)if(o=wt[C],u.X>o.Point.X){wt.splice(C,0,f),j=!0;break}j||wt.push(f)}else if(u.Y===s.yMax){for(C=0;C<ot.length;C++)if(o=ot[C],u.X<o.Point.X){ot.splice(C,0,f),j=!0;break}j||ot.push(f)}}return f=new vt,f.Id=-1,u=new xt,u.X=s.xMin,u.Y=s.yMin,f.Point=u,Ct.push(f),zt.addAll($,Ct),f=new vt,f.Id=-1,u=new xt,u.X=s.xMin,u.Y=s.yMax,f.Point=u,Ct.push(f),zt.addAll(ot,Ct),f=new vt,f.Id=-1,u=new xt,u.X=s.xMax,u.Y=s.yMax,f.Point=u,Ct.push(f),zt.addAll(ct,Ct),f=new vt,f.Id=-1,u=new xt,u.X=s.xMax,u.Y=s.yMin,f.Point=u,Ct.push(f),zt.addAll(wt,Ct),Ct.push(Ct[0]),Ct}static insertEndPoint2Border(r,s){let o,f,b,u,w,C,M,K,j,$,ot,ct=[],wt=[],Ct=[];for(K=[],zt.addAll(r,K),o=s[0],C=o.Point,Ct.push(o),b=1;b<s.length;b++){for(o=s[b],M=o.Point,ct=[],u=0;u<K.length&&u!==K.length;u++)j=K[u],Math.abs(j.sPoint.X-C.X)<1e-6&&Math.abs(j.sPoint.Y-C.Y)<1e-6&&(ct.push(j),K.splice(u,1),u-=1);if(ct.length>0)if(wt=[],ct.length>1){for(u=0;u<ct.length;u++)if(j=ct[u],$=Math.pow(j.Point.X-C.X,2)+Math.pow(j.Point.Y-C.Y,2),u===0)wt.push([$,u]);else{for(ot=!1,w=0;w<wt.length;w++)if($<parseFloat(wt[w][0])){wt.splice(w,0,[$,u]),ot=!0;break}ot||wt.push([$,u])}for(u=0;u<wt.length;u++)j=ct[parseInt(wt[u][1])],f=new vt,f.Id=j.Index,f.Point=j.Point,Ct.push(f)}else j=ct[0],f=new vt,f.Id=j.Index,f.Point=j.Point,Ct.push(f);Ct.push(o),C=M}return Ct}static insertPoint2Border_Ring(r,s,o,f){let b,u,w,C,M,K,j,$,ot,ct=[],wt=[],Ct=[];for(M=0;M<o.getLineNum();M++){for(ot=o.LineList[M],wt=[],w=0;w<ot.pointList.length;w++)b=new vt,b.Id=-1,b.BorderIdx=M,b.Point=ot.pointList[w],b.Value=r[ot.ijPointList[w].I][ot.ijPointList[w].J],wt.push(b);for(w=0;w<s.length;w++)for(u=s[w].clone(),u.BorderIdx=M,$=u.Point,K=wt[0].Point.clone(),C=1;C<wt.length;C++){if(j=wt[C].Point.clone(),($.X-K.X)*($.X-j.X)<=0&&($.Y-K.Y)*($.Y-j.Y)<=0&&($.X-K.X)*(j.Y-K.Y)-(j.X-K.X)*($.Y-K.Y)==0){wt.splice(C,0,u);break}K=j}for(Ct=[],w=0;w<wt.length;w++)u=wt[w],u.BInnerIdx=w,Ct.push(u);f[M]=Ct.length,zt.addAll(Ct,ct)}return ct}static doubleEquals(r,s){let o=Math.abs(1e-5*r);return Math.abs(r-s)<=o}}zt._endPointList=[];var ve=function(z,r,s,o){return new(s||(s=Promise))(function(f,b){function u(M){try{C(o.next(M))}catch(K){b(K)}}function w(M){try{C(o.throw(M))}catch(K){b(K)}}function C(M){var K;M.done?f(M.value):(K=M.value,K instanceof s?K:new s(function(j){j(K)})).then(u,w)}C((o=o.apply(z,r||[])).next())})};let ye,we=null,Ee=0;function ze(z,r){const s=r(8*z.length);return(we!==null&&we.buffer===ye.memory.buffer||(we=new Float64Array(ye.memory.buffer)),we).set(z,s/8),Ee=z.length,s}let Be=null;function e0(){return Be!==null&&Be.buffer===ye.memory.buffer||(Be=new Int32Array(ye.memory.buffer)),Be}const He=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});He.decode();let a0=null;function Ye(z,r){return He.decode((a0!==null&&a0.buffer===ye.memory.buffer||(a0=new Uint8Array(ye.memory.buffer)),a0).subarray(z,z+r))}let d0=null;function b0(){return d0!==null&&d0.buffer===ye.memory.buffer||(d0=new Float32Array(ye.memory.buffer)),d0}function O0(z,r){const s=r(4*z.length);return b0().set(z,s/4),Ee=z.length,s}function T0(z){return ve(this,void 0,void 0,function*(){if(ye)return Bt.kg.debug("wasm contour already intialized"),ye;(typeof(z=z??k.v.wasmPath+"/qe_lib_bg.wasm")=="string"||typeof Request=="function"&&z instanceof Request||typeof URL=="function"&&z instanceof URL)&&(z=yield fetch(z).catch(o=>{Bt.kg.error("load contour wasm failed from "+z)}));const{instance:r,module:s}=yield function(o,f){return ve(this,void 0,void 0,function*(){if(Bt.kg.debug("load wasm"),typeof Response=="function"&&o instanceof Response){const b=yield o.arrayBuffer();return yield WebAssembly.instantiate(b,f)}{const b=yield WebAssembly.instantiate(o,f);return b instanceof WebAssembly.Instance?{instance:b,module:o}:b}})}(z,{});return ye=r.exports,T0.__wbindgen_wasm_module=s,ye})}var R0=function(z,r,s,o){return new(s||(s=Promise))(function(f,b){function u(M){try{C(o.next(M))}catch(K){b(K)}}function w(M){try{C(o.throw(M))}catch(K){b(K)}}function C(M){var K;M.done?f(M.value):(K=M.value,K instanceof s?K:new s(function(j){j(K)})).then(u,w)}C((o=o.apply(z,r||[])).next())})};class D0{static createDefaultColorStops(r,s,o){const f=JSON.parse(JSON.stringify(D0.DefaultColorStopOptions));f.fieldName=(0,jt.En)(s,f.fieldName);const b=r.length+1,u=f.stops.length;if(b<=u){for(let wt=0;wt<=r.length;wt++)f.stops[wt].value=r[wt];return f.stops.length>r.length+1&&(f.stops[r.length+1].value=(0,jt.En)(o,k.v.defaultUndef)),f.stops.splice(b),f}const w=u-1,C=b-u,M=parseInt(C/w),K=C-M*(w-1),j={stops:[],fieldName:f.fieldName};let $=0;const ot=(wt,Ct,qt,kt)=>{const $t=(kt+1)/(qt+1)*100;return wt.mix(Ct,$t)};let ct=null;for(let wt=0;wt<w;wt++){ct=ct||new Cx.t(f.stops[wt].stop),j.stops.push({value:r[$++],stop:ct});const Ct=wt===f.stops.length-2?M:K,qt=new Cx.t(f.stops[wt+1].stop);for(let kt=0;kt<Ct;kt++)j.stops.push({value:r[$++],stop:ot(ct,qt,Ct,kt)});ct=qt}return j.stops.push({value:(0,jt.En)(o,k.v.defaultUndef),stop:"rgba(0,0,0,0)"}),j}constructor(r){this.options={},(0,jt.Ov)(this.options,r)}getFeatureOfPoints(r,s,o,f,b){s=s||"value";const u=[];for(let K of o.PointList)u.push([K.X,K.Y]);let w,C=o.Value;if(r==="LineString")w={type:"LineString",coordinates:u};else if(w={type:"Polygon",coordinates:[u]},b&&f){if(b.IsHighCenter||b.IsBorder){const K=f.indexOf(b.LowValue);C=K>=0&&K<f.length-1?f[K+1]:b.HighValue}else C=b.LowValue;if(b.HasHoles()){zt.isClockwise(o.PointList)||w.coordinates[0].reverse();for(let K=0;K<b.HoleLines.length;K++){const j=b.HoleLines[K],$=[];for(let ot of j.PointList)$.push([ot.X,ot.Y]);zt.isClockwise(j.PointList)&&$.reverse(),w.coordinates.push($)}}}let M={id:o.BorderIdx};return M[s]=C,{type:"Feature",geometry:w,properties:M}}traceShaded(r,s,o,f,b){let u=zt.tracingPolygons(o,r.contourlines,r.borders,s);for(let w of u){let C=w.OutLine,M=this.getFeatureOfPoints("Polygon",b,C,s,w);f.push(M)}return{type:"FeatureCollection",features:f}}traceShadedWithContourResult(r){const s=this.traceShaded(r.contourInfo,r.analysisValues,r.dataSource.getGrid().getYxArr(),[],r.valueFieldName),o=new zi(s);let f=r.drawOptions;return f||(f={polygon:{color:D0.createDefaultColorStops(r.analysisValues,r.valueFieldName)}}),this.options.layerCreator&&this.options.layerCreator(r.layerOptions,o,f)}tracingContourShaded(r){if(!r||!r.dataSource)return;const s=r.dataSource.getGrid();let o=(0,jt.En)(r.undef,s.undef);o===void 0&&(Bt.kg.warn("格点分析尚未提供缺测值，将使用默认的缺测值："+k.v.defaultUndef),o=k.v.defaultUndef),(0,ce.T)(r.dataSource.gridOptions);const f=a.createGridXY_Delt(r.dataSource.gridOptions.xStart,r.dataSource.gridOptions.yStart,r.dataSource.gridOptions.xEnd,r.dataSource.gridOptions.yEnd,r.dataSource.gridOptions.xDelta,r.dataSource.gridOptions.yDelta),b=s.getYxArr(),u=[],w=zt.tracingBorders(b,f[0],f[1],u,o);let C=zt.tracingContourLines(b,f[0],f[1],r.analysisValues.length,r.analysisValues,o,w,u);C=zt.smoothLines(C);let M=[];for(let wt of C){let Ct=this.getFeatureOfPoints("LineString",r.valueFieldName,wt);M.push(Ct)}const K={type:"FeatureCollection",features:M};let j=r.drawOptions;j?(typeof j=="string"&&(j=li.Zc.getResource(j),j||Bt.kg.error("当前资源"+j+"未找到！请先使用资源管理器加载！")),j.polyline=(0,jt.En)(j.polyline,JSON.parse(JSON.stringify(D0.DefaultContourShadedStyle.polyline))),j.polygon=(0,jt.En)(j.polygon,{color:D0.createDefaultColorStops(r.analysisValues,r.valueFieldName)})):j={polyline:Object.assign({},JSON.parse(JSON.stringify(D0.DefaultContourShadedStyle.polyline))),polygon:{color:D0.createDefaultColorStops(r.analysisValues,r.valueFieldName)}};const $={contourlines:C,borders:w,layer:void 0,dataSource:void 0,drawOptions:j};r.withShaded&&this.traceShaded($,r.analysisValues,b,M,r.valueFieldName);const ot=new zi(K);$.dataSource=ot;const ct=this.options.layerCreator&&this.options.layerCreator(r.layerOptions,ot,j);return $.layer=ct,r.reserveTracingInfo?$:{layer:ct}}tracingContourShadedWASM(r){var s,o,f,b;return R0(this,void 0,void 0,function*(){if(!r||!r.dataSource)return;const u=r.dataSource,w=u.gridOptions;yield T0();const C=JSON.parse(r.withShaded?function(ot,ct,wt,Ct,qt,kt,$t,ie,oe){try{const le=ye.__wbindgen_add_to_stack_pointer(-16),ge=ze(ot,ye.__wbindgen_malloc),_e=Ee,Le=ze(ct,ye.__wbindgen_malloc),Re=Ee;ye.make_contours_lonlat(le,ge,_e,Le,Re,wt,Ct,qt,kt,$t,ie,oe);var ae=e0()[le/4+0],fe=e0()[le/4+1];return Ye(ae,fe)}finally{ye.__wbindgen_add_to_stack_pointer(16),ye.__wbindgen_free(ae,fe)}}(u.getGrid().toNumberArr(),r.analysisValues,u.getGrid().xSize,u.getGrid().ySize,w.xStart,w.xDelta,w.yStart,w.yDelta,(o=(s=r.undef)!==null&&s!==void 0?s:u.getGrid().undef)!==null&&o!==void 0?o:k.v.defaultUndef):function(ot,ct,wt,Ct,qt,kt,$t,ie,oe){try{const le=ye.__wbindgen_add_to_stack_pointer(-16),ge=ze(ot,ye.__wbindgen_malloc),_e=Ee,Le=ze(ct,ye.__wbindgen_malloc),Re=Ee;ye.make_contour_rings_lonlat(le,ge,_e,Le,Re,wt,Ct,qt,kt,$t,ie,oe);var ae=e0()[le/4+0],fe=e0()[le/4+1];return Ye(ae,fe)}finally{ye.__wbindgen_add_to_stack_pointer(16),ye.__wbindgen_free(ae,fe)}}(u.getGrid().toNumberArr(),r.analysisValues,u.getGrid().xSize,u.getGrid().ySize,w.xStart,w.xDelta,w.yStart,w.yDelta,(b=(f=r.undef)!==null&&f!==void 0?f:u.getGrid().undef)!==null&&b!==void 0?b:k.v.defaultUndef)),M=new zi(C);let K=r.drawOptions;K?typeof K=="string"&&(K=li.Zc.getResource(K),K||Bt.kg.error("当前资源"+K+"未找到！请先使用资源管理器加载！")):K={polyline:Object.assign({},JSON.parse(JSON.stringify(D0.DefaultContourShadedStyle.polyline))),polygon:{color:D0.createDefaultColorStops(r.analysisValues,r.valueFieldName)}};const j=this.options.layerCreator&&this.options.layerCreator(r.layerOptions,M,K),$={contourlines:C,layer:j,dataSource:M,drawOptions:K};return r.reserveTracingInfo?$:{layer:j}})}static interpToGridWASM(r,s,o,f){return R0(this,void 0,void 0,function*(){const b=performance.now();f=(0,jt.En)(f,k.v.defaultUndef);const u=s.getFeatures();if(!u||u.features.length===0)return;const w=[];if(ta(u,($,ot)=>{if($.geometry.type!=="Point")return;let ct=parseFloat($.properties[o]);if(typeof ct!="number"||isNaN(ct)||ct>9e4)return;let wt=$.geometry;w.push(parseFloat(wt.coordinates[0]),parseFloat(wt.coordinates[1]),ct)}),(0,ce.T)(r),(w.length>15?5:w.length/3-1)<=0)return void Bt.kg.error("点数太少，无法插值！");let C=new Float32Array(r.xSize*r.ySize);C.fill(f);const M=new Float32Array(r.xSize);M.forEach(($,ot)=>{M[ot]=r.xStart+r.xDelta*ot});const K=new Float32Array(r.ySize);K.forEach(($,ot)=>{K[ot]=r.yStart+r.yDelta*ot}),C=function($,ot,ct,wt){try{const oe=ye.__wbindgen_add_to_stack_pointer(-16),ae=O0($,ye.__wbindgen_malloc),fe=Ee,le=O0(ot,ye.__wbindgen_malloc),ge=Ee,_e=O0(ct,ye.__wbindgen_malloc),Le=Ee;ye.interp_idw(oe,ae,fe,le,ge,_e,Le,wt);var Ct=e0()[oe/4+0],qt=e0()[oe/4+1],kt=($t=Ct,ie=qt,b0().subarray($t/4,$t/4+ie)).slice();return ye.__wbindgen_free(Ct,4*qt),kt}finally{ye.__wbindgen_add_to_stack_pointer(16)}var $t,ie}(new Float32Array(w),M,K,4);const j=new it.P(Ot.U.Float32,r.xSize,r.ySize,C.buffer,f);return Bt.kg.debug("interp costs "+(performance.now()-b)+"ms"),new zr.o([[j]],{gridOptions:r})})}static interpToGridProvider(r,s,o,f){const b=performance.now();(0,ce.T)(r);const u=new Float32Array(r.xSize);u.forEach((ct,wt)=>{u[wt]=r.xStart+r.xDelta*wt});const w=new Float32Array(r.ySize);w.forEach((ct,wt)=>{w[wt]=r.yStart+r.yDelta*wt});let C=new Float32Array(r.xSize*r.ySize);C.fill(f);const M=s.getFeatures();if(!M||M.features.length===0)return;const K=[];ta(M,(ct,wt)=>{if(ct.geometry.type!=="Point")return;let Ct=parseFloat(ct.properties[o]);if(typeof Ct!="number"||isNaN(Ct)||Ct>9e4)return;let qt=ct.geometry;K.push(parseFloat(qt.coordinates[0]),parseFloat(qt.coordinates[1]),Ct)});const j=K.length>15?5:K.length/3-1;if(j<=0)return void Bt.kg.error("点数太少，无法插值！");const $=K.length/3;for(let ct=0;ct<r.ySize;ct++){const wt=ct*r.xSize;for(let Ct=0;Ct<r.xSize;Ct++){const qt=wt+Ct,kt=u[Ct],$t=w[ct],ie=[new Float32Array(j),new Float32Array(j)];for(let fe=0;fe<$;fe++){let le=3*fe,ge=K[le],_e=K[le+1],Le=K[le+2];if(kt==ge&&$t==_e){C[qt]=Le;break}{let Re=kt-ge,Ke=$t-_e,i0=1/(Re*Re+Ke*Ke);for(let We=0;We<j;We++)if(ie[0][We]<i0){ie[0][We]=i0,ie[1][We]=Le;break}}}let oe=0,ae=0;for(let fe=0;fe<j;fe++)oe+=ie[0][fe]*ie[1][fe],ae+=ie[0][fe];C[qt]=oe/ae}}for(let ct=1;ct<r.ySize-1;ct++){let wt=ct*r.xSize,Ct=wt+r.xSize,qt=wt-r.xSize;for(let kt=1;kt<r.xSize-1;kt++){let $t=wt+kt,ie=Ct+kt,oe=qt+kt,ae=$t+1,fe=$t-1;C[$t]=C[$t]+.125*(C[ie]+C[oe]+C[ae]+C[fe]-4*C[$t])}}const ot=new it.P(Ot.U.Float32,r.xSize,r.ySize,C.buffer,f);return Bt.kg.debug("interp costs "+(performance.now()-b)+"ms"),new zr.o([[ot]],{gridOptions:r})}static interpToGrid(r,s,o,f){const b=performance.now(),u=s.getFeatures();if(!u||u.features.length===0)return;const w=[];let C=0;ta(u,(wt,Ct)=>{if(wt.geometry.type!=="Point")return;let qt=parseFloat(wt.properties[o]);if(typeof qt!="number"||isNaN(qt)||qt>9e4)return;let kt=wt.geometry;w[C]=[],w[C][0]=parseFloat(kt.coordinates[0]),w[C][1]=parseFloat(kt.coordinates[1]),w[C][2]=qt,C++}),(r.xDelta<0||r.yDelta<0)&&Bt.kg.error("插值参数中的x y间隔需要为正值！"),(0,ce.T)(r);let M=[];M.length=r.xSize;let K=[];K.length=r.ySize,a.createGridXY_Num(r.xStart,r.yStart,r.xEnd,r.yEnd,M,K);const j=w.length>5?5:w.length-1;if(j<=0)return void Bt.kg.warn("用于插值的站点数量过少，无法插值，建议数量大于5！");const $=a.interpolation_IDW_Neighbor_Undef(w,M,K,j,(0,jt.En)(f,k.v.defaultUndef)),ot=new it.P(Ot.U.Float32,r.xSize,r.ySize,void 0,(0,jt.En)(f,k.v.defaultUndef));ot.update($);const ct=new zr.o([[ot]],{gridOptions:r});return Bt.kg.debug("interp costs "+(performance.now()-b)+"ms"),ct}tracingContourShadedFromPoints(r){const s=D0.interpToGridProvider(r.gridOpts,r.points,r.fieldName,r.undef);return this.tracingContourShaded({dataSource:s,withShaded:r.withShaded,drawOptions:r.drawOptions,valueFieldName:(0,jt.En)(r.valueFieldName,r.fieldName),analysisValues:r.analysisValues,layerOptions:r.layerOptions,reserveTracingInfo:r.reserveTracingInfo})}tracingContourShadedFromPointsWASM(r){return R0(this,void 0,void 0,function*(){const s=D0.interpToGridProvider(r.gridOpts,r.points,r.fieldName,r.undef);return this.tracingContourShadedWASM({dataSource:s,withShaded:r.withShaded,drawOptions:r.drawOptions,analysisValues:r.analysisValues,layerOptions:r.layerOptions,reserveTracingInfo:r.reserveTracingInfo})})}tracingStreamLinesAsync(r,s){var o,f,b;return R0(this,void 0,void 0,function*(){const u=r.dataSource.getU(),w=r.dataSource.getV(),C=r.dataSource.wProvider&&r.dataSource.wProvider.getGrid();!((o=r.dataSource.gridOptions.zValues)===null||o===void 0)&&o.length||(r.dataSource.gridOptions.zValues=[0]);let M=(0,jt.En)(r.undef,u.undef);M===void 0&&(Bt.kg.warn("格点分析尚未提供缺测值，将使用默认的缺测值："+k.v.defaultUndef),M=k.v.defaultUndef);const K=(f=r.threadCount)!==null&&f!==void 0?f:1;r.needVolume&&r.point2D&&(Bt.kg.debug("当前设置需要返回管线，但是是用了二维点，自动调整为返回三维点"),r.point2D=!1);const j=r.needVolume?new Ks(k.v.workerPath+"/sl.volume.js",K,"streamline",{type:"classic"}):new Ks(k.v.workerPath+"/sl.js",K,"streamline",{type:"classic"}),$=[],ot=[],ct=[],wt=(oe,ae)=>{if(!oe)return;let fe;return fe=ae.length===0?oe.slice(0):ae.pop(),fe},Ct=((b=r.dataSource.gridOptions.zValues)===null||b===void 0?void 0:b.length)||1;let qt,kt,$t,ie=!1;if(Ct===1)qt=u.raw.buffer,kt=w.raw.buffer,$t=void 0;else if(r.zIdx>=0)qt=r.dataSource.getU(void 0,r.zIdx).raw.buffer,kt=r.dataSource.getV(void 0,r.zIdx).raw.buffer,$t=void 0;else{const oe=(0,jt.cM)(u.dataType,new ArrayBuffer(u.raw.byteLength*Ct)),ae=(0,jt.cM)(w.dataType,new ArrayBuffer(w.raw.byteLength*Ct)),fe=r.dataSource.wProvider&&(0,jt.cM)(r.dataSource.getW().dataType,new ArrayBuffer(r.dataSource.getW().raw.byteLength*Ct));let le=0;for(let ge=0;ge<Ct;ge++)oe.set(r.dataSource.getU(void 0,ge).raw,le),ae.set(r.dataSource.getV(void 0,ge).raw,le),fe==null||fe.set(r.dataSource.getW(void 0,ge).raw,le),le+=u.raw.length;qt=oe.buffer,kt=ae.buffer,$t=fe==null?void 0:fe.buffer,ie=!0}return new Promise((oe,ae)=>{var fe,le;let ge=0,_e=0;const Le={type:"FeatureCollection",features:[]},Re=[],Ke=(fe=r.lineCount)!==null&&fe!==void 0?fe:1e3,i0=Math.max(parseInt(Ke/K)+1,K);let We=Ke,Xe=0;const Ze=Object.assign({},r.dataSource.gridOptions);let Qe;ie||(r.zIdx>0&&(0,jt.ri)(Ze.zValues[r.zIdx])?Ze.zValues=[Ze.zValues[r.zIdx]]:Ze.zValues=[0]),Qe=r.seedGenerator?r.seedGenerator:r.zIdx<0?()=>(0,jt.r_)(r.dataSource.gridOptions):()=>[...(0,jt.r_)(r.dataSource.gridOptions,!1),r.dataSource.gridOptions.zValues[r.zIdx]];const v0=r.volumeOptions||{},o0={vertices:[],indices:[],st:[],normals:[]},A0=(Y0,xx)=>{if(Y0===1)return new Uint8Array(xx);if(Y0===2)return new Uint16Array(xx);if(Y0===4)return new Uint32Array(xx);throw new Error("不能识别的索引单个长度："+Y0)},sx=Y0=>{if(o0.vertices.length===1){Y0.vertices=new Float32Array(o0.vertices[0]);const Ix=o0.indices[0].len;return Y0.indices=A0(Ix,o0.indices[0].data),Y0.normals=new Float32Array(o0.normals[0]),void(Y0.st=new Float32Array(o0.st[0]))}let xx=0,V0=0,Px=0,Vi=0;for(let Ix=0;Ix<o0.indices.length;Ix++)xx+=o0.vertices[Ix].byteLength/4,V0+=o0.indices[Ix].data.byteLength/o0.indices[Ix].len,Px+=o0.normals[Ix].byteLength/4,Vi+=o0.st[Ix].byteLength/4;const Yx=new Float32Array(xx),Yn=new Float32Array(Px),_i=new Float32Array(Vi);let _s=0,Ha=0,Ka=0;for(let Ix=0;Ix<o0.indices.length;Ix++){const Pa=new Float32Array(o0.vertices[Ix]);Yx.set(Pa,_s),_s+=Pa.length;const xa=new Float32Array(o0.normals[Ix]);Yn.set(xa,Ha),Ha+=xa.length;const Sa=new Float32Array(o0.st[Ix]);_i.set(Sa,Ka),Ka+=Sa.length}const Na=xx/3>65535?new Uint32Array(V0):new Uint16Array(V0);let Fa=0,Ya=0;for(let Ix=0;Ix<o0.indices.length;Ix++){const Pa=o0.vertices[Ix].byteLength/12,xa=A0(o0.indices[Ix].len,o0.indices[Ix].data);Fa>0?xa.forEach(Sa=>{Na[Ya++]=Sa+Fa}):(Na.set(xa),Ya=xa.length),Fa+=Pa}Y0.vertices=Yx,Y0.indices=Na,Y0.normals=Yn,Y0.st=_i};for(;!(We<=0);){let Y0=i0;We<i0&&(Y0=We);const xx=[];for(let Px=0;Px<Y0;Px++){const Vi=Qe(Xe);Vi&&(xx.push(...Vi),Xe++)}const V0={data:Object.assign({gridOptions:Ze,u:u.raw.buffer,v:w.raw.buffer,scale:u.dataScale,offset:u.dataOffset,dataType:u.dataType,algo:u.algo,wScale:C==null?void 0:C.dataScale,wOffset:C==null?void 0:C.dataOffset,wAlgo:C==null?void 0:C.algo,wUndef:C==null?void 0:C.undef,undef:M,step:r.step,backward:r.backward,seeds:xx,hReso:r.hReso,vReso:r.vReso,allLoop:r.allLoop,stayLoop:r.stayLoop,lineMinCount:r.lineMinCount,wDataType:r.dataSource.wProvider&&((le=r.dataSource.wProvider.getGrid())===null||le===void 0?void 0:le.dataType),zScale:r.zScale,disableDensityControl:r.disableDensityControl,point2D:r.point2D},v0),beforeExec:()=>{V0.data.u=wt(qt,$),V0.data.v=wt(kt,ot),V0.transffers=[V0.data.u,V0.data.v],$t&&(V0.data.w=wt($t,ct),V0.transffers.push(V0.data.w))},onCompleted:Px=>{var Vi,Yx;const Yn={type:"FeatureCollection",features:[]};if(!((Vi=Px.streamlines)===null||Vi===void 0)&&Vi.length&&Px.streamlines.forEach(_i=>{const _s={type:"Feature",geometry:{type:"LineString",coordinates:_i},properties:{}};Yn.features.push(_s),Le.features.push(_s),Re.push(_i)}),s&&s({streamlines:Px.streamlines,allFC:Le,fc:Yn}),$.push(Px.u),ot.push(Px.v),Px.w&&ct.push(Px.w),r.needVolume&&(!((Yx=Px.streamlines)===null||Yx===void 0)&&Yx.length)&&(o0.indices.push({len:Px.indiceByteLen,data:Px.indices}),o0.normals.push(Px.normals),o0.st.push(Px.st),o0.vertices.push(Px.vertices)),_e++,_e===ge){const _i={provider:new zi(Le),streamlines:Re};r.needVolume&&sx(_i),oe(_i),j.destroy()}}};j.push(V0),ge++,We-=i0}})})}}D0.DefaultContourShadedStyle={polyline:{color:"rgba(255,255,255,0.5)",label:[{text:{data:"$value",backColor:"#edf2ba",backPadding:[8,2],backRoundRect:!0,backRoundRadius:8,backHeight:12,color:"black",font:"12px Arial",backShadowColor:"gray",backShadowOffset:[2,2]}}]},polygon:{}},D0.DefaultColorStopOptions={stops:[{value:-100,stop:"rgba(0,0,255,0.8)"},{value:0,stop:"rgba(255,255,255,0.8)"},{value:100,stop:"rgba(255,0,0,0.8)"}],field:"value"};class $0{constructor(r){this.map=r}getCurrent(){return this.currentTool}setCurrent(r){var s,o,f;(s=this.currentTool)===null||s===void 0||s.end(),this.currentTool=r,(o=this.currentTool)===null||o===void 0||o.setMap(this.map),(f=this.currentTool)===null||f===void 0||f.begin()}}class B0 extends Br.c{constructor(){super(...arguments),this.stopRulesMap={}}attach(r,s,o){o||(o=(0,fx.it)(r))||Bt.kg.error("未能根据"+r+"找到相应资源！"),o instanceof Nr.NB||(o=new Nr.NB(o));const f={firer:this,msg:{key:r,sr:o}};this.stopRulesMap[r]?this.stopRulesMap[r].changed.push(s):(this.stopRulesMap[r]={sr:o,changed:[s]},this.fire(B0.EventTypes.attachFirst,f)),this.fire(B0.EventTypes.attach,f)}setOpacity(r,s,o,f=Nr.DY.outside,b=0){const u=this.stopRulesMap[r];u||Bt.kg.warn("未能找到key为"+r+"的调色板！"),u.sr.setOpacityByIndex(s,f,b,o);for(const w of u.changed)w();this.fire(B0.EventTypes.changeOpacity,{firer:this,msg:{key:r,sr:u.sr}})}detach(r,s){const o=this.stopRulesMap[r];o||Bt.kg.warn("未能找到key为"+r+"的调色板！");const f=()=>{this.fire(B0.EventTypes.detachLast,{firer:this,msg:{key:r,sr:o.sr}}),this.fire(B0.EventTypes.detach,{firer:this,msg:{key:r,sr:o.sr}}),delete o.changed,delete o.sr,delete this.stopRulesMap[r]};if(s){const b=o.changed.indexOf(s);b>=0&&o.changed.splice(b,1),o.changed.length===0?f():this.fire(B0.EventTypes.detach,{firer:this,msg:{key:r,sr:o.sr}})}else f()}}B0.EventTypes={attach:"attach",attachFirst:"attach:first",detachLast:"detach:last",detach:"detach",changeOpacity:"change:opacity"};var L0=t(285);class ox{constructor(r,s){this.options=(0,jt.Ov)({},s,ox.DefaultOptions),this._buf=r,this._pos=0}unpack(){const r=performance.now();for(var s=this._view=new DataView(this._buf),o=0,f="";o<s.byteLength&&(f+=String.fromCharCode(s.getUint8(o))).indexOf(`
Data:
`)===-1;)o+=1;f=f.substr(0,f.length-7),this._pos=o+1;const b=this.dapvar=new L0.cF(f).parse(),u=this.getValue();return Bt.kg.debug("unpack dods costs "+(performance.now()-r)+"ms"),{dds:b,dods:u}}getValue(){var r=this.dapvar.type.toLowerCase();let s;return s=r==="structure"||r==="dataset"?this._parse_structure():r==="grid"?this._parse_grid():r==="sequence"?this._parse_sequence():this._buf.slice(this._pos,this._pos+4)==="Z\0\0\0"?this._parse_base_type_sequence():this._parse_base_type(r),s}_parse_structure(){var r,s={},o=this.dapvar;for(var f in o)o[f].type&&(this.dapvar=o[f],r=this.getValue(),s[f]=r);return this.dapvar=o,s}_parse_grid(){var r,s=[],o=this.dapvar;for(var f in this.dapvar=o.array,r=this.getValue(),s.push(r),o.maps)o.maps[f].type&&(this.dapvar=o.maps[f],r=this.getValue(),s.push(r));return this.dapvar=o,s}_parse_sequence(){for(var r,s=[],o=this._unpack_uint32(),f=this.dapvar;o!==2768240640;){var b=[];for(var u in f)f[u].type&&(this.dapvar=f[u],r=this.getValue(),b.push(r));s.push(b),o=this._unpack_uint32()}return this.dapvar=f,s}_parse_base_type_sequence(){for(var r,s=[],o=this._unpack_uint32();o!==2768240640;)r=this.getValue(),s.push(r),o=this._unpack_uint32();return s}_parse_base_type(r){var s=[],o=1;if(this.dapvar.shape.length&&(o=this._unpack_uint32(),r!=="url"&&r!=="string"&&this._unpack_uint32()),r==="byte")s=this._unpack_bytes(o);else if(r==="url"||r==="string")s=this._unpack_string(o);else{var f;switch(s=[],r){case"float64":f="_unpack_float64",s=new Float64Array(o);break;case"float32":f="_unpack_float32",s=new Float32Array(o);break;case"int":case"int32":f="_unpack_int32",s=new Int32Array(o);break;case"uint":case"uint32":f="_unpack_uint32",s=new Uint32Array(o);break;case"int16":f="_unpack_int32",s=new Int16Array(o);break;case"uint16":f="_unpack_uint32",s=new Uint16Array(o);break;case"int8":f="_unpack_int32",s=new Int8Array(o);break;case"uint8":f="_unpack_uint32",s=new Uint8Array(o)}for(var b=0;b<o;b++)s[b]=this[f]()}return this.dapvar.shape?this.options.reshape&&(s=this.reshape(s,this.dapvar.shape)):s=s[0],s}_unpack_byte(){var r=this._pos;return this._pos+=1,this._view.getUint8(r)}_unpack_uint32(){var r=this._pos;return this._pos+=4,this._view.getUint32(r)}_unpack_int32(){var r=this._pos;return this._pos+=4,this._view.getInt32(r)}_unpack_float32(){var r=this._pos;return this._pos+=4,this._view.getFloat32(r)}_unpack_float64(){var r=this._pos;return this._pos+=8,this._view.getFloat64(r)}_unpack_bytes(r){for(var s=(4-r%4)%4,o=[],f=0;f<r;f++)o.push(this._unpack_byte());return this._pos+=s,o}_unpack_string(r){for(var s=[],o=0;o<r;o++){for(var f=this._unpack_uint32(),b=(4-f%4)%4,u="",w=0;w<f;w++)u+=String.fromCharCode(this._unpack_byte());s.push(u),this._pos+=b}return s}reshape(r,s){if(!s.length)return r[0];if(s.length===1)return r.slice(0,s[0]);for(var o,f,b,u=[],w=0;w<s[0];w++)b=(f=w*(o=r.length/s[0]))+o,u.push(this.reshape(r.slice(f,b),s.slice(1)));return u}}ox.DefaultOptions={reshape:!1};var vx=function(z,r,s,o){return new(s||(s=Promise))(function(f,b){function u(M){try{C(o.next(M))}catch(K){b(K)}}function w(M){try{C(o.throw(M))}catch(K){b(K)}}function C(M){var K;M.done?f(M.value):(K=M.value,K instanceof s?K:new s(function(j){j(K)})).then(u,w)}C((o=o.apply(z,r||[])).next())})};class Fi extends Br.c{constructor(r,s=[],o=!1,f={lon:"lon",lat:"lat"}){super(),this.baseUrl=r,this.varList=s,this.dimName=f,this._loading=!1,o&&this.loadDataInfo()}getGridDataType(r){switch(r.toLowerCase()){case"float64":return Fi.Float64AS32?{type:Ot.U.Float32,len:4}:{type:Ot.U.Float64,len:8};case"float32":return{type:Ot.U.Float32,len:4};case"int":case"int32":return{type:Ot.U.Int32,len:4};case"uint":case"uint32":return{type:Ot.U.UInt32,len:4};case"int16":return{type:Ot.U.Int16,len:2};case"uint16":return{type:Ot.U.UInt16,len:2};case"int8":case"byte":return{type:Ot.U.Int8,len:1};case"uint8":return{type:Ot.U.UInt8,len:1}}}_parseGridOptions(r,s){var o,f,b;return vx(this,void 0,void 0,function*(){let u=r.shape||((o=r.array)===null||o===void 0?void 0:o.shape),w=3,C=2,M=1,K=0;if(u.length!==4)if(u.length===3)((b=(f=r.array)===null||f===void 0?void 0:f.dimensions)===null||b===void 0?void 0:b.indexOf("level"))===0?(w=2,C=1,M=0,K=-1):(w=2,C=1,M=-1,K=0);else{if(u.length!==2)return Bt.kg.debug("unsupported shape:"+u),void Bt.kg.debug(r);w=1,C=0,M=-1,K=-1}let j=s[w+1],$=s[C+1];if(typeof s[0]!="object"){if(!this.dimName)return void Bt.kg.warn("当前变量中没有MAP信息，无法获取格点属性！");let ct={varName:this.dimName.lat,xFilter:"[0:1:0]",yFilter:"[0:1:1]",tFilter:"[0]",zFilter:"[0]"};$=(yield this.loadDataByFullFilter(ct)).data,ct={varName:this.dimName.lon,xFilter:"[0:1:1]",yFilter:"[0:1:0]",tFilter:"[0]",zFilter:"[0]"},j=(yield this.loadDataByFullFilter(ct)).data,K=-1,M=-1}const ot={xStart:j[0],xDelta:j.length>1?j[1]-j[0]:0,xSize:u[w],yStart:$[0],yDelta:$.length>1?$[1]-$[0]:0,ySize:u[C],zValues:M<0?[0]:s[M+1],tCount:K<0?1:u[K],tValues:K<0?[0]:s[K+1]};return(0,ce.T)(ot),ot})}get dataInfo(){return this._dataInfo||Bt.kg.warn("请先调用dapService的loadDataInfo后再获取！"),this._dataInfo}loadDataInfo(r=!1,s=!0){var o;if(this._dataInfo&&!r)return Promise.resolve(this._dataInfo);if(this._loading)return s?new Promise((b,u)=>{this.once("info:loaded",w=>{b(w.msg)})}):Promise.resolve(void 0);let f=".dds";return!((o=this.varList)===null||o===void 0)&&o.length&&(f+="?",this.varList.forEach(b=>{f+=b+","}),f=f.slice(0,f.length-1)),fetch(this.baseUrl+f).then(b=>b.text().then(u=>{const w=new L0.cF(u).parse();return fetch(this.baseUrl+".das").then(C=>C.text().then(M=>{const K=new L0.Bn(M,w).parse();return this._dataInfo=K,this.fire("info:loaded",{firer:this,msg:K}),K}).catch(Bt.kg.debug)).catch(Bt.kg.debug)}).catch(Bt.kg.debug)).catch(Bt.kg.debug)}loadDataByRawFilter(r){return fetch(this.baseUrl+(".dods?"+encodeURI(r))).then(s=>s.arrayBuffer().then(o=>new ox(o).unpack()).catch(Bt.kg.debug)).catch(Bt.kg.debug)}loadDataByFullFilter(r){return vx(this,void 0,void 0,function*(){const s=()=>vx(this,void 0,void 0,function*(){var o,f,b;const u=this.dataInfo[r.varName];let w=u.shape||((o=u.array)===null||o===void 0?void 0:o.shape),C=r.zFilter,M=r.tFilter,K=r.yFilter,j=r.xFilter;if(w.length===4)M=M||"[0:1:"+(w[0]-1)+"]",C=C||"[0:1:"+(w[1]-1)+"]",K=K||"[0:1:"+(w[2]-1)+"]",j=j||"[0:1:"+(w[3]-1)+"]";else if(w.length===3)((b=(f=u.array)===null||f===void 0?void 0:f.dimensions)===null||b===void 0?void 0:b.indexOf("level"))===0?(w=[1,w[0],w[1],w[2]],M="",C=C||"[0:1:"+(w[1]-1)+"]"):(w=[w[0],1,w[1],w[2]],M=M||"[0:1:"+(w[0]-1)+"]",C=""),K=K||"[0:1:"+(w[2]-1)+"]",j=j||"[0:1:"+(w[3]-1)+"]";else if(w.length===2)M="",C="",w=[1,1,w[0],w[1]],K=K||"[0:1:"+(w[2]-1)+"]",j=j||"[0:1:"+(w[3]-1)+"]";else{if(w.length!==1)return Bt.kg.debug("unsupported shape:"+w),void Bt.kg.debug(u);if(M="",C="",u.name===this.dimName.lon)K="",w=[1,1,1,w[0]],j=j||"[0:1:"+(w[3]-1)+"]";else{if(u.name!==this.dimName.lat)return Bt.kg.debug("unsupported shape:"+w),void Bt.kg.debug(u);j="",w=[1,1,w[0],1],K=K||"[0:1:"+(w[2]-1)+"]"}}const $=""+r.varName+M+C+K+j,ot=yield this.loadDataByRawFilter($),ct=ot.dods[r.varName];return Object.assign(Object.assign({},ot),{data:typeof ct[0]=="object"?ct[0]:ct})});return this._dataInfo?s():this.loadDataInfo(!1,!0).then(o=>s()).catch(Bt.kg.debug)})}getFullGridOptions(r,s=!1){return vx(this,void 0,void 0,function*(){this.dataInfo||(yield this.loadDataInfo());const o={varName:r,xFilter:"[0:1:1]",yFilter:"[0:1:1]",tFilter:"[0]"};s&&delete o.tFilter;const f=yield this.loadDataByFullFilter(o),b=this.dataInfo[r],u=f.dods[r];return this._parseGridOptions(b,u)})}dapResultToProvider(r,s,o){var f,b,u,w,C,M;return vx(this,void 0,void 0,function*(){const K=r.dds[s],j=r.dods[s],$=o??(yield this._parseGridOptions(K,j));if(!$)return void Bt.kg.warn("获取格点属性信息失败！");const ot=(b=(f=K.array)===null||f===void 0?void 0:f.type)!==null&&b!==void 0?b:K.type,ct=(C=this.getGridDataType((w=(u=K.array)===null||u===void 0?void 0:u.type)!==null&&w!==void 0?w:K.type))!==null&&C!==void 0?C:{type:Ot.U.Float32,len:4};let wt=(M=K.attributes)===null||M===void 0?void 0:M.missing_value;(!(0,jt.ri)(wt)||wt>999999)&&(wt=999999);const Ct=[],qt=typeof j[0]=="object"?j[0]:j;let kt=qt.buffer;if(!kt&&qt instanceof Array){let ae;switch(Bt.kg.debug("dap获取的数据不是TypedArray！"),ct.type){case Ot.U.UInt8:ae=new Uint8Array(qt);break;case Ot.U.Int8:ae=new Int8Array(qt);break;case Ot.U.UInt16:ae=new Uint16Array(qt);break;case Ot.U.Int16:ae=new Int16Array(qt);break;case Ot.U.UInt32:ae=new Uint32Array(qt);break;case Ot.U.Int32:ae=new Int32Array(qt);break;case Ot.U.Float32:ae=new Float32Array(qt);break;case Ot.U.Float64:ae=new Float64Array(qt);break;default:throw new Error("not supported grid data type "+ct)}kt=ae.buffer}Fi.Float64AS32&&ct.type===Ot.U.Float32&&ot.toLowerCase()==="float64"&&qt instanceof Float64Array&&(Bt.kg.warn("FLOAT64 AS FLOAT32"),kt=new Float32Array(qt).buffer);let $t=0,ie=$.ySize*$.xSize*ct.len;for(let ae=0;ae<$.tCount;ae++){const fe=[];for(let le=0;le<$.zValues.length;le++){const ge=$t+ie,_e=new it.P(ct.type,$.xSize,$.ySize,kt.slice($t,ge),wt);fe.push(_e),$t=ge}Ct.push(fe)}const oe=new zr.o(Ct,{gridOptions:$});return{dds:r.dds,dods:r.dods,gridOptions:$,provider:oe}})}loadData(r){const s=(f,b)=>{if((0,jt.ri)(f))return(0,jt.ri)(b)?"["+f+":"+b+"]":"["+f+"]"},o=()=>{var f,b,u,w,C,M,K;const j=this.dataInfo[r.varName];let $=j.shape||((f=j.array)===null||f===void 0?void 0:f.shape),ot="",ct="";if($.length===4)ot="["+((b=r.zIdx)!==null&&b!==void 0?b:0)+"]",ct="["+((u=r.tIdx)!==null&&u!==void 0?u:0)+"]";else if($.length===3)((C=(w=j.array)===null||w===void 0?void 0:w.dimensions)===null||C===void 0?void 0:C.indexOf("level"))===0?($=[1,$[0],$[1],$[2]],ot="["+((M=r.zIdx)!==null&&M!==void 0?M:0)+"]"):($=[$[0],1,$[1],$[2]],ct="["+((K=r.tIdx)!==null&&K!==void 0?K:0)+"]");else{if($.length!==2)return Bt.kg.debug("unsupported shape:"+$),void Bt.kg.debug(j);$=[1,1,$[0],$[1]]}const wt=$[2],Ct=s(r.yStartIdx,r.yEndIdx)||"[0:"+(wt-1)+"]",qt=$[3],kt=s(r.xStartIdx,r.xEndIdx)||"[0:"+(qt-1)+"]",$t=""+r.varName+ct+ot+Ct+kt;return this.loadDataByRawFilter($t).then(ie=>this.dapResultToProvider(ie,r.varName)).catch(Bt.kg.debug)};return this._dataInfo?o():this.loadDataInfo(!1,!0).then(f=>o()).catch(Bt.kg.debug)}}Fi.Float64AS32=!0;var Vx=t(811);const Vr=function(z,r,s){s===void 0&&(s={});var o=(0,Vx.c9)(z),f=(0,Vx.c9)(r),b=(0,Lx.Ht)(f[1]-o[1]),u=(0,Lx.Ht)(f[0]-o[0]),w=(0,Lx.Ht)(o[1]),C=(0,Lx.Ht)(f[1]),M=Math.pow(Math.sin(b/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(w)*Math.cos(C);return(0,Lx.DL)(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)),s.units)};function pn(z,r,s){if(s===void 0&&(s={}),s.final===!0)return function(j,$){var ot=pn($,j);return(ot+180)%360}(z,r);var o=(0,Vx.c9)(z),f=(0,Vx.c9)(r),b=(0,Lx.Ht)(o[0]),u=(0,Lx.Ht)(f[0]),w=(0,Lx.Ht)(o[1]),C=(0,Lx.Ht)(f[1]),M=Math.sin(u-b)*Math.cos(C),K=Math.cos(w)*Math.sin(C)-Math.sin(w)*Math.cos(C)*Math.cos(u-b);return(0,Lx.vi)(Math.atan2(M,K))}var mn=t(204);function Jn(z,r,s){s===void 0&&(s={});for(var o=(0,Vx.wA)(z).coordinates,f=0,b=0;b<o.length&&!(r>=f&&b===o.length-1);b++){if(f>=r){var u=r-f;if(u){var w=pn(o[b],o[b-1])-180;return(0,mn.Z)(o[b],u,w,s)}return(0,Lx.xm)(o[b])}f+=Vr(o[b],o[b+1],s)}return(0,Lx.xm)(o[o.length-1])}class ii{constructor(r){(r==null?void 0:r.defaultMode)==="h"?this._defaultDrawOptions=ii.HDefaultOptions:this._defaultDrawOptions=ii.VDefaultOptions}setDrawOptions(r,s=!0){if(r)return this._drawOptions&&s?this._drawOptions=(0,jt.uw)({},r,this._drawOptions):this._drawOptions=(0,jt.uw)({},r,this._defaultDrawOptions),this;this._drawOptions=(0,jt.f8)(this._defaultDrawOptions)}update(r){var s;const{content:o,x:f,y:b,mainTitle:u,subTitle:w,vTitle:C,hTitle:M,vSubTitle:K,hSubTitle:j}=r,$=(s=this._drawOptions)!==null&&s!==void 0?s:this._defaultDrawOptions,ot=$.content.ltOffset,ct=$.content.rbOffset,wt=[o.width,o.height],Ct=[wt[0]+ot[0]+ct[0],wt[1]+ot[1]+ct[1]],qt=document.createElement("canvas");qt.width=Ct[0],qt.height=Ct[1];const kt=qt.getContext("2d");kt.save(),kt.fillStyle=$.background,kt.fillRect(0,0,Ct[0],Ct[1]),kt.restore(),kt.drawImage(o,0,0,wt[0],wt[1],ot[0],ot[1],wt[0],wt[1]),this._drawBorder(kt,$.border,ot,wt);let $t=[ot[0]+wt[0]/2,Math.floor(ot[1]/2.5)];const ie=$.title;ie.position==="start"?$t=[...ot]:ie.position==="end"&&($t=[ot[0]+wt[0],ot[1]+wt[1]]),this._drawText(kt,ie.main,$t,u,0),this._drawText(kt,ie.sub,$t,w,1);const oe=[];f.forEach(Ze=>{oe.push(ot[0]+Ze.percent*wt[0])});const ae=[];b.forEach(Ze=>{ae.push(ot[1]+wt[1]*(1-Ze.percent))});const fe=$.gridLines,le=$.axis.tick;let ge=ot[1]+wt[1];oe.forEach((Ze,Qe)=>{let v0;Math.abs(Ze-ot[0])>2&&Math.abs(Ze-(ot[0]+wt[0]))>2&&this._drawLine(kt,fe.major,[Ze,ge],[Ze,ot[1]]),v0=le.position==="out"?[Ze,ge+le.length]:le.position==="cross"?[Ze,ge+le.length/2]:[Ze,ge];const o0=[Ze,v0[1]-le.length];this._drawLine(kt,le.line,v0,o0);const A0=[Ze,v0[1]+3];this._drawText(kt,$.axis.label.bottom.text,A0,f[Qe].label,Qe),this._drawText(kt,$.axis.label.bottom.text2,A0,f[Qe].label2,Qe)}),ae.forEach((Ze,Qe)=>{Math.abs(Ze-ot[1])>2&&Math.abs(Ze-(ot[1]+wt[1]))>2&&this._drawLine(kt,fe.major,[ot[0],Ze],[ot[0]+wt[0],Ze]);let v0=[];v0=le.position==="out"?[ot[0]-le.length,Ze]:le.position==="cross"?[ot[0]-le.length/2,Ze]:[ot[0],Ze];const o0=[v0[0]+le.length,Ze];this._drawLine(kt,le.line,v0,o0);const A0=[v0[0]-3,Ze];this._drawText(kt,$.axis.label.left.text,A0,b[Qe].label,Qe),this._drawText(kt,$.axis.label.left.text2,A0,b[Qe].label2,Qe)});const _e=[ot[0]+wt[0]/2,ge],Le=$.axis.label.bottom.title;Le.position==="start"?_e[0]=ot[0]:Le.position==="end"&&(_e[0]=ot[0]+wt[0]),this._drawText(kt,Le.main,_e,M,0),this._drawText(kt,Le.sub,_e,j,1);const Re=[ot[0],ot[1]+wt[1]/2],Ke=$.axis.label.left.title;Ke.position==="start"?Re[1]=ot[1]:Ke.position==="end"&&(Re[1]=ge),this._drawText(kt,Ke.main,Re,C,0),this._drawText(kt,Ke.sub,Re,K,1);const i0=[],We=[];if($.axis.tick.minorCount>0){const Ze=(Qe,v0)=>{for(let o0=0;o0<Qe.length-1;o0++){const A0=Qe[o0],sx=(Qe[o0+1]-A0)/($.axis.tick.minorCount+1);for(let Y0=1;Y0<=$.axis.tick.minorCount;Y0++)v0.push(A0+sx*Y0)}};Ze(oe,i0),Ze(ae,We),i0.forEach(Qe=>{let v0;this._drawLine(kt,fe.minor,[Qe,ot[1]+wt[1]],[Qe,ot[1]]),v0=le.position==="out"?[Qe,ot[1]+wt[1]+le.length/2]:le.position==="cross"?[Qe,ot[1]+wt[1]+le.length/2/2]:[Qe,ot[1]+wt[1]];const o0=[Qe,v0[1]-le.length/2];this._drawLine(kt,le.line,v0,o0)}),We.forEach(Qe=>{this._drawLine(kt,fe.minor,[ot[0],Qe],[ot[0]+wt[0],Qe]);let v0=[];v0=le.position==="out"?[ot[0]-le.length/2,Qe]:le.position==="cross"?[ot[0]-le.length/2/2,Qe]:[ot[0],Qe];const o0=[v0[0]+le.length/2,Qe];this._drawLine(kt,le.line,v0,o0)})}let Xe=[];return Xe=$.legend.mode==="h"?[ot[0]+(wt[0]-$.legend.width)/2+$.legend.offset[0],ot[1]+wt[1]+$.legend.offset[1]]:[ot[0]+wt[0]+$.legend.offset[0],ot[1]+(wt[1]-$.legend.height)/2+$.legend.offset[1]],this._drawLegend(kt,$.legend,Xe),qt}_drawLegend(r,s,o){var f;if(!s.visible)return;let b=s.color;if(typeof b=="string"&&(b=(0,fx.it)(s.color)),b.width){const C=s.color;return void r.drawImage(C,0,0,C.width,C.height,o[0],o[1],s.width,s.height)}if(!b.stops)return void Bt.kg.error("色标配置不正确，无法绘制色标！",!1);b instanceof Nr.NB||(b=new Nr.NB(b));let u=[...b.stops];((f=u[u.length-1].stop)===null||f===void 0?void 0:f.alpha())<.01&&u.pop();const w=Math.max(0,s.skip)+1;u.length>s.height?Bt.kg.warn("颜色数量大于图例高度，无法绘制图例！"):s.mode==="h"?this._drawHLegend(r,s,o,u,w):this._drawVLegend(r,s,o,u,w)}_drawVLegend(r,s,o,f,b){const u=1*s.height/f.length;r.save();let w=s.reverse?o[1]+s.height-u:o[1];for(let M=0;M<f.length;M++){const K=f[M].stop;if(!(K instanceof Cx.t))return Bt.kg.error("颜色实例不正确，无法绘制色标！",!1),void r.restore();r.fillStyle=K.rgbaString(),r.fillRect(o[0],w,s.width,u),s.reverse?w-=u:w+=u}r.restore(),this._drawBorder(r,s.border,o,[s.width,s.height]);const C=[o[0]+s.width,o[1]+s.height];for(let M=0;M<f.length-1;M+=b){w=s.reverse?o[1]+s.height-(M+1)*u:o[1]+(M+1)*u;const K=[C[0],w],j=[C[0]+s.tick.length,w];this._drawLine(r,s.tick.style,K,j),this._drawText(r,s.label,j,f[M].value.toString(),M)}}_drawHLegend(r,s,o,f,b){const u=1*s.width/f.length;r.save();let w=s.reverse?o[0]+s.width-u:o[0];for(let M=0;M<f.length;M++){const K=f[M].stop;if(!(K instanceof Cx.t))return Bt.kg.error("颜色实例不正确，无法绘制色标！",!1),void r.restore();r.fillStyle=K.rgbaString(),r.fillRect(w,o[1],u,s.height),s.reverse?w-=u:w+=u}r.restore(),this._drawBorder(r,s.border,o,[s.width,s.height]);const C=[o[0]+s.width,o[1]+s.height];for(let M=0;M<f.length-1;M+=b){w=s.reverse?o[0]+s.width-(M+1)*u:o[0]+(M+1)*u;const K=[w,C[1]],j=[w,C[1]+s.tick.length];this._drawLine(r,s.tick.style,K,j),this._drawText(r,s.label,j,f[M].value.toString(),M)}}_drawText(r,s,o,f,b){if(!(0,jt.ri)(s)||!(f!=null&&f.length)||!s.visible)return!1;if(r.save(),r.font=s.font,r.fillStyle=s.color,r.textAlign=s.textAlign,r.textBaseline=s.textBase,s.formater&&(f=s.formater(b,f)),s.offset&&(o=[o[0]+s.offset[0],o[1]+s.offset[1]]),typeof s.angle=="number"){const u=s.angle*Math.PI/180;r.translate(o[0],o[1]),r.rotate(u),r.translate(-o[0],-o[1])}return r.fillText(f,o[0],o[1]),r.restore(),!0}_drawBorder(r,s,o,f){s.visible&&(r.save(),r.strokeStyle=s.color,r.lineWidth=s.width,s.dashArray&&r.setLineDash(s.dashArray),s.width>1?r.strokeRect(Math.floor(o[0]),Math.floor(o[1]),f[0],f[1]):r.strokeRect(Math.floor(o[0])+.5,Math.floor(o[1])+.5,f[0],f[1]),r.restore())}_drawLine(r,s,o,f){s.visible&&(r.save(),r.strokeStyle=s.color,r.lineWidth=s.width,s.dashArray&&r.setLineDash(s.dashArray),r.beginPath(),s.width>1?(r.moveTo(Math.floor(o[0]),Math.floor(o[1])),r.lineTo(Math.floor(f[0]),Math.floor(f[1]))):(r.moveTo(Math.floor(o[0])+.5,Math.floor(o[1])+.5),r.lineTo(Math.floor(f[0])+.5,Math.floor(f[1])+.5)),r.stroke(),r.restore())}static getAxisArrayFromZProviderAndPath(r,s,o,f=6,b=2){r.length;const u=f;let w=[];if(r.length<=u)for(let $=0;$<r.length;$++)w.push({label:r[$].y.toFixed(b),label2:r[$].x.toFixed(b),percent:1*$/(r.length-1)});else{const $={type:"Feature",geometry:{type:"LineString",coordinates:r.map(ct=>[ct.x,ct.y])},properties:{}},ot=((C={units:"kilometers"})===void 0&&(C={}),N($,function(ct,wt){var Ct=wt.geometry.coordinates;return ct+Vr(Ct[0],Ct[1],C)},0)/(f-1));w.push({label:r[0].y.toFixed(b),label2:r[0].x.toFixed(b),percent:0});for(let ct=1;ct<f-1;ct++){const wt=Jn($,ct*ot,{units:"kilometers"});w.push({label:wt.geometry.coordinates[1].toFixed(b),label2:wt.geometry.coordinates[0].toFixed(b),percent:1*ct/(f-1)})}w.push({label:r[r.length-1].y.toFixed(b),label2:r[r.length-1].x.toFixed(b),percent:1})}var C;const M=o,K=[],j=s[s.length-1]-s[0];return M.forEach($=>{$<s[0]||$>s[s.length-1]?Bt.kg.warn("给定的Z坐标超过了zValues的范围！"):K.push({label:$.toString(),percent:($-s[0])/j})}),{xArr:w,yArr:K}}}ii.VDefaultOptions={background:"black",content:{ltOffset:[70,75],rbOffset:[80,50]},border:{visible:!0,width:2,color:"white"},gridLines:{major:{visible:!0,width:1,color:"gray",dashArray:[5,2,5,2]},minor:{visible:!1,width:1,color:"gray",dashArray:[3,3,3,3]}},title:{position:"center",main:{visible:!0,font:"22px Arial",color:"white",textAlign:"center",textBase:"middle"},sub:{visible:!0,font:"16px Arial",color:"white",textAlign:"center",textBase:"middle",offset:[0,25]}},axis:{tick:{position:"out",length:6,line:{color:"white",visible:!0,width:1}},label:{bottom:{text:{visible:!0,font:"14px Arial",color:"white",offset:[0,5],textAlign:"center",textBase:"top"},text2:{visible:!0,font:"14px Arial",color:"white",offset:[0,20],textAlign:"center",textBase:"top"},title:{position:"center",main:{visible:!1,font:"14px Arial",color:"white",textAlign:"center",textBase:"middle",offset:[0,55]},sub:{visible:!1,font:"12px Arial",color:"white",textAlign:"center",textBase:"middle",offset:[0,75]}}},left:{text:{visible:!0,font:"14px Arial",color:"white",offset:[-5,0],textAlign:"end",textBase:"middle"},text2:{visible:!0,font:"14px Arial",color:"white",offset:[-5,20],textAlign:"center",textBase:"middle"},title:{position:"center",main:{visible:!0,font:"14px Arial",color:"white",textAlign:"center",textBase:"middle",offset:[-50,0],angle:-90},sub:{visible:!1,font:"12px Arial",color:"white",textAlign:"center",textBase:"middle",offset:[-70,0],angle:-90}}}}},legend:{mode:"v",width:20,height:300,skip:0,offset:[20,0],visible:!0,reverse:!1,border:{visible:!0,width:1,color:"white"},label:{visible:!0,font:"16px Arial",color:"white",offset:[5,0],textAlign:"start",textBase:"middle"},tick:{style:{visible:!0,width:1,color:"white"},length:3},color:void 0}},ii.HDefaultOptions=(0,jt.uw)({},{content:{rbOffset:[50,115]},legend:{mode:"h",width:450,height:20,offset:[0,60],label:{textAlign:"center",textBase:"top",offset:[0,5]}}},ii.VDefaultOptions);class Wr{constructor(r){this.finishPointCount=-1,this.freehand=!1,this.setPoints(r)}setCoordinates(r){this.coordinates=r}isPlot(){return!0}get generated(){return this.coordinates!==void 0}setPoints(r){this.points=r||[],this.points.length>=1?this.generate():this.coordinates=void 0}addPoint(r){if(this.points.length>0){const s=this.points[this.points.length-1];if(Math.abs(s[0]-r[0])===0&&Math.abs(s[1]-r[1])===0)return!1}return this.points.push(r),this.generate(),!0}getPoints(r=!0){return r?this.points.slice(0):this.points}getPointCount(){return this.points.length}updatePoint(r,s){s>=0&&s<this.points.length&&(this.points[s]=r,this.generate())}updateLastPoint(r){this.updatePoint(r,this.points.length-1)}finishDrawing(){}}class Wx extends Wr{getGeoJSON(){if(this.coordinates)return{type:"Polygon",coordinates:this.coordinates}}}class pr extends Wr{getGeoJSON(){if(this.coordinates)return{type:"LineString",coordinates:this.coordinates}}}class Hn extends Wr{getGeoJSON(){if(this.coordinates)return{type:"Point",coordinates:this.coordinates}}}const u0={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},E0={MARKER:"点",POLYLINE:"线",CURVE:"曲线",POLYGON:"多边形",CLOSED_CURVE:"曲面",RECTANGLE:"矩形",CIRCLE:"圆",ELLIPSE:"椭圆",ARC:"弧线",SECTOR:"扇形",FREEHAND_LINE:"手绘线",FREEHAND_POLYGON:"手绘多边形",LUNE:"弓形",DOUBLE_ARROW:"钳击",GATHERING_PLACE:"聚集地",STRAIGHT_ARROW:"直线箭头",ASSAULT_DIRECTION:"突击方向",ATTACK_ARROW:"进攻方向",TAILED_ATTACK_ARROW:"进攻方向（燕尾）",SQUAD_COMBAT:"分队战斗行动",TAILED_SQUAD_COMBAT:"分队战斗行动（燕尾）",FINE_ARROW:"细箭头"},ux=function(z,r){return Math.sqrt(Math.pow(z[0]-r[0],2)+Math.pow(z[1]-r[1],2))},Ta=function(z){for(var r=0,s=0;s<z.length-1;s++)r+=ux(z[s],z[s+1]);return r},qr=function(z){return Math.pow(Ta(z),.99)},mr=function(z,r){return[(z[0]+r[0])/2,(z[1]+r[1])/2]},Ga=function(z,r,s){var o=[(z[0]+r[0])/2,(z[1]+r[1])/2],f=[o[0]-z[1]+r[1],o[1]+z[0]-r[0]],b=[(z[0]+s[0])/2,(z[1]+s[1])/2],u=[b[0]-z[1]+s[1],b[1]+z[0]-s[0]];return $a(o,f,b,u)},$a=function(z,r,s,o){if(z[1]==r[1]){var f=(o[0]-s[0])/(o[1]-s[1]),b=f*(z[1]-s[1])+s[0],u=z[1];return[b,u]}if(s[1]==o[1]){var w=(r[0]-z[0])/(r[1]-z[1]);return[b=w*(s[1]-z[1])+z[0],u=s[1]]}return w=(r[0]-z[0])/(r[1]-z[1]),f=(o[0]-s[0])/(o[1]-s[1]),[b=w*(u=(w*z[1]-z[0]-f*s[1]+s[0])/(w-f))-w*z[1]+z[0],u]},gn=function(z,r){var s,o=Math.asin(Math.abs(r[1]-z[1])/ux(z,r));return r[1]>=z[1]&&r[0]>=z[0]?s=o+Math.PI:r[1]>=z[1]&&r[0]<z[0]?s=u0.TWO_PI-o:r[1]<z[1]&&r[0]<z[0]?s=o:r[1]<z[1]&&r[0]>=z[0]&&(s=Math.PI-o),s},Aa=function(z,r,s){var o=gn(r,z)-gn(r,s);return o<0?o+u0.TWO_PI:o},ea=function(z,r,s){return(s[1]-z[1])*(r[0]-z[0])>(r[1]-z[1])*(s[0]-z[0])},Ia=function(z,r,s,o,f){var b=1-(z=Math.max(Math.min(z,1),0)),u=z*z,w=u*z,C=b*b,M=C*b;return[M*r[0]+3*C*z*s[0]+3*b*u*o[0]+w*f[0],M*r[1]+3*C*z*s[1]+3*b*u*o[1]+w*f[1]]},M0=function(z,r,s,o,f){var b=gn(z,r),u=f?b+s:b-s,w=o*Math.cos(u),C=o*Math.sin(u);return[r[0]+w,r[1]+C]},Ea=function(z,r,s,o){var f,b,u=[],w=o-s;w=w<0?w+u0.TWO_PI:w;for(var C=0;C<=u0.FITTING_COUNT;C++){var M=s+w*C/u0.FITTING_COUNT;f=z[0]+r*Math.cos(M),b=z[1]+r*Math.sin(M),u.push([f,b])}return u},da=function(z,r,s,o){var f=Ra(r,s,o),b=Math.sqrt(f[0]*f[0]+f[1]*f[1]),u=f[0]/b,w=f[1]/b,C=ux(r,s),M=ux(s,o);if(b>u0.ZERO_TOLERANCE)if(ea(r,s,o)){var K=z*C,j=s[0]-K*w,$=s[1]+K*u,ot=[j,$];K=z*M;var ct=[j=s[0]+K*w,$=s[1]-K*u]}else K=z*C,ot=[j=s[0]+K*w,$=s[1]-K*u],K=z*M,ct=[j=s[0]-K*w,$=s[1]+K*u];else ot=[j=s[0]+z*(r[0]-s[0]),$=s[1]+z*(r[1]-s[1])],ct=[j=s[0]+z*(o[0]-s[0]),$=s[1]+z*(o[1]-s[1])];return[ot,ct]},Ra=function(z,r,s){var o=z[0]-r[0],f=z[1]-r[1],b=Math.sqrt(o*o+f*f);o/=b,f/=b;var u=s[0]-r[0],w=s[1]-r[1],C=Math.sqrt(u*u+w*w);return[o+(u/=C),f+(w/=C)]},Xa=function(z,r){var s=z[0],o=z[1],f=z[2],b=da(0,s,o,f)[0],u=Ra(s,o,f);if(Math.sqrt(u[0]*u[0]+u[1]*u[1])>u0.ZERO_TOLERANCE)var w=mr(s,o),C=s[0]-w[0],M=s[1]-w[1],K=2/ux(s,o),j=-K*M,$=K*C,ot=j*j-$*$,ct=2*j*$,wt=$*$-j*j,Ct=b[0]-w[0],qt=b[1]-w[1],kt=w[0]+ot*Ct+ct*qt,$t=w[1]+ct*Ct+wt*qt;else kt=s[0]+r*(o[0]-s[0]),$t=s[1]+r*(o[1]-s[1]);return[kt,$t]},Da=function(z){if(z.length<=2)return z;for(var r=[],s=z.length-1,o=0;o<=1;o+=.01){for(var f=0,b=0,u=0;u<=s;u++){var w=Qa(s,u),C=Math.pow(o,u),M=Math.pow(1-o,s-u);f+=w*C*M*z[u][0],b+=w*C*M*z[u][1]}r.push([f,b])}return r.push(z[s]),r},Qa=function(z,r){return Ca(z)/(Ca(r)*Ca(z-r))},Ca=function(z){if(z<=1)return 1;if(z==2)return 2;if(z==3)return 6;if(z==4)return 24;if(z==5)return 120;for(var r=1,s=1;s<=z;s++)r*=s;return r},Kn=function(z){if(z.length<=2)return z;var r=[],s=z.length-2-1;r.push(z[0]);for(var o=0;o<=s;o++)for(var f=0;f<=1;f+=.05){for(var b=0,u=0,w=0;w<=2;w++){var C=ja(w,f);b+=C*z[o+w][0],u+=C*z[o+w][1]}r.push([b,u])}return r.push(z[z.length-1]),r},ja=function(z,r){return z==0?Math.pow(r-1,2)/2:z==1?(-2*Math.pow(r,2)+2*r+1)/2:z==2?Math.pow(r,2)/2:0};class to extends pr{constructor(){super(...arguments),this.type=E0.ARC,this.finishPointCount=3}generate(){if(!(this.getPointCount()<=2)){var r=this.points[0],s=this.points[1],o=this.points[2],f=Ga(r,s,o),b=ux(r,f),u=gn(r,f),w=gn(s,f);if(ea(r,s,o))var C=w,M=u;else C=u,M=w;this.setCoordinates(Ea(f,b,C,M))}}}class eo extends Wx{constructor(){super(...arguments),this.type=E0.ELLIPSE,this.finishPointCount=2}generate(){if(!(this.getPointCount()<2)){var r=this.points[0],s=this.points[1],o=mr(r,s),f=Math.abs((r[0]-s[0])/2),b=Math.abs((r[1]-s[1])/2);this.setCoordinates([this.generatePoints(o,f,b)])}}generatePoints(r,s,o){for(var f,b,u,w=[],C=0;C<=u0.FITTING_COUNT;C++)u=2*Math.PI*C/u0.FITTING_COUNT,f=r[0]+s*Math.cos(u),b=r[1]+o*Math.sin(u),w.push([f,b]);return w}}class xo extends pr{constructor(){super(...arguments),this.type=E0.CURVE,this.t=.3}generate(){this.getPointCount()<=2||this.setCoordinates(function(r,s){for(var o=[Xa(s,r)],f=0;f<s.length-2;f++){var b=s[f],u=s[f+1],w=s[f+2],C=da(r,b,u,w);o=o.concat(C)}var M=function($,ot){var ct=$.length,wt=$[ct-3],Ct=$[ct-2],qt=$[ct-1],kt=da(0,wt,Ct,qt)[1],$t=Ra(wt,Ct,qt);if(Math.sqrt($t[0]*$t[0]+$t[1]*$t[1])>u0.ZERO_TOLERANCE)var ie=mr(Ct,qt),oe=qt[0]-ie[0],ae=qt[1]-ie[1],fe=2/ux(Ct,qt),le=-fe*ae,ge=fe*oe,_e=le*le-ge*ge,Le=2*le*ge,Re=ge*ge-le*le,Ke=kt[0]-ie[0],i0=kt[1]-ie[1],We=ie[0]+_e*Ke+Le*i0,Xe=ie[1]+Le*Ke+Re*i0;else We=qt[0]+ot*(Ct[0]-qt[0]),Xe=qt[1]+ot*(Ct[1]-qt[1]);return[We,Xe]}(s,r);o.push(M);var K=[];for(f=0;f<s.length-1;f++){b=s[f],u=s[f+1],K.push(b);for(let $=0;$<u0.FITTING_COUNT;$++){var j=Ia($/u0.FITTING_COUNT,b,o[2*f],o[2*f+1],u);K.push(j)}K.push(u)}return K}(this.t,this.points))}}class io extends Wx{constructor(){super(...arguments),this.type=E0.CLOSED_CURVE,this.t=.3}generate(){if(!((r=this.getPointCount())<=2)){var r,s=this.getPoints();s.push(s[0],s[1]);for(var o=[],f=0;f<s.length-2;f++){var b=da(this.t,s[f],s[f+1],s[f+2]);o=o.concat(b)}o=[o[(r=o.length)-1]].concat(o.slice(0,r-1));var u=[];for(f=0;f<s.length-2;f++){var w=s[f],C=s[f+1];u.push(w);for(var M=0;M<=u0.FITTING_COUNT;M++){var K=Ia(M/u0.FITTING_COUNT,w,o[2*f],o[2*f+1],C);u.push(K)}u.push(C)}this.setCoordinates([u])}}}class ro extends Wx{constructor(){super(...arguments),this.type=E0.LUNE,this.finishPointCount=3}generate(){if(!(this.getPointCount()<2)){var r=this.getPoints();if(this.getPointCount()==2){var s=mr(r[0],r[1]),o=ux(r[0],s),f=M0(r[0],s,u0.HALF_PI,o,void 0);r.push(f)}var b=r[0],u=r[1],w=r[2],C=Ga(b,u,w),M=ux(b,C),K=gn(b,C),j=gn(u,C);if(ea(b,u,w))var $=j,ot=K;else $=K,ot=j;(r=Ea(C,M,$,ot)).push(r[0]),this.setCoordinates([r])}}}class no extends Wx{constructor(){super(...arguments),this.type=E0.SECTOR,this.finishPointCount=3}generate(){if(!(this.getPointCount()<=2)){var r=this.getPoints(),s=r[0],o=r[1],f=r[2],b=ux(o,s),u=gn(o,s),w=gn(f,s),C=Ea(s,b,u,w);C.push(s,C[0]),this.setCoordinates([C])}}}class so extends Wx{constructor(){super(...arguments),this.type=E0.GATHERING_PLACE,this.t=.4,this.finishPointCount=3}generate(){var r=this.getPoints();if(!(r.length<2)){if(this.getPointCount()==2){var s=mr(r[0],r[1]),o=ux(r[0],s)/.9,f=M0(r[0],s,u0.HALF_PI,o,!0);r=[r[0],f,r[1]]}s=mr(r[0],r[2]),r.push(s,r[0],r[1]);for(var b=[],u=0;u<r.length-2;u++){var w=r[u],C=r[u+1],M=r[u+2],K=da(this.t,w,C,M);b=b.concat(K)}var j=b.length;b=[b[j-1]].concat(b.slice(0,j-1));var $=[];for(u=0;u<r.length-2;u++){w=r[u],C=r[u+1],$.push(w);for(var ot=0;ot<=u0.FITTING_COUNT;ot++)f=Ia(ot/u0.FITTING_COUNT,w,b[2*u],b[2*u+1],C),$.push(f);$.push(C)}this.setCoordinates([$])}}}class Va extends Wx{constructor(){super(...arguments),this.type=E0.FINE_ARROW,this.tailWidthFactor=.15,this.neckWidthFactor=.2,this.headWidthFactor=.25,this.headAngle=Math.PI/8.5,this.neckAngle=Math.PI/13,this.finishPointCount=2}generate(){if(!(this.getPointCount()<2)){var r=this.getPoints(),s=r[0],o=r[1],f=qr(r),b=f*this.tailWidthFactor,u=f*this.neckWidthFactor,w=f*this.headWidthFactor,C=M0(o,s,u0.HALF_PI,b,!0),M=M0(o,s,u0.HALF_PI,b,!1),K=M0(s,o,this.headAngle,w,!1),j=M0(s,o,this.headAngle,w,!0),$=[C,M0(s,o,this.neckAngle,u,!1),K,o,j,M0(s,o,this.neckAngle,u,!0),M];this.setCoordinates([$])}}}class ao extends Va{constructor(){super(...arguments),this.type=E0.ASSAULT_DIRECTION,this.tailWidthFactor=.2,this.neckWidthFactor=.25,this.headWidthFactor=.3,this.headAngle=Math.PI/4,this.neckAngle=.17741*Math.PI}}class _a extends Wx{constructor(){super(...arguments),this.type=E0.ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.headTailFactor=.8}generate(){if(!(this.getPointCount()<=2)){var r=this.getPoints(),s=r[0],o=r[1];ea(r[0],r[1],r[2])&&(s=r[1],o=r[0]);var f=[mr(s,o)].concat(r.slice(2)),b=this.getArrowHeadPoints(f,s,o),u=b[0],w=b[4],C=ux(s,o)/qr(f),M=this.getArrowBodyPoints(f,u,w,C),K=M.length,j=[s].concat(M.slice(0,K/2));j.push(u);var $=[o].concat(M.slice(K/2,K));$.push(w),j=Kn(j),$=Kn($),this.setCoordinates([j.concat(b,$.reverse())])}}getArrowHeadPoints(r,s,o){var f=qr(r),b=f*this.headHeightFactor,u=r[r.length-1];f=ux(u,r[r.length-2]);var w=ux(s,o);b>w*this.headTailFactor&&(b=w*this.headTailFactor);var C=b*this.headWidthFactor,M=b*this.neckWidthFactor,K=(b=b>f?f:b)*this.neckHeightFactor,j=M0(r[r.length-2],u,0,b,!0),$=M0(r[r.length-2],u,0,K,!0),ot=M0(u,j,u0.HALF_PI,C,!1),ct=M0(u,j,u0.HALF_PI,C,!0);return[M0(u,$,u0.HALF_PI,M,!1),ot,u,ct,M0(u,$,u0.HALF_PI,M,!0)]}getArrowBodyPoints(r,s,o,f){for(var b=Ta(r),u=qr(r)*f,w=(u-ux(s,o))/2,C=0,M=[],K=[],j=1;j<r.length-1;j++){var $=Aa(r[j-1],r[j],r[j+1])/2,ot=(u/2-(C+=ux(r[j-1],r[j]))/b*w)/Math.sin($),ct=M0(r[j-1],r[j],Math.PI-$,ot,!0),wt=M0(r[j-1],r[j],$,ot,!1);M.push(ct),K.push(wt)}return M.concat(K)}}class oo extends Wx{constructor(){super(...arguments),this.type=E0.CIRCLE,this.finishPointCount=2}generate(){if(!(this.getPointCount()<2)){var r=this.points[0],s=ux(r,this.points[1]);this.setCoordinates([this.generatePoints(r,s)])}}generatePoints(r,s){for(var o,f,b,u=[],w=0;w<=u0.FITTING_COUNT;w++)b=2*Math.PI*w/u0.FITTING_COUNT,o=r[0]+s*Math.cos(b),f=r[1]+s*Math.sin(b),u.push([o,f]);return u}}class lo extends Wx{constructor(){super(...arguments),this.type=E0.DOUBLE_ARROW,this.headHeightFactor=.25,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.connPoint=null,this.tempPoint4=null,this.finishPointCount=4}finishDrawing(){this.getPointCount()==3&&this.tempPoint4!=null&&this.points.push(this.tempPoint4),this.connPoint!=null&&this.points.push(this.connPoint)}generate(){if(!((u=this.getPointCount())<=2)){var r,s,o=this.points[0],f=this.points[1],b=this.points[2],u=this.getPointCount();this.tempPoint4=u==3?this.getTempPoint4(o,f,b):this.points[3],this.connPoint=u==3||u==4?mr(o,f):this.points[4],ea(o,f,b)?(r=this.getArrowPoints(o,this.connPoint,this.tempPoint4,!1),s=this.getArrowPoints(this.connPoint,f,b,!0)):(r=this.getArrowPoints(f,this.connPoint,b,!1),s=this.getArrowPoints(this.connPoint,o,this.tempPoint4,!0));var w=r.length,C=(w-5)/2,M=r.slice(0,C),K=r.slice(C,C+5),j=r.slice(C+5,w),$=s.slice(0,C),ot=s.slice(C,C+5),ct=s.slice(C+5,w);$=Da($);var wt=Da(ct.concat(M.slice(1)));j=Da(j);var Ct=$.concat(ot,wt,K,j);this.setCoordinates([Ct])}}getArrowPoints(r,s,o,f){var b=mr(r,s),u=ux(b,o),w=M0(o,b,0,.3*u,!0),C=M0(o,b,0,.5*u,!0),M=[b,w=M0(b,w,u0.HALF_PI,u/5,f),C=M0(b,C,u0.HALF_PI,u/4,f),o],K=this.getArrowHeadPoints(M,this.headHeightFactor,this.headWidthFactor),j=K[0],$=K[4],ot=ux(r,s)/qr(M)/2,ct=this.getArrowBodyPoints(M,j,$,ot),wt=ct.length,Ct=ct.slice(0,wt/2),qt=ct.slice(wt/2,wt);return Ct.push(j),qt.push($),(Ct=Ct.reverse()).push(s),(qt=qt.reverse()).push(r),Ct.reverse().concat(K,qt)}getArrowHeadPoints(r,s,o){var f=qr(r)*this.headHeightFactor,b=r[r.length-1],u=(ux(s,o),f*this.headWidthFactor),w=f*this.neckWidthFactor,C=f*this.neckHeightFactor,M=M0(r[r.length-2],b,0,f,!0),K=M0(r[r.length-2],b,0,C,!0),j=M0(b,M,u0.HALF_PI,u,!1),$=M0(b,M,u0.HALF_PI,u,!0);return[M0(b,K,u0.HALF_PI,w,!1),j,b,$,M0(b,K,u0.HALF_PI,w,!0)]}getArrowBodyPoints(r,s,o,f){for(var b=Ta(r),u=qr(r)*f,w=(u-ux(s,o))/2,C=0,M=[],K=[],j=1;j<r.length-1;j++){var $=Aa(r[j-1],r[j],r[j+1])/2,ot=(u/2-(C+=ux(r[j-1],r[j]))/b*w)/Math.sin($),ct=M0(r[j-1],r[j],Math.PI-$,ot,!0),wt=M0(r[j-1],r[j],$,ot,!1);M.push(ct),K.push(wt)}return M.concat(K)}getTempPoint4(r,s,o){var f,b,u,w,C=mr(r,s),M=ux(C,o),K=Aa(r,C,o);return K<u0.HALF_PI?(b=M*Math.sin(K),u=M*Math.cos(K),w=M0(r,C,u0.HALF_PI,b,!1),f=M0(C,w,u0.HALF_PI,u,!0)):K>=u0.HALF_PI&&K<Math.PI?(b=M*Math.sin(Math.PI-K),u=M*Math.cos(Math.PI-K),w=M0(r,C,u0.HALF_PI,b,!1),f=M0(C,w,u0.HALF_PI,u,!1)):K>=Math.PI&&K<1.5*Math.PI?(b=M*Math.sin(K-Math.PI),u=M*Math.cos(K-Math.PI),w=M0(r,C,u0.HALF_PI,b,!0),f=M0(C,w,u0.HALF_PI,u,!0)):(b=M*Math.sin(2*Math.PI-K),u=M*Math.cos(2*Math.PI-K),w=M0(r,C,u0.HALF_PI,b,!0),f=M0(C,w,u0.HALF_PI,u,!1)),f}}class ho extends _a{constructor(){super(...arguments),this.type=E0.TAILED_ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.headTailFactor=.8,this.swallowTailFactor=1,this.swallowTailPnt=null}generate(){if(!((ot=this.getPointCount())<=2)){var r=this.getPoints(),s=r[0],o=r[1];ea(r[0],r[1],r[2])&&(s=r[1],o=r[0]);var f=[mr(s,o)].concat(r.slice(2)),b=this.getArrowHeadPoints(f,s,o),u=b[0],w=b[4],C=ux(s,o),M=qr(f),K=M*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=M0(f[1],f[0],0,K,!0);var j=C/M,$=this.getArrowBodyPoints(f,u,w,j),ot=$.length,ct=[s].concat($.slice(0,ot/2));ct.push(u);var wt=[o].concat($.slice(ot/2,ot));wt.push(w),ct=Kn(ct),wt=Kn(wt),this.setCoordinates([ct.concat(b,wt.reverse(),[this.swallowTailPnt,ct[0]])])}}}class uo extends _a{constructor(){super(...arguments),this.type=E0.SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1}generate(){if(!((w=this.getPointCount())<2)){var r=this.getPoints(),s=this.getTailPoints(r),o=this.getArrowHeadPoints(r,s[0],s[1]),f=o[0],b=o[4],u=this.getArrowBodyPoints(r,f,b,this.tailWidthFactor),w=u.length,C=[s[0]].concat(u.slice(0,w/2));C.push(f);var M=[s[1]].concat(u.slice(w/2,w));M.push(b),C=Kn(C),M=Kn(M),this.setCoordinates([C.concat(o,M.reverse())])}}getTailPoints(r){var s=qr(r)*this.tailWidthFactor;return[M0(r[1],r[0],u0.HALF_PI,s,!1),M0(r[1],r[0],u0.HALF_PI,s,!0)]}}class fo extends _a{constructor(){super(...arguments),this.type=E0.TAILED_SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.swallowTailFactor=1,this.swallowTailPnt=null}generate(){if(!((w=this.getPointCount())<2)){var r=this.getPoints(),s=this.getTailPoints(r),o=this.getArrowHeadPoints(r,s[0],s[2]),f=o[0],b=o[4],u=this.getArrowBodyPoints(r,f,b,this.tailWidthFactor),w=u.length,C=[s[0]].concat(u.slice(0,w/2));C.push(f);var M=[s[2]].concat(u.slice(w/2,w));M.push(b),C=Kn(C),M=Kn(M),this.setCoordinates([C.concat(o,M.reverse(),[s[1],C[0]])])}}getTailPoints(r){var s=qr(r)*this.tailWidthFactor,o=M0(r[1],r[0],u0.HALF_PI,s,!1),f=M0(r[1],r[0],u0.HALF_PI,s,!0),b=s*this.swallowTailFactor;return[o,M0(r[1],r[0],0,b,!0),f]}}class co extends pr{constructor(){super(...arguments),this.type=E0.FREEHAND_LINE,this.freehand=!0}generate(){this.getPointCount()<2||this.setCoordinates(this.points)}}class po extends Wx{constructor(){super(...arguments),this.type=E0.FREEHAND_POLYGON,this.freehand=!0}generate(){this.getPointCount()<=2||this.setCoordinates([this.points])}}class mo extends Wx{constructor(){super(...arguments),this.type=E0.POLYGON}generate(){this.getPointCount()<=2||this.setCoordinates([this.points])}}class go extends Hn{constructor(){super(...arguments),this.type=E0.MARKER,this.finishPointCount=1}generate(){var r=this.points[0];this.setCoordinates(r)}}class Wa extends pr{constructor(r,s){super(r),this.type=E0.POLYLINE,(s==null?void 0:s.finishPointCount)>1&&(this.finishPointCount=s.finishPointCount)}generate(){this.getPointCount()<2||this.setCoordinates(this.points)}}class vo extends pr{constructor(){super(...arguments),this.type=E0.STRAIGHT_ARROW,this.finishPointCount=2,this.maxArrowLength=3e6,this.arrowLengthScale=5}generate(){if(!(this.getPointCount()<2)){var r=this.getPoints(),s=r[0],o=r[1],f=ux(s,o)/this.arrowLengthScale;f=f>this.maxArrowLength?this.maxArrowLength:f;var b=M0(s,o,Math.PI/6,f,!1),u=M0(s,o,Math.PI/6,f,!0);this.setCoordinates([s,o,b,o,u])}}}class yo extends Wx{constructor(){super(...arguments),this.type=E0.RECTANGLE,this.finishPointCount=2}generate(){if(!(this.getPointCount()<2)){var r=this.points[0],s=this.points[1],o=Math.min(r[0],s[0]),f=Math.max(r[0],s[0]),b=Math.min(r[1],s[1]),u=Math.max(r[1],s[1]),w=[o,u],C=[f,u],M=[f,b],K=[o,b];this.setCoordinates([[w,C,M,K]])}}}const ba={};function _o(z,r){ba[z]=r}function ka(z,r,s){if(ba[z]&&typeof ba[z]=="function")return ba[z](r);switch(z){case E0.ARC:return new to(r);case E0.ELLIPSE:return new eo(r);case E0.CURVE:return new xo(r);case E0.CLOSED_CURVE:return new io(r);case E0.LUNE:return new ro(r);case E0.SECTOR:return new no(r);case E0.GATHERING_PLACE:return new so(r);case E0.STRAIGHT_ARROW:return new vo(r);case E0.ASSAULT_DIRECTION:return new ao(r);case E0.ATTACK_ARROW:return new _a(r);case E0.FINE_ARROW:return new Va(r);case E0.CIRCLE:return new oo(r);case E0.DOUBLE_ARROW:return new lo(r);case E0.TAILED_ATTACK_ARROW:return new ho(r);case E0.SQUAD_COMBAT:return new uo(r);case E0.TAILED_SQUAD_COMBAT:return new fo(r);case E0.FREEHAND_LINE:return new co(r);case E0.FREEHAND_POLYGON:return new po(r);case E0.POLYGON:return new mo(r);case E0.MARKER:return new go(r);case E0.RECTANGLE:return new yo(r);case E0.POLYLINE:return new Wa(r,s)}throw new Error("不能识别的绘制类型！"+z)}var fa;(function(z){z[z.left=0]="left",z[z.middle=1]="middle",z[z.right=2]="right"})(fa||(fa={}));class vn extends Br.c{constructor(r){super(),this.dragging=!1,this.movePointAdded=!1,this.draggingMoved=!1,this.onPointerDown=s=>{this.dragging=!0,this.draggingMoved=!0,this.pointDownTime=performance.now()},this.onPointerMove=s=>{if(this.dragging)this.draggingMoved=!0;else if(this.shape){if(this.shape.freehand)return this.shape.addPoint(s.coords),void this.updateShape();this.movePointAdded?this.shape.updateLastPoint(s.coords):this.shape.addPoint(s.coords)&&(this.movePointAdded=!0),this.updateShape()}},this.onPointerUp=s=>{if(this.dragging=!1,s.buttonType===fa.left){const o=this.pointDownTime&&performance.now()-this.pointDownTime||0;if(this.draggingMoved&&o>vn.PointDownAsDragTime)return this.draggingMoved=!1,void(this.pointDownTime=void 0);Bt.kg.debug("pointer down time "+o),this.shape?this.movePointAdded||this.shape.addPoint(s.coords):(this.shape=ka(this.options.drawType,[s.coords],this.options.shapeOptions),this.options.autoClear&&this.clear()),this.updateShape(),this.fire(vn.EventTypes.pointAdd,{firer:this,msg:{point:s.coords,source:s}}),this.shape.finishPointCount>0&&this.shape.getPointCount()>=this.shape.finishPointCount&&this.finishDraw(s)}else this.shape&&s.buttonType===fa.right&&(this.fire(vn.EventTypes.pointAdd,{firer:this,msg:{point:s.coords,source:s}}),this.finishDraw(s));this.movePointAdded=!1},this.options=r,this.listeners={onPointerDown:this.onPointerDown,onPointerMove:this.onPointerMove,onPointerUp:this.onPointerUp}}finishDraw(r){var s;this.shape&&this.shape.generated&&this.fire(vn.EventTypes.drawFinish,{firer:this,msg:r}),this.options.continious?((s=this.options.tempLineRenderer)===null||s===void 0||s.clear(),this.tempLineShape=void 0,this.shape=void 0,this.drawId=(0,jt.hQ)()):this.end(),this.fire(vn.EventTypes.afterFinish,{firer:this,msg:r})}updateShape(){var r,s,o;if(this.shape.generated)return this.tempLineShape&&((r=this.options.tempLineRenderer)===null||r===void 0||r.clear(),this.tempLineShape=void 0),void((s=this.options.renderer)===null||s===void 0||s.updateShape(this.drawId,this.shape,this.properties));this.tempLineShape||(this.tempLineShape=new Wa),this.tempLineShape.setPoints(this.shape.getPoints(!1)),(o=this.options.tempLineRenderer)===null||o===void 0||o.updateShape(this.drawId+"_temp",this.tempLineShape,this.properties)}addPoint(r){this.shape?this.shape.addPoint(r):(this.shape=ka(this.options.drawType,[r],this.options.shapeOptions),this.options.autoClear&&this.clear())}begin(r){this.options.renderer&&this.options.tempLineRenderer?(this.properties=r,this.options.lockMapWhenPlot&&this.lockMap(),this.drawId=(0,jt.hQ)(),this.setListeners()):Bt.kg.error("vector绘制工具需要提供renderer和tempLineRenderer！")}end(){var r;this.unsetListeners(),this.options.lockMapWhenPlot&&this.unlockMap(),(r=this.options.tempLineRenderer)===null||r===void 0||r.clear(),this.drawId=void 0,this.shape=void 0}setMap(r){var s,o;this.map=r,(s=this.options.renderer)===null||s===void 0||s.setMap(r),(o=this.options.tempLineRenderer)===null||o===void 0||o.setMap(r)}updateDrawType(r){this.options.drawType=r,this.drawId&&this.finishDraw(void 0)}getGeoJSON(){var r;return(r=this.options.renderer)===null||r===void 0?void 0:r.getGeoJSON()}pick(r){var s;return(s=this.options.renderer)===null||s===void 0?void 0:s.pick(r)}clear(){var r,s;(r=this.options.renderer)===null||r===void 0||r.clear(),(s=this.options.tempLineRenderer)===null||s===void 0||s.clear()}}vn.EventTypes={drawFinish:"draw:finish",pointAdd:"point:add",afterFinish:"after:finish"},vn.PointDownAsDragTime=200;class bo{constructor(){this.EarthRadius=6371.1,this.rx=this.ry=0,this.r_res=1}geo2polar(r,s,o){const f=Math.sin(r)*Math.sin(this.r_phy)+Math.cos(r)*Math.cos(this.r_phy)*Math.cos(s);let b=Math.sqrt(1-f*f);b>1?b=1:b<-1&&(b=-1);const u=Math.asin(b);let w=Math.cos(r)*Math.sin(s)/b;w>1?w=1:w<-1&&(w=-1);let C=Math.asin(w);r<Math.asin(f*Math.sin(this.r_phy))?C=Math.PI-C:s<0&&(C=2*Math.PI+C),o.beta=u,o.theta=C}polar2geo(r,s,o){const f=Math.cos(r)*Math.sin(this.r_phy)+Math.sin(r)*Math.cos(this.r_phy)*Math.cos(s),b=Math.sqrt(1-f*f),u=Math.asin(f);let w=Math.sin(s)*Math.sin(r)/b;w>1?w=1:w<-1&&(w=-1);const C=Math.asin(w);o.phy=u,o.delta_numda=C}arcS_of_gps(r,s,o){const f=s/this.EarthRadius,b=r*Math.PI/180;let u={phy:void 0,delta_numda:void 0};this.polar2geo(f,b,u);const w=180*u.phy/Math.PI,C=180*(u.delta_numda+this.r_numda)/Math.PI;o.lon=C,o.lat=w}gps_to_Azimuth(r,s,o){const f=s*Math.PI/180,b=r*Math.PI/180-this.r_numda;let u={beta:void 0,theta:void 0};this.geo2polar(f,b,u);const w=180*u.theta/Math.PI;o.az=w,o.beta=u.beta}gps_to_arcS(r,s,o){const f={az:void 0,beta:void 0};if(this.gps_to_Azimuth(r,s,f),o.S===void 0)throw new Error("S can't be undefined");let b=o.S*this.EarthRadius;o.az=f.az,o.S=b}gps_to_arcS_Grid(r,s,o){const f=s*Math.PI/180,b=r*Math.PI/180-this.r_numda,u={beta:void 0,theta:void 0};this.geo2polar(f,b,u),o.sx=parseInt((u.beta*this.EarthRadius*Math.sin(u.theta)/this.r_res+this.rx+.5).toString()),o.sy=parseInt((this.ry-u.beta*this.EarthRadius*Math.cos(u.theta)/this.r_res+.5).toString())}}class wo extends bo{constructor(r,s,o,f,b,u){super(),this.r_numda=r*Math.PI/180,this.r_phy=s*Math.PI/180,this.r_h=.001*o,this.r_res=.001*u,this.rx=f,this.ry=b,this.Km=1}tilt_of_gps(r,s,o){if(s<this.r_res)return o.dh=this.r_h,void(o.dS=s);const f=this.Km*this.EarthRadius,b=r*Math.PI/180,u=this.Km*Math.atan(s*Math.cos(b)/(f+this.r_h+s*Math.sin(b)));o.dS=this.EarthRadius*u,o.dh=Math.sqrt((f+this.r_h)*(f+this.r_h)+s*s+2*(f+this.r_h)*s*Math.sin(b))-f}tilt_of_gps_lon_lat(r,s,o,f){if(this.tilt_of_gps(r,o,f),o<this.r_res)return f.lon=180*this.r_numda/Math.PI,void(f.lat=180*this.r_phy/Math.PI);this.arcS_of_gps(s,f.dS,f)}tilt_of_gps_by_grid(r,s,o,f){const b=Math.sqrt((s-this.rx)*(s-this.rx)+(this.ry-o)*(this.ry-o))*this.r_res;let u=Math.asin((s-this.rx)*this.r_res/b);u=s>=this.rx&&o<=this.ry?180*u/Math.PI:s<this.rx&&o<=this.ry?360+180*u/Math.PI:180-180*u/Math.PI,this.tilt_of_gps_lon_lat(r,u,b,f)}ES_of_H(r,s,o){if(s<=this.r_res)o.dh=this.r_h;else{const f=r*Math.PI/180,b=this.EarthRadius*this.Km,u=s/b;o.dh=(b+this.r_h)*Math.cos(f)/Math.cos(f+u)-b}}HS_of_E(r,s,o){const f=this.EarthRadius*this.Km,b=s/f;let u=Math.cos(b);u>1&&(u=1);const w=Math.sin(b),C=(u*(f+r)-(f+this.r_h))/(w*(f+r));o.ele=180*Math.atan(C)/Math.PI}gps_to_tilt(r,s,o,f){let b={beta:void 0,az:f.Az};this.gps_to_Azimuth(r,s,b),b.beta=b.beta/this.Km;const u=o*Math.PI/180;f.L=(this.Km*this.EarthRadius+this.r_h)*Math.sin(b.beta)/Math.cos(u+b.beta);const w=this.EarthRadius*this.Km;f.H=Math.sqrt((w+this.r_h)*(w+this.r_h)+f.L*f.L+2*(w+this.r_h)*f.L*Math.sin(u))-w,f.Az=b.az}gps_to_tilt_grid(r,s,o,f){const b={Az:void 0,L:void 0,H:void 0};this.gps_to_tilt(r,s,o,b);const u=Math.sin(b.Az*Math.PI/180),w=Math.cos(b.Az*Math.PI/180);f.x=b.L*u/this.r_res,f.y=b.L*w/this.r_res}DEM_to_tilt(r,s,o,f){const b={beta:void 0,az:f.Az};if(this.gps_to_Azimuth(r,s,b),f.S=b.beta*this.EarthRadius,o<=this.r_h)return f.e=0,void(f.L=f.S);b.beta=b.beta/this.Km;const u=this.Km*this.EarthRadius;let w=Math.cos(b.beta);w>1&&(w=1);const C=Math.sin(b.beta);f.e=Math.atan(((u+o)*w-(u+this.r_h))/((u+o)*C)),f.L=(u+o)*C/Math.cos(f.e),f.e=180*f.e/Math.PI,f.Az=b.az}RayPath_of_SH(r,s,o){o.S=o.S||[],o.H=o.H||[];const f={dh:void 0,dS:void 0};let b=0;for(let u=0;u<s;++u)this.tilt_of_gps(r,b,f),o.S[u]=f.dS/this.r_res+.5,o.H[u]=1e3*f.dh+.5,b+=this.r_res}}function Po(z,r,s,o=1,f=1,b=1){o=Math.floor(o),f=Math.floor(f),b=Math.floor(b);const u=[],w=[],C=[],M=[];let K=0;function j($,ot,ct,wt,Ct,qt,kt,$t,ie,oe,ae){const fe=qt/ie,le=kt/oe,ge=qt/2,_e=kt/2,Le=$t/2,Re=ie+1,Ke=oe+1;let i0=0;const We={};for(let Xe=0;Xe<Ke;Xe++){const Ze=Xe*le-_e;for(let Qe=0;Qe<Re;Qe++){const v0=Qe*fe-ge;We[$]=v0*wt,We[ot]=Ze*Ct,We[ct]=Le,w.push(We.x,We.y,We.z),We[$]=0,We[ot]=0,We[ct]=$t>0?1:-1,C.push(We.x,We.y,We.z),M.push(Qe/ie),M.push(1-Xe/oe),i0+=1}}for(let Xe=0;Xe<oe;Xe++)for(let Ze=0;Ze<ie;Ze++){const Qe=K+Ze+Re*Xe,v0=K+Ze+Re*(Xe+1),o0=K+(Ze+1)+Re*(Xe+1),A0=K+(Ze+1)+Re*Xe;u.push(Qe,v0,A0),u.push(v0,o0,A0)}K+=i0}return j("z","y","x",-1,-1,s,r,z,b,f),j("z","y","x",1,-1,s,r,-z,b,f),j("x","z","y",1,1,z,s,r,o,b),j("x","z","y",1,-1,z,s,-r,o,b),j("x","y","z",1,-1,z,r,s,o,f),j("x","y","z",-1,-1,z,r,-s,o,f),{indices:u,vertices:w,normals:C,uvs:M}}function So(z,r){return s=>(s-z.x)/(r.x-z.x)*(r.y-z.y)+z.y}function Lo(z,r){const s=(r.x-z.x)/(r.y-z.y),o=z.x-s*z.y;return f=>s*f+o}function Ma(z,r,s){if(z.length<2)return;let o={},f=[],b=0;for(let u=0;u<z.length-1;u++){let w=z[u],C=z[u+1];if(w.x===C.x){let M=Math.abs(s),K=j=>j<=C.y;C.y<w.y&&(K=j=>j>=C.y,M=-M);for(let j=w.y;K(j);j+=M)f[b]={x:w.x,y:j},b++}else if(w.y===C.y){let M=Math.abs(r),K=j=>j<=C.x;C.x<w.x&&(K=j=>j>=C.x,M=-M);for(let j=w.x;K(j);j+=M)f[b]={x:j,y:w.y},b++}else if(Math.abs(Math.ceil((C.x-w.x)/r))<Math.abs(Math.ceil((C.y-w.y)/s))){let M=Math.abs(s),K=$=>$<=C.y;C.y<w.y&&(K=$=>$>=C.y,M=-M);let j=Lo(w,C);for(let $=w.y;K($);$+=M){let ot=j($);f[b]={x:ot,y:$},b++}}else{let M=w.x.toString()+w.y.toString()+C.x.toString()+C.y.toString(),K=o[M];K||(K=So(w,C),o[M]=K);let j=Math.abs(r),$=ot=>ot<=C.x;C.x<w.x&&($=ot=>ot>=C.x,j=-j);for(let ot=w.x;$(ot);ot+=j){let ct=K(ot);f[b]={x:ot,y:ct},b++}}}return f.push(z[z.length-1]),{posMap:f}}function Oo(z,r,s,o,f,b){z.beginPath(),z.arc(r+b,s+b,b,Math.PI,3*Math.PI/2),z.lineTo(o-b+r,s),z.arc(o-b+r,b+s,b,3*Math.PI/2,2*Math.PI),z.lineTo(o+r,f+s-b),z.arc(o-b+r,f-b+s,b,0,1*Math.PI/2),z.lineTo(b+r,f+s),z.arc(b+r,f-b+s,b,1*Math.PI/2,Math.PI),z.closePath()}function To(z,r,s,o=void 0,f=!1,b=0,u=512,w=256,C=0,M=void 0){var K;if(!(o!=null&&o.length)){o=[];for(let ae=500;ae<1e4;ae+=500)o.push(ae)}let j;r[0]instanceof Array?(j=[],r.forEach(ae=>j.push({x:ae[0],y:ae[1]}))):j=r;let $,ot=(0,ax.m_)(s);M?$=M:($=document.createElement("canvas"),$.width=u,$.height=w);let ct=$.getContext("2d");const wt=Ma(j,z.gridOptions.xDelta,z.gridOptions.yDelta);if(!(!((K=wt.posMap)===null||K===void 0)&&K.length))return;const Ct=ae=>Math.floor(ae/u*(wt.posMap.length-1));let qt=(ae,fe,le,ge)=>{ge=ge??z.gridOptions.zValues;const _e=(1-ae/w)*(o[o.length-1]-o[0])+o[0];let Le=ge.length-1,Re=ge.length-1,Ke=0;if(!(_e<ge[0]||_e>ge[ge.length-1])){for(let i0=0;i0<ge.length;i0++)if(_e<=parseFloat(ge[i0])){Re=Math.max(0,i0-1),Le=i0,Ke=Re===Le?0:(_e-ge[Re])/(ge[Le]-ge[Re]);break}return{upper:Le,lower:Re,weight:Ke}}};if(f){const ae={},fe=new wo(z.centerLon(),z.centerLat(),b??0,z.gridOptions.xSize,z.gridOptions.ySize,1),le=qt;qt=(ge,_e,Le)=>{const Re=_e.toFixed(3)+"_"+Le.toFixed(3),Ke=z.gridOptions.zValues.map(i0=>{const We=Re+"_"+i0.toFixed(3);if(ae[We])return ae[We].H;const Xe={};return fe.gps_to_tilt(_e,Le,i0,Xe),Xe.H=1e3*Xe.H,ae[We]=Xe,Xe.H});return le(ge,_e,Le,Ke)}}let kt=ct.getImageData(0,0,u,w),$t=-4,ie=-1/0,oe=1/0;for(let ae=0;ae<w;ae++)for(let fe=0;fe<u;fe++){let le=Ct(fe);$t+=4;const ge=wt.posMap[le],_e=(0,jt.tr)(z.gridOptions.xStart,z.gridOptions.xDelta,ge.x),Le=(0,jt.tr)(z.gridOptions.yStart,z.gridOptions.yDelta,ge.y);if(_e<0||Le<0||_e>=z.gridOptions.xSize||Le>=z.gridOptions.ySize){kt.data[$t]=0,kt.data[$t+1]=0,kt.data[$t+2]=0,kt.data[$t+3]=0;continue}let Re=qt(ae,ge.x,ge.y);if(!Re){kt.data[$t]=0,kt.data[$t+1]=0,kt.data[$t+2]=0,kt.data[$t+3]=0;continue}const Ke=z.getGrid(C,Re.lower),i0=z.getGrid(C,Re.upper),We=Ke.getPos(Le,_e);let Xe=Ke.read1D(We),Ze=i0.read1D(We);const Qe=Ke.isUndef(Xe),v0=i0.isUndef(Ze);let o0,A0=!1;Qe||v0?(A0=!0,o0=Ke.undef):o0=Xe*(1-Re.weight)+Ze*Re.weight,A0||(o0>ie&&(ie=o0),o0<oe&&(oe=o0));let sx=ot.getRule(o0).stop;if(!(sx instanceof Cx.t))return Bt.kg.warn("颜色规则中的颜色配置有误"),Bt.kg.warn(sx),{canvas:$,path:wt.posMap,maxVal:ie,minVal:oe};kt.data[$t]=sx.red(),kt.data[$t+1]=sx.green(),kt.data[$t+2]=sx.blue(),kt.data[$t+3]=Math.floor(255*sx.alpha())}return ct.putImageData(kt,0,0),{canvas:$,path:wt.posMap,maxVal:ie,minVal:oe,outputZValues:o}}function Ao(z,r,s,o=512,f=256,b=-1,u=0,w=void 0){var C;let M;r[0]instanceof Array?(M=[],r.forEach(ie=>M.push({x:ie[0],y:ie[1]}))):M=r;let K,j=(0,ax.m_)(s);w?K=w:(K=document.createElement("canvas"),K.width=o,K.height=f);let $=K.getContext("2d");const ot=Ma(M,z.gridOptions.xDelta,z.gridOptions.yDelta);if(!(!((C=ot.posMap)===null||C===void 0)&&C.length))return;const ct=ie=>Math.floor(ie/o*(ot.posMap.length-1));let wt=ie=>Math.floor((1-ie/f)*(z.gridOptions.zValues.length-1));b>parseFloat(z.gridOptions.zValues[0])&&(wt=ie=>{const oe=(1-ie/f)*b;for(let ae=0;ae<z.gridOptions.zValues.length;ae++)if(oe<parseFloat(z.gridOptions.zValues[ae]))return ae;return z.gridOptions.zValues.length-1});let Ct=$.getImageData(0,0,o,f),qt=-4,kt=-1/0,$t=1/0;for(let ie=0;ie<f;ie++){let oe=wt(ie);for(let ae=0;ae<o;ae++){qt+=4;let fe=ct(ae);const le=z.getGrid(u,oe),ge=ot.posMap[fe],_e=(0,jt.tr)(z.gridOptions.xStart,z.gridOptions.xDelta,ge.x),Le=(0,jt.tr)(z.gridOptions.yStart,z.gridOptions.yDelta,ge.y);if(_e<0||Le<0||_e>=le.xSize||Le>=le.ySize){Ct.data[qt]=0,Ct.data[qt+1]=0,Ct.data[qt+2]=0,Ct.data[qt+3]=0;continue}let Re=le.read2D(Le,_e);le.isUndef(Re)||(Re>kt&&(kt=Re),Re<$t&&($t=Re));let Ke=j.getRule(Re).stop;if(!(Ke instanceof Cx.t))return Bt.kg.warn("颜色规则中的颜色配置有误"),Bt.kg.warn(Ke),{canvas:K,path:ot.posMap,maxVal:kt,minVal:$t};Ct.data[qt]=Ke.red(),Ct.data[qt+1]=Ke.green(),Ct.data[qt+2]=Ke.blue(),Ct.data[qt+3]=Math.floor(255*Ke.alpha())}}return $.putImageData(Ct,0,0),{canvas:K,path:ot.posMap,maxVal:kt,minVal:$t}}var vs=t(251);const ys=["0","1","2","3","4","5","6","7"],wa=["1","2","3","4"],za=["0","1","2","3"],Gi={tdt:"c4f61f8b0b036ff262d8b480fa826711",zkxt:"8a2174987fca73490355324d79908f10d36d7d114759abd832eb1fc5fb1d105d"},Z0={tdtSatellite:"tdtSatellite",tdtSatelliteAnnotation:"tdtSatelliteAnnotation",tdtNormal:"tdtNormal",tdtNormalAnnotation:"tdtNormalAnnotation",tdtBounds:"tdtBounds",tdtTerrain:"tdtTerrain",tdtTerrainAnnotation:"tdtTerrainAnnotation",gdSatellite:"gdSatellite",gdSatelliteAnnotation:"gdSatelliteAnnotation",gdNormal:"gdNormal",gdWarm:"gdWarm",geoQNormal:"geoQNormal",geoQPurplishBlue:"geoQPurplishBlue",geoQGray:"geoQGray",geoQWarm:"geoQWarm",geoQBoundary:"geoQBoundary",geoQWater:"geoQWater",tencentStreet:"tencentStreet",tencentDem:"tencentDem",tencentAnnotation:"tencentAnnotation",stamenTerrain:"stamenTerrain",stamenWaterColor:"stamenWaterColor",esriSate:"esriSate",esriTerrain:"esriTarrain",esriShaded:"esriShaded",mtb:"mtb",nasaNight:"nasaNight",windy:"windy",vectorTop:"vectorTop",zkxtNormal:"zkxtNormal",zkxtTerrain:"zkxtTerrain",zkxtSatellite:"zkxtSatellite",zkxtSatelliteAnnotation:"zkxtSatelliteAnnotation",zkxtTerrainAnnotation:"zkxtTerrainAnnotation"},Ba={};function Io(z,r){Z0[z]=z,Ba[z]=r}function Eo(z){let r={url:"https://t{s}.tianditu.gov.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk="+Gi.tdt,subdomains:ys};switch(z){case Z0.tdtSatellite:break;case Z0.tdtSatelliteAnnotation:r={url:"https://t{s}.tianditu.gov.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk="+Gi.tdt,subdomains:ys};break;case Z0.tdtNormal:r={url:"https://t{s}.tianditu.gov.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk="+Gi.tdt,subdomains:ys};break;case Z0.tdtNormalAnnotation:r={url:"https://t{s}.tianditu.gov.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk="+Gi.tdt,subdomains:ys};break;case Z0.tdtTerrain:r={url:"https://t{s}.tianditu.gov.cn/DataServer?T=ter_w&X={x}&Y={y}&L={z}&tk="+Gi.tdt,subdomains:ys};break;case Z0.tdtTerrainAnnotation:r={url:"https://t{s}.tianditu.gov.cn/DataServer?T=cta_w&X={x}&Y={y}&L={z}&tk="+Gi.tdt,subdomains:ys};break;case Z0.tdtBounds:r={url:"https://t{s}.tianditu.gov.cn/ibo_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=ibo&tileMatrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+Gi.tdt,subdomains:ys};break;case Z0.gdSatellite:r={url:"https://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",subdomains:wa};break;case Z0.gdSatelliteAnnotation:r={url:"https://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",subdomains:wa};break;case Z0.gdNormal:r={url:"https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",subdomains:wa};break;case Z0.gdWarm:r={url:"https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",subdomains:wa};break;case Z0.geoQNormal:r={url:"https://mapnew.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}"};break;case Z0.geoQPurplishBlue:r={url:"https://mapnew.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}"};break;case Z0.geoQGray:r={url:"https://mapnew.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}"};break;case Z0.geoQWarm:r={url:"https://mapnew.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}"};break;case Z0.geoQBoundary:r={url:"https://thematic.geoq.cn/arcgis/rest/services/ThematicMaps/administrative_division_boundaryandlabel/MapServer/tile/{z}/{y}/{x}"};break;case Z0.geoQWater:r={url:"https://thematic.geoq.cn/arcgis/rest/services/ThematicMaps/WorldHydroMap/MapServer/tile/{z}/{y}/{x}"};break;case Z0.tencentStreet:r={url:"https://rt{s}.map.gtimg.com/realtimerender?z={z}&x={x}&y={y}&type=vector&style=0",subdomains:za,tms:!0};break;case Z0.tencentDem:r={url:"https://p{s}.map.gtimg.com/demTiles/{z}/{x}/{y}/{x}_{y}.jpg",subdomains:za,tms:!0};break;case Z0.tencentAnnotation:r={url:"https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={y}&styleid=2&version=837",subdomains:za,tms:!0};break;case Z0.stamenTerrain:r={url:"https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}{r}.{ext}",subdomains:"abcd",minZoom:0,maxZoom:18,ext:"png"};break;case Z0.stamenWaterColor:r={url:"https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}{r}.{ext}",subdomains:"abcd",minZoom:1,maxZoom:16,ext:"jpg"};break;case Z0.esriSate:r={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"};break;case Z0.esriShaded:r={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}"};break;case Z0.esriTerrain:r={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}"};break;case Z0.mtb:r={url:"https://tile.mtbmap.cz/mtbmap_tiles/{z}/{x}/{y}.png"};break;case Z0.nasaNight:r={url:"https://map1.vis.earthdata.nasa.gov/wmts-webmerc/VIIRS_CityLights_2012/default/{time}/{tilematrixset}{maxZoom}/{z}/{y}/{x}.{format}",bounds:[[-85.0511287776,-179.999999975],[85.0511287776,179.999999975]],minZoom:1,maxZoom:8,format:"jpg",time:"",tilematrixset:"GoogleMapsCompatible_Level"};break;case Z0.vectorTop:r={url:"https://qefiles.91weather.com/cdn-repo/mlog/cloud/terrain/tile/gaode/d461a96842e24b958142f84c3051e588/{z}/{x}_{y}.png"};break;case Z0.zkxtNormal:r={url:"https://tiles{s}.geovisearth.com/base/v1/vec/{z}/{x}/{y}?format=webp&tmsIds=w&token="+Gi.zkxt,subdomains:["1","2","3"]};break;case Z0.zkxtSatellite:r={url:"https://tiles{s}.geovisearth.com/base/v1/img/{z}/{x}/{y}?format=webp&tmsIds=w&token="+Gi.zkxt,subdomains:["1","2","3"]};break;case Z0.zkxtSatelliteAnnotation:r={url:"https://tiles{s}.geovisearth.com/base/v1/cia/{z}/{x}/{y}?format=webp&tmsIds=w&token="+Gi.zkxt,subdomains:["1","2","3"]};break;case Z0.zkxtTerrain:r={url:"https://tiles{s}.geovisearth.com/base/v1/ter/{z}/{x}/{y}?format=webp&tmsIds=w&token="+Gi.zkxt,subdomains:["1","2","3"]};break;case Z0.zkxtTerrainAnnotation:r={url:"https://tiles{s}.geovisearth.com/base/v1/cat/{z}/{x}/{y}?format=webp&tmsIds=w&token="+Gi.zkxt,subdomains:["1","2","3"]};break;case Z0.windy:r={url:"https://tiles.windy.com/tiles/v10.0/darkmap/{z}/{x}/{y}.png"};break;default:Ba[z]&&(r=Ba[z])}return r}const Ua={code:"%8C%C6%DE%CC%CE%B0%A6%D3%E6%DC%u4E92%u9CE4%uA007%uDE86%uFF81%u7154%u788D%uE4E3%uC0A8%uCA6E%u7548%9C%9Cc%B2%DF%E9%EB%DB%D0%CF%DC%B4%u8CA1%u1BF2%u0962%uDC51%u62A0%9C%9C%u5566%uCA6E%uD8B0%uCACB%uF33A%u0C4B%uFD4F%uDCA9%uAF8F%u4EFB%uFF87%DC%D5%C7%CF%D5%C9%C3%D0"};function Ax(z){z=unescape(z);for(var r=String.fromCharCode(z.charCodeAt(0)-z.length),s=1;s<z.length;s++)r+=String.fromCharCode(z.charCodeAt(s)-r.charCodeAt(s-1));return r}var Ro=function(z,r,s,o){return new(s||(s=Promise))(function(f,b){function u(M){try{C(o.next(M))}catch(K){b(K)}}function w(M){try{C(o.throw(M))}catch(K){b(K)}}function C(M){var K;M.done?f(M.value):(K=M.value,K instanceof s?K:new s(function(j){j(K)})).then(u,w)}C((o=o.apply(z,r||[])).next())})};let qa=!1;const Do=1747197734471,Co="3.1.0";function ko(z,r=!0){qa?Bt.kg.debug("请勿重复调用init方法！"):(qa=!0,Js(),pa(),(0,Bt.qr)(),Bt.kg.note("QE VERSION:"+Co),Bt.kg.debug("当前WebGL使用版本："+(k.v.useWebGL2?"2":"1")),r===!1&&Ja())}let Za=!1;function Ja(){return Ro(this,void 0,void 0,function*(){if(Za)return Ua;Bt.kg.debug(Ax("%u8BC9%uDA27%uE8F2%u264D%uD9EE%u4E5B%5C%5C")),Za=!0,Bt.kg.note(Ax("%u4E35%uCCFD%uD624%uAE2E%uBE2A%uBE5C%uB296%uA9C6%u9DDF%uC4A7%uC675%uDE86%u8C45%u7DCB%uCCC9%uDEF2%u105A%u0B69%u0C4B%uFD4F%uDCA9%uAF8F%u504E%DC%D5%C7%CF%D5%C9%C3%D0%u8D9C%uDB9D%uA3B6%uA360%uC062%uD45E%uE21B%uD152%uDE86%u190E%FD%uE770%u7149"));let z=!1;const r=()=>{location.origin.startsWith("file://")?alert(Ax("%u60CA%uF7A8%u2081%uE0A9%uB628%uB2D1%uC780%uCC32%uA6B0%uB080%uC153%uEAE5%uF16C%uB47D%u4DF7%u5078%uA0CA%uA342%uA2D4%uA2A7%uD3C5%u8054%C6%DE%CC%CE%B0%A6%D3%E6%DC%u65EF%uCDEA%u6764")):location.host.indexOf(Ax("u%DB%D2%C4%CD%D4%D7%E2%E7"))<0&&location.host.indexOf(Ax("%3Acie%5E%5E%5E%5E_"))<0&&(alert(Ax("%u60E0%uBFFB%uB1A0%uA1CC%uC4A7%uEBAC%uDCB3%uB438%uCCFD%uE620%uBE5C%uB296%uA9C6%uC0A8%u7154%u4D19%uB33C%uC830%uF3E9%u105A%uD380%uDFCD%u21AD%u94EF%u5883%uF082%u1AB7%uD78D%uB905%uC830%uF3E9%u105A%uF5F6%uC48D%uCCFD%uF13C%uD974%uCAB4%uCACB%u664F%u52FB%uA2D4%uCF39%uFD4F%uDCA9%uAF8F%u504E%DC%D5%C7%CF%D5%C9%C3%D0%uFF70")),alert(Ax("%u60CC%uB497%uA2D4%uA058%uE760%u21D2%u245A%u2FD7%u966E%u6122%uE21B%uF0BE%uC2B4%uCA69%uD408%uADE7%uB1CD%u5FD1%C6%DE%CC%CE%B0%A6%D3%E6%DC%u7FB9%uFA2A%uFE90%uD78D%uA523%uDE86%uF0C1%uCACB%u6644")),location.href=Ax("%84%DC%E8%E4%AAi%5E%A0%D6%C8%CF%DB%E4%D9%92gj%A8%DC%C6%D5%DC%CD%D7%A0%91%D2%DC"))};fetch(k.v.licPath+"?t="+new Date().getTime()).then(s=>{s.text().then(o=>{const f=Ax(o);if(f.indexOf(Ax("%5B%C6%DE%CC%CE%B0%A6%D3%E6%DC"))<0||f.indexOf(Ax("%u8C65%u1BF2%u0962%uDC51"))<0||f.indexOf(Ax("%u638A%uCACB"))<0||f.indexOf(Ax("%u514F%uDE86"))<0||f.indexOf(Ax("%u7985%uE4E3%uC0A8%uCA6E"))<0||f.indexOf(Ax("v%DC%D5%C7%CF%D5%C9%C3%D0"))<0)r();else{if(f.indexOf(location.host)<0)return void r();if(f.indexOf("development")>=0){const b=new Date(parseInt(f.trim().substring(f.length-26,f.length-13))).getTime();if(new Date().getTime()<b)return void r();if(new Date(parseInt(f.trim().substring(f.length-13))).getTime()<new Date().getTime())return alert(Ax("%u60C6%uD72C%uC603%uC4A7%uEBAC%uE4B6%uD605%uC6E8%uC3E3%uD716%uD974%uC056%uBF11%u64F3%u8B03%u0C4B%uFD4F%uDDA3%uD72C%uC61F%uAE2F%uB3DA%uBC3A%uCCA4%uB7E0%uB930%uCCB0%uD7F8%uD974%u662D")),console.warn("%u60C6%uD72C%uC603%uC4A7%uEBAC%uE4B6%uD605%uC6E8%uC3E3%uD716%uD974%uC056%uBF11%u64F3%u8B03%u0C4B%uFD4F%uDDA3%uD72C%uC61F%uAE2F%uB3DA%uBC3A%uCCA4%uB7E0%uB930%uCCB0%uD7F8%uD974%u662D"),void r()}if(f.indexOf(Ax("r%D5%D6%D6%DD%AE"))<0)return alert(Ax("%u5F7C%uB1A0%uE1BC%uDE65%uC13E%uD974%uB539%u9F89%uAD35%u5AC5%u8B03%u0C4B%uFD4F%uDDA3%uD72C%uDD91%uB9AE%uA23C%uAE2F%uB3DA%u5447%uFE09%u5055%uDE86%uFF81%uD974%uF323%uDE17%uE884%u274C%u105A%uF660%uD643%uAD60%uC48F%u76F0%D5%CC%u65EA%uB47D%u4DFF")),void r();{const b=f.indexOf(Ax("r%D5%D6%D6%DD%AE"))+6,u=f.substring(b,b+13),w=parseInt(u);if(!(0,jt.ri)(w)||Do>w)return alert(Ax("%u5F7C%uB1A0%uE1BC%uDE65%uC13E%uD974%uB539%u9F89%uAD35%u5AC5%u8B03%u0C4B%uFD4F%uDDA3%uD72C%uDD91%uB9AE%uA23C%uAE2F%uB3DA%u5447%uFE09%u5055%uDE86%uFF81%uD974%uF323%uDE17%uE884%u274C%u105A%uF660%uD643%uAD60%uC48F%u76F0%D5%CC%u65EA%uB47D%u4DFF")),void r()}Bt.kg.debug(Ax("%u8BC8%uDA27%uE8F2%u264D%uEDD1%uB4AF%u51A0")),Ua.code=o,z=!0}}).catch(()=>{r()})}).catch(()=>{r()}),setInterval(()=>{z||r()},1e4)})}})(),p})())}(quickearth_core)),quickearth_core.exports}var quickearth_coreExports=requireQuickearth_core(),quickearth_leaflet={exports:{}};(function(Je,Ce){(function(ne,Zt){Je.exports=Zt(requireQuickearth_core(),leafletSrcExports)})(self,(ne,Zt)=>(()=>{var de={921:I=>{function At(Nt){var ft=new Error("Cannot find module '"+Nt+"'");throw ft.code="MODULE_NOT_FOUND",ft}At.keys=()=>[],At.resolve=At,At.id=921,I.exports=At},616:(I,At,Nt)=>{var ft=Nt(277);function at(dt){var et=[1/0,1/0,-1/0,-1/0];return ft.coordEach(dt,function(_t){et[0]>_t[0]&&(et[0]=_t[0]),et[1]>_t[1]&&(et[1]=_t[1]),et[2]<_t[0]&&(et[2]=_t[0]),et[3]<_t[1]&&(et[3]=_t[1])}),et}at.default=at,At.Z=at},484:(I,At)=>{function Nt(F,pt,ht){ht===void 0&&(ht={});var mt={type:"Feature"};return(ht.id===0||ht.id)&&(mt.id=ht.id),ht.bbox&&(mt.bbox=ht.bbox),mt.properties=pt||{},mt.geometry=F,mt}function ft(F,pt,ht){if(ht===void 0&&(ht={}),!F)throw new Error("coordinates is required");if(!Array.isArray(F))throw new Error("coordinates must be an Array");if(F.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!lt(F[0])||!lt(F[1]))throw new Error("coordinates must contain numbers");return Nt({type:"Point",coordinates:F},pt,ht)}function at(F,pt,ht){ht===void 0&&(ht={});for(var mt=0,bt=F;mt<bt.length;mt++){var ut=bt[mt];if(ut.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Mt=0;Mt<ut[ut.length-1].length;Mt++)if(ut[ut.length-1][Mt]!==ut[0][Mt])throw new Error("First and last Position are not equivalent.")}return Nt({type:"Polygon",coordinates:F},pt,ht)}function dt(F,pt,ht){if(ht===void 0&&(ht={}),F.length<2)throw new Error("coordinates must be an array of two or more positions");return Nt({type:"LineString",coordinates:F},pt,ht)}function et(F,pt){pt===void 0&&(pt={});var ht={type:"FeatureCollection"};return pt.id&&(ht.id=pt.id),pt.bbox&&(ht.bbox=pt.bbox),ht.features=F,ht}function _t(F,pt,ht){return ht===void 0&&(ht={}),Nt({type:"MultiLineString",coordinates:F},pt,ht)}function rt(F,pt,ht){return ht===void 0&&(ht={}),Nt({type:"MultiPoint",coordinates:F},pt,ht)}function Pt(F,pt,ht){return ht===void 0&&(ht={}),Nt({type:"MultiPolygon",coordinates:F},pt,ht)}function St(F,pt){pt===void 0&&(pt="kilometers");var ht=At.factors[pt];if(!ht)throw new Error(pt+" units is invalid");return F*ht}function yt(F,pt){pt===void 0&&(pt="kilometers");var ht=At.factors[pt];if(!ht)throw new Error(pt+" units is invalid");return F/ht}function gt(F){return F%(2*Math.PI)*180/Math.PI}function lt(F){return!isNaN(F)&&F!==null&&!Array.isArray(F)}Object.defineProperty(At,"__esModule",{value:!0}),At.earthRadius=63710088e-1,At.factors={centimeters:100*At.earthRadius,centimetres:100*At.earthRadius,degrees:At.earthRadius/111325,feet:3.28084*At.earthRadius,inches:39.37*At.earthRadius,kilometers:At.earthRadius/1e3,kilometres:At.earthRadius/1e3,meters:At.earthRadius,metres:At.earthRadius,miles:At.earthRadius/1609.344,millimeters:1e3*At.earthRadius,millimetres:1e3*At.earthRadius,nauticalmiles:At.earthRadius/1852,radians:1,yards:1.0936*At.earthRadius},At.unitsFactors={centimeters:100,centimetres:100,degrees:8982708286548395e-21,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:.0006213711922373339,millimeters:1e3,millimetres:1e3,nauticalmiles:.0005399568034557236,radians:1/At.earthRadius,yards:1.0936133},At.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},At.feature=Nt,At.geometry=function(F,pt,ht){switch(F){case"Point":return ft(pt).geometry;case"LineString":return dt(pt).geometry;case"Polygon":return at(pt).geometry;case"MultiPoint":return rt(pt).geometry;case"MultiLineString":return _t(pt).geometry;case"MultiPolygon":return Pt(pt).geometry;default:throw new Error(F+" is invalid")}},At.point=ft,At.points=function(F,pt,ht){return ht===void 0&&(ht={}),et(F.map(function(mt){return ft(mt,pt)}),ht)},At.polygon=at,At.polygons=function(F,pt,ht){return ht===void 0&&(ht={}),et(F.map(function(mt){return at(mt,pt)}),ht)},At.lineString=dt,At.lineStrings=function(F,pt,ht){return ht===void 0&&(ht={}),et(F.map(function(mt){return dt(mt,pt)}),ht)},At.featureCollection=et,At.multiLineString=_t,At.multiPoint=rt,At.multiPolygon=Pt,At.geometryCollection=function(F,pt,ht){return ht===void 0&&(ht={}),Nt({type:"GeometryCollection",geometries:F},pt,ht)},At.round=function(F,pt){if(pt===void 0&&(pt=0),pt&&!(pt>=0))throw new Error("precision must be a positive number");var ht=Math.pow(10,pt||0);return Math.round(F*ht)/ht},At.radiansToLength=St,At.lengthToRadians=yt,At.lengthToDegrees=function(F,pt){return gt(yt(F,pt))},At.bearingToAzimuth=function(F){var pt=F%360;return pt<0&&(pt+=360),pt},At.radiansToDegrees=gt,At.degreesToRadians=function(F){return F%360*Math.PI/180},At.convertLength=function(F,pt,ht){if(pt===void 0&&(pt="kilometers"),ht===void 0&&(ht="kilometers"),!(F>=0))throw new Error("length must be a positive number");return St(yt(F,pt),ht)},At.convertArea=function(F,pt,ht){if(pt===void 0&&(pt="meters"),ht===void 0&&(ht="kilometers"),!(F>=0))throw new Error("area must be a positive number");var mt=At.areaFactors[pt];if(!mt)throw new Error("invalid original units");var bt=At.areaFactors[ht];if(!bt)throw new Error("invalid final units");return F/mt*bt},At.isNumber=lt,At.isObject=function(F){return!!F&&F.constructor===Object},At.validateBBox=function(F){if(!F)throw new Error("bbox is required");if(!Array.isArray(F))throw new Error("bbox must be an Array");if(F.length!==4&&F.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");F.forEach(function(pt){if(!lt(pt))throw new Error("bbox must only contain numbers")})},At.validateId=function(F){if(!F)throw new Error("id is required");if(["string","number"].indexOf(typeof F)===-1)throw new Error("id must be a number or a string")}},277:(I,At,Nt)=>{Object.defineProperty(At,"__esModule",{value:!0});var ft=Nt(484);function at(yt,gt,lt){if(yt!==null)for(var F,pt,ht,mt,bt,ut,Mt,st,tt=0,Ut=0,nt=yt.type,ue=nt==="FeatureCollection",re=nt==="Feature",ee=ue?yt.features.length:1,Qt=0;Qt<ee;Qt++){bt=(st=!!(Mt=ue?yt.features[Qt].geometry:re?yt.geometry:yt)&&Mt.type==="GeometryCollection")?Mt.geometries.length:1;for(var Lt=0;Lt<bt;Lt++){var pe=0,be=0;if((mt=st?Mt.geometries[Lt]:Mt)!==null){ut=mt.coordinates;var se=mt.type;switch(tt=!lt||se!=="Polygon"&&se!=="MultiPolygon"?0:1,se){case null:break;case"Point":if(gt(ut,Ut,Qt,pe,be)===!1)return!1;Ut++,pe++;break;case"LineString":case"MultiPoint":for(F=0;F<ut.length;F++){if(gt(ut[F],Ut,Qt,pe,be)===!1)return!1;Ut++,se==="MultiPoint"&&pe++}se==="LineString"&&pe++;break;case"Polygon":case"MultiLineString":for(F=0;F<ut.length;F++){for(pt=0;pt<ut[F].length-tt;pt++){if(gt(ut[F][pt],Ut,Qt,pe,be)===!1)return!1;Ut++}se==="MultiLineString"&&pe++,se==="Polygon"&&be++}se==="Polygon"&&pe++;break;case"MultiPolygon":for(F=0;F<ut.length;F++){for(be=0,pt=0;pt<ut[F].length;pt++){for(ht=0;ht<ut[F][pt].length-tt;ht++){if(gt(ut[F][pt][ht],Ut,Qt,pe,be)===!1)return!1;Ut++}be++}pe++}break;case"GeometryCollection":for(F=0;F<mt.geometries.length;F++)if(at(mt.geometries[F],gt,lt)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function dt(yt,gt){var lt;switch(yt.type){case"FeatureCollection":for(lt=0;lt<yt.features.length&&gt(yt.features[lt].properties,lt)!==!1;lt++);break;case"Feature":gt(yt.properties,0)}}function et(yt,gt){if(yt.type==="Feature")gt(yt,0);else if(yt.type==="FeatureCollection")for(var lt=0;lt<yt.features.length&&gt(yt.features[lt],lt)!==!1;lt++);}function _t(yt,gt){var lt,F,pt,ht,mt,bt,ut,Mt,st,tt,Ut=0,nt=yt.type==="FeatureCollection",ue=yt.type==="Feature",re=nt?yt.features.length:1;for(lt=0;lt<re;lt++){for(bt=nt?yt.features[lt].geometry:ue?yt.geometry:yt,Mt=nt?yt.features[lt].properties:ue?yt.properties:{},st=nt?yt.features[lt].bbox:ue?yt.bbox:void 0,tt=nt?yt.features[lt].id:ue?yt.id:void 0,mt=(ut=!!bt&&bt.type==="GeometryCollection")?bt.geometries.length:1,pt=0;pt<mt;pt++)if((ht=ut?bt.geometries[pt]:bt)!==null)switch(ht.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(gt(ht,Ut,Mt,st,tt)===!1)return!1;break;case"GeometryCollection":for(F=0;F<ht.geometries.length;F++)if(gt(ht.geometries[F],Ut,Mt,st,tt)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}else if(gt(null,Ut,Mt,st,tt)===!1)return!1;Ut++}}function rt(yt,gt){_t(yt,function(lt,F,pt,ht,mt){var bt,ut=lt===null?null:lt.type;switch(ut){case null:case"Point":case"LineString":case"Polygon":return gt(ft.feature(lt,pt,{bbox:ht,id:mt}),F,0)!==!1&&void 0}switch(ut){case"MultiPoint":bt="Point";break;case"MultiLineString":bt="LineString";break;case"MultiPolygon":bt="Polygon"}for(var Mt=0;Mt<lt.coordinates.length;Mt++){var st={type:bt,coordinates:lt.coordinates[Mt]};if(gt(ft.feature(st,pt),F,Mt)===!1)return!1}})}function Pt(yt,gt){rt(yt,function(lt,F,pt){var ht=0;if(lt.geometry){var mt=lt.geometry.type;if(mt!=="Point"&&mt!=="MultiPoint"){var bt,ut=0,Mt=0,st=0;return at(lt,function(tt,Ut,nt,ue,re){if(bt===void 0||F>ut||ue>Mt||re>st)return bt=tt,ut=F,Mt=ue,st=re,void(ht=0);var ee=ft.lineString([bt,tt],lt.properties);if(gt(ee,F,pt,re,ht)===!1)return!1;ht++,bt=tt})!==!1&&void 0}}})}function St(yt,gt){if(!yt)throw new Error("geojson is required");rt(yt,function(lt,F,pt){if(lt.geometry!==null){var ht=lt.geometry.type,mt=lt.geometry.coordinates;switch(ht){case"LineString":if(gt(lt,F,pt,0,0)===!1)return!1;break;case"Polygon":for(var bt=0;bt<mt.length;bt++)if(gt(ft.lineString(mt[bt],lt.properties),F,pt,bt)===!1)return!1}}})}At.coordAll=function(yt){var gt=[];return at(yt,function(lt){gt.push(lt)}),gt},At.coordEach=at,At.coordReduce=function(yt,gt,lt,F){var pt=lt;return at(yt,function(ht,mt,bt,ut,Mt){pt=mt===0&&lt===void 0?ht:gt(pt,ht,mt,bt,ut,Mt)},F),pt},At.featureEach=et,At.featureReduce=function(yt,gt,lt){var F=lt;return et(yt,function(pt,ht){F=ht===0&&lt===void 0?pt:gt(F,pt,ht)}),F},At.findPoint=function(yt,gt){if(gt=gt||{},!ft.isObject(gt))throw new Error("options is invalid");var lt,F=gt.featureIndex||0,pt=gt.multiFeatureIndex||0,ht=gt.geometryIndex||0,mt=gt.coordIndex||0,bt=gt.properties;switch(yt.type){case"FeatureCollection":F<0&&(F=yt.features.length+F),bt=bt||yt.features[F].properties,lt=yt.features[F].geometry;break;case"Feature":bt=bt||yt.properties,lt=yt.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":lt=yt;break;default:throw new Error("geojson is invalid")}if(lt===null)return null;var ut=lt.coordinates;switch(lt.type){case"Point":return ft.point(ut,bt,gt);case"MultiPoint":return pt<0&&(pt=ut.length+pt),ft.point(ut[pt],bt,gt);case"LineString":return mt<0&&(mt=ut.length+mt),ft.point(ut[mt],bt,gt);case"Polygon":return ht<0&&(ht=ut.length+ht),mt<0&&(mt=ut[ht].length+mt),ft.point(ut[ht][mt],bt,gt);case"MultiLineString":return pt<0&&(pt=ut.length+pt),mt<0&&(mt=ut[pt].length+mt),ft.point(ut[pt][mt],bt,gt);case"MultiPolygon":return pt<0&&(pt=ut.length+pt),ht<0&&(ht=ut[pt].length+ht),mt<0&&(mt=ut[pt][ht].length-mt),ft.point(ut[pt][ht][mt],bt,gt)}throw new Error("geojson is invalid")},At.findSegment=function(yt,gt){if(gt=gt||{},!ft.isObject(gt))throw new Error("options is invalid");var lt,F=gt.featureIndex||0,pt=gt.multiFeatureIndex||0,ht=gt.geometryIndex||0,mt=gt.segmentIndex||0,bt=gt.properties;switch(yt.type){case"FeatureCollection":F<0&&(F=yt.features.length+F),bt=bt||yt.features[F].properties,lt=yt.features[F].geometry;break;case"Feature":bt=bt||yt.properties,lt=yt.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":lt=yt;break;default:throw new Error("geojson is invalid")}if(lt===null)return null;var ut=lt.coordinates;switch(lt.type){case"Point":case"MultiPoint":return null;case"LineString":return mt<0&&(mt=ut.length+mt-1),ft.lineString([ut[mt],ut[mt+1]],bt,gt);case"Polygon":return ht<0&&(ht=ut.length+ht),mt<0&&(mt=ut[ht].length+mt-1),ft.lineString([ut[ht][mt],ut[ht][mt+1]],bt,gt);case"MultiLineString":return pt<0&&(pt=ut.length+pt),mt<0&&(mt=ut[pt].length+mt-1),ft.lineString([ut[pt][mt],ut[pt][mt+1]],bt,gt);case"MultiPolygon":return pt<0&&(pt=ut.length+pt),ht<0&&(ht=ut[pt].length+ht),mt<0&&(mt=ut[pt][ht].length-mt-1),ft.lineString([ut[pt][ht][mt],ut[pt][ht][mt+1]],bt,gt)}throw new Error("geojson is invalid")},At.flattenEach=rt,At.flattenReduce=function(yt,gt,lt){var F=lt;return rt(yt,function(pt,ht,mt){F=ht===0&&mt===0&&lt===void 0?pt:gt(F,pt,ht,mt)}),F},At.geomEach=_t,At.geomReduce=function(yt,gt,lt){var F=lt;return _t(yt,function(pt,ht,mt,bt,ut){F=ht===0&&lt===void 0?pt:gt(F,pt,ht,mt,bt,ut)}),F},At.lineEach=St,At.lineReduce=function(yt,gt,lt){var F=lt;return St(yt,function(pt,ht,mt,bt){F=ht===0&&lt===void 0?pt:gt(F,pt,ht,mt,bt)}),F},At.propEach=dt,At.propReduce=function(yt,gt,lt){var F=lt;return dt(yt,function(pt,ht){F=ht===0&&lt===void 0?pt:gt(F,pt,ht)}),F},At.segmentEach=Pt,At.segmentReduce=function(yt,gt,lt){var F=lt,pt=!1;return Pt(yt,function(ht,mt,bt,ut,Mt){F=pt===!1&&lt===void 0?ht:gt(F,ht,mt,bt,ut,Mt),pt=!0}),F}},246:(I,At,Nt)=>{var ft=Nt(485),at=Nt(484),dt=Nt(277),et=Nt(616).Z,_t=dt.featureEach,rt=(dt.coordEach,at.polygon,at.featureCollection);function Pt(St){var yt=new ft(St);return yt.insert=function(gt){if(gt.type!=="Feature")throw new Error("invalid feature");return gt.bbox=gt.bbox?gt.bbox:et(gt),ft.prototype.insert.call(this,gt)},yt.load=function(gt){var lt=[];return Array.isArray(gt)?gt.forEach(function(F){if(F.type!=="Feature")throw new Error("invalid features");F.bbox=F.bbox?F.bbox:et(F),lt.push(F)}):_t(gt,function(F){if(F.type!=="Feature")throw new Error("invalid features");F.bbox=F.bbox?F.bbox:et(F),lt.push(F)}),ft.prototype.load.call(this,lt)},yt.remove=function(gt,lt){if(gt.type!=="Feature")throw new Error("invalid feature");return gt.bbox=gt.bbox?gt.bbox:et(gt),ft.prototype.remove.call(this,gt,lt)},yt.clear=function(){return ft.prototype.clear.call(this)},yt.search=function(gt){var lt=ft.prototype.search.call(this,this.toBBox(gt));return rt(lt)},yt.collides=function(gt){return ft.prototype.collides.call(this,this.toBBox(gt))},yt.all=function(){var gt=ft.prototype.all.call(this);return rt(gt)},yt.toJSON=function(){return ft.prototype.toJSON.call(this)},yt.fromJSON=function(gt){return ft.prototype.fromJSON.call(this,gt)},yt.toBBox=function(gt){var lt;if(gt.bbox)lt=gt.bbox;else if(Array.isArray(gt)&&gt.length===4)lt=gt;else if(Array.isArray(gt)&&gt.length===6)lt=[gt[0],gt[1],gt[3],gt[4]];else if(gt.type==="Feature")lt=et(gt);else{if(gt.type!=="FeatureCollection")throw new Error("invalid geojson");lt=et(gt)}return{minX:lt[0],minY:lt[1],maxX:lt[2],maxY:lt[3]}},yt}I.exports=Pt,I.exports.default=Pt},378:(I,At,Nt)=>{I.exports=function ft(at,dt,et){function _t(St,yt){if(!dt[St]){if(!at[St]){if(!yt&&Nt(921))return commonjsRequire(St);if(rt)return rt(St,!0);var gt=new Error("Cannot find module '"+St+"'");throw gt.code="MODULE_NOT_FOUND",gt}var lt=dt[St]={exports:{}};at[St][0].call(lt.exports,function(F){return _t(at[St][1][F]||F)},lt,lt.exports,ft,at,dt,et)}return dt[St].exports}for(var rt=void 0,Pt=0;Pt<et.length;Pt++)_t(et[Pt]);return _t}({1:[function(ft,at,dt){var et=ft("./utils"),_t=ft("./support"),rt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";dt.encode=function(Pt){for(var St,yt,gt,lt,F,pt,ht,mt=[],bt=0,ut=Pt.length,Mt=ut,st=et.getTypeOf(Pt)!=="string";bt<Pt.length;)Mt=ut-bt,gt=st?(St=Pt[bt++],yt=bt<ut?Pt[bt++]:0,bt<ut?Pt[bt++]:0):(St=Pt.charCodeAt(bt++),yt=bt<ut?Pt.charCodeAt(bt++):0,bt<ut?Pt.charCodeAt(bt++):0),lt=St>>2,F=(3&St)<<4|yt>>4,pt=1<Mt?(15&yt)<<2|gt>>6:64,ht=2<Mt?63&gt:64,mt.push(rt.charAt(lt)+rt.charAt(F)+rt.charAt(pt)+rt.charAt(ht));return mt.join("")},dt.decode=function(Pt){var St,yt,gt,lt,F,pt,ht=0,mt=0,bt="data:";if(Pt.substr(0,5)===bt)throw new Error("Invalid base64 input, it looks like a data url.");var ut,Mt=3*(Pt=Pt.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(Pt.charAt(Pt.length-1)===rt.charAt(64)&&Mt--,Pt.charAt(Pt.length-2)===rt.charAt(64)&&Mt--,Mt%1!=0)throw new Error("Invalid base64 input, bad content length.");for(ut=_t.uint8array?new Uint8Array(0|Mt):new Array(0|Mt);ht<Pt.length;)St=rt.indexOf(Pt.charAt(ht++))<<2|(lt=rt.indexOf(Pt.charAt(ht++)))>>4,yt=(15&lt)<<4|(F=rt.indexOf(Pt.charAt(ht++)))>>2,gt=(3&F)<<6|(pt=rt.indexOf(Pt.charAt(ht++))),ut[mt++]=St,F!==64&&(ut[mt++]=yt),pt!==64&&(ut[mt++]=gt);return ut}},{"./support":30,"./utils":32}],2:[function(ft,at,dt){var et=ft("./external"),_t=ft("./stream/DataWorker"),rt=ft("./stream/Crc32Probe"),Pt=ft("./stream/DataLengthProbe");function St(yt,gt,lt,F,pt){this.compressedSize=yt,this.uncompressedSize=gt,this.crc32=lt,this.compression=F,this.compressedContent=pt}St.prototype={getContentWorker:function(){var yt=new _t(et.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new Pt("data_length")),gt=this;return yt.on("end",function(){if(this.streamInfo.data_length!==gt.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),yt},getCompressedWorker:function(){return new _t(et.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},St.createWorkerFrom=function(yt,gt,lt){return yt.pipe(new rt).pipe(new Pt("uncompressedSize")).pipe(gt.compressWorker(lt)).pipe(new Pt("compressedSize")).withStreamInfo("compression",gt)},at.exports=St},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(ft,at,dt){var et=ft("./stream/GenericWorker");dt.STORE={magic:"\0\0",compressWorker:function(){return new et("STORE compression")},uncompressWorker:function(){return new et("STORE decompression")}},dt.DEFLATE=ft("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(ft,at,dt){var et=ft("./utils"),_t=function(){for(var rt,Pt=[],St=0;St<256;St++){rt=St;for(var yt=0;yt<8;yt++)rt=1&rt?3988292384^rt>>>1:rt>>>1;Pt[St]=rt}return Pt}();at.exports=function(rt,Pt){return rt!==void 0&&rt.length?et.getTypeOf(rt)!=="string"?function(St,yt,gt,lt){var F=_t,pt=0+gt;St^=-1;for(var ht=0;ht<pt;ht++)St=St>>>8^F[255&(St^yt[ht])];return-1^St}(0|Pt,rt,rt.length):function(St,yt,gt,lt){var F=_t,pt=0+gt;St^=-1;for(var ht=0;ht<pt;ht++)St=St>>>8^F[255&(St^yt.charCodeAt(ht))];return-1^St}(0|Pt,rt,rt.length):0}},{"./utils":32}],5:[function(ft,at,dt){dt.base64=!1,dt.binary=!1,dt.dir=!1,dt.createFolders=!0,dt.date=null,dt.compression=null,dt.compressionOptions=null,dt.comment=null,dt.unixPermissions=null,dt.dosPermissions=null},{}],6:[function(ft,at,dt){var et;et=typeof Promise<"u"?Promise:ft("lie"),at.exports={Promise:et}},{lie:37}],7:[function(ft,at,dt){var et=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",_t=ft("pako"),rt=ft("./utils"),Pt=ft("./stream/GenericWorker"),St=et?"uint8array":"array";function yt(gt,lt){Pt.call(this,"FlateWorker/"+gt),this._pako=null,this._pakoAction=gt,this._pakoOptions=lt,this.meta={}}dt.magic="\b\0",rt.inherits(yt,Pt),yt.prototype.processChunk=function(gt){this.meta=gt.meta,this._pako===null&&this._createPako(),this._pako.push(rt.transformTo(St,gt.data),!1)},yt.prototype.flush=function(){Pt.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},yt.prototype.cleanUp=function(){Pt.prototype.cleanUp.call(this),this._pako=null},yt.prototype._createPako=function(){this._pako=new _t[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var gt=this;this._pako.onData=function(lt){gt.push({data:lt,meta:gt.meta})}},dt.compressWorker=function(gt){return new yt("Deflate",gt)},dt.uncompressWorker=function(){return new yt("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(ft,at,dt){function et(F,pt){var ht,mt="";for(ht=0;ht<pt;ht++)mt+=String.fromCharCode(255&F),F>>>=8;return mt}function _t(F,pt,ht,mt,bt,ut){var Mt,st,tt=F.file,Ut=F.compression,nt=ut!==St.utf8encode,ue=rt.transformTo("string",ut(tt.name)),re=rt.transformTo("string",St.utf8encode(tt.name)),ee=tt.comment,Qt=rt.transformTo("string",ut(ee)),Lt=rt.transformTo("string",St.utf8encode(ee)),pe=re.length!==tt.name.length,be=Lt.length!==ee.length,se="",Fe="",Pe="",It=tt.dir,Rt=tt.date,Jt={crc32:0,compressedSize:0,uncompressedSize:0};pt&&!ht||(Jt.crc32=F.crc32,Jt.compressedSize=F.compressedSize,Jt.uncompressedSize=F.uncompressedSize);var Yt=0;pt&&(Yt|=8),nt||!pe&&!be||(Yt|=2048);var Te=0,me=0;It&&(Te|=16),bt==="UNIX"?(me=798,Te|=function(Ge,Tt){var Vt=Ge;return Ge||(Vt=Tt?16893:33204),(65535&Vt)<<16}(tt.unixPermissions,It)):(me=20,Te|=function(Ge){return 63&(Ge||0)}(tt.dosPermissions)),Mt=Rt.getUTCHours(),Mt<<=6,Mt|=Rt.getUTCMinutes(),Mt<<=5,Mt|=Rt.getUTCSeconds()/2,st=Rt.getUTCFullYear()-1980,st<<=4,st|=Rt.getUTCMonth()+1,st<<=5,st|=Rt.getUTCDate(),pe&&(Fe=et(1,1)+et(yt(ue),4)+re,se+="up"+et(Fe.length,2)+Fe),be&&(Pe=et(1,1)+et(yt(Qt),4)+Lt,se+="uc"+et(Pe.length,2)+Pe);var De="";return De+=`
\0`,De+=et(Yt,2),De+=Ut.magic,De+=et(Mt,2),De+=et(st,2),De+=et(Jt.crc32,4),De+=et(Jt.compressedSize,4),De+=et(Jt.uncompressedSize,4),De+=et(ue.length,2),De+=et(se.length,2),{fileRecord:gt.LOCAL_FILE_HEADER+De+ue+se,dirRecord:gt.CENTRAL_FILE_HEADER+et(me,2)+De+et(Qt.length,2)+"\0\0\0\0"+et(Te,4)+et(mt,4)+ue+se+Qt}}var rt=ft("../utils"),Pt=ft("../stream/GenericWorker"),St=ft("../utf8"),yt=ft("../crc32"),gt=ft("../signature");function lt(F,pt,ht,mt){Pt.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=pt,this.zipPlatform=ht,this.encodeFileName=mt,this.streamFiles=F,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}rt.inherits(lt,Pt),lt.prototype.push=function(F){var pt=F.meta.percent||0,ht=this.entriesCount,mt=this._sources.length;this.accumulate?this.contentBuffer.push(F):(this.bytesWritten+=F.data.length,Pt.prototype.push.call(this,{data:F.data,meta:{currentFile:this.currentFile,percent:ht?(pt+100*(ht-mt-1))/ht:100}}))},lt.prototype.openedSource=function(F){this.currentSourceOffset=this.bytesWritten,this.currentFile=F.file.name;var pt=this.streamFiles&&!F.file.dir;if(pt){var ht=_t(F,pt,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:ht.fileRecord,meta:{percent:0}})}else this.accumulate=!0},lt.prototype.closedSource=function(F){this.accumulate=!1;var pt=this.streamFiles&&!F.file.dir,ht=_t(F,pt,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(ht.dirRecord),pt)this.push({data:function(mt){return gt.DATA_DESCRIPTOR+et(mt.crc32,4)+et(mt.compressedSize,4)+et(mt.uncompressedSize,4)}(F),meta:{percent:100}});else for(this.push({data:ht.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},lt.prototype.flush=function(){for(var F=this.bytesWritten,pt=0;pt<this.dirRecords.length;pt++)this.push({data:this.dirRecords[pt],meta:{percent:100}});var ht=this.bytesWritten-F,mt=function(bt,ut,Mt,st,tt){var Ut=rt.transformTo("string",tt(st));return gt.CENTRAL_DIRECTORY_END+"\0\0\0\0"+et(bt,2)+et(bt,2)+et(ut,4)+et(Mt,4)+et(Ut.length,2)+Ut}(this.dirRecords.length,ht,F,this.zipComment,this.encodeFileName);this.push({data:mt,meta:{percent:100}})},lt.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},lt.prototype.registerPrevious=function(F){this._sources.push(F);var pt=this;return F.on("data",function(ht){pt.processChunk(ht)}),F.on("end",function(){pt.closedSource(pt.previous.streamInfo),pt._sources.length?pt.prepareNextSource():pt.end()}),F.on("error",function(ht){pt.error(ht)}),this},lt.prototype.resume=function(){return!!Pt.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},lt.prototype.error=function(F){var pt=this._sources;if(!Pt.prototype.error.call(this,F))return!1;for(var ht=0;ht<pt.length;ht++)try{pt[ht].error(F)}catch{}return!0},lt.prototype.lock=function(){Pt.prototype.lock.call(this);for(var F=this._sources,pt=0;pt<F.length;pt++)F[pt].lock()},at.exports=lt},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(ft,at,dt){var et=ft("../compressions"),_t=ft("./ZipFileWorker");dt.generateWorker=function(rt,Pt,St){var yt=new _t(Pt.streamFiles,St,Pt.platform,Pt.encodeFileName),gt=0;try{rt.forEach(function(lt,F){gt++;var pt=function(ut,Mt){var st=ut||Mt,tt=et[st];if(!tt)throw new Error(st+" is not a valid compression method !");return tt}(F.options.compression,Pt.compression),ht=F.options.compressionOptions||Pt.compressionOptions||{},mt=F.dir,bt=F.date;F._compressWorker(pt,ht).withStreamInfo("file",{name:lt,dir:mt,date:bt,comment:F.comment||"",unixPermissions:F.unixPermissions,dosPermissions:F.dosPermissions}).pipe(yt)}),yt.entriesCount=gt}catch(lt){yt.error(lt)}return yt}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(ft,at,dt){function et(){if(!(this instanceof et))return new et;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var _t=new et;for(var rt in this)typeof this[rt]!="function"&&(_t[rt]=this[rt]);return _t}}(et.prototype=ft("./object")).loadAsync=ft("./load"),et.support=ft("./support"),et.defaults=ft("./defaults"),et.version="3.10.1",et.loadAsync=function(_t,rt){return new et().loadAsync(_t,rt)},et.external=ft("./external"),at.exports=et},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(ft,at,dt){var et=ft("./utils"),_t=ft("./external"),rt=ft("./utf8"),Pt=ft("./zipEntries"),St=ft("./stream/Crc32Probe"),yt=ft("./nodejsUtils");function gt(lt){return new _t.Promise(function(F,pt){var ht=lt.decompressed.getContentWorker().pipe(new St);ht.on("error",function(mt){pt(mt)}).on("end",function(){ht.streamInfo.crc32!==lt.decompressed.crc32?pt(new Error("Corrupted zip : CRC32 mismatch")):F()}).resume()})}at.exports=function(lt,F){var pt=this;return F=et.extend(F||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:rt.utf8decode}),yt.isNode&&yt.isStream(lt)?_t.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):et.prepareContent("the loaded zip file",lt,!0,F.optimizedBinaryString,F.base64).then(function(ht){var mt=new Pt(F);return mt.load(ht),mt}).then(function(ht){var mt=[_t.Promise.resolve(ht)],bt=ht.files;if(F.checkCRC32)for(var ut=0;ut<bt.length;ut++)mt.push(gt(bt[ut]));return _t.Promise.all(mt)}).then(function(ht){for(var mt=ht.shift(),bt=mt.files,ut=0;ut<bt.length;ut++){var Mt=bt[ut],st=Mt.fileNameStr,tt=et.resolve(Mt.fileNameStr);pt.file(tt,Mt.decompressed,{binary:!0,optimizedBinaryString:!0,date:Mt.date,dir:Mt.dir,comment:Mt.fileCommentStr.length?Mt.fileCommentStr:null,unixPermissions:Mt.unixPermissions,dosPermissions:Mt.dosPermissions,createFolders:F.createFolders}),Mt.dir||(pt.file(tt).unsafeOriginalName=st)}return mt.zipComment.length&&(pt.comment=mt.zipComment),pt})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(ft,at,dt){var et=ft("../utils"),_t=ft("../stream/GenericWorker");function rt(Pt,St){_t.call(this,"Nodejs stream input adapter for "+Pt),this._upstreamEnded=!1,this._bindStream(St)}et.inherits(rt,_t),rt.prototype._bindStream=function(Pt){var St=this;(this._stream=Pt).pause(),Pt.on("data",function(yt){St.push({data:yt,meta:{percent:0}})}).on("error",function(yt){St.isPaused?this.generatedError=yt:St.error(yt)}).on("end",function(){St.isPaused?St._upstreamEnded=!0:St.end()})},rt.prototype.pause=function(){return!!_t.prototype.pause.call(this)&&(this._stream.pause(),!0)},rt.prototype.resume=function(){return!!_t.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},at.exports=rt},{"../stream/GenericWorker":28,"../utils":32}],13:[function(ft,at,dt){var et=ft("readable-stream").Readable;function _t(rt,Pt,St){et.call(this,Pt),this._helper=rt;var yt=this;rt.on("data",function(gt,lt){yt.push(gt)||yt._helper.pause(),St&&St(lt)}).on("error",function(gt){yt.emit("error",gt)}).on("end",function(){yt.push(null)})}ft("../utils").inherits(_t,et),_t.prototype._read=function(){this._helper.resume()},at.exports=_t},{"../utils":32,"readable-stream":16}],14:[function(ft,at,dt){at.exports={isNode:typeof Buffer<"u",newBufferFrom:function(et,_t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(et,_t);if(typeof et=="number")throw new Error('The "data" argument must not be a number');return new Buffer(et,_t)},allocBuffer:function(et){if(Buffer.alloc)return Buffer.alloc(et);var _t=new Buffer(et);return _t.fill(0),_t},isBuffer:function(et){return Buffer.isBuffer(et)},isStream:function(et){return et&&typeof et.on=="function"&&typeof et.pause=="function"&&typeof et.resume=="function"}}},{}],15:[function(ft,at,dt){function et(tt,Ut,nt){var ue,re=rt.getTypeOf(Ut),ee=rt.extend(nt||{},yt);ee.date=ee.date||new Date,ee.compression!==null&&(ee.compression=ee.compression.toUpperCase()),typeof ee.unixPermissions=="string"&&(ee.unixPermissions=parseInt(ee.unixPermissions,8)),ee.unixPermissions&&16384&ee.unixPermissions&&(ee.dir=!0),ee.dosPermissions&&16&ee.dosPermissions&&(ee.dir=!0),ee.dir&&(tt=bt(tt)),ee.createFolders&&(ue=mt(tt))&&ut.call(this,ue,!0);var Qt=re==="string"&&ee.binary===!1&&ee.base64===!1;nt&&nt.binary!==void 0||(ee.binary=!Qt),(Ut instanceof gt&&Ut.uncompressedSize===0||ee.dir||!Ut||Ut.length===0)&&(ee.base64=!1,ee.binary=!0,Ut="",ee.compression="STORE",re="string");var Lt;Lt=Ut instanceof gt||Ut instanceof Pt?Ut:pt.isNode&&pt.isStream(Ut)?new ht(tt,Ut):rt.prepareContent(tt,Ut,ee.binary,ee.optimizedBinaryString,ee.base64);var pe=new lt(tt,Lt,ee);this.files[tt]=pe}var _t=ft("./utf8"),rt=ft("./utils"),Pt=ft("./stream/GenericWorker"),St=ft("./stream/StreamHelper"),yt=ft("./defaults"),gt=ft("./compressedObject"),lt=ft("./zipObject"),F=ft("./generate"),pt=ft("./nodejsUtils"),ht=ft("./nodejs/NodejsStreamInputAdapter"),mt=function(tt){tt.slice(-1)==="/"&&(tt=tt.substring(0,tt.length-1));var Ut=tt.lastIndexOf("/");return 0<Ut?tt.substring(0,Ut):""},bt=function(tt){return tt.slice(-1)!=="/"&&(tt+="/"),tt},ut=function(tt,Ut){return Ut=Ut!==void 0?Ut:yt.createFolders,tt=bt(tt),this.files[tt]||et.call(this,tt,null,{dir:!0,createFolders:Ut}),this.files[tt]};function Mt(tt){return Object.prototype.toString.call(tt)==="[object RegExp]"}var st={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(tt){var Ut,nt,ue;for(Ut in this.files)ue=this.files[Ut],(nt=Ut.slice(this.root.length,Ut.length))&&Ut.slice(0,this.root.length)===this.root&&tt(nt,ue)},filter:function(tt){var Ut=[];return this.forEach(function(nt,ue){tt(nt,ue)&&Ut.push(ue)}),Ut},file:function(tt,Ut,nt){if(arguments.length!==1)return tt=this.root+tt,et.call(this,tt,Ut,nt),this;if(Mt(tt)){var ue=tt;return this.filter(function(ee,Qt){return!Qt.dir&&ue.test(ee)})}var re=this.files[this.root+tt];return re&&!re.dir?re:null},folder:function(tt){if(!tt)return this;if(Mt(tt))return this.filter(function(re,ee){return ee.dir&&tt.test(re)});var Ut=this.root+tt,nt=ut.call(this,Ut),ue=this.clone();return ue.root=nt.name,ue},remove:function(tt){tt=this.root+tt;var Ut=this.files[tt];if(Ut||(tt.slice(-1)!=="/"&&(tt+="/"),Ut=this.files[tt]),Ut&&!Ut.dir)delete this.files[tt];else for(var nt=this.filter(function(re,ee){return ee.name.slice(0,tt.length)===tt}),ue=0;ue<nt.length;ue++)delete this.files[nt[ue].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(tt){var Ut,nt={};try{if((nt=rt.extend(tt||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:_t.utf8encode})).type=nt.type.toLowerCase(),nt.compression=nt.compression.toUpperCase(),nt.type==="binarystring"&&(nt.type="string"),!nt.type)throw new Error("No output type specified.");rt.checkSupport(nt.type),nt.platform!=="darwin"&&nt.platform!=="freebsd"&&nt.platform!=="linux"&&nt.platform!=="sunos"||(nt.platform="UNIX"),nt.platform==="win32"&&(nt.platform="DOS");var ue=nt.comment||this.comment||"";Ut=F.generateWorker(this,nt,ue)}catch(re){(Ut=new Pt("error")).error(re)}return new St(Ut,nt.type||"string",nt.mimeType)},generateAsync:function(tt,Ut){return this.generateInternalStream(tt).accumulate(Ut)},generateNodeStream:function(tt,Ut){return(tt=tt||{}).type||(tt.type="nodebuffer"),this.generateInternalStream(tt).toNodejsStream(Ut)}};at.exports=st},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(ft,at,dt){at.exports=ft("stream")},{stream:void 0}],17:[function(ft,at,dt){var et=ft("./DataReader");function _t(rt){et.call(this,rt);for(var Pt=0;Pt<this.data.length;Pt++)rt[Pt]=255&rt[Pt]}ft("../utils").inherits(_t,et),_t.prototype.byteAt=function(rt){return this.data[this.zero+rt]},_t.prototype.lastIndexOfSignature=function(rt){for(var Pt=rt.charCodeAt(0),St=rt.charCodeAt(1),yt=rt.charCodeAt(2),gt=rt.charCodeAt(3),lt=this.length-4;0<=lt;--lt)if(this.data[lt]===Pt&&this.data[lt+1]===St&&this.data[lt+2]===yt&&this.data[lt+3]===gt)return lt-this.zero;return-1},_t.prototype.readAndCheckSignature=function(rt){var Pt=rt.charCodeAt(0),St=rt.charCodeAt(1),yt=rt.charCodeAt(2),gt=rt.charCodeAt(3),lt=this.readData(4);return Pt===lt[0]&&St===lt[1]&&yt===lt[2]&&gt===lt[3]},_t.prototype.readData=function(rt){if(this.checkOffset(rt),rt===0)return[];var Pt=this.data.slice(this.zero+this.index,this.zero+this.index+rt);return this.index+=rt,Pt},at.exports=_t},{"../utils":32,"./DataReader":18}],18:[function(ft,at,dt){var et=ft("../utils");function _t(rt){this.data=rt,this.length=rt.length,this.index=0,this.zero=0}_t.prototype={checkOffset:function(rt){this.checkIndex(this.index+rt)},checkIndex:function(rt){if(this.length<this.zero+rt||rt<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+rt+"). Corrupted zip ?")},setIndex:function(rt){this.checkIndex(rt),this.index=rt},skip:function(rt){this.setIndex(this.index+rt)},byteAt:function(){},readInt:function(rt){var Pt,St=0;for(this.checkOffset(rt),Pt=this.index+rt-1;Pt>=this.index;Pt--)St=(St<<8)+this.byteAt(Pt);return this.index+=rt,St},readString:function(rt){return et.transformTo("string",this.readData(rt))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var rt=this.readInt(4);return new Date(Date.UTC(1980+(rt>>25&127),(rt>>21&15)-1,rt>>16&31,rt>>11&31,rt>>5&63,(31&rt)<<1))}},at.exports=_t},{"../utils":32}],19:[function(ft,at,dt){var et=ft("./Uint8ArrayReader");function _t(rt){et.call(this,rt)}ft("../utils").inherits(_t,et),_t.prototype.readData=function(rt){this.checkOffset(rt);var Pt=this.data.slice(this.zero+this.index,this.zero+this.index+rt);return this.index+=rt,Pt},at.exports=_t},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(ft,at,dt){var et=ft("./DataReader");function _t(rt){et.call(this,rt)}ft("../utils").inherits(_t,et),_t.prototype.byteAt=function(rt){return this.data.charCodeAt(this.zero+rt)},_t.prototype.lastIndexOfSignature=function(rt){return this.data.lastIndexOf(rt)-this.zero},_t.prototype.readAndCheckSignature=function(rt){return rt===this.readData(4)},_t.prototype.readData=function(rt){this.checkOffset(rt);var Pt=this.data.slice(this.zero+this.index,this.zero+this.index+rt);return this.index+=rt,Pt},at.exports=_t},{"../utils":32,"./DataReader":18}],21:[function(ft,at,dt){var et=ft("./ArrayReader");function _t(rt){et.call(this,rt)}ft("../utils").inherits(_t,et),_t.prototype.readData=function(rt){if(this.checkOffset(rt),rt===0)return new Uint8Array(0);var Pt=this.data.subarray(this.zero+this.index,this.zero+this.index+rt);return this.index+=rt,Pt},at.exports=_t},{"../utils":32,"./ArrayReader":17}],22:[function(ft,at,dt){var et=ft("../utils"),_t=ft("../support"),rt=ft("./ArrayReader"),Pt=ft("./StringReader"),St=ft("./NodeBufferReader"),yt=ft("./Uint8ArrayReader");at.exports=function(gt){var lt=et.getTypeOf(gt);return et.checkSupport(lt),lt!=="string"||_t.uint8array?lt==="nodebuffer"?new St(gt):_t.uint8array?new yt(et.transformTo("uint8array",gt)):new rt(et.transformTo("array",gt)):new Pt(gt)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(ft,at,dt){dt.LOCAL_FILE_HEADER="PK",dt.CENTRAL_FILE_HEADER="PK",dt.CENTRAL_DIRECTORY_END="PK",dt.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",dt.ZIP64_CENTRAL_DIRECTORY_END="PK",dt.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(ft,at,dt){var et=ft("./GenericWorker"),_t=ft("../utils");function rt(Pt){et.call(this,"ConvertWorker to "+Pt),this.destType=Pt}_t.inherits(rt,et),rt.prototype.processChunk=function(Pt){this.push({data:_t.transformTo(this.destType,Pt.data),meta:Pt.meta})},at.exports=rt},{"../utils":32,"./GenericWorker":28}],25:[function(ft,at,dt){var et=ft("./GenericWorker"),_t=ft("../crc32");function rt(){et.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}ft("../utils").inherits(rt,et),rt.prototype.processChunk=function(Pt){this.streamInfo.crc32=_t(Pt.data,this.streamInfo.crc32||0),this.push(Pt)},at.exports=rt},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(ft,at,dt){var et=ft("../utils"),_t=ft("./GenericWorker");function rt(Pt){_t.call(this,"DataLengthProbe for "+Pt),this.propName=Pt,this.withStreamInfo(Pt,0)}et.inherits(rt,_t),rt.prototype.processChunk=function(Pt){if(Pt){var St=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=St+Pt.data.length}_t.prototype.processChunk.call(this,Pt)},at.exports=rt},{"../utils":32,"./GenericWorker":28}],27:[function(ft,at,dt){var et=ft("../utils"),_t=ft("./GenericWorker");function rt(Pt){_t.call(this,"DataWorker");var St=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,Pt.then(function(yt){St.dataIsReady=!0,St.data=yt,St.max=yt&&yt.length||0,St.type=et.getTypeOf(yt),St.isPaused||St._tickAndRepeat()},function(yt){St.error(yt)})}et.inherits(rt,_t),rt.prototype.cleanUp=function(){_t.prototype.cleanUp.call(this),this.data=null},rt.prototype.resume=function(){return!!_t.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,et.delay(this._tickAndRepeat,[],this)),!0)},rt.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(et.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},rt.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var Pt=null,St=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":Pt=this.data.substring(this.index,St);break;case"uint8array":Pt=this.data.subarray(this.index,St);break;case"array":case"nodebuffer":Pt=this.data.slice(this.index,St)}return this.index=St,this.push({data:Pt,meta:{percent:this.max?this.index/this.max*100:0}})},at.exports=rt},{"../utils":32,"./GenericWorker":28}],28:[function(ft,at,dt){function et(_t){this.name=_t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}et.prototype={push:function(_t){this.emit("data",_t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(_t){this.emit("error",_t)}return!0},error:function(_t){return!this.isFinished&&(this.isPaused?this.generatedError=_t:(this.isFinished=!0,this.emit("error",_t),this.previous&&this.previous.error(_t),this.cleanUp()),!0)},on:function(_t,rt){return this._listeners[_t].push(rt),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(_t,rt){if(this._listeners[_t])for(var Pt=0;Pt<this._listeners[_t].length;Pt++)this._listeners[_t][Pt].call(this,rt)},pipe:function(_t){return _t.registerPrevious(this)},registerPrevious:function(_t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=_t.streamInfo,this.mergeStreamInfo(),this.previous=_t;var rt=this;return _t.on("data",function(Pt){rt.processChunk(Pt)}),_t.on("end",function(){rt.end()}),_t.on("error",function(Pt){rt.error(Pt)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var _t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),_t=!0),this.previous&&this.previous.resume(),!_t},flush:function(){},processChunk:function(_t){this.push(_t)},withStreamInfo:function(_t,rt){return this.extraStreamInfo[_t]=rt,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var _t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,_t)&&(this.streamInfo[_t]=this.extraStreamInfo[_t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var _t="Worker "+this.name;return this.previous?this.previous+" -> "+_t:_t}},at.exports=et},{}],29:[function(ft,at,dt){var et=ft("../utils"),_t=ft("./ConvertWorker"),rt=ft("./GenericWorker"),Pt=ft("../base64"),St=ft("../support"),yt=ft("../external"),gt=null;if(St.nodestream)try{gt=ft("../nodejs/NodejsStreamOutputAdapter")}catch{}function lt(F,pt,ht){var mt=pt;switch(pt){case"blob":case"arraybuffer":mt="uint8array";break;case"base64":mt="string"}try{this._internalType=mt,this._outputType=pt,this._mimeType=ht,et.checkSupport(mt),this._worker=F.pipe(new _t(mt)),F.lock()}catch(bt){this._worker=new rt("error"),this._worker.error(bt)}}lt.prototype={accumulate:function(F){return function(pt,ht){return new yt.Promise(function(mt,bt){var ut=[],Mt=pt._internalType,st=pt._outputType,tt=pt._mimeType;pt.on("data",function(Ut,nt){ut.push(Ut),ht&&ht(nt)}).on("error",function(Ut){ut=[],bt(Ut)}).on("end",function(){try{var Ut=function(nt,ue,re){switch(nt){case"blob":return et.newBlob(et.transformTo("arraybuffer",ue),re);case"base64":return Pt.encode(ue);default:return et.transformTo(nt,ue)}}(st,function(nt,ue){var re,ee=0,Qt=null,Lt=0;for(re=0;re<ue.length;re++)Lt+=ue[re].length;switch(nt){case"string":return ue.join("");case"array":return Array.prototype.concat.apply([],ue);case"uint8array":for(Qt=new Uint8Array(Lt),re=0;re<ue.length;re++)Qt.set(ue[re],ee),ee+=ue[re].length;return Qt;case"nodebuffer":return Buffer.concat(ue);default:throw new Error("concat : unsupported type '"+nt+"'")}}(Mt,ut),tt);mt(Ut)}catch(nt){bt(nt)}ut=[]}).resume()})}(this,F)},on:function(F,pt){var ht=this;return F==="data"?this._worker.on(F,function(mt){pt.call(ht,mt.data,mt.meta)}):this._worker.on(F,function(){et.delay(pt,arguments,ht)}),this},resume:function(){return et.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(F){if(et.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new gt(this,{objectMode:this._outputType!=="nodebuffer"},F)}},at.exports=lt},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(ft,at,dt){if(dt.base64=!0,dt.array=!0,dt.string=!0,dt.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",dt.nodebuffer=typeof Buffer<"u",dt.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")dt.blob=!1;else{var et=new ArrayBuffer(0);try{dt.blob=new Blob([et],{type:"application/zip"}).size===0}catch{try{var _t=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);_t.append(et),dt.blob=_t.getBlob("application/zip").size===0}catch{dt.blob=!1}}}try{dt.nodestream=!!ft("readable-stream").Readable}catch{dt.nodestream=!1}},{"readable-stream":16}],31:[function(ft,at,dt){for(var et=ft("./utils"),_t=ft("./support"),rt=ft("./nodejsUtils"),Pt=ft("./stream/GenericWorker"),St=new Array(256),yt=0;yt<256;yt++)St[yt]=252<=yt?6:248<=yt?5:240<=yt?4:224<=yt?3:192<=yt?2:1;function gt(){Pt.call(this,"utf-8 decode"),this.leftOver=null}function lt(){Pt.call(this,"utf-8 encode")}St[254]=St[254]=1,dt.utf8encode=function(F){return _t.nodebuffer?rt.newBufferFrom(F,"utf-8"):function(pt){var ht,mt,bt,ut,Mt,st=pt.length,tt=0;for(ut=0;ut<st;ut++)(64512&(mt=pt.charCodeAt(ut)))==55296&&ut+1<st&&(64512&(bt=pt.charCodeAt(ut+1)))==56320&&(mt=65536+(mt-55296<<10)+(bt-56320),ut++),tt+=mt<128?1:mt<2048?2:mt<65536?3:4;for(ht=_t.uint8array?new Uint8Array(tt):new Array(tt),ut=Mt=0;Mt<tt;ut++)(64512&(mt=pt.charCodeAt(ut)))==55296&&ut+1<st&&(64512&(bt=pt.charCodeAt(ut+1)))==56320&&(mt=65536+(mt-55296<<10)+(bt-56320),ut++),mt<128?ht[Mt++]=mt:(mt<2048?ht[Mt++]=192|mt>>>6:(mt<65536?ht[Mt++]=224|mt>>>12:(ht[Mt++]=240|mt>>>18,ht[Mt++]=128|mt>>>12&63),ht[Mt++]=128|mt>>>6&63),ht[Mt++]=128|63&mt);return ht}(F)},dt.utf8decode=function(F){return _t.nodebuffer?et.transformTo("nodebuffer",F).toString("utf-8"):function(pt){var ht,mt,bt,ut,Mt=pt.length,st=new Array(2*Mt);for(ht=mt=0;ht<Mt;)if((bt=pt[ht++])<128)st[mt++]=bt;else if(4<(ut=St[bt]))st[mt++]=65533,ht+=ut-1;else{for(bt&=ut===2?31:ut===3?15:7;1<ut&&ht<Mt;)bt=bt<<6|63&pt[ht++],ut--;1<ut?st[mt++]=65533:bt<65536?st[mt++]=bt:(bt-=65536,st[mt++]=55296|bt>>10&1023,st[mt++]=56320|1023&bt)}return st.length!==mt&&(st.subarray?st=st.subarray(0,mt):st.length=mt),et.applyFromCharCode(st)}(F=et.transformTo(_t.uint8array?"uint8array":"array",F))},et.inherits(gt,Pt),gt.prototype.processChunk=function(F){var pt=et.transformTo(_t.uint8array?"uint8array":"array",F.data);if(this.leftOver&&this.leftOver.length){if(_t.uint8array){var ht=pt;(pt=new Uint8Array(ht.length+this.leftOver.length)).set(this.leftOver,0),pt.set(ht,this.leftOver.length)}else pt=this.leftOver.concat(pt);this.leftOver=null}var mt=function(ut,Mt){var st;for((Mt=Mt||ut.length)>ut.length&&(Mt=ut.length),st=Mt-1;0<=st&&(192&ut[st])==128;)st--;return st<0||st===0?Mt:st+St[ut[st]]>Mt?st:Mt}(pt),bt=pt;mt!==pt.length&&(_t.uint8array?(bt=pt.subarray(0,mt),this.leftOver=pt.subarray(mt,pt.length)):(bt=pt.slice(0,mt),this.leftOver=pt.slice(mt,pt.length))),this.push({data:dt.utf8decode(bt),meta:F.meta})},gt.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:dt.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},dt.Utf8DecodeWorker=gt,et.inherits(lt,Pt),lt.prototype.processChunk=function(F){this.push({data:dt.utf8encode(F.data),meta:F.meta})},dt.Utf8EncodeWorker=lt},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(ft,at,dt){var et=ft("./support"),_t=ft("./base64"),rt=ft("./nodejsUtils"),Pt=ft("./external");function St(ht){return ht}function yt(ht,mt){for(var bt=0;bt<ht.length;++bt)mt[bt]=255&ht.charCodeAt(bt);return mt}ft("setimmediate"),dt.newBlob=function(ht,mt){dt.checkSupport("blob");try{return new Blob([ht],{type:mt})}catch{try{var bt=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return bt.append(ht),bt.getBlob(mt)}catch{throw new Error("Bug : can't construct the Blob.")}}};var gt={stringifyByChunk:function(ht,mt,bt){var ut=[],Mt=0,st=ht.length;if(st<=bt)return String.fromCharCode.apply(null,ht);for(;Mt<st;)mt==="array"||mt==="nodebuffer"?ut.push(String.fromCharCode.apply(null,ht.slice(Mt,Math.min(Mt+bt,st)))):ut.push(String.fromCharCode.apply(null,ht.subarray(Mt,Math.min(Mt+bt,st)))),Mt+=bt;return ut.join("")},stringifyByChar:function(ht){for(var mt="",bt=0;bt<ht.length;bt++)mt+=String.fromCharCode(ht[bt]);return mt},applyCanBeUsed:{uint8array:function(){try{return et.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return et.nodebuffer&&String.fromCharCode.apply(null,rt.allocBuffer(1)).length===1}catch{return!1}}()}};function lt(ht){var mt=65536,bt=dt.getTypeOf(ht),ut=!0;if(bt==="uint8array"?ut=gt.applyCanBeUsed.uint8array:bt==="nodebuffer"&&(ut=gt.applyCanBeUsed.nodebuffer),ut)for(;1<mt;)try{return gt.stringifyByChunk(ht,bt,mt)}catch{mt=Math.floor(mt/2)}return gt.stringifyByChar(ht)}function F(ht,mt){for(var bt=0;bt<ht.length;bt++)mt[bt]=ht[bt];return mt}dt.applyFromCharCode=lt;var pt={};pt.string={string:St,array:function(ht){return yt(ht,new Array(ht.length))},arraybuffer:function(ht){return pt.string.uint8array(ht).buffer},uint8array:function(ht){return yt(ht,new Uint8Array(ht.length))},nodebuffer:function(ht){return yt(ht,rt.allocBuffer(ht.length))}},pt.array={string:lt,array:St,arraybuffer:function(ht){return new Uint8Array(ht).buffer},uint8array:function(ht){return new Uint8Array(ht)},nodebuffer:function(ht){return rt.newBufferFrom(ht)}},pt.arraybuffer={string:function(ht){return lt(new Uint8Array(ht))},array:function(ht){return F(new Uint8Array(ht),new Array(ht.byteLength))},arraybuffer:St,uint8array:function(ht){return new Uint8Array(ht)},nodebuffer:function(ht){return rt.newBufferFrom(new Uint8Array(ht))}},pt.uint8array={string:lt,array:function(ht){return F(ht,new Array(ht.length))},arraybuffer:function(ht){return ht.buffer},uint8array:St,nodebuffer:function(ht){return rt.newBufferFrom(ht)}},pt.nodebuffer={string:lt,array:function(ht){return F(ht,new Array(ht.length))},arraybuffer:function(ht){return pt.nodebuffer.uint8array(ht).buffer},uint8array:function(ht){return F(ht,new Uint8Array(ht.length))},nodebuffer:St},dt.transformTo=function(ht,mt){if(mt=mt||"",!ht)return mt;dt.checkSupport(ht);var bt=dt.getTypeOf(mt);return pt[bt][ht](mt)},dt.resolve=function(ht){for(var mt=ht.split("/"),bt=[],ut=0;ut<mt.length;ut++){var Mt=mt[ut];Mt==="."||Mt===""&&ut!==0&&ut!==mt.length-1||(Mt===".."?bt.pop():bt.push(Mt))}return bt.join("/")},dt.getTypeOf=function(ht){return typeof ht=="string"?"string":Object.prototype.toString.call(ht)==="[object Array]"?"array":et.nodebuffer&&rt.isBuffer(ht)?"nodebuffer":et.uint8array&&ht instanceof Uint8Array?"uint8array":et.arraybuffer&&ht instanceof ArrayBuffer?"arraybuffer":void 0},dt.checkSupport=function(ht){if(!et[ht.toLowerCase()])throw new Error(ht+" is not supported by this platform")},dt.MAX_VALUE_16BITS=65535,dt.MAX_VALUE_32BITS=-1,dt.pretty=function(ht){var mt,bt,ut="";for(bt=0;bt<(ht||"").length;bt++)ut+="\\x"+((mt=ht.charCodeAt(bt))<16?"0":"")+mt.toString(16).toUpperCase();return ut},dt.delay=function(ht,mt,bt){setImmediate(function(){ht.apply(bt||null,mt||[])})},dt.inherits=function(ht,mt){function bt(){}bt.prototype=mt.prototype,ht.prototype=new bt},dt.extend=function(){var ht,mt,bt={};for(ht=0;ht<arguments.length;ht++)for(mt in arguments[ht])Object.prototype.hasOwnProperty.call(arguments[ht],mt)&&bt[mt]===void 0&&(bt[mt]=arguments[ht][mt]);return bt},dt.prepareContent=function(ht,mt,bt,ut,Mt){return Pt.Promise.resolve(mt).then(function(st){return et.blob&&(st instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(st))!==-1)&&typeof FileReader<"u"?new Pt.Promise(function(tt,Ut){var nt=new FileReader;nt.onload=function(ue){tt(ue.target.result)},nt.onerror=function(ue){Ut(ue.target.error)},nt.readAsArrayBuffer(st)}):st}).then(function(st){var tt=dt.getTypeOf(st);return tt?(tt==="arraybuffer"?st=dt.transformTo("uint8array",st):tt==="string"&&(Mt?st=_t.decode(st):bt&&ut!==!0&&(st=function(Ut){return yt(Ut,et.uint8array?new Uint8Array(Ut.length):new Array(Ut.length))}(st))),st):Pt.Promise.reject(new Error("Can't read the data of '"+ht+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(ft,at,dt){var et=ft("./reader/readerFor"),_t=ft("./utils"),rt=ft("./signature"),Pt=ft("./zipEntry"),St=ft("./support");function yt(gt){this.files=[],this.loadOptions=gt}yt.prototype={checkSignature:function(gt){if(!this.reader.readAndCheckSignature(gt)){this.reader.index-=4;var lt=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+_t.pretty(lt)+", expected "+_t.pretty(gt)+")")}},isSignature:function(gt,lt){var F=this.reader.index;this.reader.setIndex(gt);var pt=this.reader.readString(4)===lt;return this.reader.setIndex(F),pt},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var gt=this.reader.readData(this.zipCommentLength),lt=St.uint8array?"uint8array":"array",F=_t.transformTo(lt,gt);this.zipComment=this.loadOptions.decodeFileName(F)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var gt,lt,F,pt=this.zip64EndOfCentralSize-44;0<pt;)gt=this.reader.readInt(2),lt=this.reader.readInt(4),F=this.reader.readData(lt),this.zip64ExtensibleData[gt]={id:gt,length:lt,value:F}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var gt,lt;for(gt=0;gt<this.files.length;gt++)lt=this.files[gt],this.reader.setIndex(lt.localHeaderOffset),this.checkSignature(rt.LOCAL_FILE_HEADER),lt.readLocalPart(this.reader),lt.handleUTF8(),lt.processAttributes()},readCentralDir:function(){var gt;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(rt.CENTRAL_FILE_HEADER);)(gt=new Pt({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(gt);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var gt=this.reader.lastIndexOfSignature(rt.CENTRAL_DIRECTORY_END);if(gt<0)throw this.isSignature(0,rt.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(gt);var lt=gt;if(this.checkSignature(rt.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===_t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===_t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===_t.MAX_VALUE_16BITS||this.centralDirRecords===_t.MAX_VALUE_16BITS||this.centralDirSize===_t.MAX_VALUE_32BITS||this.centralDirOffset===_t.MAX_VALUE_32BITS){if(this.zip64=!0,(gt=this.reader.lastIndexOfSignature(rt.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(gt),this.checkSignature(rt.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,rt.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(rt.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(rt.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var F=this.centralDirOffset+this.centralDirSize;this.zip64&&(F+=20,F+=12+this.zip64EndOfCentralSize);var pt=lt-F;if(0<pt)this.isSignature(lt,rt.CENTRAL_FILE_HEADER)||(this.reader.zero=pt);else if(pt<0)throw new Error("Corrupted zip: missing "+Math.abs(pt)+" bytes.")},prepareReader:function(gt){this.reader=et(gt)},load:function(gt){this.prepareReader(gt),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},at.exports=yt},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(ft,at,dt){var et=ft("./reader/readerFor"),_t=ft("./utils"),rt=ft("./compressedObject"),Pt=ft("./crc32"),St=ft("./utf8"),yt=ft("./compressions"),gt=ft("./support");function lt(F,pt){this.options=F,this.loadOptions=pt}lt.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(F){var pt,ht;if(F.skip(22),this.fileNameLength=F.readInt(2),ht=F.readInt(2),this.fileName=F.readData(this.fileNameLength),F.skip(ht),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((pt=function(mt){for(var bt in yt)if(Object.prototype.hasOwnProperty.call(yt,bt)&&yt[bt].magic===mt)return yt[bt];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+_t.pretty(this.compressionMethod)+" unknown (inner file : "+_t.transformTo("string",this.fileName)+")");this.decompressed=new rt(this.compressedSize,this.uncompressedSize,this.crc32,pt,F.readData(this.compressedSize))},readCentralPart:function(F){this.versionMadeBy=F.readInt(2),F.skip(2),this.bitFlag=F.readInt(2),this.compressionMethod=F.readString(2),this.date=F.readDate(),this.crc32=F.readInt(4),this.compressedSize=F.readInt(4),this.uncompressedSize=F.readInt(4);var pt=F.readInt(2);if(this.extraFieldsLength=F.readInt(2),this.fileCommentLength=F.readInt(2),this.diskNumberStart=F.readInt(2),this.internalFileAttributes=F.readInt(2),this.externalFileAttributes=F.readInt(4),this.localHeaderOffset=F.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");F.skip(pt),this.readExtraFields(F),this.parseZIP64ExtraField(F),this.fileComment=F.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var F=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),F==0&&(this.dosPermissions=63&this.externalFileAttributes),F==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var F=et(this.extraFields[1].value);this.uncompressedSize===_t.MAX_VALUE_32BITS&&(this.uncompressedSize=F.readInt(8)),this.compressedSize===_t.MAX_VALUE_32BITS&&(this.compressedSize=F.readInt(8)),this.localHeaderOffset===_t.MAX_VALUE_32BITS&&(this.localHeaderOffset=F.readInt(8)),this.diskNumberStart===_t.MAX_VALUE_32BITS&&(this.diskNumberStart=F.readInt(4))}},readExtraFields:function(F){var pt,ht,mt,bt=F.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});F.index+4<bt;)pt=F.readInt(2),ht=F.readInt(2),mt=F.readData(ht),this.extraFields[pt]={id:pt,length:ht,value:mt};F.setIndex(bt)},handleUTF8:function(){var F=gt.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=St.utf8decode(this.fileName),this.fileCommentStr=St.utf8decode(this.fileComment);else{var pt=this.findExtraFieldUnicodePath();if(pt!==null)this.fileNameStr=pt;else{var ht=_t.transformTo(F,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(ht)}var mt=this.findExtraFieldUnicodeComment();if(mt!==null)this.fileCommentStr=mt;else{var bt=_t.transformTo(F,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(bt)}}},findExtraFieldUnicodePath:function(){var F=this.extraFields[28789];if(F){var pt=et(F.value);return pt.readInt(1)!==1||Pt(this.fileName)!==pt.readInt(4)?null:St.utf8decode(pt.readData(F.length-5))}return null},findExtraFieldUnicodeComment:function(){var F=this.extraFields[25461];if(F){var pt=et(F.value);return pt.readInt(1)!==1||Pt(this.fileComment)!==pt.readInt(4)?null:St.utf8decode(pt.readData(F.length-5))}return null}},at.exports=lt},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(ft,at,dt){function et(pt,ht,mt){this.name=pt,this.dir=mt.dir,this.date=mt.date,this.comment=mt.comment,this.unixPermissions=mt.unixPermissions,this.dosPermissions=mt.dosPermissions,this._data=ht,this._dataBinary=mt.binary,this.options={compression:mt.compression,compressionOptions:mt.compressionOptions}}var _t=ft("./stream/StreamHelper"),rt=ft("./stream/DataWorker"),Pt=ft("./utf8"),St=ft("./compressedObject"),yt=ft("./stream/GenericWorker");et.prototype={internalStream:function(pt){var ht=null,mt="string";try{if(!pt)throw new Error("No output type specified.");var bt=(mt=pt.toLowerCase())==="string"||mt==="text";mt!=="binarystring"&&mt!=="text"||(mt="string"),ht=this._decompressWorker();var ut=!this._dataBinary;ut&&!bt&&(ht=ht.pipe(new Pt.Utf8EncodeWorker)),!ut&&bt&&(ht=ht.pipe(new Pt.Utf8DecodeWorker))}catch(Mt){(ht=new yt("error")).error(Mt)}return new _t(ht,mt,"")},async:function(pt,ht){return this.internalStream(pt).accumulate(ht)},nodeStream:function(pt,ht){return this.internalStream(pt||"nodebuffer").toNodejsStream(ht)},_compressWorker:function(pt,ht){if(this._data instanceof St&&this._data.compression.magic===pt.magic)return this._data.getCompressedWorker();var mt=this._decompressWorker();return this._dataBinary||(mt=mt.pipe(new Pt.Utf8EncodeWorker)),St.createWorkerFrom(mt,pt,ht)},_decompressWorker:function(){return this._data instanceof St?this._data.getContentWorker():this._data instanceof yt?this._data:new rt(this._data)}};for(var gt=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],lt=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},F=0;F<gt.length;F++)et.prototype[gt[F]]=lt;at.exports=et},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(ft,at,dt){(function(et){var _t,rt,Pt=et.MutationObserver||et.WebKitMutationObserver;if(Pt){var St=0,yt=new Pt(pt),gt=et.document.createTextNode("");yt.observe(gt,{characterData:!0}),_t=function(){gt.data=St=++St%2}}else if(et.setImmediate||et.MessageChannel===void 0)_t="document"in et&&"onreadystatechange"in et.document.createElement("script")?function(){var ht=et.document.createElement("script");ht.onreadystatechange=function(){pt(),ht.onreadystatechange=null,ht.parentNode.removeChild(ht),ht=null},et.document.documentElement.appendChild(ht)}:function(){setTimeout(pt,0)};else{var lt=new et.MessageChannel;lt.port1.onmessage=pt,_t=function(){lt.port2.postMessage(0)}}var F=[];function pt(){var ht,mt;rt=!0;for(var bt=F.length;bt;){for(mt=F,F=[],ht=-1;++ht<bt;)mt[ht]();bt=F.length}rt=!1}at.exports=function(ht){F.push(ht)!==1||rt||_t()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(ft,at,dt){var et=ft("immediate");function _t(){}var rt={},Pt=["REJECTED"],St=["FULFILLED"],yt=["PENDING"];function gt(bt){if(typeof bt!="function")throw new TypeError("resolver must be a function");this.state=yt,this.queue=[],this.outcome=void 0,bt!==_t&&ht(this,bt)}function lt(bt,ut,Mt){this.promise=bt,typeof ut=="function"&&(this.onFulfilled=ut,this.callFulfilled=this.otherCallFulfilled),typeof Mt=="function"&&(this.onRejected=Mt,this.callRejected=this.otherCallRejected)}function F(bt,ut,Mt){et(function(){var st;try{st=ut(Mt)}catch(tt){return rt.reject(bt,tt)}st===bt?rt.reject(bt,new TypeError("Cannot resolve promise with itself")):rt.resolve(bt,st)})}function pt(bt){var ut=bt&&bt.then;if(bt&&(typeof bt=="object"||typeof bt=="function")&&typeof ut=="function")return function(){ut.apply(bt,arguments)}}function ht(bt,ut){var Mt=!1;function st(nt){Mt||(Mt=!0,rt.reject(bt,nt))}function tt(nt){Mt||(Mt=!0,rt.resolve(bt,nt))}var Ut=mt(function(){ut(tt,st)});Ut.status==="error"&&st(Ut.value)}function mt(bt,ut){var Mt={};try{Mt.value=bt(ut),Mt.status="success"}catch(st){Mt.status="error",Mt.value=st}return Mt}(at.exports=gt).prototype.finally=function(bt){if(typeof bt!="function")return this;var ut=this.constructor;return this.then(function(Mt){return ut.resolve(bt()).then(function(){return Mt})},function(Mt){return ut.resolve(bt()).then(function(){throw Mt})})},gt.prototype.catch=function(bt){return this.then(null,bt)},gt.prototype.then=function(bt,ut){if(typeof bt!="function"&&this.state===St||typeof ut!="function"&&this.state===Pt)return this;var Mt=new this.constructor(_t);return this.state!==yt?F(Mt,this.state===St?bt:ut,this.outcome):this.queue.push(new lt(Mt,bt,ut)),Mt},lt.prototype.callFulfilled=function(bt){rt.resolve(this.promise,bt)},lt.prototype.otherCallFulfilled=function(bt){F(this.promise,this.onFulfilled,bt)},lt.prototype.callRejected=function(bt){rt.reject(this.promise,bt)},lt.prototype.otherCallRejected=function(bt){F(this.promise,this.onRejected,bt)},rt.resolve=function(bt,ut){var Mt=mt(pt,ut);if(Mt.status==="error")return rt.reject(bt,Mt.value);var st=Mt.value;if(st)ht(bt,st);else{bt.state=St,bt.outcome=ut;for(var tt=-1,Ut=bt.queue.length;++tt<Ut;)bt.queue[tt].callFulfilled(ut)}return bt},rt.reject=function(bt,ut){bt.state=Pt,bt.outcome=ut;for(var Mt=-1,st=bt.queue.length;++Mt<st;)bt.queue[Mt].callRejected(ut);return bt},gt.resolve=function(bt){return bt instanceof this?bt:rt.resolve(new this(_t),bt)},gt.reject=function(bt){var ut=new this(_t);return rt.reject(ut,bt)},gt.all=function(bt){var ut=this;if(Object.prototype.toString.call(bt)!=="[object Array]")return this.reject(new TypeError("must be an array"));var Mt=bt.length,st=!1;if(!Mt)return this.resolve([]);for(var tt=new Array(Mt),Ut=0,nt=-1,ue=new this(_t);++nt<Mt;)re(bt[nt],nt);return ue;function re(ee,Qt){ut.resolve(ee).then(function(Lt){tt[Qt]=Lt,++Ut!==Mt||st||(st=!0,rt.resolve(ue,tt))},function(Lt){st||(st=!0,rt.reject(ue,Lt))})}},gt.race=function(bt){if(Object.prototype.toString.call(bt)!=="[object Array]")return this.reject(new TypeError("must be an array"));var ut=bt.length,Mt=!1;if(!ut)return this.resolve([]);for(var st,tt=-1,Ut=new this(_t);++tt<ut;)st=bt[tt],this.resolve(st).then(function(nt){Mt||(Mt=!0,rt.resolve(Ut,nt))},function(nt){Mt||(Mt=!0,rt.reject(Ut,nt))});return Ut}},{immediate:36}],38:[function(ft,at,dt){var et={};(0,ft("./lib/utils/common").assign)(et,ft("./lib/deflate"),ft("./lib/inflate"),ft("./lib/zlib/constants")),at.exports=et},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(ft,at,dt){var et=ft("./zlib/deflate"),_t=ft("./utils/common"),rt=ft("./utils/strings"),Pt=ft("./zlib/messages"),St=ft("./zlib/zstream"),yt=Object.prototype.toString,gt=0,lt=-1,F=0,pt=8;function ht(bt){if(!(this instanceof ht))return new ht(bt);this.options=_t.assign({level:lt,method:pt,chunkSize:16384,windowBits:15,memLevel:8,strategy:F,to:""},bt||{});var ut=this.options;ut.raw&&0<ut.windowBits?ut.windowBits=-ut.windowBits:ut.gzip&&0<ut.windowBits&&ut.windowBits<16&&(ut.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new St,this.strm.avail_out=0;var Mt=et.deflateInit2(this.strm,ut.level,ut.method,ut.windowBits,ut.memLevel,ut.strategy);if(Mt!==gt)throw new Error(Pt[Mt]);if(ut.header&&et.deflateSetHeader(this.strm,ut.header),ut.dictionary){var st;if(st=typeof ut.dictionary=="string"?rt.string2buf(ut.dictionary):yt.call(ut.dictionary)==="[object ArrayBuffer]"?new Uint8Array(ut.dictionary):ut.dictionary,(Mt=et.deflateSetDictionary(this.strm,st))!==gt)throw new Error(Pt[Mt]);this._dict_set=!0}}function mt(bt,ut){var Mt=new ht(ut);if(Mt.push(bt,!0),Mt.err)throw Mt.msg||Pt[Mt.err];return Mt.result}ht.prototype.push=function(bt,ut){var Mt,st,tt=this.strm,Ut=this.options.chunkSize;if(this.ended)return!1;st=ut===~~ut?ut:ut===!0?4:0,typeof bt=="string"?tt.input=rt.string2buf(bt):yt.call(bt)==="[object ArrayBuffer]"?tt.input=new Uint8Array(bt):tt.input=bt,tt.next_in=0,tt.avail_in=tt.input.length;do{if(tt.avail_out===0&&(tt.output=new _t.Buf8(Ut),tt.next_out=0,tt.avail_out=Ut),(Mt=et.deflate(tt,st))!==1&&Mt!==gt)return this.onEnd(Mt),!(this.ended=!0);tt.avail_out!==0&&(tt.avail_in!==0||st!==4&&st!==2)||(this.options.to==="string"?this.onData(rt.buf2binstring(_t.shrinkBuf(tt.output,tt.next_out))):this.onData(_t.shrinkBuf(tt.output,tt.next_out)))}while((0<tt.avail_in||tt.avail_out===0)&&Mt!==1);return st===4?(Mt=et.deflateEnd(this.strm),this.onEnd(Mt),this.ended=!0,Mt===gt):st!==2||(this.onEnd(gt),!(tt.avail_out=0))},ht.prototype.onData=function(bt){this.chunks.push(bt)},ht.prototype.onEnd=function(bt){bt===gt&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=_t.flattenChunks(this.chunks)),this.chunks=[],this.err=bt,this.msg=this.strm.msg},dt.Deflate=ht,dt.deflate=mt,dt.deflateRaw=function(bt,ut){return(ut=ut||{}).raw=!0,mt(bt,ut)},dt.gzip=function(bt,ut){return(ut=ut||{}).gzip=!0,mt(bt,ut)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(ft,at,dt){var et=ft("./zlib/inflate"),_t=ft("./utils/common"),rt=ft("./utils/strings"),Pt=ft("./zlib/constants"),St=ft("./zlib/messages"),yt=ft("./zlib/zstream"),gt=ft("./zlib/gzheader"),lt=Object.prototype.toString;function F(ht){if(!(this instanceof F))return new F(ht);this.options=_t.assign({chunkSize:16384,windowBits:0,to:""},ht||{});var mt=this.options;mt.raw&&0<=mt.windowBits&&mt.windowBits<16&&(mt.windowBits=-mt.windowBits,mt.windowBits===0&&(mt.windowBits=-15)),!(0<=mt.windowBits&&mt.windowBits<16)||ht&&ht.windowBits||(mt.windowBits+=32),15<mt.windowBits&&mt.windowBits<48&&!(15&mt.windowBits)&&(mt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new yt,this.strm.avail_out=0;var bt=et.inflateInit2(this.strm,mt.windowBits);if(bt!==Pt.Z_OK)throw new Error(St[bt]);this.header=new gt,et.inflateGetHeader(this.strm,this.header)}function pt(ht,mt){var bt=new F(mt);if(bt.push(ht,!0),bt.err)throw bt.msg||St[bt.err];return bt.result}F.prototype.push=function(ht,mt){var bt,ut,Mt,st,tt,Ut,nt=this.strm,ue=this.options.chunkSize,re=this.options.dictionary,ee=!1;if(this.ended)return!1;ut=mt===~~mt?mt:mt===!0?Pt.Z_FINISH:Pt.Z_NO_FLUSH,typeof ht=="string"?nt.input=rt.binstring2buf(ht):lt.call(ht)==="[object ArrayBuffer]"?nt.input=new Uint8Array(ht):nt.input=ht,nt.next_in=0,nt.avail_in=nt.input.length;do{if(nt.avail_out===0&&(nt.output=new _t.Buf8(ue),nt.next_out=0,nt.avail_out=ue),(bt=et.inflate(nt,Pt.Z_NO_FLUSH))===Pt.Z_NEED_DICT&&re&&(Ut=typeof re=="string"?rt.string2buf(re):lt.call(re)==="[object ArrayBuffer]"?new Uint8Array(re):re,bt=et.inflateSetDictionary(this.strm,Ut)),bt===Pt.Z_BUF_ERROR&&ee===!0&&(bt=Pt.Z_OK,ee=!1),bt!==Pt.Z_STREAM_END&&bt!==Pt.Z_OK)return this.onEnd(bt),!(this.ended=!0);nt.next_out&&(nt.avail_out!==0&&bt!==Pt.Z_STREAM_END&&(nt.avail_in!==0||ut!==Pt.Z_FINISH&&ut!==Pt.Z_SYNC_FLUSH)||(this.options.to==="string"?(Mt=rt.utf8border(nt.output,nt.next_out),st=nt.next_out-Mt,tt=rt.buf2string(nt.output,Mt),nt.next_out=st,nt.avail_out=ue-st,st&&_t.arraySet(nt.output,nt.output,Mt,st,0),this.onData(tt)):this.onData(_t.shrinkBuf(nt.output,nt.next_out)))),nt.avail_in===0&&nt.avail_out===0&&(ee=!0)}while((0<nt.avail_in||nt.avail_out===0)&&bt!==Pt.Z_STREAM_END);return bt===Pt.Z_STREAM_END&&(ut=Pt.Z_FINISH),ut===Pt.Z_FINISH?(bt=et.inflateEnd(this.strm),this.onEnd(bt),this.ended=!0,bt===Pt.Z_OK):ut!==Pt.Z_SYNC_FLUSH||(this.onEnd(Pt.Z_OK),!(nt.avail_out=0))},F.prototype.onData=function(ht){this.chunks.push(ht)},F.prototype.onEnd=function(ht){ht===Pt.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=_t.flattenChunks(this.chunks)),this.chunks=[],this.err=ht,this.msg=this.strm.msg},dt.Inflate=F,dt.inflate=pt,dt.inflateRaw=function(ht,mt){return(mt=mt||{}).raw=!0,pt(ht,mt)},dt.ungzip=pt},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(ft,at,dt){var et=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";dt.assign=function(Pt){for(var St=Array.prototype.slice.call(arguments,1);St.length;){var yt=St.shift();if(yt){if(typeof yt!="object")throw new TypeError(yt+"must be non-object");for(var gt in yt)yt.hasOwnProperty(gt)&&(Pt[gt]=yt[gt])}}return Pt},dt.shrinkBuf=function(Pt,St){return Pt.length===St?Pt:Pt.subarray?Pt.subarray(0,St):(Pt.length=St,Pt)};var _t={arraySet:function(Pt,St,yt,gt,lt){if(St.subarray&&Pt.subarray)Pt.set(St.subarray(yt,yt+gt),lt);else for(var F=0;F<gt;F++)Pt[lt+F]=St[yt+F]},flattenChunks:function(Pt){var St,yt,gt,lt,F,pt;for(St=gt=0,yt=Pt.length;St<yt;St++)gt+=Pt[St].length;for(pt=new Uint8Array(gt),St=lt=0,yt=Pt.length;St<yt;St++)F=Pt[St],pt.set(F,lt),lt+=F.length;return pt}},rt={arraySet:function(Pt,St,yt,gt,lt){for(var F=0;F<gt;F++)Pt[lt+F]=St[yt+F]},flattenChunks:function(Pt){return[].concat.apply([],Pt)}};dt.setTyped=function(Pt){Pt?(dt.Buf8=Uint8Array,dt.Buf16=Uint16Array,dt.Buf32=Int32Array,dt.assign(dt,_t)):(dt.Buf8=Array,dt.Buf16=Array,dt.Buf32=Array,dt.assign(dt,rt))},dt.setTyped(et)},{}],42:[function(ft,at,dt){var et=ft("./common"),_t=!0,rt=!0;try{String.fromCharCode.apply(null,[0])}catch{_t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{rt=!1}for(var Pt=new et.Buf8(256),St=0;St<256;St++)Pt[St]=252<=St?6:248<=St?5:240<=St?4:224<=St?3:192<=St?2:1;function yt(gt,lt){if(lt<65537&&(gt.subarray&&rt||!gt.subarray&&_t))return String.fromCharCode.apply(null,et.shrinkBuf(gt,lt));for(var F="",pt=0;pt<lt;pt++)F+=String.fromCharCode(gt[pt]);return F}Pt[254]=Pt[254]=1,dt.string2buf=function(gt){var lt,F,pt,ht,mt,bt=gt.length,ut=0;for(ht=0;ht<bt;ht++)(64512&(F=gt.charCodeAt(ht)))==55296&&ht+1<bt&&(64512&(pt=gt.charCodeAt(ht+1)))==56320&&(F=65536+(F-55296<<10)+(pt-56320),ht++),ut+=F<128?1:F<2048?2:F<65536?3:4;for(lt=new et.Buf8(ut),ht=mt=0;mt<ut;ht++)(64512&(F=gt.charCodeAt(ht)))==55296&&ht+1<bt&&(64512&(pt=gt.charCodeAt(ht+1)))==56320&&(F=65536+(F-55296<<10)+(pt-56320),ht++),F<128?lt[mt++]=F:(F<2048?lt[mt++]=192|F>>>6:(F<65536?lt[mt++]=224|F>>>12:(lt[mt++]=240|F>>>18,lt[mt++]=128|F>>>12&63),lt[mt++]=128|F>>>6&63),lt[mt++]=128|63&F);return lt},dt.buf2binstring=function(gt){return yt(gt,gt.length)},dt.binstring2buf=function(gt){for(var lt=new et.Buf8(gt.length),F=0,pt=lt.length;F<pt;F++)lt[F]=gt.charCodeAt(F);return lt},dt.buf2string=function(gt,lt){var F,pt,ht,mt,bt=lt||gt.length,ut=new Array(2*bt);for(F=pt=0;F<bt;)if((ht=gt[F++])<128)ut[pt++]=ht;else if(4<(mt=Pt[ht]))ut[pt++]=65533,F+=mt-1;else{for(ht&=mt===2?31:mt===3?15:7;1<mt&&F<bt;)ht=ht<<6|63&gt[F++],mt--;1<mt?ut[pt++]=65533:ht<65536?ut[pt++]=ht:(ht-=65536,ut[pt++]=55296|ht>>10&1023,ut[pt++]=56320|1023&ht)}return yt(ut,pt)},dt.utf8border=function(gt,lt){var F;for((lt=lt||gt.length)>gt.length&&(lt=gt.length),F=lt-1;0<=F&&(192&gt[F])==128;)F--;return F<0||F===0?lt:F+Pt[gt[F]]>lt?F:lt}},{"./common":41}],43:[function(ft,at,dt){at.exports=function(et,_t,rt,Pt){for(var St=65535&et|0,yt=et>>>16&65535|0,gt=0;rt!==0;){for(rt-=gt=2e3<rt?2e3:rt;yt=yt+(St=St+_t[Pt++]|0)|0,--gt;);St%=65521,yt%=65521}return St|yt<<16|0}},{}],44:[function(ft,at,dt){at.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(ft,at,dt){var et=function(){for(var _t,rt=[],Pt=0;Pt<256;Pt++){_t=Pt;for(var St=0;St<8;St++)_t=1&_t?3988292384^_t>>>1:_t>>>1;rt[Pt]=_t}return rt}();at.exports=function(_t,rt,Pt,St){var yt=et,gt=St+Pt;_t^=-1;for(var lt=St;lt<gt;lt++)_t=_t>>>8^yt[255&(_t^rt[lt])];return-1^_t}},{}],46:[function(ft,at,dt){var et,_t=ft("../utils/common"),rt=ft("./trees"),Pt=ft("./adler32"),St=ft("./crc32"),yt=ft("./messages"),gt=0,lt=0,F=-2,pt=2,ht=8,mt=286,bt=30,ut=19,Mt=2*mt+1,st=15,tt=3,Ut=258,nt=Ut+tt+1,ue=42,re=113;function ee(Tt,Vt){return Tt.msg=yt[Vt],Vt}function Qt(Tt){return(Tt<<1)-(4<Tt?9:0)}function Lt(Tt){for(var Vt=Tt.length;0<=--Vt;)Tt[Vt]=0}function pe(Tt){var Vt=Tt.state,xe=Vt.pending;xe>Tt.avail_out&&(xe=Tt.avail_out),xe!==0&&(_t.arraySet(Tt.output,Vt.pending_buf,Vt.pending_out,xe,Tt.next_out),Tt.next_out+=xe,Vt.pending_out+=xe,Tt.total_out+=xe,Tt.avail_out-=xe,Vt.pending-=xe,Vt.pending===0&&(Vt.pending_out=0))}function be(Tt,Vt){rt._tr_flush_block(Tt,0<=Tt.block_start?Tt.block_start:-1,Tt.strstart-Tt.block_start,Vt),Tt.block_start=Tt.strstart,pe(Tt.strm)}function se(Tt,Vt){Tt.pending_buf[Tt.pending++]=Vt}function Fe(Tt,Vt){Tt.pending_buf[Tt.pending++]=Vt>>>8&255,Tt.pending_buf[Tt.pending++]=255&Vt}function Pe(Tt,Vt){var xe,Kt,Me=Tt.max_chain_length,Se=Tt.strstart,ke=Tt.prev_length,Ne=Tt.nice_match,Oe=Tt.strstart>Tt.w_size-nt?Tt.strstart-(Tt.w_size-nt):0,$e=Tt.window,l0=Tt.w_mask,je=Tt.prev,I0=Tt.strstart+Ut,X0=$e[Se+ke-1],W0=$e[Se+ke];Tt.prev_length>=Tt.good_match&&(Me>>=2),Ne>Tt.lookahead&&(Ne=Tt.lookahead);do if($e[(xe=Vt)+ke]===W0&&$e[xe+ke-1]===X0&&$e[xe]===$e[Se]&&$e[++xe]===$e[Se+1]){Se+=2,xe++;do;while($e[++Se]===$e[++xe]&&$e[++Se]===$e[++xe]&&$e[++Se]===$e[++xe]&&$e[++Se]===$e[++xe]&&$e[++Se]===$e[++xe]&&$e[++Se]===$e[++xe]&&$e[++Se]===$e[++xe]&&$e[++Se]===$e[++xe]&&Se<I0);if(Kt=Ut-(I0-Se),Se=I0-Ut,ke<Kt){if(Tt.match_start=Vt,Ne<=(ke=Kt))break;X0=$e[Se+ke-1],W0=$e[Se+ke]}}while((Vt=je[Vt&l0])>Oe&&--Me!=0);return ke<=Tt.lookahead?ke:Tt.lookahead}function It(Tt){var Vt,xe,Kt,Me,Se,ke,Ne,Oe,$e,l0,je=Tt.w_size;do{if(Me=Tt.window_size-Tt.lookahead-Tt.strstart,Tt.strstart>=je+(je-nt)){for(_t.arraySet(Tt.window,Tt.window,je,je,0),Tt.match_start-=je,Tt.strstart-=je,Tt.block_start-=je,Vt=xe=Tt.hash_size;Kt=Tt.head[--Vt],Tt.head[Vt]=je<=Kt?Kt-je:0,--xe;);for(Vt=xe=je;Kt=Tt.prev[--Vt],Tt.prev[Vt]=je<=Kt?Kt-je:0,--xe;);Me+=je}if(Tt.strm.avail_in===0)break;if(ke=Tt.strm,Ne=Tt.window,Oe=Tt.strstart+Tt.lookahead,l0=void 0,($e=Me)<(l0=ke.avail_in)&&(l0=$e),xe=l0===0?0:(ke.avail_in-=l0,_t.arraySet(Ne,ke.input,ke.next_in,l0,Oe),ke.state.wrap===1?ke.adler=Pt(ke.adler,Ne,l0,Oe):ke.state.wrap===2&&(ke.adler=St(ke.adler,Ne,l0,Oe)),ke.next_in+=l0,ke.total_in+=l0,l0),Tt.lookahead+=xe,Tt.lookahead+Tt.insert>=tt)for(Se=Tt.strstart-Tt.insert,Tt.ins_h=Tt.window[Se],Tt.ins_h=(Tt.ins_h<<Tt.hash_shift^Tt.window[Se+1])&Tt.hash_mask;Tt.insert&&(Tt.ins_h=(Tt.ins_h<<Tt.hash_shift^Tt.window[Se+tt-1])&Tt.hash_mask,Tt.prev[Se&Tt.w_mask]=Tt.head[Tt.ins_h],Tt.head[Tt.ins_h]=Se,Se++,Tt.insert--,!(Tt.lookahead+Tt.insert<tt)););}while(Tt.lookahead<nt&&Tt.strm.avail_in!==0)}function Rt(Tt,Vt){for(var xe,Kt;;){if(Tt.lookahead<nt){if(It(Tt),Tt.lookahead<nt&&Vt===gt)return 1;if(Tt.lookahead===0)break}if(xe=0,Tt.lookahead>=tt&&(Tt.ins_h=(Tt.ins_h<<Tt.hash_shift^Tt.window[Tt.strstart+tt-1])&Tt.hash_mask,xe=Tt.prev[Tt.strstart&Tt.w_mask]=Tt.head[Tt.ins_h],Tt.head[Tt.ins_h]=Tt.strstart),xe!==0&&Tt.strstart-xe<=Tt.w_size-nt&&(Tt.match_length=Pe(Tt,xe)),Tt.match_length>=tt)if(Kt=rt._tr_tally(Tt,Tt.strstart-Tt.match_start,Tt.match_length-tt),Tt.lookahead-=Tt.match_length,Tt.match_length<=Tt.max_lazy_match&&Tt.lookahead>=tt){for(Tt.match_length--;Tt.strstart++,Tt.ins_h=(Tt.ins_h<<Tt.hash_shift^Tt.window[Tt.strstart+tt-1])&Tt.hash_mask,xe=Tt.prev[Tt.strstart&Tt.w_mask]=Tt.head[Tt.ins_h],Tt.head[Tt.ins_h]=Tt.strstart,--Tt.match_length!=0;);Tt.strstart++}else Tt.strstart+=Tt.match_length,Tt.match_length=0,Tt.ins_h=Tt.window[Tt.strstart],Tt.ins_h=(Tt.ins_h<<Tt.hash_shift^Tt.window[Tt.strstart+1])&Tt.hash_mask;else Kt=rt._tr_tally(Tt,0,Tt.window[Tt.strstart]),Tt.lookahead--,Tt.strstart++;if(Kt&&(be(Tt,!1),Tt.strm.avail_out===0))return 1}return Tt.insert=Tt.strstart<tt-1?Tt.strstart:tt-1,Vt===4?(be(Tt,!0),Tt.strm.avail_out===0?3:4):Tt.last_lit&&(be(Tt,!1),Tt.strm.avail_out===0)?1:2}function Jt(Tt,Vt){for(var xe,Kt,Me;;){if(Tt.lookahead<nt){if(It(Tt),Tt.lookahead<nt&&Vt===gt)return 1;if(Tt.lookahead===0)break}if(xe=0,Tt.lookahead>=tt&&(Tt.ins_h=(Tt.ins_h<<Tt.hash_shift^Tt.window[Tt.strstart+tt-1])&Tt.hash_mask,xe=Tt.prev[Tt.strstart&Tt.w_mask]=Tt.head[Tt.ins_h],Tt.head[Tt.ins_h]=Tt.strstart),Tt.prev_length=Tt.match_length,Tt.prev_match=Tt.match_start,Tt.match_length=tt-1,xe!==0&&Tt.prev_length<Tt.max_lazy_match&&Tt.strstart-xe<=Tt.w_size-nt&&(Tt.match_length=Pe(Tt,xe),Tt.match_length<=5&&(Tt.strategy===1||Tt.match_length===tt&&4096<Tt.strstart-Tt.match_start)&&(Tt.match_length=tt-1)),Tt.prev_length>=tt&&Tt.match_length<=Tt.prev_length){for(Me=Tt.strstart+Tt.lookahead-tt,Kt=rt._tr_tally(Tt,Tt.strstart-1-Tt.prev_match,Tt.prev_length-tt),Tt.lookahead-=Tt.prev_length-1,Tt.prev_length-=2;++Tt.strstart<=Me&&(Tt.ins_h=(Tt.ins_h<<Tt.hash_shift^Tt.window[Tt.strstart+tt-1])&Tt.hash_mask,xe=Tt.prev[Tt.strstart&Tt.w_mask]=Tt.head[Tt.ins_h],Tt.head[Tt.ins_h]=Tt.strstart),--Tt.prev_length!=0;);if(Tt.match_available=0,Tt.match_length=tt-1,Tt.strstart++,Kt&&(be(Tt,!1),Tt.strm.avail_out===0))return 1}else if(Tt.match_available){if((Kt=rt._tr_tally(Tt,0,Tt.window[Tt.strstart-1]))&&be(Tt,!1),Tt.strstart++,Tt.lookahead--,Tt.strm.avail_out===0)return 1}else Tt.match_available=1,Tt.strstart++,Tt.lookahead--}return Tt.match_available&&(Kt=rt._tr_tally(Tt,0,Tt.window[Tt.strstart-1]),Tt.match_available=0),Tt.insert=Tt.strstart<tt-1?Tt.strstart:tt-1,Vt===4?(be(Tt,!0),Tt.strm.avail_out===0?3:4):Tt.last_lit&&(be(Tt,!1),Tt.strm.avail_out===0)?1:2}function Yt(Tt,Vt,xe,Kt,Me){this.good_length=Tt,this.max_lazy=Vt,this.nice_length=xe,this.max_chain=Kt,this.func=Me}function Te(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ht,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _t.Buf16(2*Mt),this.dyn_dtree=new _t.Buf16(2*(2*bt+1)),this.bl_tree=new _t.Buf16(2*(2*ut+1)),Lt(this.dyn_ltree),Lt(this.dyn_dtree),Lt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _t.Buf16(st+1),this.heap=new _t.Buf16(2*mt+1),Lt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _t.Buf16(2*mt+1),Lt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function me(Tt){var Vt;return Tt&&Tt.state?(Tt.total_in=Tt.total_out=0,Tt.data_type=pt,(Vt=Tt.state).pending=0,Vt.pending_out=0,Vt.wrap<0&&(Vt.wrap=-Vt.wrap),Vt.status=Vt.wrap?ue:re,Tt.adler=Vt.wrap===2?0:1,Vt.last_flush=gt,rt._tr_init(Vt),lt):ee(Tt,F)}function De(Tt){var Vt=me(Tt);return Vt===lt&&function(xe){xe.window_size=2*xe.w_size,Lt(xe.head),xe.max_lazy_match=et[xe.level].max_lazy,xe.good_match=et[xe.level].good_length,xe.nice_match=et[xe.level].nice_length,xe.max_chain_length=et[xe.level].max_chain,xe.strstart=0,xe.block_start=0,xe.lookahead=0,xe.insert=0,xe.match_length=xe.prev_length=tt-1,xe.match_available=0,xe.ins_h=0}(Tt.state),Vt}function Ge(Tt,Vt,xe,Kt,Me,Se){if(!Tt)return F;var ke=1;if(Vt===-1&&(Vt=6),Kt<0?(ke=0,Kt=-Kt):15<Kt&&(ke=2,Kt-=16),Me<1||9<Me||xe!==ht||Kt<8||15<Kt||Vt<0||9<Vt||Se<0||4<Se)return ee(Tt,F);Kt===8&&(Kt=9);var Ne=new Te;return(Tt.state=Ne).strm=Tt,Ne.wrap=ke,Ne.gzhead=null,Ne.w_bits=Kt,Ne.w_size=1<<Ne.w_bits,Ne.w_mask=Ne.w_size-1,Ne.hash_bits=Me+7,Ne.hash_size=1<<Ne.hash_bits,Ne.hash_mask=Ne.hash_size-1,Ne.hash_shift=~~((Ne.hash_bits+tt-1)/tt),Ne.window=new _t.Buf8(2*Ne.w_size),Ne.head=new _t.Buf16(Ne.hash_size),Ne.prev=new _t.Buf16(Ne.w_size),Ne.lit_bufsize=1<<Me+6,Ne.pending_buf_size=4*Ne.lit_bufsize,Ne.pending_buf=new _t.Buf8(Ne.pending_buf_size),Ne.d_buf=1*Ne.lit_bufsize,Ne.l_buf=3*Ne.lit_bufsize,Ne.level=Vt,Ne.strategy=Se,Ne.method=xe,De(Tt)}et=[new Yt(0,0,0,0,function(Tt,Vt){var xe=65535;for(xe>Tt.pending_buf_size-5&&(xe=Tt.pending_buf_size-5);;){if(Tt.lookahead<=1){if(It(Tt),Tt.lookahead===0&&Vt===gt)return 1;if(Tt.lookahead===0)break}Tt.strstart+=Tt.lookahead,Tt.lookahead=0;var Kt=Tt.block_start+xe;if((Tt.strstart===0||Tt.strstart>=Kt)&&(Tt.lookahead=Tt.strstart-Kt,Tt.strstart=Kt,be(Tt,!1),Tt.strm.avail_out===0)||Tt.strstart-Tt.block_start>=Tt.w_size-nt&&(be(Tt,!1),Tt.strm.avail_out===0))return 1}return Tt.insert=0,Vt===4?(be(Tt,!0),Tt.strm.avail_out===0?3:4):(Tt.strstart>Tt.block_start&&(be(Tt,!1),Tt.strm.avail_out),1)}),new Yt(4,4,8,4,Rt),new Yt(4,5,16,8,Rt),new Yt(4,6,32,32,Rt),new Yt(4,4,16,16,Jt),new Yt(8,16,32,32,Jt),new Yt(8,16,128,128,Jt),new Yt(8,32,128,256,Jt),new Yt(32,128,258,1024,Jt),new Yt(32,258,258,4096,Jt)],dt.deflateInit=function(Tt,Vt){return Ge(Tt,Vt,ht,15,8,0)},dt.deflateInit2=Ge,dt.deflateReset=De,dt.deflateResetKeep=me,dt.deflateSetHeader=function(Tt,Vt){return Tt&&Tt.state?Tt.state.wrap!==2?F:(Tt.state.gzhead=Vt,lt):F},dt.deflate=function(Tt,Vt){var xe,Kt,Me,Se;if(!Tt||!Tt.state||5<Vt||Vt<0)return Tt?ee(Tt,F):F;if(Kt=Tt.state,!Tt.output||!Tt.input&&Tt.avail_in!==0||Kt.status===666&&Vt!==4)return ee(Tt,Tt.avail_out===0?-5:F);if(Kt.strm=Tt,xe=Kt.last_flush,Kt.last_flush=Vt,Kt.status===ue)if(Kt.wrap===2)Tt.adler=0,se(Kt,31),se(Kt,139),se(Kt,8),Kt.gzhead?(se(Kt,(Kt.gzhead.text?1:0)+(Kt.gzhead.hcrc?2:0)+(Kt.gzhead.extra?4:0)+(Kt.gzhead.name?8:0)+(Kt.gzhead.comment?16:0)),se(Kt,255&Kt.gzhead.time),se(Kt,Kt.gzhead.time>>8&255),se(Kt,Kt.gzhead.time>>16&255),se(Kt,Kt.gzhead.time>>24&255),se(Kt,Kt.level===9?2:2<=Kt.strategy||Kt.level<2?4:0),se(Kt,255&Kt.gzhead.os),Kt.gzhead.extra&&Kt.gzhead.extra.length&&(se(Kt,255&Kt.gzhead.extra.length),se(Kt,Kt.gzhead.extra.length>>8&255)),Kt.gzhead.hcrc&&(Tt.adler=St(Tt.adler,Kt.pending_buf,Kt.pending,0)),Kt.gzindex=0,Kt.status=69):(se(Kt,0),se(Kt,0),se(Kt,0),se(Kt,0),se(Kt,0),se(Kt,Kt.level===9?2:2<=Kt.strategy||Kt.level<2?4:0),se(Kt,3),Kt.status=re);else{var ke=ht+(Kt.w_bits-8<<4)<<8;ke|=(2<=Kt.strategy||Kt.level<2?0:Kt.level<6?1:Kt.level===6?2:3)<<6,Kt.strstart!==0&&(ke|=32),ke+=31-ke%31,Kt.status=re,Fe(Kt,ke),Kt.strstart!==0&&(Fe(Kt,Tt.adler>>>16),Fe(Kt,65535&Tt.adler)),Tt.adler=1}if(Kt.status===69)if(Kt.gzhead.extra){for(Me=Kt.pending;Kt.gzindex<(65535&Kt.gzhead.extra.length)&&(Kt.pending!==Kt.pending_buf_size||(Kt.gzhead.hcrc&&Kt.pending>Me&&(Tt.adler=St(Tt.adler,Kt.pending_buf,Kt.pending-Me,Me)),pe(Tt),Me=Kt.pending,Kt.pending!==Kt.pending_buf_size));)se(Kt,255&Kt.gzhead.extra[Kt.gzindex]),Kt.gzindex++;Kt.gzhead.hcrc&&Kt.pending>Me&&(Tt.adler=St(Tt.adler,Kt.pending_buf,Kt.pending-Me,Me)),Kt.gzindex===Kt.gzhead.extra.length&&(Kt.gzindex=0,Kt.status=73)}else Kt.status=73;if(Kt.status===73)if(Kt.gzhead.name){Me=Kt.pending;do{if(Kt.pending===Kt.pending_buf_size&&(Kt.gzhead.hcrc&&Kt.pending>Me&&(Tt.adler=St(Tt.adler,Kt.pending_buf,Kt.pending-Me,Me)),pe(Tt),Me=Kt.pending,Kt.pending===Kt.pending_buf_size)){Se=1;break}Se=Kt.gzindex<Kt.gzhead.name.length?255&Kt.gzhead.name.charCodeAt(Kt.gzindex++):0,se(Kt,Se)}while(Se!==0);Kt.gzhead.hcrc&&Kt.pending>Me&&(Tt.adler=St(Tt.adler,Kt.pending_buf,Kt.pending-Me,Me)),Se===0&&(Kt.gzindex=0,Kt.status=91)}else Kt.status=91;if(Kt.status===91)if(Kt.gzhead.comment){Me=Kt.pending;do{if(Kt.pending===Kt.pending_buf_size&&(Kt.gzhead.hcrc&&Kt.pending>Me&&(Tt.adler=St(Tt.adler,Kt.pending_buf,Kt.pending-Me,Me)),pe(Tt),Me=Kt.pending,Kt.pending===Kt.pending_buf_size)){Se=1;break}Se=Kt.gzindex<Kt.gzhead.comment.length?255&Kt.gzhead.comment.charCodeAt(Kt.gzindex++):0,se(Kt,Se)}while(Se!==0);Kt.gzhead.hcrc&&Kt.pending>Me&&(Tt.adler=St(Tt.adler,Kt.pending_buf,Kt.pending-Me,Me)),Se===0&&(Kt.status=103)}else Kt.status=103;if(Kt.status===103&&(Kt.gzhead.hcrc?(Kt.pending+2>Kt.pending_buf_size&&pe(Tt),Kt.pending+2<=Kt.pending_buf_size&&(se(Kt,255&Tt.adler),se(Kt,Tt.adler>>8&255),Tt.adler=0,Kt.status=re)):Kt.status=re),Kt.pending!==0){if(pe(Tt),Tt.avail_out===0)return Kt.last_flush=-1,lt}else if(Tt.avail_in===0&&Qt(Vt)<=Qt(xe)&&Vt!==4)return ee(Tt,-5);if(Kt.status===666&&Tt.avail_in!==0)return ee(Tt,-5);if(Tt.avail_in!==0||Kt.lookahead!==0||Vt!==gt&&Kt.status!==666){var Ne=Kt.strategy===2?function(Oe,$e){for(var l0;;){if(Oe.lookahead===0&&(It(Oe),Oe.lookahead===0)){if($e===gt)return 1;break}if(Oe.match_length=0,l0=rt._tr_tally(Oe,0,Oe.window[Oe.strstart]),Oe.lookahead--,Oe.strstart++,l0&&(be(Oe,!1),Oe.strm.avail_out===0))return 1}return Oe.insert=0,$e===4?(be(Oe,!0),Oe.strm.avail_out===0?3:4):Oe.last_lit&&(be(Oe,!1),Oe.strm.avail_out===0)?1:2}(Kt,Vt):Kt.strategy===3?function(Oe,$e){for(var l0,je,I0,X0,W0=Oe.window;;){if(Oe.lookahead<=Ut){if(It(Oe),Oe.lookahead<=Ut&&$e===gt)return 1;if(Oe.lookahead===0)break}if(Oe.match_length=0,Oe.lookahead>=tt&&0<Oe.strstart&&(je=W0[I0=Oe.strstart-1])===W0[++I0]&&je===W0[++I0]&&je===W0[++I0]){X0=Oe.strstart+Ut;do;while(je===W0[++I0]&&je===W0[++I0]&&je===W0[++I0]&&je===W0[++I0]&&je===W0[++I0]&&je===W0[++I0]&&je===W0[++I0]&&je===W0[++I0]&&I0<X0);Oe.match_length=Ut-(X0-I0),Oe.match_length>Oe.lookahead&&(Oe.match_length=Oe.lookahead)}if(Oe.match_length>=tt?(l0=rt._tr_tally(Oe,1,Oe.match_length-tt),Oe.lookahead-=Oe.match_length,Oe.strstart+=Oe.match_length,Oe.match_length=0):(l0=rt._tr_tally(Oe,0,Oe.window[Oe.strstart]),Oe.lookahead--,Oe.strstart++),l0&&(be(Oe,!1),Oe.strm.avail_out===0))return 1}return Oe.insert=0,$e===4?(be(Oe,!0),Oe.strm.avail_out===0?3:4):Oe.last_lit&&(be(Oe,!1),Oe.strm.avail_out===0)?1:2}(Kt,Vt):et[Kt.level].func(Kt,Vt);if(Ne!==3&&Ne!==4||(Kt.status=666),Ne===1||Ne===3)return Tt.avail_out===0&&(Kt.last_flush=-1),lt;if(Ne===2&&(Vt===1?rt._tr_align(Kt):Vt!==5&&(rt._tr_stored_block(Kt,0,0,!1),Vt===3&&(Lt(Kt.head),Kt.lookahead===0&&(Kt.strstart=0,Kt.block_start=0,Kt.insert=0))),pe(Tt),Tt.avail_out===0))return Kt.last_flush=-1,lt}return Vt!==4?lt:Kt.wrap<=0?1:(Kt.wrap===2?(se(Kt,255&Tt.adler),se(Kt,Tt.adler>>8&255),se(Kt,Tt.adler>>16&255),se(Kt,Tt.adler>>24&255),se(Kt,255&Tt.total_in),se(Kt,Tt.total_in>>8&255),se(Kt,Tt.total_in>>16&255),se(Kt,Tt.total_in>>24&255)):(Fe(Kt,Tt.adler>>>16),Fe(Kt,65535&Tt.adler)),pe(Tt),0<Kt.wrap&&(Kt.wrap=-Kt.wrap),Kt.pending!==0?lt:1)},dt.deflateEnd=function(Tt){var Vt;return Tt&&Tt.state?(Vt=Tt.state.status)!==ue&&Vt!==69&&Vt!==73&&Vt!==91&&Vt!==103&&Vt!==re&&Vt!==666?ee(Tt,F):(Tt.state=null,Vt===re?ee(Tt,-3):lt):F},dt.deflateSetDictionary=function(Tt,Vt){var xe,Kt,Me,Se,ke,Ne,Oe,$e,l0=Vt.length;if(!Tt||!Tt.state||(Se=(xe=Tt.state).wrap)===2||Se===1&&xe.status!==ue||xe.lookahead)return F;for(Se===1&&(Tt.adler=Pt(Tt.adler,Vt,l0,0)),xe.wrap=0,l0>=xe.w_size&&(Se===0&&(Lt(xe.head),xe.strstart=0,xe.block_start=0,xe.insert=0),$e=new _t.Buf8(xe.w_size),_t.arraySet($e,Vt,l0-xe.w_size,xe.w_size,0),Vt=$e,l0=xe.w_size),ke=Tt.avail_in,Ne=Tt.next_in,Oe=Tt.input,Tt.avail_in=l0,Tt.next_in=0,Tt.input=Vt,It(xe);xe.lookahead>=tt;){for(Kt=xe.strstart,Me=xe.lookahead-(tt-1);xe.ins_h=(xe.ins_h<<xe.hash_shift^xe.window[Kt+tt-1])&xe.hash_mask,xe.prev[Kt&xe.w_mask]=xe.head[xe.ins_h],xe.head[xe.ins_h]=Kt,Kt++,--Me;);xe.strstart=Kt,xe.lookahead=tt-1,It(xe)}return xe.strstart+=xe.lookahead,xe.block_start=xe.strstart,xe.insert=xe.lookahead,xe.lookahead=0,xe.match_length=xe.prev_length=tt-1,xe.match_available=0,Tt.next_in=Ne,Tt.input=Oe,Tt.avail_in=ke,xe.wrap=Se,lt},dt.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(ft,at,dt){at.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(ft,at,dt){at.exports=function(et,_t){var rt,Pt,St,yt,gt,lt,F,pt,ht,mt,bt,ut,Mt,st,tt,Ut,nt,ue,re,ee,Qt,Lt,pe,be,se;rt=et.state,Pt=et.next_in,be=et.input,St=Pt+(et.avail_in-5),yt=et.next_out,se=et.output,gt=yt-(_t-et.avail_out),lt=yt+(et.avail_out-257),F=rt.dmax,pt=rt.wsize,ht=rt.whave,mt=rt.wnext,bt=rt.window,ut=rt.hold,Mt=rt.bits,st=rt.lencode,tt=rt.distcode,Ut=(1<<rt.lenbits)-1,nt=(1<<rt.distbits)-1;t:do{Mt<15&&(ut+=be[Pt++]<<Mt,Mt+=8,ut+=be[Pt++]<<Mt,Mt+=8),ue=st[ut&Ut];e:for(;;){if(ut>>>=re=ue>>>24,Mt-=re,(re=ue>>>16&255)==0)se[yt++]=65535&ue;else{if(!(16&re)){if(!(64&re)){ue=st[(65535&ue)+(ut&(1<<re)-1)];continue e}if(32&re){rt.mode=12;break t}et.msg="invalid literal/length code",rt.mode=30;break t}ee=65535&ue,(re&=15)&&(Mt<re&&(ut+=be[Pt++]<<Mt,Mt+=8),ee+=ut&(1<<re)-1,ut>>>=re,Mt-=re),Mt<15&&(ut+=be[Pt++]<<Mt,Mt+=8,ut+=be[Pt++]<<Mt,Mt+=8),ue=tt[ut&nt];x:for(;;){if(ut>>>=re=ue>>>24,Mt-=re,!(16&(re=ue>>>16&255))){if(!(64&re)){ue=tt[(65535&ue)+(ut&(1<<re)-1)];continue x}et.msg="invalid distance code",rt.mode=30;break t}if(Qt=65535&ue,Mt<(re&=15)&&(ut+=be[Pt++]<<Mt,(Mt+=8)<re&&(ut+=be[Pt++]<<Mt,Mt+=8)),F<(Qt+=ut&(1<<re)-1)){et.msg="invalid distance too far back",rt.mode=30;break t}if(ut>>>=re,Mt-=re,(re=yt-gt)<Qt){if(ht<(re=Qt-re)&&rt.sane){et.msg="invalid distance too far back",rt.mode=30;break t}if(pe=bt,(Lt=0)===mt){if(Lt+=pt-re,re<ee){for(ee-=re;se[yt++]=bt[Lt++],--re;);Lt=yt-Qt,pe=se}}else if(mt<re){if(Lt+=pt+mt-re,(re-=mt)<ee){for(ee-=re;se[yt++]=bt[Lt++],--re;);if(Lt=0,mt<ee){for(ee-=re=mt;se[yt++]=bt[Lt++],--re;);Lt=yt-Qt,pe=se}}}else if(Lt+=mt-re,re<ee){for(ee-=re;se[yt++]=bt[Lt++],--re;);Lt=yt-Qt,pe=se}for(;2<ee;)se[yt++]=pe[Lt++],se[yt++]=pe[Lt++],se[yt++]=pe[Lt++],ee-=3;ee&&(se[yt++]=pe[Lt++],1<ee&&(se[yt++]=pe[Lt++]))}else{for(Lt=yt-Qt;se[yt++]=se[Lt++],se[yt++]=se[Lt++],se[yt++]=se[Lt++],2<(ee-=3););ee&&(se[yt++]=se[Lt++],1<ee&&(se[yt++]=se[Lt++]))}break}}break}}while(Pt<St&&yt<lt);Pt-=ee=Mt>>3,ut&=(1<<(Mt-=ee<<3))-1,et.next_in=Pt,et.next_out=yt,et.avail_in=Pt<St?St-Pt+5:5-(Pt-St),et.avail_out=yt<lt?lt-yt+257:257-(yt-lt),rt.hold=ut,rt.bits=Mt}},{}],49:[function(ft,at,dt){var et=ft("../utils/common"),_t=ft("./adler32"),rt=ft("./crc32"),Pt=ft("./inffast"),St=ft("./inftrees"),yt=0,gt=-2,lt=1,F=852,pt=592;function ht(ee){return(ee>>>24&255)+(ee>>>8&65280)+((65280&ee)<<8)+((255&ee)<<24)}function mt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new et.Buf16(320),this.work=new et.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function bt(ee){var Qt;return ee&&ee.state?(Qt=ee.state,ee.total_in=ee.total_out=Qt.total=0,ee.msg="",Qt.wrap&&(ee.adler=1&Qt.wrap),Qt.mode=lt,Qt.last=0,Qt.havedict=0,Qt.dmax=32768,Qt.head=null,Qt.hold=0,Qt.bits=0,Qt.lencode=Qt.lendyn=new et.Buf32(F),Qt.distcode=Qt.distdyn=new et.Buf32(pt),Qt.sane=1,Qt.back=-1,yt):gt}function ut(ee){var Qt;return ee&&ee.state?((Qt=ee.state).wsize=0,Qt.whave=0,Qt.wnext=0,bt(ee)):gt}function Mt(ee,Qt){var Lt,pe;return ee&&ee.state?(pe=ee.state,Qt<0?(Lt=0,Qt=-Qt):(Lt=1+(Qt>>4),Qt<48&&(Qt&=15)),Qt&&(Qt<8||15<Qt)?gt:(pe.window!==null&&pe.wbits!==Qt&&(pe.window=null),pe.wrap=Lt,pe.wbits=Qt,ut(ee))):gt}function st(ee,Qt){var Lt,pe;return ee?(pe=new mt,(ee.state=pe).window=null,(Lt=Mt(ee,Qt))!==yt&&(ee.state=null),Lt):gt}var tt,Ut,nt=!0;function ue(ee){if(nt){var Qt;for(tt=new et.Buf32(512),Ut=new et.Buf32(32),Qt=0;Qt<144;)ee.lens[Qt++]=8;for(;Qt<256;)ee.lens[Qt++]=9;for(;Qt<280;)ee.lens[Qt++]=7;for(;Qt<288;)ee.lens[Qt++]=8;for(St(1,ee.lens,0,288,tt,0,ee.work,{bits:9}),Qt=0;Qt<32;)ee.lens[Qt++]=5;St(2,ee.lens,0,32,Ut,0,ee.work,{bits:5}),nt=!1}ee.lencode=tt,ee.lenbits=9,ee.distcode=Ut,ee.distbits=5}function re(ee,Qt,Lt,pe){var be,se=ee.state;return se.window===null&&(se.wsize=1<<se.wbits,se.wnext=0,se.whave=0,se.window=new et.Buf8(se.wsize)),pe>=se.wsize?(et.arraySet(se.window,Qt,Lt-se.wsize,se.wsize,0),se.wnext=0,se.whave=se.wsize):(pe<(be=se.wsize-se.wnext)&&(be=pe),et.arraySet(se.window,Qt,Lt-pe,be,se.wnext),(pe-=be)?(et.arraySet(se.window,Qt,Lt-pe,pe,0),se.wnext=pe,se.whave=se.wsize):(se.wnext+=be,se.wnext===se.wsize&&(se.wnext=0),se.whave<se.wsize&&(se.whave+=be))),0}dt.inflateReset=ut,dt.inflateReset2=Mt,dt.inflateResetKeep=bt,dt.inflateInit=function(ee){return st(ee,15)},dt.inflateInit2=st,dt.inflate=function(ee,Qt){var Lt,pe,be,se,Fe,Pe,It,Rt,Jt,Yt,Te,me,De,Ge,Tt,Vt,xe,Kt,Me,Se,ke,Ne,Oe,$e,l0=0,je=new et.Buf8(4),I0=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ee||!ee.state||!ee.output||!ee.input&&ee.avail_in!==0)return gt;(Lt=ee.state).mode===12&&(Lt.mode=13),Fe=ee.next_out,be=ee.output,It=ee.avail_out,se=ee.next_in,pe=ee.input,Pe=ee.avail_in,Rt=Lt.hold,Jt=Lt.bits,Yt=Pe,Te=It,Ne=yt;t:for(;;)switch(Lt.mode){case lt:if(Lt.wrap===0){Lt.mode=13;break}for(;Jt<16;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(2&Lt.wrap&&Rt===35615){je[Lt.check=0]=255&Rt,je[1]=Rt>>>8&255,Lt.check=rt(Lt.check,je,2,0),Jt=Rt=0,Lt.mode=2;break}if(Lt.flags=0,Lt.head&&(Lt.head.done=!1),!(1&Lt.wrap)||(((255&Rt)<<8)+(Rt>>8))%31){ee.msg="incorrect header check",Lt.mode=30;break}if((15&Rt)!=8){ee.msg="unknown compression method",Lt.mode=30;break}if(Jt-=4,ke=8+(15&(Rt>>>=4)),Lt.wbits===0)Lt.wbits=ke;else if(ke>Lt.wbits){ee.msg="invalid window size",Lt.mode=30;break}Lt.dmax=1<<ke,ee.adler=Lt.check=1,Lt.mode=512&Rt?10:12,Jt=Rt=0;break;case 2:for(;Jt<16;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(Lt.flags=Rt,(255&Lt.flags)!=8){ee.msg="unknown compression method",Lt.mode=30;break}if(57344&Lt.flags){ee.msg="unknown header flags set",Lt.mode=30;break}Lt.head&&(Lt.head.text=Rt>>8&1),512&Lt.flags&&(je[0]=255&Rt,je[1]=Rt>>>8&255,Lt.check=rt(Lt.check,je,2,0)),Jt=Rt=0,Lt.mode=3;case 3:for(;Jt<32;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Lt.head&&(Lt.head.time=Rt),512&Lt.flags&&(je[0]=255&Rt,je[1]=Rt>>>8&255,je[2]=Rt>>>16&255,je[3]=Rt>>>24&255,Lt.check=rt(Lt.check,je,4,0)),Jt=Rt=0,Lt.mode=4;case 4:for(;Jt<16;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Lt.head&&(Lt.head.xflags=255&Rt,Lt.head.os=Rt>>8),512&Lt.flags&&(je[0]=255&Rt,je[1]=Rt>>>8&255,Lt.check=rt(Lt.check,je,2,0)),Jt=Rt=0,Lt.mode=5;case 5:if(1024&Lt.flags){for(;Jt<16;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Lt.length=Rt,Lt.head&&(Lt.head.extra_len=Rt),512&Lt.flags&&(je[0]=255&Rt,je[1]=Rt>>>8&255,Lt.check=rt(Lt.check,je,2,0)),Jt=Rt=0}else Lt.head&&(Lt.head.extra=null);Lt.mode=6;case 6:if(1024&Lt.flags&&(Pe<(me=Lt.length)&&(me=Pe),me&&(Lt.head&&(ke=Lt.head.extra_len-Lt.length,Lt.head.extra||(Lt.head.extra=new Array(Lt.head.extra_len)),et.arraySet(Lt.head.extra,pe,se,me,ke)),512&Lt.flags&&(Lt.check=rt(Lt.check,pe,me,se)),Pe-=me,se+=me,Lt.length-=me),Lt.length))break t;Lt.length=0,Lt.mode=7;case 7:if(2048&Lt.flags){if(Pe===0)break t;for(me=0;ke=pe[se+me++],Lt.head&&ke&&Lt.length<65536&&(Lt.head.name+=String.fromCharCode(ke)),ke&&me<Pe;);if(512&Lt.flags&&(Lt.check=rt(Lt.check,pe,me,se)),Pe-=me,se+=me,ke)break t}else Lt.head&&(Lt.head.name=null);Lt.length=0,Lt.mode=8;case 8:if(4096&Lt.flags){if(Pe===0)break t;for(me=0;ke=pe[se+me++],Lt.head&&ke&&Lt.length<65536&&(Lt.head.comment+=String.fromCharCode(ke)),ke&&me<Pe;);if(512&Lt.flags&&(Lt.check=rt(Lt.check,pe,me,se)),Pe-=me,se+=me,ke)break t}else Lt.head&&(Lt.head.comment=null);Lt.mode=9;case 9:if(512&Lt.flags){for(;Jt<16;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(Rt!==(65535&Lt.check)){ee.msg="header crc mismatch",Lt.mode=30;break}Jt=Rt=0}Lt.head&&(Lt.head.hcrc=Lt.flags>>9&1,Lt.head.done=!0),ee.adler=Lt.check=0,Lt.mode=12;break;case 10:for(;Jt<32;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}ee.adler=Lt.check=ht(Rt),Jt=Rt=0,Lt.mode=11;case 11:if(Lt.havedict===0)return ee.next_out=Fe,ee.avail_out=It,ee.next_in=se,ee.avail_in=Pe,Lt.hold=Rt,Lt.bits=Jt,2;ee.adler=Lt.check=1,Lt.mode=12;case 12:if(Qt===5||Qt===6)break t;case 13:if(Lt.last){Rt>>>=7&Jt,Jt-=7&Jt,Lt.mode=27;break}for(;Jt<3;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}switch(Lt.last=1&Rt,Jt-=1,3&(Rt>>>=1)){case 0:Lt.mode=14;break;case 1:if(ue(Lt),Lt.mode=20,Qt!==6)break;Rt>>>=2,Jt-=2;break t;case 2:Lt.mode=17;break;case 3:ee.msg="invalid block type",Lt.mode=30}Rt>>>=2,Jt-=2;break;case 14:for(Rt>>>=7&Jt,Jt-=7&Jt;Jt<32;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if((65535&Rt)!=(Rt>>>16^65535)){ee.msg="invalid stored block lengths",Lt.mode=30;break}if(Lt.length=65535&Rt,Jt=Rt=0,Lt.mode=15,Qt===6)break t;case 15:Lt.mode=16;case 16:if(me=Lt.length){if(Pe<me&&(me=Pe),It<me&&(me=It),me===0)break t;et.arraySet(be,pe,se,me,Fe),Pe-=me,se+=me,It-=me,Fe+=me,Lt.length-=me;break}Lt.mode=12;break;case 17:for(;Jt<14;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(Lt.nlen=257+(31&Rt),Rt>>>=5,Jt-=5,Lt.ndist=1+(31&Rt),Rt>>>=5,Jt-=5,Lt.ncode=4+(15&Rt),Rt>>>=4,Jt-=4,286<Lt.nlen||30<Lt.ndist){ee.msg="too many length or distance symbols",Lt.mode=30;break}Lt.have=0,Lt.mode=18;case 18:for(;Lt.have<Lt.ncode;){for(;Jt<3;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Lt.lens[I0[Lt.have++]]=7&Rt,Rt>>>=3,Jt-=3}for(;Lt.have<19;)Lt.lens[I0[Lt.have++]]=0;if(Lt.lencode=Lt.lendyn,Lt.lenbits=7,Oe={bits:Lt.lenbits},Ne=St(0,Lt.lens,0,19,Lt.lencode,0,Lt.work,Oe),Lt.lenbits=Oe.bits,Ne){ee.msg="invalid code lengths set",Lt.mode=30;break}Lt.have=0,Lt.mode=19;case 19:for(;Lt.have<Lt.nlen+Lt.ndist;){for(;Vt=(l0=Lt.lencode[Rt&(1<<Lt.lenbits)-1])>>>16&255,xe=65535&l0,!((Tt=l0>>>24)<=Jt);){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(xe<16)Rt>>>=Tt,Jt-=Tt,Lt.lens[Lt.have++]=xe;else{if(xe===16){for($e=Tt+2;Jt<$e;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(Rt>>>=Tt,Jt-=Tt,Lt.have===0){ee.msg="invalid bit length repeat",Lt.mode=30;break}ke=Lt.lens[Lt.have-1],me=3+(3&Rt),Rt>>>=2,Jt-=2}else if(xe===17){for($e=Tt+3;Jt<$e;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Jt-=Tt,ke=0,me=3+(7&(Rt>>>=Tt)),Rt>>>=3,Jt-=3}else{for($e=Tt+7;Jt<$e;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Jt-=Tt,ke=0,me=11+(127&(Rt>>>=Tt)),Rt>>>=7,Jt-=7}if(Lt.have+me>Lt.nlen+Lt.ndist){ee.msg="invalid bit length repeat",Lt.mode=30;break}for(;me--;)Lt.lens[Lt.have++]=ke}}if(Lt.mode===30)break;if(Lt.lens[256]===0){ee.msg="invalid code -- missing end-of-block",Lt.mode=30;break}if(Lt.lenbits=9,Oe={bits:Lt.lenbits},Ne=St(1,Lt.lens,0,Lt.nlen,Lt.lencode,0,Lt.work,Oe),Lt.lenbits=Oe.bits,Ne){ee.msg="invalid literal/lengths set",Lt.mode=30;break}if(Lt.distbits=6,Lt.distcode=Lt.distdyn,Oe={bits:Lt.distbits},Ne=St(2,Lt.lens,Lt.nlen,Lt.ndist,Lt.distcode,0,Lt.work,Oe),Lt.distbits=Oe.bits,Ne){ee.msg="invalid distances set",Lt.mode=30;break}if(Lt.mode=20,Qt===6)break t;case 20:Lt.mode=21;case 21:if(6<=Pe&&258<=It){ee.next_out=Fe,ee.avail_out=It,ee.next_in=se,ee.avail_in=Pe,Lt.hold=Rt,Lt.bits=Jt,Pt(ee,Te),Fe=ee.next_out,be=ee.output,It=ee.avail_out,se=ee.next_in,pe=ee.input,Pe=ee.avail_in,Rt=Lt.hold,Jt=Lt.bits,Lt.mode===12&&(Lt.back=-1);break}for(Lt.back=0;Vt=(l0=Lt.lencode[Rt&(1<<Lt.lenbits)-1])>>>16&255,xe=65535&l0,!((Tt=l0>>>24)<=Jt);){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(Vt&&!(240&Vt)){for(Kt=Tt,Me=Vt,Se=xe;Vt=(l0=Lt.lencode[Se+((Rt&(1<<Kt+Me)-1)>>Kt)])>>>16&255,xe=65535&l0,!(Kt+(Tt=l0>>>24)<=Jt);){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Rt>>>=Kt,Jt-=Kt,Lt.back+=Kt}if(Rt>>>=Tt,Jt-=Tt,Lt.back+=Tt,Lt.length=xe,Vt===0){Lt.mode=26;break}if(32&Vt){Lt.back=-1,Lt.mode=12;break}if(64&Vt){ee.msg="invalid literal/length code",Lt.mode=30;break}Lt.extra=15&Vt,Lt.mode=22;case 22:if(Lt.extra){for($e=Lt.extra;Jt<$e;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Lt.length+=Rt&(1<<Lt.extra)-1,Rt>>>=Lt.extra,Jt-=Lt.extra,Lt.back+=Lt.extra}Lt.was=Lt.length,Lt.mode=23;case 23:for(;Vt=(l0=Lt.distcode[Rt&(1<<Lt.distbits)-1])>>>16&255,xe=65535&l0,!((Tt=l0>>>24)<=Jt);){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(!(240&Vt)){for(Kt=Tt,Me=Vt,Se=xe;Vt=(l0=Lt.distcode[Se+((Rt&(1<<Kt+Me)-1)>>Kt)])>>>16&255,xe=65535&l0,!(Kt+(Tt=l0>>>24)<=Jt);){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Rt>>>=Kt,Jt-=Kt,Lt.back+=Kt}if(Rt>>>=Tt,Jt-=Tt,Lt.back+=Tt,64&Vt){ee.msg="invalid distance code",Lt.mode=30;break}Lt.offset=xe,Lt.extra=15&Vt,Lt.mode=24;case 24:if(Lt.extra){for($e=Lt.extra;Jt<$e;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}Lt.offset+=Rt&(1<<Lt.extra)-1,Rt>>>=Lt.extra,Jt-=Lt.extra,Lt.back+=Lt.extra}if(Lt.offset>Lt.dmax){ee.msg="invalid distance too far back",Lt.mode=30;break}Lt.mode=25;case 25:if(It===0)break t;if(me=Te-It,Lt.offset>me){if((me=Lt.offset-me)>Lt.whave&&Lt.sane){ee.msg="invalid distance too far back",Lt.mode=30;break}De=me>Lt.wnext?(me-=Lt.wnext,Lt.wsize-me):Lt.wnext-me,me>Lt.length&&(me=Lt.length),Ge=Lt.window}else Ge=be,De=Fe-Lt.offset,me=Lt.length;for(It<me&&(me=It),It-=me,Lt.length-=me;be[Fe++]=Ge[De++],--me;);Lt.length===0&&(Lt.mode=21);break;case 26:if(It===0)break t;be[Fe++]=Lt.length,It--,Lt.mode=21;break;case 27:if(Lt.wrap){for(;Jt<32;){if(Pe===0)break t;Pe--,Rt|=pe[se++]<<Jt,Jt+=8}if(Te-=It,ee.total_out+=Te,Lt.total+=Te,Te&&(ee.adler=Lt.check=Lt.flags?rt(Lt.check,be,Te,Fe-Te):_t(Lt.check,be,Te,Fe-Te)),Te=It,(Lt.flags?Rt:ht(Rt))!==Lt.check){ee.msg="incorrect data check",Lt.mode=30;break}Jt=Rt=0}Lt.mode=28;case 28:if(Lt.wrap&&Lt.flags){for(;Jt<32;){if(Pe===0)break t;Pe--,Rt+=pe[se++]<<Jt,Jt+=8}if(Rt!==(4294967295&Lt.total)){ee.msg="incorrect length check",Lt.mode=30;break}Jt=Rt=0}Lt.mode=29;case 29:Ne=1;break t;case 30:Ne=-3;break t;case 31:return-4;default:return gt}return ee.next_out=Fe,ee.avail_out=It,ee.next_in=se,ee.avail_in=Pe,Lt.hold=Rt,Lt.bits=Jt,(Lt.wsize||Te!==ee.avail_out&&Lt.mode<30&&(Lt.mode<27||Qt!==4))&&re(ee,ee.output,ee.next_out,Te-ee.avail_out)?(Lt.mode=31,-4):(Yt-=ee.avail_in,Te-=ee.avail_out,ee.total_in+=Yt,ee.total_out+=Te,Lt.total+=Te,Lt.wrap&&Te&&(ee.adler=Lt.check=Lt.flags?rt(Lt.check,be,Te,ee.next_out-Te):_t(Lt.check,be,Te,ee.next_out-Te)),ee.data_type=Lt.bits+(Lt.last?64:0)+(Lt.mode===12?128:0)+(Lt.mode===20||Lt.mode===15?256:0),(Yt==0&&Te===0||Qt===4)&&Ne===yt&&(Ne=-5),Ne)},dt.inflateEnd=function(ee){if(!ee||!ee.state)return gt;var Qt=ee.state;return Qt.window&&(Qt.window=null),ee.state=null,yt},dt.inflateGetHeader=function(ee,Qt){var Lt;return ee&&ee.state&&2&(Lt=ee.state).wrap?((Lt.head=Qt).done=!1,yt):gt},dt.inflateSetDictionary=function(ee,Qt){var Lt,pe=Qt.length;return ee&&ee.state?(Lt=ee.state).wrap!==0&&Lt.mode!==11?gt:Lt.mode===11&&_t(1,Qt,pe,0)!==Lt.check?-3:re(ee,Qt,pe,pe)?(Lt.mode=31,-4):(Lt.havedict=1,yt):gt},dt.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(ft,at,dt){var et=ft("../utils/common"),_t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],rt=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Pt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],St=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];at.exports=function(yt,gt,lt,F,pt,ht,mt,bt){var ut,Mt,st,tt,Ut,nt,ue,re,ee,Qt=bt.bits,Lt=0,pe=0,be=0,se=0,Fe=0,Pe=0,It=0,Rt=0,Jt=0,Yt=0,Te=null,me=0,De=new et.Buf16(16),Ge=new et.Buf16(16),Tt=null,Vt=0;for(Lt=0;Lt<=15;Lt++)De[Lt]=0;for(pe=0;pe<F;pe++)De[gt[lt+pe]]++;for(Fe=Qt,se=15;1<=se&&De[se]===0;se--);if(se<Fe&&(Fe=se),se===0)return pt[ht++]=20971520,pt[ht++]=20971520,bt.bits=1,0;for(be=1;be<se&&De[be]===0;be++);for(Fe<be&&(Fe=be),Lt=Rt=1;Lt<=15;Lt++)if(Rt<<=1,(Rt-=De[Lt])<0)return-1;if(0<Rt&&(yt===0||se!==1))return-1;for(Ge[1]=0,Lt=1;Lt<15;Lt++)Ge[Lt+1]=Ge[Lt]+De[Lt];for(pe=0;pe<F;pe++)gt[lt+pe]!==0&&(mt[Ge[gt[lt+pe]]++]=pe);if(nt=yt===0?(Te=Tt=mt,19):yt===1?(Te=_t,me-=257,Tt=rt,Vt-=257,256):(Te=Pt,Tt=St,-1),Lt=be,Ut=ht,It=pe=Yt=0,st=-1,tt=(Jt=1<<(Pe=Fe))-1,yt===1&&852<Jt||yt===2&&592<Jt)return 1;for(;;){for(ue=Lt-It,ee=mt[pe]<nt?(re=0,mt[pe]):mt[pe]>nt?(re=Tt[Vt+mt[pe]],Te[me+mt[pe]]):(re=96,0),ut=1<<Lt-It,be=Mt=1<<Pe;pt[Ut+(Yt>>It)+(Mt-=ut)]=ue<<24|re<<16|ee|0,Mt!==0;);for(ut=1<<Lt-1;Yt&ut;)ut>>=1;if(ut!==0?(Yt&=ut-1,Yt+=ut):Yt=0,pe++,--De[Lt]==0){if(Lt===se)break;Lt=gt[lt+mt[pe]]}if(Fe<Lt&&(Yt&tt)!==st){for(It===0&&(It=Fe),Ut+=be,Rt=1<<(Pe=Lt-It);Pe+It<se&&!((Rt-=De[Pe+It])<=0);)Pe++,Rt<<=1;if(Jt+=1<<Pe,yt===1&&852<Jt||yt===2&&592<Jt)return 1;pt[st=Yt&tt]=Fe<<24|Pe<<16|Ut-ht|0}}return Yt!==0&&(pt[Ut+Yt]=Lt-It<<24|4194304|0),bt.bits=Fe,0}},{"../utils/common":41}],51:[function(ft,at,dt){at.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(ft,at,dt){var et=ft("../utils/common");function _t(Vt){for(var xe=Vt.length;0<=--xe;)Vt[xe]=0}var rt=256,Pt=286,St=30,yt=15,gt=16,lt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],pt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],mt=new Array(576);_t(mt);var bt=new Array(60);_t(bt);var ut=new Array(512);_t(ut);var Mt=new Array(256);_t(Mt);var st=new Array(29);_t(st);var tt,Ut,nt,ue=new Array(St);function re(Vt,xe,Kt,Me,Se){this.static_tree=Vt,this.extra_bits=xe,this.extra_base=Kt,this.elems=Me,this.max_length=Se,this.has_stree=Vt&&Vt.length}function ee(Vt,xe){this.dyn_tree=Vt,this.max_code=0,this.stat_desc=xe}function Qt(Vt){return Vt<256?ut[Vt]:ut[256+(Vt>>>7)]}function Lt(Vt,xe){Vt.pending_buf[Vt.pending++]=255&xe,Vt.pending_buf[Vt.pending++]=xe>>>8&255}function pe(Vt,xe,Kt){Vt.bi_valid>gt-Kt?(Vt.bi_buf|=xe<<Vt.bi_valid&65535,Lt(Vt,Vt.bi_buf),Vt.bi_buf=xe>>gt-Vt.bi_valid,Vt.bi_valid+=Kt-gt):(Vt.bi_buf|=xe<<Vt.bi_valid&65535,Vt.bi_valid+=Kt)}function be(Vt,xe,Kt){pe(Vt,Kt[2*xe],Kt[2*xe+1])}function se(Vt,xe){for(var Kt=0;Kt|=1&Vt,Vt>>>=1,Kt<<=1,0<--xe;);return Kt>>>1}function Fe(Vt,xe,Kt){var Me,Se,ke=new Array(yt+1),Ne=0;for(Me=1;Me<=yt;Me++)ke[Me]=Ne=Ne+Kt[Me-1]<<1;for(Se=0;Se<=xe;Se++){var Oe=Vt[2*Se+1];Oe!==0&&(Vt[2*Se]=se(ke[Oe]++,Oe))}}function Pe(Vt){var xe;for(xe=0;xe<Pt;xe++)Vt.dyn_ltree[2*xe]=0;for(xe=0;xe<St;xe++)Vt.dyn_dtree[2*xe]=0;for(xe=0;xe<19;xe++)Vt.bl_tree[2*xe]=0;Vt.dyn_ltree[512]=1,Vt.opt_len=Vt.static_len=0,Vt.last_lit=Vt.matches=0}function It(Vt){8<Vt.bi_valid?Lt(Vt,Vt.bi_buf):0<Vt.bi_valid&&(Vt.pending_buf[Vt.pending++]=Vt.bi_buf),Vt.bi_buf=0,Vt.bi_valid=0}function Rt(Vt,xe,Kt,Me){var Se=2*xe,ke=2*Kt;return Vt[Se]<Vt[ke]||Vt[Se]===Vt[ke]&&Me[xe]<=Me[Kt]}function Jt(Vt,xe,Kt){for(var Me=Vt.heap[Kt],Se=Kt<<1;Se<=Vt.heap_len&&(Se<Vt.heap_len&&Rt(xe,Vt.heap[Se+1],Vt.heap[Se],Vt.depth)&&Se++,!Rt(xe,Me,Vt.heap[Se],Vt.depth));)Vt.heap[Kt]=Vt.heap[Se],Kt=Se,Se<<=1;Vt.heap[Kt]=Me}function Yt(Vt,xe,Kt){var Me,Se,ke,Ne,Oe=0;if(Vt.last_lit!==0)for(;Me=Vt.pending_buf[Vt.d_buf+2*Oe]<<8|Vt.pending_buf[Vt.d_buf+2*Oe+1],Se=Vt.pending_buf[Vt.l_buf+Oe],Oe++,Me===0?be(Vt,Se,xe):(be(Vt,(ke=Mt[Se])+rt+1,xe),(Ne=lt[ke])!==0&&pe(Vt,Se-=st[ke],Ne),be(Vt,ke=Qt(--Me),Kt),(Ne=F[ke])!==0&&pe(Vt,Me-=ue[ke],Ne)),Oe<Vt.last_lit;);be(Vt,256,xe)}function Te(Vt,xe){var Kt,Me,Se,ke=xe.dyn_tree,Ne=xe.stat_desc.static_tree,Oe=xe.stat_desc.has_stree,$e=xe.stat_desc.elems,l0=-1;for(Vt.heap_len=0,Vt.heap_max=573,Kt=0;Kt<$e;Kt++)ke[2*Kt]!==0?(Vt.heap[++Vt.heap_len]=l0=Kt,Vt.depth[Kt]=0):ke[2*Kt+1]=0;for(;Vt.heap_len<2;)ke[2*(Se=Vt.heap[++Vt.heap_len]=l0<2?++l0:0)]=1,Vt.depth[Se]=0,Vt.opt_len--,Oe&&(Vt.static_len-=Ne[2*Se+1]);for(xe.max_code=l0,Kt=Vt.heap_len>>1;1<=Kt;Kt--)Jt(Vt,ke,Kt);for(Se=$e;Kt=Vt.heap[1],Vt.heap[1]=Vt.heap[Vt.heap_len--],Jt(Vt,ke,1),Me=Vt.heap[1],Vt.heap[--Vt.heap_max]=Kt,Vt.heap[--Vt.heap_max]=Me,ke[2*Se]=ke[2*Kt]+ke[2*Me],Vt.depth[Se]=(Vt.depth[Kt]>=Vt.depth[Me]?Vt.depth[Kt]:Vt.depth[Me])+1,ke[2*Kt+1]=ke[2*Me+1]=Se,Vt.heap[1]=Se++,Jt(Vt,ke,1),2<=Vt.heap_len;);Vt.heap[--Vt.heap_max]=Vt.heap[1],function(je,I0){var X0,W0,U0,J0,yx,cx,H0=I0.dyn_tree,kx=I0.max_code,ri=I0.stat_desc.static_tree,Ox=I0.stat_desc.has_stree,$x=I0.stat_desc.extra_bits,lx=I0.stat_desc.extra_base,y0=I0.stat_desc.max_length,he=0;for(J0=0;J0<=yt;J0++)je.bl_count[J0]=0;for(H0[2*je.heap[je.heap_max]+1]=0,X0=je.heap_max+1;X0<573;X0++)y0<(J0=H0[2*H0[2*(W0=je.heap[X0])+1]+1]+1)&&(J0=y0,he++),H0[2*W0+1]=J0,kx<W0||(je.bl_count[J0]++,yx=0,lx<=W0&&(yx=$x[W0-lx]),cx=H0[2*W0],je.opt_len+=cx*(J0+yx),Ox&&(je.static_len+=cx*(ri[2*W0+1]+yx)));if(he!==0){do{for(J0=y0-1;je.bl_count[J0]===0;)J0--;je.bl_count[J0]--,je.bl_count[J0+1]+=2,je.bl_count[y0]--,he-=2}while(0<he);for(J0=y0;J0!==0;J0--)for(W0=je.bl_count[J0];W0!==0;)kx<(U0=je.heap[--X0])||(H0[2*U0+1]!==J0&&(je.opt_len+=(J0-H0[2*U0+1])*H0[2*U0],H0[2*U0+1]=J0),W0--)}}(Vt,xe),Fe(ke,l0,Vt.bl_count)}function me(Vt,xe,Kt){var Me,Se,ke=-1,Ne=xe[1],Oe=0,$e=7,l0=4;for(Ne===0&&($e=138,l0=3),xe[2*(Kt+1)+1]=65535,Me=0;Me<=Kt;Me++)Se=Ne,Ne=xe[2*(Me+1)+1],++Oe<$e&&Se===Ne||(Oe<l0?Vt.bl_tree[2*Se]+=Oe:Se!==0?(Se!==ke&&Vt.bl_tree[2*Se]++,Vt.bl_tree[32]++):Oe<=10?Vt.bl_tree[34]++:Vt.bl_tree[36]++,ke=Se,l0=(Oe=0)===Ne?($e=138,3):Se===Ne?($e=6,3):($e=7,4))}function De(Vt,xe,Kt){var Me,Se,ke=-1,Ne=xe[1],Oe=0,$e=7,l0=4;for(Ne===0&&($e=138,l0=3),Me=0;Me<=Kt;Me++)if(Se=Ne,Ne=xe[2*(Me+1)+1],!(++Oe<$e&&Se===Ne)){if(Oe<l0)for(;be(Vt,Se,Vt.bl_tree),--Oe!=0;);else Se!==0?(Se!==ke&&(be(Vt,Se,Vt.bl_tree),Oe--),be(Vt,16,Vt.bl_tree),pe(Vt,Oe-3,2)):Oe<=10?(be(Vt,17,Vt.bl_tree),pe(Vt,Oe-3,3)):(be(Vt,18,Vt.bl_tree),pe(Vt,Oe-11,7));ke=Se,l0=(Oe=0)===Ne?($e=138,3):Se===Ne?($e=6,3):($e=7,4)}}_t(ue);var Ge=!1;function Tt(Vt,xe,Kt,Me){pe(Vt,0+(Me?1:0),3),function(Se,ke,Ne,Oe){It(Se),Lt(Se,Ne),Lt(Se,~Ne),et.arraySet(Se.pending_buf,Se.window,ke,Ne,Se.pending),Se.pending+=Ne}(Vt,xe,Kt)}dt._tr_init=function(Vt){Ge||(function(){var xe,Kt,Me,Se,ke,Ne=new Array(yt+1);for(Se=Me=0;Se<28;Se++)for(st[Se]=Me,xe=0;xe<1<<lt[Se];xe++)Mt[Me++]=Se;for(Mt[Me-1]=Se,Se=ke=0;Se<16;Se++)for(ue[Se]=ke,xe=0;xe<1<<F[Se];xe++)ut[ke++]=Se;for(ke>>=7;Se<St;Se++)for(ue[Se]=ke<<7,xe=0;xe<1<<F[Se]-7;xe++)ut[256+ke++]=Se;for(Kt=0;Kt<=yt;Kt++)Ne[Kt]=0;for(xe=0;xe<=143;)mt[2*xe+1]=8,xe++,Ne[8]++;for(;xe<=255;)mt[2*xe+1]=9,xe++,Ne[9]++;for(;xe<=279;)mt[2*xe+1]=7,xe++,Ne[7]++;for(;xe<=287;)mt[2*xe+1]=8,xe++,Ne[8]++;for(Fe(mt,287,Ne),xe=0;xe<St;xe++)bt[2*xe+1]=5,bt[2*xe]=se(xe,5);tt=new re(mt,lt,257,Pt,yt),Ut=new re(bt,F,0,St,yt),nt=new re(new Array(0),pt,0,19,7)}(),Ge=!0),Vt.l_desc=new ee(Vt.dyn_ltree,tt),Vt.d_desc=new ee(Vt.dyn_dtree,Ut),Vt.bl_desc=new ee(Vt.bl_tree,nt),Vt.bi_buf=0,Vt.bi_valid=0,Pe(Vt)},dt._tr_stored_block=Tt,dt._tr_flush_block=function(Vt,xe,Kt,Me){var Se,ke,Ne=0;0<Vt.level?(Vt.strm.data_type===2&&(Vt.strm.data_type=function(Oe){var $e,l0=4093624447;for($e=0;$e<=31;$e++,l0>>>=1)if(1&l0&&Oe.dyn_ltree[2*$e]!==0)return 0;if(Oe.dyn_ltree[18]!==0||Oe.dyn_ltree[20]!==0||Oe.dyn_ltree[26]!==0)return 1;for($e=32;$e<rt;$e++)if(Oe.dyn_ltree[2*$e]!==0)return 1;return 0}(Vt)),Te(Vt,Vt.l_desc),Te(Vt,Vt.d_desc),Ne=function(Oe){var $e;for(me(Oe,Oe.dyn_ltree,Oe.l_desc.max_code),me(Oe,Oe.dyn_dtree,Oe.d_desc.max_code),Te(Oe,Oe.bl_desc),$e=18;3<=$e&&Oe.bl_tree[2*ht[$e]+1]===0;$e--);return Oe.opt_len+=3*($e+1)+5+5+4,$e}(Vt),Se=Vt.opt_len+3+7>>>3,(ke=Vt.static_len+3+7>>>3)<=Se&&(Se=ke)):Se=ke=Kt+5,Kt+4<=Se&&xe!==-1?Tt(Vt,xe,Kt,Me):Vt.strategy===4||ke===Se?(pe(Vt,2+(Me?1:0),3),Yt(Vt,mt,bt)):(pe(Vt,4+(Me?1:0),3),function(Oe,$e,l0,je){var I0;for(pe(Oe,$e-257,5),pe(Oe,l0-1,5),pe(Oe,je-4,4),I0=0;I0<je;I0++)pe(Oe,Oe.bl_tree[2*ht[I0]+1],3);De(Oe,Oe.dyn_ltree,$e-1),De(Oe,Oe.dyn_dtree,l0-1)}(Vt,Vt.l_desc.max_code+1,Vt.d_desc.max_code+1,Ne+1),Yt(Vt,Vt.dyn_ltree,Vt.dyn_dtree)),Pe(Vt),Me&&It(Vt)},dt._tr_tally=function(Vt,xe,Kt){return Vt.pending_buf[Vt.d_buf+2*Vt.last_lit]=xe>>>8&255,Vt.pending_buf[Vt.d_buf+2*Vt.last_lit+1]=255&xe,Vt.pending_buf[Vt.l_buf+Vt.last_lit]=255&Kt,Vt.last_lit++,xe===0?Vt.dyn_ltree[2*Kt]++:(Vt.matches++,xe--,Vt.dyn_ltree[2*(Mt[Kt]+rt+1)]++,Vt.dyn_dtree[2*Qt(xe)]++),Vt.last_lit===Vt.lit_bufsize-1},dt._tr_align=function(Vt){pe(Vt,2,3),be(Vt,256,mt),function(xe){xe.bi_valid===16?(Lt(xe,xe.bi_buf),xe.bi_buf=0,xe.bi_valid=0):8<=xe.bi_valid&&(xe.pending_buf[xe.pending++]=255&xe.bi_buf,xe.bi_buf>>=8,xe.bi_valid-=8)}(Vt)}},{"../utils/common":41}],53:[function(ft,at,dt){at.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(ft,at,dt){(function(et){(function(_t,rt){if(!_t.setImmediate){var Pt,St,yt,gt,lt=1,F={},pt=!1,ht=_t.document,mt=Object.getPrototypeOf&&Object.getPrototypeOf(_t);mt=mt&&mt.setTimeout?mt:_t,Pt={}.toString.call(_t.process)==="[object process]"?function(st){process.nextTick(function(){ut(st)})}:function(){if(_t.postMessage&&!_t.importScripts){var st=!0,tt=_t.onmessage;return _t.onmessage=function(){st=!1},_t.postMessage("","*"),_t.onmessage=tt,st}}()?(gt="setImmediate$"+Math.random()+"$",_t.addEventListener?_t.addEventListener("message",Mt,!1):_t.attachEvent("onmessage",Mt),function(st){_t.postMessage(gt+st,"*")}):_t.MessageChannel?((yt=new MessageChannel).port1.onmessage=function(st){ut(st.data)},function(st){yt.port2.postMessage(st)}):ht&&"onreadystatechange"in ht.createElement("script")?(St=ht.documentElement,function(st){var tt=ht.createElement("script");tt.onreadystatechange=function(){ut(st),tt.onreadystatechange=null,St.removeChild(tt),tt=null},St.appendChild(tt)}):function(st){setTimeout(ut,0,st)},mt.setImmediate=function(st){typeof st!="function"&&(st=new Function(""+st));for(var tt=new Array(arguments.length-1),Ut=0;Ut<tt.length;Ut++)tt[Ut]=arguments[Ut+1];var nt={callback:st,args:tt};return F[lt]=nt,Pt(lt),lt++},mt.clearImmediate=bt}function bt(st){delete F[st]}function ut(st){if(pt)setTimeout(ut,0,st);else{var tt=F[st];if(tt){pt=!0;try{(function(Ut){var nt=Ut.callback,ue=Ut.args;switch(ue.length){case 0:nt();break;case 1:nt(ue[0]);break;case 2:nt(ue[0],ue[1]);break;case 3:nt(ue[0],ue[1],ue[2]);break;default:nt.apply(rt,ue)}})(tt)}finally{bt(st),pt=!1}}}}function Mt(st){st.source===_t&&typeof st.data=="string"&&st.data.indexOf(gt)===0&&ut(+st.data.slice(gt.length))}})(typeof self>"u"?et===void 0?this:et:self)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)},485:function(I){I.exports=function(){function At(mt,bt,ut,Mt,st){(function tt(Ut,nt,ue,re,ee){for(;re>ue;){if(re-ue>600){var Qt=re-ue+1,Lt=nt-ue+1,pe=Math.log(Qt),be=.5*Math.exp(2*pe/3),se=.5*Math.sqrt(pe*be*(Qt-be)/Qt)*(Lt-Qt/2<0?-1:1);tt(Ut,nt,Math.max(ue,Math.floor(nt-Lt*be/Qt+se)),Math.min(re,Math.floor(nt+(Qt-Lt)*be/Qt+se)),ee)}var Fe=Ut[nt],Pe=ue,It=re;for(Nt(Ut,ue,nt),ee(Ut[re],Fe)>0&&Nt(Ut,ue,re);Pe<It;){for(Nt(Ut,Pe,It),Pe++,It--;ee(Ut[Pe],Fe)<0;)Pe++;for(;ee(Ut[It],Fe)>0;)It--}ee(Ut[ue],Fe)===0?Nt(Ut,ue,It):Nt(Ut,++It,re),It<=nt&&(ue=It+1),nt<=It&&(re=It-1)}})(mt,bt,ut||0,Mt||mt.length-1,st||ft)}function Nt(mt,bt,ut){var Mt=mt[bt];mt[bt]=mt[ut],mt[ut]=Mt}function ft(mt,bt){return mt<bt?-1:mt>bt?1:0}var at=function(mt){mt===void 0&&(mt=9),this._maxEntries=Math.max(4,mt),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function dt(mt,bt,ut){if(!ut)return bt.indexOf(mt);for(var Mt=0;Mt<bt.length;Mt++)if(ut(mt,bt[Mt]))return Mt;return-1}function et(mt,bt){_t(mt,0,mt.children.length,bt,mt)}function _t(mt,bt,ut,Mt,st){st||(st=pt(null)),st.minX=1/0,st.minY=1/0,st.maxX=-1/0,st.maxY=-1/0;for(var tt=bt;tt<ut;tt++){var Ut=mt.children[tt];rt(st,mt.leaf?Mt(Ut):Ut)}return st}function rt(mt,bt){return mt.minX=Math.min(mt.minX,bt.minX),mt.minY=Math.min(mt.minY,bt.minY),mt.maxX=Math.max(mt.maxX,bt.maxX),mt.maxY=Math.max(mt.maxY,bt.maxY),mt}function Pt(mt,bt){return mt.minX-bt.minX}function St(mt,bt){return mt.minY-bt.minY}function yt(mt){return(mt.maxX-mt.minX)*(mt.maxY-mt.minY)}function gt(mt){return mt.maxX-mt.minX+(mt.maxY-mt.minY)}function lt(mt,bt){return mt.minX<=bt.minX&&mt.minY<=bt.minY&&bt.maxX<=mt.maxX&&bt.maxY<=mt.maxY}function F(mt,bt){return bt.minX<=mt.maxX&&bt.minY<=mt.maxY&&bt.maxX>=mt.minX&&bt.maxY>=mt.minY}function pt(mt){return{children:mt,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ht(mt,bt,ut,Mt,st){for(var tt=[bt,ut];tt.length;)if(!((ut=tt.pop())-(bt=tt.pop())<=Mt)){var Ut=bt+Math.ceil((ut-bt)/Mt/2)*Mt;At(mt,Ut,bt,ut,st),tt.push(bt,Ut,Ut,ut)}}return at.prototype.all=function(){return this._all(this.data,[])},at.prototype.search=function(mt){var bt=this.data,ut=[];if(!F(mt,bt))return ut;for(var Mt=this.toBBox,st=[];bt;){for(var tt=0;tt<bt.children.length;tt++){var Ut=bt.children[tt],nt=bt.leaf?Mt(Ut):Ut;F(mt,nt)&&(bt.leaf?ut.push(Ut):lt(mt,nt)?this._all(Ut,ut):st.push(Ut))}bt=st.pop()}return ut},at.prototype.collides=function(mt){var bt=this.data;if(!F(mt,bt))return!1;for(var ut=[];bt;){for(var Mt=0;Mt<bt.children.length;Mt++){var st=bt.children[Mt],tt=bt.leaf?this.toBBox(st):st;if(F(mt,tt)){if(bt.leaf||lt(mt,tt))return!0;ut.push(st)}}bt=ut.pop()}return!1},at.prototype.load=function(mt){if(!mt||!mt.length)return this;if(mt.length<this._minEntries){for(var bt=0;bt<mt.length;bt++)this.insert(mt[bt]);return this}var ut=this._build(mt.slice(),0,mt.length-1,0);if(this.data.children.length)if(this.data.height===ut.height)this._splitRoot(this.data,ut);else{if(this.data.height<ut.height){var Mt=this.data;this.data=ut,ut=Mt}this._insert(ut,this.data.height-ut.height-1,!0)}else this.data=ut;return this},at.prototype.insert=function(mt){return mt&&this._insert(mt,this.data.height-1),this},at.prototype.clear=function(){return this.data=pt([]),this},at.prototype.remove=function(mt,bt){if(!mt)return this;for(var ut,Mt,st,tt=this.data,Ut=this.toBBox(mt),nt=[],ue=[];tt||nt.length;){if(tt||(tt=nt.pop(),Mt=nt[nt.length-1],ut=ue.pop(),st=!0),tt.leaf){var re=dt(mt,tt.children,bt);if(re!==-1)return tt.children.splice(re,1),nt.push(tt),this._condense(nt),this}st||tt.leaf||!lt(tt,Ut)?Mt?(ut++,tt=Mt.children[ut],st=!1):tt=null:(nt.push(tt),ue.push(ut),ut=0,Mt=tt,tt=tt.children[0])}return this},at.prototype.toBBox=function(mt){return mt},at.prototype.compareMinX=function(mt,bt){return mt.minX-bt.minX},at.prototype.compareMinY=function(mt,bt){return mt.minY-bt.minY},at.prototype.toJSON=function(){return this.data},at.prototype.fromJSON=function(mt){return this.data=mt,this},at.prototype._all=function(mt,bt){for(var ut=[];mt;)mt.leaf?bt.push.apply(bt,mt.children):ut.push.apply(ut,mt.children),mt=ut.pop();return bt},at.prototype._build=function(mt,bt,ut,Mt){var st,tt=ut-bt+1,Ut=this._maxEntries;if(tt<=Ut)return et(st=pt(mt.slice(bt,ut+1)),this.toBBox),st;Mt||(Mt=Math.ceil(Math.log(tt)/Math.log(Ut)),Ut=Math.ceil(tt/Math.pow(Ut,Mt-1))),(st=pt([])).leaf=!1,st.height=Mt;var nt=Math.ceil(tt/Ut),ue=nt*Math.ceil(Math.sqrt(Ut));ht(mt,bt,ut,ue,this.compareMinX);for(var re=bt;re<=ut;re+=ue){var ee=Math.min(re+ue-1,ut);ht(mt,re,ee,nt,this.compareMinY);for(var Qt=re;Qt<=ee;Qt+=nt){var Lt=Math.min(Qt+nt-1,ee);st.children.push(this._build(mt,Qt,Lt,Mt-1))}}return et(st,this.toBBox),st},at.prototype._chooseSubtree=function(mt,bt,ut,Mt){for(;Mt.push(bt),!bt.leaf&&Mt.length-1!==ut;){for(var st=1/0,tt=1/0,Ut=void 0,nt=0;nt<bt.children.length;nt++){var ue=bt.children[nt],re=yt(ue),ee=(Qt=mt,Lt=ue,(Math.max(Lt.maxX,Qt.maxX)-Math.min(Lt.minX,Qt.minX))*(Math.max(Lt.maxY,Qt.maxY)-Math.min(Lt.minY,Qt.minY))-re);ee<tt?(tt=ee,st=re<st?re:st,Ut=ue):ee===tt&&re<st&&(st=re,Ut=ue)}bt=Ut||bt.children[0]}var Qt,Lt;return bt},at.prototype._insert=function(mt,bt,ut){var Mt=ut?mt:this.toBBox(mt),st=[],tt=this._chooseSubtree(Mt,this.data,bt,st);for(tt.children.push(mt),rt(tt,Mt);bt>=0&&st[bt].children.length>this._maxEntries;)this._split(st,bt),bt--;this._adjustParentBBoxes(Mt,st,bt)},at.prototype._split=function(mt,bt){var ut=mt[bt],Mt=ut.children.length,st=this._minEntries;this._chooseSplitAxis(ut,st,Mt);var tt=this._chooseSplitIndex(ut,st,Mt),Ut=pt(ut.children.splice(tt,ut.children.length-tt));Ut.height=ut.height,Ut.leaf=ut.leaf,et(ut,this.toBBox),et(Ut,this.toBBox),bt?mt[bt-1].children.push(Ut):this._splitRoot(ut,Ut)},at.prototype._splitRoot=function(mt,bt){this.data=pt([mt,bt]),this.data.height=mt.height+1,this.data.leaf=!1,et(this.data,this.toBBox)},at.prototype._chooseSplitIndex=function(mt,bt,ut){for(var Mt,st,tt,Ut,nt,ue,re,ee=1/0,Qt=1/0,Lt=bt;Lt<=ut-bt;Lt++){var pe=_t(mt,0,Lt,this.toBBox),be=_t(mt,Lt,ut,this.toBBox),se=(st=pe,tt=be,Ut=Math.max(st.minX,tt.minX),nt=Math.max(st.minY,tt.minY),ue=Math.min(st.maxX,tt.maxX),re=Math.min(st.maxY,tt.maxY),Math.max(0,ue-Ut)*Math.max(0,re-nt)),Fe=yt(pe)+yt(be);se<ee?(ee=se,Mt=Lt,Qt=Fe<Qt?Fe:Qt):se===ee&&Fe<Qt&&(Qt=Fe,Mt=Lt)}return Mt||ut-bt},at.prototype._chooseSplitAxis=function(mt,bt,ut){var Mt=mt.leaf?this.compareMinX:Pt,st=mt.leaf?this.compareMinY:St;this._allDistMargin(mt,bt,ut,Mt)<this._allDistMargin(mt,bt,ut,st)&&mt.children.sort(Mt)},at.prototype._allDistMargin=function(mt,bt,ut,Mt){mt.children.sort(Mt);for(var st=this.toBBox,tt=_t(mt,0,bt,st),Ut=_t(mt,ut-bt,ut,st),nt=gt(tt)+gt(Ut),ue=bt;ue<ut-bt;ue++){var re=mt.children[ue];rt(tt,mt.leaf?st(re):re),nt+=gt(tt)}for(var ee=ut-bt-1;ee>=bt;ee--){var Qt=mt.children[ee];rt(Ut,mt.leaf?st(Qt):Qt),nt+=gt(Ut)}return nt},at.prototype._adjustParentBBoxes=function(mt,bt,ut){for(var Mt=ut;Mt>=0;Mt--)rt(bt[Mt],mt)},at.prototype._condense=function(mt){for(var bt=mt.length-1,ut=void 0;bt>=0;bt--)mt[bt].children.length===0?bt>0?(ut=mt[bt-1].children).splice(ut.indexOf(mt[bt]),1):this.clear():et(mt[bt],this.toBBox)},at}()},953:I=>{I.exports=Zt},489:I=>{I.exports=ne}},Et={};function Dt(I){var At=Et[I];if(At!==void 0)return At.exports;var Nt=Et[I]={exports:{}};return de[I].call(Nt.exports,Nt,Nt.exports,Dt),Nt.exports}Dt.n=I=>{var At=I&&I.__esModule?()=>I.default:()=>I;return Dt.d(At,{a:At}),At},Dt.d=(I,At)=>{for(var Nt in At)Dt.o(At,Nt)&&!Dt.o(I,Nt)&&Object.defineProperty(I,Nt,{enumerable:!0,get:At[Nt]})},Dt.o=(I,At)=>Object.prototype.hasOwnProperty.call(I,At),Dt.r=I=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})};var Y={};return(()=>{Dt.r(Y),Dt.d(Y,{BorderAxisTool:()=>U0,LAxisLayer:()=>Gr,LCSLayer:()=>Lx,LCanvas2DGridBaseLayer:()=>yx,LCanvas2DLayer:()=>ke,LCanvasLayer:()=>Te,LCanvasPixelLayer:()=>Ui,LDataAnimationService:()=>At,LDistanceMapTool:()=>J0,LGLGridBaseLayer:()=>qn,LGLLine:()=>hi,LGLTileBaseLayer:()=>Bi,LGLVectorBaseLayer:()=>zi,LGeoJSONLayer:()=>Ne,LGridLabelLayer:()=>Ni,LMap:()=>Jt,LMapboxGLLayer:()=>cn,LPixelLayer:()=>rr,LPixelTileLayer:()=>ui,LTileLayerGL:()=>fn,LTracingService:()=>Oe,LVectorMapService:()=>I0,LVectorMapTool:()=>W0,LVectorMapToolRenderer:()=>X0,LWindLayer:()=>Zn,createTileLayer:()=>ta,gridOptions2Bounds:()=>ya});var I=Dt(489);class At extends I.DataAnimationService{constructor(a,_){super(a,_),this.movePause=()=>{this.pause()},this.moveResume=()=>{this.resume()},this.options.map||I.logger.error("leaflet格点动画图层需要设置map对象！")}start(){return this.options.map.on("dragstart",this.movePause),this.options.map.on("dragend",this.moveResume),super.start()}stop(){return super.stop(),this.options.map.off("dragstart",this.movePause),this.options.map.off("dragend",this.moveResume),this}}function Nt(N,a,_){_===void 0&&(_={});var E={type:"Feature"};return(_.id===0||_.id)&&(E.id=_.id),_.bbox&&(E.bbox=_.bbox),E.properties=a||{},E.geometry=N,E}function ft(N,a,_){if(_===void 0&&(_={}),!N)throw new Error("coordinates is required");if(!Array.isArray(N))throw new Error("coordinates must be an Array");if(N.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pt(N[0])||!Pt(N[1]))throw new Error("coordinates must contain numbers");return Nt({type:"Point",coordinates:N},a,_)}function at(N,a,_){_===void 0&&(_={});for(var E=0,V=N;E<V.length;E++){var xt=V[E];if(xt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var vt=0;vt<xt[xt.length-1].length;vt++)if(xt[xt.length-1][vt]!==xt[0][vt])throw new Error("First and last Position are not equivalent.")}return Nt({type:"Polygon",coordinates:N},a,_)}function dt(N,a,_){if(_===void 0&&(_={}),N.length<2)throw new Error("coordinates must be an array of two or more positions");return Nt({type:"LineString",coordinates:N},a,_)}function et(N,a){a===void 0&&(a={});var _={type:"FeatureCollection"};return a.id&&(_.id=a.id),a.bbox&&(_.bbox=a.bbox),_.features=N,_}function _t(N,a,_){return _===void 0&&(_={}),Nt({type:"MultiLineString",coordinates:N},a,_)}function rt(N,a,_){return _===void 0&&(_={}),Nt({type:"MultiPolygon",coordinates:N},a,_)}function Pt(N){return!isNaN(N)&&N!==null&&!Array.isArray(N)}function St(N,a,_){if(N!==null)for(var E,V,xt,vt,Wt,Ht,Gt,Xt,Ft=0,te=0,zt=N.type,ve=zt==="FeatureCollection",ye=zt==="Feature",we=ve?N.features.length:1,Ee=0;Ee<we;Ee++){Wt=(Xt=!!(Gt=ve?N.features[Ee].geometry:ye?N.geometry:N)&&Gt.type==="GeometryCollection")?Gt.geometries.length:1;for(var ze=0;ze<Wt;ze++){var Be=0,e0=0;if((vt=Xt?Gt.geometries[ze]:Gt)!==null){Ht=vt.coordinates;var He=vt.type;switch(Ft=!_||He!=="Polygon"&&He!=="MultiPolygon"?0:1,He){case null:break;case"Point":if(a(Ht,te,Ee,Be,e0)===!1)return!1;te++,Be++;break;case"LineString":case"MultiPoint":for(E=0;E<Ht.length;E++){if(a(Ht[E],te,Ee,Be,e0)===!1)return!1;te++,He==="MultiPoint"&&Be++}He==="LineString"&&Be++;break;case"Polygon":case"MultiLineString":for(E=0;E<Ht.length;E++){for(V=0;V<Ht[E].length-Ft;V++){if(a(Ht[E][V],te,Ee,Be,e0)===!1)return!1;te++}He==="MultiLineString"&&Be++,He==="Polygon"&&e0++}He==="Polygon"&&Be++;break;case"MultiPolygon":for(E=0;E<Ht.length;E++){for(e0=0,V=0;V<Ht[E].length;V++){for(xt=0;xt<Ht[E][V].length-Ft;xt++){if(a(Ht[E][V][xt],te,Ee,Be,e0)===!1)return!1;te++}e0++}Be++}break;case"GeometryCollection":for(E=0;E<vt.geometries.length;E++)if(St(vt.geometries[E],a,_)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yt(N,a){if(N.type==="Feature")a(N,0);else if(N.type==="FeatureCollection")for(var _=0;_<N.features.length&&a(N.features[_],_)!==!1;_++);}function gt(N,a){(function(_,E){var V,xt,vt,Wt,Ht,Gt,Xt,Ft,te,zt,ve=0,ye=_.type==="FeatureCollection",we=_.type==="Feature",Ee=ye?_.features.length:1;for(V=0;V<Ee;V++){for(Gt=ye?_.features[V].geometry:we?_.geometry:_,Ft=ye?_.features[V].properties:we?_.properties:{},te=ye?_.features[V].bbox:we?_.bbox:void 0,zt=ye?_.features[V].id:we?_.id:void 0,Ht=(Xt=!!Gt&&Gt.type==="GeometryCollection")?Gt.geometries.length:1,vt=0;vt<Ht;vt++)if((Wt=Xt?Gt.geometries[vt]:Gt)!==null)switch(Wt.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(E(Wt,ve,Ft,te,zt)===!1)return!1;break;case"GeometryCollection":for(xt=0;xt<Wt.geometries.length;xt++)if(E(Wt.geometries[xt],ve,Ft,te,zt)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}else if(E(null,ve,Ft,te,zt)===!1)return!1;ve++}})(N,function(_,E,V,xt,vt){var Wt,Ht=_===null?null:_.type;switch(Ht){case null:case"Point":case"LineString":case"Polygon":return a(Nt(_,V,{bbox:xt,id:vt}),E,0)!==!1&&void 0}switch(Ht){case"MultiPoint":Wt="Point";break;case"MultiLineString":Wt="LineString";break;case"MultiPolygon":Wt="Polygon"}for(var Gt=0;Gt<_.coordinates.length;Gt++){var Xt=_.coordinates[Gt];if(a(Nt({type:Wt,coordinates:Xt},V),E,Gt)===!1)return!1}})}var lt=Dt(953),F=Dt.n(lt);function pt(N){var a=[1/0,1/0,-1/0,-1/0];return St(N,function(_){a[0]>_[0]&&(a[0]=_[0]),a[1]>_[1]&&(a[1]=_[1]),a[2]<_[0]&&(a[2]=_[0]),a[3]<_[1]&&(a[3]=_[1])}),a}pt.default=pt;const ht=pt;function mt(N){if(!N)throw new Error("coord is required");if(!Array.isArray(N)){if(N.type==="Feature"&&N.geometry!==null&&N.geometry.type==="Point")return N.geometry.coordinates;if(N.type==="Point")return N.coordinates}if(Array.isArray(N)&&N.length>=2&&!Array.isArray(N[0])&&!Array.isArray(N[1]))return N;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function bt(N){if(Array.isArray(N))return N;if(N.type==="Feature"){if(N.geometry!==null)return N.geometry.coordinates}else if(N.coordinates)return N.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ut(N){return N.type==="Feature"?N.geometry:N}function Mt(N,a,_){if(_===void 0&&(_={}),!N)throw new Error("point is required");if(!a)throw new Error("polygon is required");var E=mt(N),V=ut(a),xt=V.type,vt=a.bbox,Wt=V.coordinates;if(vt&&function(te,zt){return zt[0]<=te[0]&&zt[1]<=te[1]&&zt[2]>=te[0]&&zt[3]>=te[1]}(E,vt)===!1)return!1;xt==="Polygon"&&(Wt=[Wt]);for(var Ht=!1,Gt=0;Gt<Wt.length&&!Ht;Gt++)if(st(E,Wt[Gt][0],_.ignoreBoundary)){for(var Xt=!1,Ft=1;Ft<Wt[Gt].length&&!Xt;)st(E,Wt[Gt][Ft],!_.ignoreBoundary)&&(Xt=!0),Ft++;Xt||(Ht=!0)}return Ht}function st(N,a,_){var E=!1;a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]&&(a=a.slice(0,a.length-1));for(var V=0,xt=a.length-1;V<a.length;xt=V++){var vt=a[V][0],Wt=a[V][1],Ht=a[xt][0],Gt=a[xt][1];if(N[1]*(vt-Ht)+Wt*(Ht-N[0])+Gt*(N[0]-vt)==0&&(vt-N[0])*(Ht-N[0])<=0&&(Wt-N[1])*(Gt-N[1])<=0)return!_;Wt>N[1]!=Gt>N[1]&&N[0]<(Ht-vt)*(N[1]-Wt)/(Gt-Wt)+vt&&(E=!E)}return E}function tt(N,a,_,E,V){var xt=_[0],vt=_[1],Wt=N[0],Ht=N[1],Gt=a[0],Xt=a[1],Ft=Gt-Wt,te=Xt-Ht,zt=(_[0]-Wt)*te-(_[1]-Ht)*Ft;if(V!==null){if(Math.abs(zt)>V)return!1}else if(zt!==0)return!1;return E?E==="start"?Math.abs(Ft)>=Math.abs(te)?Ft>0?Wt<xt&&xt<=Gt:Gt<=xt&&xt<Wt:te>0?Ht<vt&&vt<=Xt:Xt<=vt&&vt<Ht:E==="end"?Math.abs(Ft)>=Math.abs(te)?Ft>0?Wt<=xt&&xt<Gt:Gt<xt&&xt<=Wt:te>0?Ht<=vt&&vt<Xt:Xt<vt&&vt<=Ht:E==="both"&&(Math.abs(Ft)>=Math.abs(te)?Ft>0?Wt<xt&&xt<Gt:Gt<xt&&xt<Wt:te>0?Ht<vt&&vt<Xt:Xt<vt&&vt<Ht):Math.abs(Ft)>=Math.abs(te)?Ft>0?Wt<=xt&&xt<=Gt:Gt<=xt&&xt<=Wt:te>0?Ht<=vt&&vt<=Xt:Xt<=vt&&vt<=Ht}const Ut=function(N,a,_){_===void 0&&(_={});for(var E=mt(N),V=bt(a),xt=0;xt<V.length-1;xt++){var vt=!1;if(_.ignoreEndVertices&&(xt===0&&(vt="start"),xt===V.length-2&&(vt="end"),xt===0&&xt+1===V.length-1&&(vt="both")),tt(V[xt],V[xt+1],E,vt,_.epsilon===void 0?null:_.epsilon))return!0}return!1};function nt(N,a){var _=ut(N),E=ut(a),V=_.type,xt=E.type,vt=_.coordinates,Wt=E.coordinates;switch(V){case"Point":if(xt==="Point")return re(vt,Wt);throw new Error("feature2 "+xt+" geometry not supported");case"MultiPoint":switch(xt){case"Point":return function(Ht,Gt){var Xt,Ft=!1;for(Xt=0;Xt<Ht.coordinates.length;Xt++)if(re(Ht.coordinates[Xt],Gt.coordinates)){Ft=!0;break}return Ft}(_,E);case"MultiPoint":return function(Ht,Gt){for(var Xt=0,Ft=Gt.coordinates;Xt<Ft.length;Xt++){for(var te=Ft[Xt],zt=!1,ve=0,ye=Ht.coordinates;ve<ye.length;ve++)if(re(te,ye[ve])){zt=!0;break}if(!zt)return!1}return!0}(_,E);default:throw new Error("feature2 "+xt+" geometry not supported")}case"LineString":switch(xt){case"Point":return Ut(E,_,{ignoreEndVertices:!0});case"LineString":return function(Ht,Gt){for(var Xt=!1,Ft=0,te=Gt.coordinates;Ft<te.length;Ft++){var zt=te[Ft];if(Ut({type:"Point",coordinates:zt},Ht,{ignoreEndVertices:!0})&&(Xt=!0),!Ut({type:"Point",coordinates:zt},Ht,{ignoreEndVertices:!1}))return!1}return Xt}(_,E);case"MultiPoint":return function(Ht,Gt){for(var Xt=!1,Ft=0,te=Gt.coordinates;Ft<te.length;Ft++){var zt=te[Ft];if(Ut(zt,Ht,{ignoreEndVertices:!0})&&(Xt=!0),!Ut(zt,Ht))return!1}return!!Xt}(_,E);default:throw new Error("feature2 "+xt+" geometry not supported")}case"Polygon":switch(xt){case"Point":return Mt(E,_,{ignoreBoundary:!0});case"LineString":return function(Ht,Gt){var Xt,Ft,te=!1,zt=0;if(!ue(ht(Ht),ht(Gt)))return!1;for(;zt<Gt.coordinates.length-1;zt++)if(Mt({type:"Point",coordinates:(Xt=Gt.coordinates[zt],Ft=Gt.coordinates[zt+1],[(Xt[0]+Ft[0])/2,(Xt[1]+Ft[1])/2])},Ht,{ignoreBoundary:!0})){te=!0;break}return te}(_,E);case"Polygon":return function(Ht,Gt){if(Ht.type==="Feature"&&Ht.geometry===null||Gt.type==="Feature"&&Gt.geometry===null||!ue(ht(Ht),ht(Gt)))return!1;for(var Xt=0,Ft=ut(Gt).coordinates;Xt<Ft.length;Xt++)for(var te=0,zt=Ft[Xt];te<zt.length;te++)if(!Mt(zt[te],Ht))return!1;return!0}(_,E);case"MultiPoint":return function(Ht,Gt){for(var Xt=0,Ft=Gt.coordinates;Xt<Ft.length;Xt++)if(!Mt(Ft[Xt],Ht,{ignoreBoundary:!0}))return!1;return!0}(_,E);default:throw new Error("feature2 "+xt+" geometry not supported")}default:throw new Error("feature1 "+V+" geometry not supported")}}function ue(N,a){return!(N[0]>a[0]||N[2]<a[2]||N[1]>a[1]||N[3]<a[3])}function re(N,a){return N[0]===a[0]&&N[1]===a[1]}const ee=function(N){if(!N)throw new Error("geojson is required");var a=[];return gt(N,function(_){(function(E,V){var xt=[],vt=E.geometry;if(vt!==null){switch(vt.type){case"Polygon":xt=bt(vt);break;case"LineString":xt=[bt(vt)]}xt.forEach(function(Wt){var Ht=function(Gt,Xt){var Ft=[];return Gt.reduce(function(te,zt){var ve,ye,we,Ee,ze,Be,e0=dt([te,zt],Xt);return e0.bbox=(ye=zt,we=(ve=te)[0],Ee=ve[1],[we<(ze=ye[0])?we:ze,Ee<(Be=ye[1])?Ee:Be,we>ze?we:ze,Ee>Be?Ee:Be]),Ft.push(e0),zt}),Ft}(Wt,E.properties);Ht.forEach(function(Gt){Gt.id=V.length,V.push(Gt)})})}})(_,a)}),et(a)};var Qt=Dt(246);function Lt(N,a){var _=bt(N),E=bt(a);if(_.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(E.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var V=_[0][0],xt=_[0][1],vt=_[1][0],Wt=_[1][1],Ht=E[0][0],Gt=E[0][1],Xt=E[1][0],Ft=E[1][1],te=(Ft-Gt)*(vt-V)-(Xt-Ht)*(Wt-xt);if(te===0)return null;var zt=((Xt-Ht)*(xt-Gt)-(Ft-Gt)*(V-Ht))/te,ve=((vt-V)*(xt-Gt)-(Wt-xt)*(V-Ht))/te;return zt>=0&&zt<=1&&ve>=0&&ve<=1?ft([V+zt*(vt-V),xt+zt*(Wt-xt)]):null}const pe=function(N,a){var _={},E=[];if(N.type==="LineString"&&(N=Nt(N)),a.type==="LineString"&&(a=Nt(a)),N.type==="Feature"&&a.type==="Feature"&&N.geometry!==null&&a.geometry!==null&&N.geometry.type==="LineString"&&a.geometry.type==="LineString"&&N.geometry.coordinates.length===2&&a.geometry.coordinates.length===2){var V=Lt(N,a);return V&&E.push(V),et(E)}var xt=Qt();return xt.load(ee(a)),yt(ee(N),function(vt){yt(xt.search(vt),function(Wt){var Ht=Lt(vt,Wt);if(Ht){var Gt=bt(Ht).join(",");_[Gt]||(_[Gt]=!0,E.push(Ht))}})}),et(E)};function be(N,a){a===void 0&&(a={});var _=ut(N);switch(a.properties||N.type!=="Feature"||(a.properties=N.properties),_.type){case"Polygon":return function(E,V){return V===void 0&&(V={}),se(ut(E).coordinates,V.properties?V.properties:E.type==="Feature"?E.properties:{})}(_,a);case"MultiPolygon":return function(E,V){V===void 0&&(V={});var xt=ut(E).coordinates,vt=V.properties?V.properties:E.type==="Feature"?E.properties:{},Wt=[];return xt.forEach(function(Ht){Wt.push(se(Ht,vt))}),et(Wt)}(_,a);default:throw new Error("invalid poly")}}function se(N,a){return N.length>1?_t(N,a):dt(N[0],a)}function Fe(N,a){for(var _=0;_<N.coordinates.length-1;_++)if(It(N.coordinates[_],N.coordinates[_+1],a.coordinates))return!0;return!1}function Pe(N,a){for(var _=0,E=a.coordinates;_<E.length;_++)if(Mt(E[_],N))return!0;return pe(a,be(N)).features.length>0}function It(N,a,_){var E=_[0]-N[0],V=_[1]-N[1],xt=a[0]-N[0],vt=a[1]-N[1];return E*vt-V*xt==0&&(Math.abs(xt)>=Math.abs(vt)?xt>0?N[0]<=_[0]&&_[0]<=a[0]:a[0]<=_[0]&&_[0]<=N[0]:vt>0?N[1]<=_[1]&&_[1]<=a[1]:a[1]<=_[1]&&_[1]<=N[1])}function Rt(N,a){var _=!1;return gt(N,function(E){gt(a,function(V){if(_===!0)return!0;_=!function(xt,vt){var Wt=!0;return gt(xt,function(Ht){gt(vt,function(Gt){if(Wt===!1)return!1;Wt=function(Xt,Ft){switch(Xt.type){case"Point":switch(Ft.type){case"Point":return te=Xt.coordinates,zt=Ft.coordinates,!(te[0]===zt[0]&&te[1]===zt[1]);case"LineString":return!Fe(Ft,Xt);case"Polygon":return!Mt(Xt,Ft)}break;case"LineString":switch(Ft.type){case"Point":return!Fe(Xt,Ft);case"LineString":return!(pe(Xt,Ft).features.length>0);case"Polygon":return!Pe(Ft,Xt)}break;case"Polygon":switch(Ft.type){case"Point":return!Mt(Ft,Xt);case"LineString":return!Pe(Xt,Ft);case"Polygon":return!function(ve,ye){for(var we=0,Ee=ve.coordinates[0];we<Ee.length;we++)if(Mt(Ee[we],ye))return!0;for(var ze=0,Be=ye.coordinates[0];ze<Be.length;ze++)if(Mt(Be[ze],ve))return!0;return pe(be(ve),be(ye)).features.length>0}(Ft,Xt)}}var te,zt;return!1}(Ht.geometry,Gt.geometry)})}),Wt}(E.geometry,V.geometry)})}),_}class Jt extends F().Map{constructor(a,_){_.attributionControl!==!0&&(_.attributionControl=!1),super(a,_),this.createInitialPanes(),this.toolService=new I.MapToolService(this),_.defaultLayers?(0,I.loadResourcesAndLayers)(_.defaultLayers,E=>{E instanceof F().Layer?this.addLayer(E):(I.logger.warn("创建的图层类型非Leaflet图层！"),I.logger.warn(E))},E=>{this.fire(Jt.EventTypes.defaultLayersLoaded,{firer:this,msg:E})}):this.fire(Jt.EventTypes.defaultLayersLoaded,{firer:this,msg:[]})}getTheme(){return this._theme}setTheme(a){if(a===this._theme)return;const _=this._theme;this._theme=a,this.fire(Jt.EventTypes.themeChanged,{firer:this,msg:{oldTheme:_,newTheme:a}})}addLayerByConfig(a){return new Promise((_,E)=>{(0,I.loadResourcesAndLayers)(a,V=>{V instanceof F().Layer?this.addLayer(V):(I.logger.warn("创建的图层类型非Leaflet图层！"),I.logger.warn(V))},V=>{_(V)})})}createInitialPanes(){const a=I.consts.customPanes;for(const _ in a){const E=a[_];this.getPane(E.name)&&(I.logger.warn("pane:"+E.name+"已经存在，将只修改其z-index！"),this.getPane(E.name).style.zIndex=E.zIdx),this.createPane(E.name).style.zIndex=E.zIdx}}}function Yt(N){N=unescape(N);for(var a=String.fromCharCode(N.charCodeAt(0)-N.length),_=1;_<N.length;_++)a+=String.fromCharCode(N.charCodeAt(_)-a.charCodeAt(_-1));return a}Jt.EventTypes={defaultLayersLoaded:"defaultLayers:loaded",themeChanged:"theme:changed"};class Te extends F().Layer{constructor(a){super(a),this._loopHandler=void 0,this._locked=0,this.layerOptions={},this.renderId=0,this._visible=!0,this.moving=!1,this._sizeChanged=!1,this.ratio=1,this.imgWaiters={},this.setMoving=()=>{this.moving=!0},this.onAnimationZoom=_=>{this._animateZoom(_.center,_.zoom)},this.onZoom=()=>{this._animateZoom(this._map.getCenter(),this._map.getZoom())},this.setLayerOptions(a,!1),I.consts.checkRetina&&this.supportRetina()&&!this.layerOptions.ignoreRetina&&(this.ratio=I.consts.retinaRatio||window.devicePixelRatio||1)}initialize(a){F().Util.setOptions(this,a)}lock(){return this._locked++,this}unlock(){return this._locked--,this._locked<0&&(this._locked=0),this._locked===0&&this.redraw(),this}anyLocked(){return this._locked>0}setLayerOptions(a,_=!0){var E,V;if(typeof a=="string"?(this.layerOptions=(E=I.resourceService.getResource(a))===null||E===void 0?void 0:E.instance,this.layerOptions||I.logger.error("图层属性资源"+a+"不存在！")):_&&this.layerOptions?(0,I.setOptions)(this.layerOptions,a):((0,I.setOptions)(this.layerOptions,a,Te.DefaultOptions),this.layerOptions.name=(0,I.defaultVal)(this.layerOptions.name,(0,I.uid)())),this.layerOptions.mask&&typeof this.layerOptions.mask=="string"){const xt=this.layerOptions.mask;xt.indexOf(I.consts.fieldLoaderIndicator)>0?this.layerOptions.mask=(0,I.processFieldWithLoaders)(xt):this.layerOptions.mask=(V=I.resourceService.getResource(xt))===null||V===void 0?void 0:V.instance,this.layerOptions.mask||I.logger.warn("图层"+this.layerOptions.name+"的mask资源"+xt+"不存在！")}this._loopHandler&&!this.layerOptions.loop&&(cancelAnimationFrame(this._loopHandler),this._loopHandler=void 0),this.redraw()}isVisible(){return this._visible}redraw(){if(this._map)return this._frame||this._map._animating||(this._frame=F().Util.requestAnimFrame(this._redraw,this)),this}onAdd(a){if(this._map=a,this._map instanceof Jt){if(!this._canvas){this._canvas=F().DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),this._canvas.id=(0,I.uid)();var _=F().DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this._canvas.style[_]="50% 50%";var E=this._map.getSize();this._canvas.width=E.x*this.ratio,this._canvas.height=E.y*this.ratio,this._canvas.style.width=E.x+"px",this._canvas.style.height=E.y+"px";var V=this._map.options.zoomAnimation&&F().Browser.any3d;F().DomUtil.addClass(this._canvas,"leaflet-zoom-"+(V?"animated":"hide"))}return this.layerOptions.pane?this.getPane(this.layerOptions.pane).appendChild(this._canvas):a._panes.gridPane?a._panes.gridPane.appendChild(this._canvas):a._panes.overlayPane.appendChild(this._canvas),this.onCanvasReady(this._canvas),a.on("moveend",this._reset,this),a.on("resize",this._resize,this),a.options.zoomAnimation&&F().Browser.any3d&&(a.on("zoomanim",this.onAnimationZoom,this),a.on("zoom",this.onZoom,this)),this._map.on(Jt.EventTypes.themeChanged,this.onThemeChanged,this),this._reset(),this.layerOptions.loop&&this._loop(),this}}onThemeChanged(a){var _;if(!this._map||!this._theme)return;const E=this._theme.split(I.consts.fieldLoaderIndicator),V=E[0].split(I.consts.themeIndicator),xt=V.length===1?"":V[1],vt=(_=a.msg.newTheme)!==null&&_!==void 0?_:"";if(xt==vt)return;const Wt=V[0]+"@"+vt;if(I.resourceService.hasResource(Wt)){const Ht=Wt+(E.length>1?I.consts.fieldLoaderIndicator+E[1]:"");this.setDrawOptions&&this.setDrawOptions(Ht,!1),this.redraw()}}onCanvasReady(a){this._map.on("movestart",this.setMoving)}onceImageLoaded(a,_){if(I.resourceService.hasResource(a))return void _(I.resourceService.getResource(a).instance);const E=this.renderId;if(this.imgWaiters[a])return void this.imgWaiters[a].push(_);a.startsWith("http")||a.startsWith("/")||(a=I.consts.resourcePath+"/"+a);const V=xt=>{if(xt)if(this.imgWaiters){if(this.renderId!==E)return delete this.imgWaiters[a],void I.logger.debug("图片加载完成时绘制上下文发生了变化，将取消原有回调！");for(const vt of this.imgWaiters[a])vt(xt);delete this.imgWaiters[a],I.resourceService.addResource(a,{resourceType:I.resourceTypePreDefined.images,instance:xt})}else I.logger.debug("图片加载完成后回调被清空！");else I.logger.debug("图片不存在！")};(0,I.imageResourceCreator)({resourceType:I.resourceTypePreDefined.images,requestInfo:a,key:void 0}).then(xt=>{V(xt&&xt.instance||void 0)}).catch(xt=>{V(void 0)}),this.imgWaiters[a]=[_]}pauseLoop(){this.layerOptions.loop&&this._loopHandler&&(cancelAnimationFrame(this._loopHandler),this._loopHandler=void 0)}resumeLoop(){this.layerOptions.loop&&this._loopHandler===void 0&&this._loop()}_loop(){this._canvas&&(this.fire(Te.EventTypes.loop,{firer:this}),this._loopHandler=requestAnimationFrame(()=>this._loop()),this._redraw())}onRemove(a){return this.layerOptions.pane?this.getPane(this.layerOptions.pane).removeChild(this._canvas):a._panes.gridPane?a._panes.gridPane.removeChild(this._canvas):a._panes.overlayPane.removeChild(this._canvas),a.off("moveend",this._reset,this),a.off("resize",this._resize,this),a.off("movestart",this.setMoving),a.options.zoomAnimation&&(a.off("zoomanim",this.onAnimationZoom,this),a.off("zoom",this.onZoom,this)),this._map.off(Jt.EventTypes.themeChanged,this.onThemeChanged,this),this._loopHandler&&(cancelAnimationFrame(this._loopHandler),this._loopHandler=void 0),this._canvas=null,this}reinit(){return this.redraw(),this}proj(a){return this._map.latLngToContainerPoint([a[1],a[0]])}_resize(a){this._canvas.width=a.newSize.x*this.ratio,this._canvas.height=a.newSize.y*this.ratio,this._canvas.style.width=a.newSize.x+"px",this._canvas.style.height=a.newSize.y+"px",this._sizeChanged=!0}_reset(){if(this._map){this.moving=!1;var a=this._map.containerPointToLayerPoint([0,0]);F().DomUtil.setPosition(this._canvas,a),this._redraw()}}_redraw(){var a,_;if(this.layerOptions.drawWhenVisible&&(!(!((a=this._canvas)===null||a===void 0)&&a.clientWidth)||!(!((_=this._canvas)===null||_===void 0)&&_.width)))return void I.logger.debug("canvas处于不可见模式，取消重绘！");if(this.layerOptions.loop&&this.moving)return;if(this.renderId=Math.random(),this.anyLocked())return void I.logger.debug("当前图层已被锁定，无法更新！");const E=performance.now(),V=this._map.getSize(),xt=this._map.getBounds(),vt=180*V.x/(2003750834e-2*(xt.getEast()-xt.getWest())),Wt=this._map.getZoom(),Ht=this._map.containerPointToLatLng([0,0]),Gt=this._map.containerPointToLatLng([10,10]),Xt=Math.abs(Gt.lng-Ht.lng)/10,Ft=Math.abs(Gt.lat-Ht.lat)/10;this._zoom=this._map.getZoom(),this._center=this._map.getCenter();const te={canvas:this._canvas,bounds:xt,size:V,zoomScale:vt,zoom:Wt,options:this.layerOptions,reso:F().point(Xt,Ft)};this.onRedraw(te),this._sizeChanged=!1,this._frame=null,this.layerOptions.debugShowPerformance&&I.logger.debug("draw "+this.layerOptions.name+" costs  + "+(performance.now()-E)+"ms"),Yt(I.authInfo.code).indexOf(location.hostname)<0&&(this instanceof Ge||Tt.getUpdateProjection(this._map))}_animateZoom(a,_){const E=this._map.getZoomScale(_,this._zoom),V=this._map._getTopLeftPoint(this._center,_),xt=this._map._getTopLeftPoint(a,_),vt=V.subtract(xt).subtract(this._map._getMapPanePos());F().Browser.any3d?F().DomUtil.setTransform(this._canvas,vt,E):F().DomUtil.setPosition(this._canvas,vt)}supportRetina(){return!1}}Te.DefaultOptions={loop:!1,drawWhenVisible:!1},Te.EventTypes={loop:"loop"};const me=CanvasRenderingContext2D.prototype.fillText,De=CanvasRenderingContext2D.prototype.strokeText;class Ge extends Te{constructor(){super()}setVisible(a){return this}destroy(){return this}onCanvasReady(a){super.onCanvasReady(a);const _=a.getContext("2d");_.scale(this.ratio,this.ratio),_[Yt("j%D5%DD%E2")]=Yt("%3Bf%A5%E8%98a%B3%DB%CA%CD");const E=Math.random(),V=Math.random();E>.5?(this._x=this._canvas.clientWidth-2,_.textAlign="end"):(this._x=2,_.textAlign="start"),V>=0?(this._y=this._canvas.clientHeight-2,_.textBaseline="bottom"):(this._y=2,_.textBaseline="top")}_resize(a){this._canvas.getContext("2d").scale(1,1),super._resize(a),this._canvas.getContext("2d").scale(this.ratio,this.ratio)}onRedraw(a){const _=document.getElementById(this._canvas.id);(this._canvas.className.indexOf(Yt("%84%DC%C7%8F%96%D7%E1%E3%D5%C8%D7%E3%E1"))>=0||!_||_.style.display.toLowerCase()==="none")&&this.remove(),_.style[Yt("%81%A7%96%D7%D2%C9%DD")]=Yt("%3Frrrrr");const E=a.canvas.getContext("2d");E.clearRect(0,0,this._canvas.clientWidth,this._canvas.clientHeight),E.globalAlpha=1,E.font="10px Arial",E.strokeStyle=Yt("%81%D9%C9%8A%5Dg%5E%5Dde%5E%5Egi%5D"),De.bind(E)(Yt("K%91%C6%DE%CC%CE%B0%A6%D3%E6%DC"),this._x,this._y),E.fillStyle=Yt("%82%D9%C9%8AZgja%5Egja%5Egj%5E"),me.bind(E)(Yt("K%91%C6%DE%CC%CE%B0%A6%D3%E6%DC"),this._x,this._y)}supportRetina(){return!0}getUpdateProjection(a){this._map||this.addTo(a)}}let Tt=new Ge;function Vt(N,a){var _,E,V,xt,vt,Wt,Ht;for(E=1;E<=8;E*=2){for(_=[],xt=!(Kt(V=N[N.length-1],a)&E),vt=0;vt<N.length;vt++)(Ht=!(Kt(Wt=N[vt],a)&E))!==xt&&_.push(xe(V,Wt,E,a)),Ht&&_.push(Wt),V=Wt,xt=Ht;if(!(N=_).length)break}return _}function xe(N,a,_,E){return 8&_?[N[0]+(a[0]-N[0])*(E[3]-N[1])/(a[1]-N[1]),E[3]]:4&_?[N[0]+(a[0]-N[0])*(E[1]-N[1])/(a[1]-N[1]),E[1]]:2&_?[E[2],N[1]+(a[1]-N[1])*(E[2]-N[0])/(a[0]-N[0])]:1&_?[E[0],N[1]+(a[1]-N[1])*(E[0]-N[0])/(a[0]-N[0])]:null}function Kt(N,a){var _=0;return N[0]<a[0]?_|=1:N[0]>a[2]&&(_|=2),N[1]<a[1]?_|=4:N[1]>a[3]&&(_|=8),_}function Me(N,a){var _=ut(N),E=_.type,V=N.type==="Feature"?N.properties:{},xt=_.coordinates;switch(E){case"LineString":case"MultiLineString":var vt=[];return E==="LineString"&&(xt=[xt]),xt.forEach(function(Wt){(function(Ht,Gt,Xt){var Ft,te,zt,ve,ye,we=Ht.length,Ee=Kt(Ht[0],Gt),ze=[];for(Xt||(Xt=[]),Ft=1;Ft<we;Ft++){for(ve=Ht[Ft-1],te=zt=Kt(ye=Ht[Ft],Gt);;){if(!(Ee|te)){ze.push(ve),te!==zt?(ze.push(ye),Ft<we-1&&(Xt.push(ze),ze=[])):Ft===we-1&&ze.push(ye);break}if(Ee&te)break;Ee?Ee=Kt(ve=xe(ve,ye,Ee,Gt),Gt):te=Kt(ye=xe(ve,ye,te,Gt),Gt)}Ee=zt}ze.length&&Xt.push(ze)})(Wt,a,vt)}),vt.length===1?dt(vt[0],V):_t(vt,V);case"Polygon":return at(Se(xt,a),V);case"MultiPolygon":return rt(xt.map(function(Wt){return Se(Wt,a)}),V);default:throw new Error("geometry "+E+" not supported")}}function Se(N,a){for(var _=[],E=0,V=N;E<V.length;E++){var xt=Vt(V[E],a);xt.length>0&&(xt[0][0]===xt[xt.length-1][0]&&xt[0][1]===xt[xt.length-1][1]||xt.push(xt[0]),xt.length>=4&&_.push(xt))}return _}class ke extends Te{setVisible(a){return this._visible===a||(this._visible=a,this._redraw()),this}onCanvasReady(a){super.onCanvasReady(a),a.getContext("2d").scale(this.ratio,this.ratio)}_resize(a){this._canvas.getContext("2d").scale(1,1),super._resize(a),this._canvas.getContext("2d").scale(this.ratio,this.ratio)}_redraw(){if(!this._canvas)return;const a=this._canvas.getContext("2d");if(!a.canvas.width||!a.canvas.height){if(I.logger.debug("canvas尺寸有误！"),!a.canvas.clientWidth)return;a.canvas.width=a.canvas.clientWidth,a.canvas.height=a.canvas.clientHeight}const _=Math.max(this._canvas.clientWidth,this._canvas.width),E=Math.max(this._canvas.clientHeight,this._canvas.height);a.clearRect(0,0,_,E),this._visible&&(a.save(),this.maskOut(a),super._redraw(),a.restore())}maskOut(a){if(!this.layerOptions.mask)return;const _=this._map.getBounds();let E=this.layerOptions.mask.bounds;if(!E){const V=this.layerOptions.mask.bbox||ht(this.layerOptions.mask);E=this.layerOptions.mask.bounds=F().latLngBounds(F().latLng(V[1],V[0]),F().latLng(V[3],V[2]))}E.intersects(_)?(a.beginPath(),gt(this.layerOptions.mask,V=>{var xt;if(((xt=V==null?void 0:V.geometry)===null||xt===void 0?void 0:xt.type)!=="Polygon")return;const vt=V.geometry;if(!vt)return;const Wt=Me(vt,[_.getWest(),_.getSouth(),_.getEast(),_.getNorth()]).geometry;if(Wt&&Wt.coordinates&&Wt.coordinates[0])for(let Ht=0;Ht<Wt.coordinates.length;Ht++){if(Wt.coordinates[Ht].length<=2)continue;const Gt=Wt.coordinates[Ht][0];let Xt=this.proj(Gt);a.moveTo(Xt.x,Xt.y);for(let Ft=1;Ft<Wt.coordinates[Ht].length;Ft++){let te=Wt.coordinates[Ht][Ft];Xt=this.proj(te),a.lineTo(Xt.x,Xt.y)}}}),a.clip()):I.logger.debug("mask与当前视野无交集，无需clip！")}destroy(){}supportRetina(){return!0}}class Ne extends ke{constructor(a){super((0,I.setOptions)({},a,Ne.DefaultOptions)),this.textWidthCache={},this.Pi2=2*Math.PI,this.redrawFromDataSourceTracking=()=>{this.layerOptions.trackDataSource&&this.redraw()},this.windImageCtx=document.createElement("canvas").getContext("2d"),this.windImageCtx.canvas.width=this.windImageCtx.canvas.height=32,this.windImageCtx.globalCompositeOperation="source-atop"}setDrawOptions(a,_=!0){return this.drawOptions&&this.drawOptions.clearCaches(),typeof a=="string"&&(this._theme=a,a=a.indexOf(I.consts.fieldLoaderIndicator)>0?(0,I.processFieldWithLoaders)(a):I.resourceService.getResource(a).instance),typeof a!="object"||a instanceof I.FeatureStyle?this.drawOptions=a:_&&this.drawOptions?this.drawOptions.update(a):this.drawOptions=this._createStyleObjectFromStyleOptions(a),this.dataSource&&this.redraw(),this}setDataSource(a){return this.dataSource&&(this.dataSource.offFeaturesUpdate(this.redrawFromDataSourceTracking),this.drawOptions&&this.drawOptions.clearCaches()),this.dataSource=a,this.pickPolys=void 0,this.drawOptions&&this.redraw(),this.dataSource.onFeaturesUpdate(this.redrawFromDataSourceTracking),this}pickObjects(a,_){if(!this.pickTree)return[];if(this.layerOptions.pickType==="none")return I.logger.warn("当前没有设置要素拾取类型pickType!"),[];a=Object.assign(Object.assign({},this.layerOptions.pickBufferSize),a);const E=this.pickTree.retrieve(a),V=[],xt=F().bounds([a.x-a.width/2,a.y-a.width/2],[a.x+a.width/2,a.y+a.height/2]),vt=this._map.containerPointToLatLng(xt.getTopLeft()),Wt=this._map.containerPointToLatLng(xt.getBottomRight()),Ht={type:"Feature",geometry:{type:"Polygon",coordinates:[[[vt.lng,vt.lat],[vt.lng,Wt.lat],[Wt.lng,Wt.lat],[Wt.lng,vt.lat],[vt.lng,vt.lat]]]},properties:{}},Gt=F().point(a.x,a.y);_||(_=this._map.containerPointToLatLng(Gt)),E&&E.forEach(Ft=>{Ft.source.geometry.type==="Point"&&(Ft.bounds||(Ft.bounds=F().bounds([Ft.x,Ft.y],[Ft.x+Ft.width,Ft.y+Ft.height]))).intersects(xt)&&V.push(Ft.source)});const Xt={type:"Feature",geometry:{type:"Point",coordinates:[_.lng,_.lat]},properties:{}};if(this.pickPolys&&this.pickPolys.length>0)for(const Ft of this.pickPolys)(Ft.geometry.type==="Polygon"&&nt(Ft,Xt)||Ft.geometry.type==="LineString"&&Rt(Ft,Ht))&&V.push(Ft);return V}getEvents(){const a=super.getEvents&&super.getEvents();return Object.assign(Object.assign({},a),{click:_=>{this.handleClickPick(_)}})}onRemove(a){return this.drawOptions&&this.drawOptions.clearCaches(),this.dataSource&&this.dataSource.offFeaturesUpdate(this.redrawFromDataSourceTracking),super.onRemove(a)}handleClickPick(a){if(this.layerOptions.pickType==="none"||!this._visible)return;const _=a.containerPoint;_&&a.latlng||I.logger.warn("当前没有提供点击的点坐标信息！");const E=this.pickObjects(_,a.latlng);E.length&&this.fire(Ne.EventTypes.picked,{firer:this,data:E,msg:E,source:a})}_resize(a){this.collisionDetector&&(this.collisionDetector.clear(),this.collisionDetector=void 0),super._resize(a)}addPickableObject(a){a.width&&a.height&&(a.width+=this.layerOptions.pickBufferSize.width,a.height+=this.layerOptions.pickBufferSize.height,this.pickTree.insert(a))}getDrawableLabels(a,_,E,V,xt,vt,Wt,Ht){if(_)for(const Gt of _){if(Gt.image&&Gt.image.visible){const Xt=Gt.image.offset||[0,0],Ft={x:a.x+Xt[0],y:a.y+Xt[1],width:Gt.image.size[0],height:Gt.image.size[1],feature:E,drawOptions:Gt.image,type:"image",hidden:!1,parentOptions:Gt};Wt&&Gt.image.avoidCollison?(V.push(Ft),this.collisionDetector.insert(Ft)):xt.push(Ft),Ht&&Ht(Ft)}if(Gt.text&&Gt.text.visible){const Xt=Gt.text.offset||[0,0],Ft={x:a.x+Xt[0],y:a.y+Xt[1],width:Gt.text.backWidth,height:Gt.text.backHeight||20,feature:E,drawOptions:Gt.text,type:"text",hidden:!1,parentOptions:Gt};if(Wt&&Gt.text.avoidCollison){let te=this.textWidthCache[Gt.text.data];te===void 0&&(te=vt.measureText(Gt.text.data).width,this.textWidthCache[Gt.text.data]=te),Ft.width=te+Gt.text.collisionExtendSize[0],Ft.sourceWidth=te,Ft.sourceHeight=Ft.height,Ft.height=Ft.height+Gt.text.collisionExtendSize[0],V.push(Ft),this.collisionDetector.insert(Ft)}else xt.push(Ft);Ht&&Ht(Ft)}}}drawCirclePoint(a,_,E){if(_.visible){if(E.beginPath(),E.arc(a.x,a.y,_.size,0,this.Pi2),_.shadowColor?(E.shadowColor=_.shadowColor.rgbaString(),E.shadowOffsetX=_.shadowOffset[0],E.shadowOffsetY=_.shadowOffset[1],E.shadowBlur=_.shadowBlur):E.shadowColor="rgba(0,0,0,0)",_.fill){const V=_.color.rgbaString();E.fillStyle=V,E.fill()}if(_.strokeColor&&_.strokeWidth){const V=_.strokeColor.rgbaString();_.strokeWidth!==E.lineWidth&&(E.lineWidth=_.strokeWidth),V!==E.strokeStyle&&(E.strokeStyle=V),_.strokeDashArray?E.setLineDash(_.strokeDashArray):E.setLineDash([]),E.stroke()}}}drawLine(a,_,E,V,xt,vt){if(!V.visible)return;const Wt=a.geometry.coordinates;if(Wt.length===0)return;xt.lineWidth=V.width,xt.strokeStyle=V.color.rgbaString(),V.dashArray?xt.setLineDash(V.dashArray):xt.setLineDash([]),V.lineJoin&&(xt.lineJoin=V.lineJoin),V.lineCap&&(xt.lineCap=V.lineCap);const Ht=this.proj(Wt[0]);let Gt=0;const Xt=!vt&&V.label&&V.label.length>0;let Ft=Ht;if(xt.beginPath(),xt.moveTo(Ht.x,Ht.y),V.alwaysDrawFirstLabel){const te=this.proj(Wt[1]),zt=Ft;if(!(zt.x<0||zt.y<0||zt.x>(xt.canvas.clientWidth||xt.canvas.width/this.ratio)||zt.y>(xt.canvas.clientHeight||xt.canvas.height/this.ratio))){let ve=Math.atan2(te.y-zt.y,te.x-zt.x);V.labelAutoFlip&&te.x<zt.x&&(ve+=Math.PI);const ye=[];this.getDrawableLabels(zt,V.label,a,ye,E,xt,!1,we=>(we.drawOptions=Object.assign({},we.drawOptions),we.drawOptions.angle||(we.drawOptions.angle=ve),we))}}for(let te=1;te<Wt.length;te++){const zt=this.proj(Wt[te]);if(Math.abs(zt.x-Ft.x)>this.layerOptions.pixelDropNum||Math.abs(zt.y-Ft.y)>this.layerOptions.pixelDropNum){if(xt.lineTo(zt.x,zt.y),Xt&&(Gt+=zt.distanceTo(Ft),Gt>=V.labelDistance)){const ve={x:(zt.x+Ft.x)/2,y:(zt.y+Ft.y)/2};if(!(ve.x<0||ve.y<0||ve.x>(xt.canvas.clientWidth||xt.canvas.width/this.ratio)||ve.y>(xt.canvas.clientHeight||xt.canvas.height/this.ratio))){let ye=Math.atan2(zt.y-ve.y,zt.x-ve.x);V.labelAutoFlip&&zt.x<ve.x&&(ye+=Math.PI);const we=[];this.getDrawableLabels(ve,V.label,a,we,E,xt,!1,Ee=>(Ee.drawOptions=Object.assign({},Ee.drawOptions),Ee.drawOptions.angle||(Ee.drawOptions.angle=ye),Ee))}Gt=0}Ft=zt}}_&&xt.closePath(),V.shadowColor?(xt.save(),xt.shadowColor=V.shadowColor.rgbaString(),xt.shadowOffsetX=V.shadowOffset[0],xt.shadowOffsetY=V.shadowOffset[1],xt.shadowBlur=V.shadowBlur,xt.stroke(),xt.restore()):xt.stroke()}drawPolygon(a,_,E,V){const xt=E.visible&&E.fill,vt=E.lineStyle&&E.lineStyle.visible;if(!xt&&!vt)return;const Wt=()=>{vt&&(a.lineWidth=E.lineStyle.width,a.strokeStyle=E.lineStyle.color.rgbaString(),E.lineStyle.dashArray?a.setLineDash(E.lineStyle.dashArray):a.setLineDash([]));const Ht=vt&&E.lineStyle.label&&E.lineStyle.label.length>0;a.beginPath();for(const Gt of _.geometry.coordinates){const Xt=this.proj(Gt[0]);let Ft=0,te=Xt;a.moveTo(Xt.x,Xt.y);for(let zt=1;zt<Gt.length;zt++){const ve=this.proj(Gt[zt]);if(Math.abs(ve.x-te.x)>this.layerOptions.pixelDropNum||Math.abs(ve.y-te.y)>this.layerOptions.pixelDropNum){if(a.lineTo(ve.x,ve.y),Ht&&(Ft+=ve.distanceTo(te),Ft>=E.lineStyle.labelDistance)){const ye={x:(ve.x+te.x)/2,y:(ve.y+te.y)/2};if(!(ye.x<0||ye.y<0||ye.x>(a.canvas.clientWidth||a.canvas.width/this.ratio)||ye.y>(a.canvas.clientHeight||a.canvas.height/this.ratio))){let we=Math.atan2(ve.y-ye.y,ve.x-ye.x);E.lineStyle.labelAutoFlip&&ve.x<ye.x&&(we+=Math.PI),this.getDrawableLabels(ye,E.lineStyle.label,_,[],V,a,!1,Ee=>(Ee.drawOptions=Object.assign({},Ee.drawOptions),Ee.drawOptions.angle||(Ee.drawOptions.angle=we),Ee))}Ft=0}te=ve}}a.closePath()}xt&&(E.shadowColor?(a.save(),a.shadowColor=E.shadowColor.rgbaString(),a.shadowOffsetX=E.shadowOffset[0],a.shadowOffsetY=E.shadowOffset[1],a.shadowBlur=E.shadowBlur,a.fill(),a.restore()):a.fill()),vt&&(E.lineStyle.shadowColor?(a.save(),a.shadowColor=E.lineStyle.shadowColor.rgbaString(),a.shadowOffsetX=E.lineStyle.shadowOffset[0],a.shadowOffsetY=E.lineStyle.shadowOffset[1],a.shadowBlur=E.lineStyle.shadowBlur,a.stroke(),a.restore()):a.stroke())};if(xt&&E.fillImage)if(typeof E.fillImage=="string")if(this.fillPatterns[E.fillImage])a.fillStyle=this.fillPatterns[E.fillImage],Wt();else{const Ht=this.renderId;this.onceImageLoaded(E.fillImage,Gt=>{if(this.renderId!==Ht)return;const Xt=this.fillPatterns[E.fillImage]=a.createPattern(Gt,"repeat");a.fillStyle=Xt,Wt()})}else{let Ht=E.fillImage.id;Ht!=null&&Ht.length||(Ht=E.fillImage.id=(0,I.uid)()),this.fillPatterns[Ht]?a.fillStyle=this.fillPatterns[Ht]:this.fillPatterns[Ht]=a.fillStyle=a.createPattern(E.fillImage,"repeat"),Wt()}else xt&&(a.fillStyle=E.color.rgbaString()),Wt()}drawLabels(a,_){if(a&&a.length!==0){_.save(),_.globalCompositeOperation="source-over";for(const E of a)if(!E.hidden){if(E.type==="image"&&E.drawOptions.data){const V=E.drawOptions,xt=vt=>{vt&&(V.shadowColor?(_.shadowColor=V.shadowColor.rgbaString(),_.shadowBlur=V.shadowBlur,_.shadowOffsetX=V.shadowOffset[0],_.shadowOffsetY=V.shadowOffset[1]):_.shadowColor="rgba(0,0,0,0)",V.angle&&(_.save(),_.translate(E.x-V.offset[0],E.y-V.offset[1]),_.rotate(V.angle),_.translate(-E.x+V.offset[0],-E.y+V.offset[1])),V.color?(this.windImageCtx.canvas.width!==vt.width&&(this.windImageCtx.canvas.width=vt.width),this.windImageCtx.canvas.height!==vt.height&&(this.windImageCtx.canvas.height=vt.height),this.windImageCtx.clearRect(0,0,vt.width,vt.height),this.windImageCtx.globalCompositeOperation="source-over",this.windImageCtx.drawImage(vt,0,0,vt.width,vt.height),this.windImageCtx.globalCompositeOperation="source-atop",this.windImageCtx.fillStyle=V.color.rgbaString(),this.windImageCtx.fillRect(0,0,vt.width,vt.height),_.drawImage(this.windImageCtx.canvas,0,0,vt.width,vt.height,E.x,E.y,V.size[0],V.size[1])):_.drawImage(vt,0,0,vt.width,vt.height,E.x,E.y,V.size[0],V.size[1]),V.angle&&_.restore(),_.globalCompositeOperation="source-over")};typeof V.data=="string"?this.onceImageLoaded(V.data,vt=>{xt(vt)}):xt(V.data)}else if(E.drawOptions.data!==void 0){const V=E.drawOptions;if(_.save(),_.font=V.font,V.angle&&(_.translate(E.x,E.y),_.rotate(V.angle),_.translate(-E.x,-E.y)),V.backColor){V.backShadowColor?(_.shadowColor=V.backShadowColor.rgbaString(),_.shadowBlur=V.backShadowBlur,_.shadowOffsetX=V.backShadowOffset[0],_.shadowOffsetY=V.backShadowOffset[1]):_.shadowColor="rgba(0,0,0,0)";let xt=E.sourceWidth||E.width||this.textWidthCache[V.data];xt===void 0&&(xt=_.measureText(V.data).width,this.textWidthCache[V.data]=xt),xt+=2*V.backPadding[0];const vt=(E.sourceHeight||E.height)+2*V.backPadding[1];_.beginPath(),V.backRoundRect?(0,I.drawRoundRect)(_,E.x-xt/2,E.y-vt/2,xt,vt,V.backRoundRadius):V.backCircle?_.arc(E.x,E.y,xt-V.backPadding[0],0,this.Pi2):_.rect(E.x-xt/2,E.y-vt/2,xt,vt),_.fillStyle=V.backColor.rgbaString(),_.fill(),V.backStrokeColor&&V.backStrokeWidth&&(_.strokeStyle=V.backStrokeColor.rgbaString(),_.lineWidth=V.backStrokeWidth,V.backStrokeDashArray?_.setLineDash(V.backStrokeDashArray):_.setLineDash([]),_.stroke())}V.baseline&&(_.textBaseline=V.baseline),V.align&&(_.textAlign=V.align),V.shadowColor&&(_.shadowColor=V.shadowColor.rgbaString(),_.shadowOffsetX=V.shadowOffset[0],_.shadowOffsetY=V.shadowOffset[1],_.shadowBlur=V.shadowBlur),V.strokeColor&&V.strokeWidth&&(_.strokeStyle=V.strokeColor,_.lineWidth=V.strokeWidth,_.strokeText(V.data,E.x,E.y)),_.fillStyle=V.color.rgbaString(),_.fillText(V.data,E.x,E.y),_.restore()}}_.restore()}}onRedraw(a){if(!this.dataSource)return void I.logger.warn("当前数据源为空！");if(!this.drawOptions)return void I.logger.warn("当前未设置样式！");this.fire(Ne.EventTypes.beforeDraw,a),this.imgWaiters={},this.textWidthCache={},this.fillPatterns={};const _=Ne.bufferingDraw?document.createElement("canvas"):a.canvas;Ne.bufferingDraw&&(_.width=a.canvas.width,_.height=a.canvas.height,_.getContext("2d").scale(this.ratio,this.ratio));const E=_.getContext("2d");this.layerOptions.delayRendering||(E.save(),E.globalAlpha=this.drawOptions.globalOpacity(void 0)),this.collisionDetector?(this.collisionDetector.clear(),this.pickTree.clear()):(this.collisionDetector=new I.CollisonDetector({x:0,y:0,width:this._canvas.clientWidth||this._canvas.width/this.ratio,height:this._canvas.clientHeight||this._canvas.height/this.ratio,maxNodeItems:10,collisonMode:this.layerOptions.collisionDetectModel}),this.pickTree=new I.Quadtree({x:0,y:0,width:this._canvas.clientWidth||this._canvas.width/this.ratio,height:this._canvas.clientHeight||this._canvas.height/this.ratio}));let V=!1;this.layerOptions.pickType==="all"&&(this.pickPolys||(this.pickPolys=[]),V=!0);let xt=this.dataSource.getFeatures();const vt=[],Wt=[],Ht=F().bounds(F().point(0,0),F().point(this._canvas.clientWidth||this._canvas.width/this.ratio,this._canvas.clientHeight||this._canvas.height/this.ratio));E.font=this.layerOptions.collisionDefaultFont||"16px Arial";const Gt=[],Xt=this._map.containerPointToLatLng([0,0]),Ft=this._map.containerPointToLatLng([this._canvas.clientWidth||_.width/this.ratio,this._canvas.clientHeight||_.height/this.ratio]),te=[Xt.lng,Ft.lat,Ft.lng,Xt.lat];if(this.layerOptions.allowPointCollisionDetect){const ve=performance.now(),ye=[],we={type:"FeatureCollection",features:[]};gt(xt,(ze,Be,e0)=>{var He;if(((He=ze.geometry)===null||He===void 0?void 0:He.type)!=="Point")return void we.features.push(ze);const a0=this._map.latLngToContainerPoint(F().latLng(ze.geometry.coordinates[1],ze.geometry.coordinates[0]));if(ze.pos=a0,!Ht.contains(a0))return;const Ye=this.drawOptions.point.getPlaneOptions(xt.features[Be],this.layerOptions.cacheDrawOptions);if(!Ye.avoidCollison)return void we.features.push(ze);if(this._zoom<Ye.zoomMin||this._zoom>Ye.zoomMax)return;Ye.collisionBuffer.length<2&&(Ye.collisionBuffer=[Ye.collisionBuffer[0],Ye.collisionBuffer[0]]);const d0={x:a0.x,y:a0.y,width:Ye.size+Ye.collisionBuffer[0],height:Ye.size+Ye.collisionBuffer[1],feature:ze,type:"image"};ye.push(d0),this.collisionDetector.insert(d0)});const Ee=this.collisionDetector.collisionDectect(ye);this.collisionDetector.clear(),Ee.forEach(ze=>we.features.push(ze.feature)),xt=we,this.layerOptions.debugShowPerformance&&I.logger.debug("filter collsion points costs "+(performance.now()-ve)+"ms")}const zt=()=>{gt(xt,(we,Ee,ze)=>{var Be;if(we.properties=we.properties||{},((Be=we.geometry)===null||Be===void 0?void 0:Be.type)==="Point"){if(!this.drawOptions.point)return;const e0=we.pos||this._map.latLngToContainerPoint(F().latLng(we.geometry.coordinates[1],we.geometry.coordinates[0]));if(delete we.pos,!Ht.contains(e0))return;const He=this.drawOptions.point.getPlaneOptions(xt.features[Ee],this.layerOptions.cacheDrawOptions);if(this._zoom<He.zoomMin||this._zoom>He.zoomMax)return;this.drawCirclePoint(e0,He,E),this.layerOptions.pickType!=="none"&&this.addPickableObject({x:e0.x,y:e0.y,width:He.size,height:He.size,source:we}),this.getDrawableLabels(e0,He.label,we,vt,Wt,E,!0)}else if(we.geometry){const e0=()=>{if(we.geometry.type==="LineString"&&this.drawOptions.polyline)if(this.layerOptions.clipLine)gt(Me(we,te),He=>{const a0=this.drawOptions.polyline.getPlaneOptions(xt.features[Ee],this.layerOptions.cacheDrawOptions);this._zoom<a0.zoomMin||this._zoom>a0.zoomMax||(Gt.push({feature:He,style:a0}),V&&this.pickPolys.push(He))});else{const He=this.drawOptions.polyline.getPlaneOptions(xt.features[Ee],this.layerOptions.cacheDrawOptions);if(this._zoom<He.zoomMin||this._zoom>He.zoomMax)return;Gt.push({feature:we,style:He}),V&&this.pickPolys.push(we)}else if(this.drawOptions.polygon){const He=this.drawOptions.polygon.getPlaneOptions(xt.features[Ee],this.layerOptions.cacheDrawOptions);if(this._zoom<He.zoomMin||this._zoom>He.zoomMax)return;this.drawPolygon(E,we,He,Wt);const a0="center_"+ze;if(this.drawOptions.polygon&&this.drawOptions.polygon.label&&this.drawOptions.polygon.label.length>0){const Ye=xt.features[Ee];Ye[a0]||(Ye[a0]=function(O0,T0){T0===void 0&&(T0={});var R0=0,D0=0,$0=0;return St(O0,function(B0){R0+=B0[0],D0+=B0[1],$0++},!0),ft([R0/$0,D0/$0],T0.properties)}(we));const d0=Ye[a0],b0=this.proj(d0.geometry.coordinates);this.getDrawableLabels(b0,He.label,we,vt,Wt,E,!0)}V&&this.pickPolys.push(we)}else I.logger.warn("当前类型"+we.geometry.type+"尚未配置对应的样式！")};if(this.layerOptions.checkFeatureBounds){const He="bbox_"+ze,a0=xt.features[Ee];a0[He]||(a0[He]=we.bbox=ht(we));const Ye=a0[He],d0=this.proj([Ye[0],Ye[3]]),b0=this.proj([Ye[2],Ye[1]]),O0=F().bounds(d0,b0);(Ht.intersects(O0)||Ht.contains(O0)||O0.contains(Ht))&&e0()}else e0()}delete we.properties.qe_hidden}),Gt.forEach(we=>{this.drawLine(we.feature,!1,Wt,we.style,E,!1)});const ve=this.collisionDetector.collisionDectect(vt);this.drawLabels(Wt,E),this.drawLabels(ve,E),Ne.bufferingDraw&&a.canvas.getContext("2d").drawImage(_,0,0,_.width,_.height,0,0,a.canvas.clientWidth,a.canvas.clientHeight);const ye={keepObjs:ve,directObjs:Wt,features:xt};return this.fire(Ne.EventTypes.afterDraw,ye),ye};this.layerOptions.delayRendering?setTimeout(()=>{zt()},1):(zt(),E.restore())}_createStyleObjectFromStyleOptions(a){return new I.FeatureStyle(a)}}Ne.EventTypes={beforeDraw:"before:draw",afterDraw:"after:draw",picked:"picked",loop:"loop"},Ne.bufferingDraw=!1,Ne.DefaultOptions={cacheDrawOptions:!0,pickType:"none",pickBufferSize:{width:10,height:10},trackDataSource:!1,pane:I.consts.customPanes.feature.name,pixelDropNum:3,collisionDetectModel:I.CollisionDetectMode.Hide_Only_Self},Ne.qeName="l_geojson",I.layerCreator.register(Ne);class Oe extends I.TracingService{constructor(){super({layerCreator:(a,_,E)=>new Ne(a).setDataSource(_).setDrawOptions(E)})}}var $e=Dt(378),l0=Dt.n($e),je=function(N,a,_,E){return new(_||(_=Promise))(function(V,xt){function vt(Gt){try{Ht(E.next(Gt))}catch(Xt){xt(Xt)}}function Wt(Gt){try{Ht(E.throw(Gt))}catch(Xt){xt(Xt)}}function Ht(Gt){var Xt;Gt.done?V(Gt.value):(Xt=Gt.value,Xt instanceof _?Xt:new _(function(Ft){Ft(Xt)})).then(vt,Wt)}Ht((E=E.apply(N,a||[])).next())})};window.shp||I.logger.log("未找到shpjs库，将无法解码shp文件！请在index.html中引入！");class I0{constructor(a,_){this.map=a,this.layers={},this.initialStyle={},this.order=0,this.defaultVectorStyle={point:{},polyline:{},polygon:{}},_!=null&&_.length&&this.addLayers(_)}getStyleCopy(a){return JSON.parse(JSON.stringify(a))}getRealKey(a){return a.replaceAll("_",".")}addLayers(a){return je(this,void 0,void 0,function*(){for(const _ of a)yield this.addLayer(_)})}addLayer(a){return je(this,void 0,void 0,function*(){if(this.layers[a.name])return void I.logger.warn("当前已经存在名为"+a.name+"的图层！");const _=E=>{typeof a.style=="string"&&(a.style=I.resourceService.getResource(a.style).instance);const V=new Ne({name:a.name,pane:a.pane}).setDataSource(E).setDrawOptions(this.getStyleCopy(a.style));return this.layers[a.name]={layer:V,config:a,order:this.order++},this.initialStyle[a.name]=this.getStyleCopy(a.style),this.map.addLayer(V),a.hide&&V.setVisible(!1),V};if(typeof a.source=="string"){let E;if(a.source.endsWith(".zip")||a.source.endsWith(".json.zip")){const V=yield(0,I.getJSONZip)(a.source);E=a.provider==="array"?new I.PointArrayFeatureProvider(V.DS||V,{lonField:a.lonName,latField:a.latName,idField:a.idName}):new I.GeoJSONFeatureProvider(V)}else if(a.source.endsWith(".shp.zip")&&(0,I.defined)(shp)){const V=yield shp(a.source);E=new I.GeoJSONFeatureProvider(V)}else{if(!a.source.endsWith(".geojson")&&!a.source.endsWith(".json"))return I.logger.warn("暂时不支持的格式！"),Promise.resolve(void 0);{const V=yield(yield fetch(a.source)).json();E=new I.GeoJSONFeatureProvider(V)}}return _(E)}return Promise.resolve(_(a.source))})}getAllConfig(){return Object.values(this.layers).map(a=>a.config)}getLayerNames(){return Object.keys(this.layers)}getLayerInfoByName(a){return this.layers[a]}getLayerStyleConfig(a){if(this.layers[a])return this.layers[a].config.style;I.logger.warn("名为"+a+"的图层不存在！")}resetAllStyleToInitial(){for(const a in this.layers)this.resetStyleToInitial(a)}resetStyleToInitial(a){if(!this.layers[a])return void I.logger.warn("名为"+a+"的图层不存在！");const _=this.layers[a].layer,E=this.getStyleCopy(this.initialStyle[a]);this.layers[a].config.style=E,_.setDrawOptions(E,!1)}updateLayerStyle(a,_){if(!this.layers[a])return void I.logger.warn("名为"+a+"的图层不存在！");const E=this.layers[a].layer;this.layers[a].config.style=_,E.setDrawOptions(this.getStyleCopy(_),!1)}removeLayer(a){if(!this.layers[a]||!this.layers[a].config.removable)return void I.logger.warn("图层"+a+"不存在或不支持删除！");const _=this.layers[a].layer;this.map.removeLayer(_),delete this.layers[a],delete this.initialStyle[a]}clearLayers(){if(this.layers){for(const a in this.layers)this.map.removeLayer(this.layers[a].layer);this.layers={},this.initialStyle={}}}addVectorFile(a){return je(this,void 0,void 0,function*(){let _;if(a.name.endsWith(".shp.zip")){if(!(0,I.defined)(shp))throw new Error("未找到shp库！");const vt=yield a.arrayBuffer();_=yield shp(vt)}else{const vt=yield a.text();_=JSON.parse(vt)}const E=new I.GeoJSONFeatureProvider(_);let V=I.consts.customPanes.topmap.name;a.name.indexOf("bottom")>=0&&(V=I.consts.customPanes.bottommap.name);const xt={source:E,style:this.defaultVectorStyle,pane:V,name:a.name,removable:!0,key:(0,I.uid)()};return yield this.addLayer(xt),xt})}getConfigBlobInfo(a){if(!this.layers[a])return void I.logger.warn("名为"+a+"的图层不存在！");const _=JSON.stringify(this.layers[a].config.style,void 0,2);return{blob:new Blob([_]),type:"text/json;charset=utf-8",name:this.getRealKey(this.layers[a].config.key)+".json"}}getLayerZipBlobInfo(a){return je(this,void 0,void 0,function*(){const _=new(l0()),E=_.folder("data"),V=_.folder("styles");let xt=[];for(const Wt in this.layers){const Ht=this.layers[Wt].layer.dataSource,Gt=this.layers[Wt].config,Xt=this.getRealKey(Gt.key);E.file(Xt+".json",JSON.stringify(Ht.getFeatures())),V.file(Xt+".feature.style.json",JSON.stringify(Gt.style,void 0,2));const Ft={order:this.layers[Wt].order,key:Xt,pane:Gt.pane,name:Gt.name};Gt.provider==="array"&&(Ft.provider="array",Ft.latName=Gt.latName,Ft.lonName=Gt.lonName,Ft.idName=Gt.idName),xt.push(Ft)}xt=xt.sort((Wt,Ht)=>Wt.order-Ht.order);const vt={backColor:a,layers:xt};return _.file("config.json",JSON.stringify(vt,void 0,2)),{blob:yield _.generateAsync({type:"blob"}),name:"bundle-"+new Date().getTime()+".zip"}})}loadFromConfig(a,_,E){return je(this,void 0,void 0,function*(){a instanceof Array&&(a={backColor:"white",layers:a}),a.layers=a.layers.sort((xt,vt)=>xt.order-vt.order);const V={backColor:a.backColor,layers:[]};this.map.getContainer().style.backgroundColor=a.backColor;for(const xt of a.layers){const vt={source:yield _(xt.key+".json").then(Wt=>xt.provider==="array"?new I.PointArrayFeatureProvider(JSON.parse(Wt),{latField:xt.latName,lonField:xt.lonName,idField:xt.idName}):new I.GeoJSONFeatureProvider(JSON.parse(Wt))),style:yield E(xt.key+".feature.style.json").then(Wt=>JSON.parse(Wt)),pane:xt.pane,name:xt.name,removable:!1,key:xt.key};xt.provider==="array"&&(vt.provider="array",vt.lonName=xt.lonName,vt.latName=xt.latName,vt.idName=xt.idName),yield this.addLayer(vt),V.layers.push(vt)}return V})}loadFromUrl(a){return je(this,void 0,void 0,function*(){const _=a.slice(0,a.lastIndexOf("/")+1),E=yield(yield fetch(a)).json();return this.loadFromConfig(E,V=>je(this,void 0,void 0,function*(){return(yield fetch(_+"data/"+V)).text()}),V=>je(this,void 0,void 0,function*(){return(yield fetch(_+"styles/"+V)).text()}))})}loadFromZip(a){var _;return je(this,void 0,void 0,function*(){const E=yield a.arrayBuffer(),V=yield new(l0())().loadAsync(E),xt=V.folder("data"),vt=V.folder("styles");let Wt=yield(_=V.file("config.json"))===null||_===void 0?void 0:_.async("text").then(Ht=>JSON.parse(Ht));if((0,I.defined)(Wt))return this.loadFromConfig(Wt,Ht=>xt.file(Ht).async("text"),Ht=>vt.file(Ht).async("text"));I.logger.warn("当前打开的文件中不包含图层配置文件！")})}}class X0 extends Ne{constructor(a){super(a),this.setEmptyDataSource()}static createRenderers(a,_,E,V,xt){const vt={point:{fill:!1,label:[{image:{data:a}}]},polygon:{color:new I.Spectra(E).alpha(.6)},polyline:{color:_}};return V&&(vt.point.label[0].image.offset=V),xt&&(vt.polyline.dashArray=xt),{toolRenderer:new X0({debugShowPerformance:!1}).setDrawOptions(vt),toolLineRenderer:new X0({}).setDrawOptions(vt)}}setEmptyDataSource(){const a=new I.GeoJSONFeatureProvider({type:"FeatureCollection",features:[]});this.setDataSource(a)}unprojectPt(a){const _=this.map.options.crs.unproject(F().point(a[0],a[1]));return[_.lng,_.lat]}unprojectGeometry(a){if(a.type==="Point")return void(a.coordinates=this.unprojectPt(a.coordinates));let _;const E=[];a.type==="LineString"?(_=a.coordinates,a.coordinates=E):a.type==="Polygon"?(_=a.coordinates[0],a.coordinates=[E]):I.logger.error("不支持的Geometry类型："+a.type);for(let V=0;V<_.length;V++)E[V]=this.unprojectPt(_[V])}getFeatureFromShape(a,_,E){const V=_.getGeoJSON();if(!V||V.coordinates.length===0)return;this.map.options.crs!==F().CRS.EPSG4326&&this.unprojectGeometry(V);const xt={type:"Feature",geometry:V,properties:E||{},id:a};return xt.shape=_,xt}setMap(a){var _;this.map!==a&&(this.map&&this.map.removeLayer(this),this.map=a,(_=this.map)===null||_===void 0||_.addLayer(this))}updateShape(a,_,E){this.removeShape(a),this.addShape(a,_,E)}pick(a){const _=this.pickObjects(a);if(_&&_.length>0){const E=_[0];return{key:E.id,shape:E.shape,properties:E.properties}}}addShape(a,_,E){const V=this.getFeatureFromShape(a,_,E);V&&(this.dataSource.addFeature(V),this._redraw())}removeShape(a){this.dataSource.removeFeature(a)}getGeoJSON(){return this.dataSource.getFeatures()}clear(){this.setEmptyDataSource()}}class W0 extends I.VectorMapTool{constructor(a){if(super(a),this.onMouseDown=_=>{this.listeners.onPointerDown(this.getMouseEventData(_))},this.onMouseUp=_=>{this.listeners.onPointerUp(this.getMouseEventData(_))},this.onMouseMove=_=>{this.listeners.onPointerMove(this.getMouseEventData(_))},!a.renderer){const _={point:{},polygon:{color:new I.Spectra(I.predefinedColorNames.red).alpha(.5),shadowColor:I.predefinedColorNames.brown,shadowOffset:[3,3]},polyline:{color:I.predefinedColorNames.red}};a.renderer=new X0({}).setDrawOptions(_)}if(!a.tempLineRenderer){const _={polyline:{color:I.predefinedColorNames.red,dashArray:[5,5,5,5]}};a.tempLineRenderer=new X0({}).setDrawOptions(_)}}projectPoint(a){return this.map.options.crs!==F().CRS.EPSG4326?this.map.options.crs.project(a):F().point(a.lng,a.lat)}getMouseEventData(a){const _=a.originalEvent.button===0?I.VectorMapToolPointerButtonType.left:a.originalEvent.button===2?I.VectorMapToolPointerButtonType.right:I.VectorMapToolPointerButtonType.middle,E=this.projectPoint(a.latlng);return{coords:[E.x,E.y],buttonType:_,originalEvent:a.originalEvent,toolEvent:a}}setListeners(){this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),this.map.on("mousemove",this.onMouseMove),this.contextMenuFunc=window.oncontextmenu,window.oncontextmenu=()=>!1}unsetListeners(){this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),this.map.off("mousemove",this.onMouseMove),setTimeout(()=>{window.oncontextmenu=this.contextMenuFunc,this.contextMenuFunc=void 0},10)}unlockMap(){this.map.dragging.enable()}lockMap(){this.map.dragging.disable()}addPoint(a){const _=this.projectPoint(F().latLng(a[1],a[0]));super.addPoint([_.x,_.y])}}class U0{constructor(a){var _,E,V,xt,vt,Wt,Ht,Gt,Xt,Ft,te,zt,ve,ye,we,Ee;this.options=(0,I.setOptions)({},a,U0.defaultBorderAxisOptions);const ze=(xt=(E=(_=a.padding)===null||_===void 0?void 0:_.paddingTop)!==null&&E!==void 0?E:(V=a.padding)===null||V===void 0?void 0:V.value)!==null&&xt!==void 0?xt:U0.defaultPadding,Be=(Gt=(Wt=(vt=a.padding)===null||vt===void 0?void 0:vt.paddingBottom)!==null&&Wt!==void 0?Wt:(Ht=a.padding)===null||Ht===void 0?void 0:Ht.value)!==null&&Gt!==void 0?Gt:U0.defaultPadding,e0=(zt=(Ft=(Xt=a.padding)===null||Xt===void 0?void 0:Xt.paddingLeft)!==null&&Ft!==void 0?Ft:(te=a.padding)===null||te===void 0?void 0:te.value)!==null&&zt!==void 0?zt:U0.defaultPadding,He=(Ee=(ye=(ve=a.padding)===null||ve===void 0?void 0:ve.paddingRight)!==null&&ye!==void 0?ye:(we=a.padding)===null||we===void 0?void 0:we.value)!==null&&Ee!==void 0?Ee:U0.defaultPadding;if(this.options.padding.paddingTop=ze,this.options.padding.paddingBottom=Be,this.options.padding.paddingRight=He,this.options.padding.paddingLeft=e0,(0,I.defined)(this.options.ratio)||(this.options.ratio=I.consts.checkRetina&&(I.consts.retinaRatio||window.devicePixelRatio)||1),!this.options.canvas||!this.options.map)throw new Error("绘制坐标轴需要map和canvas对象！");if(this._updateOptions(this.options.sourceLt,this.options.sourceRb),this.options.clip){let a0=document.createElement("canvas");a0.width=(this.options.canvas.clientWidth||this.options.canvas.width/this.options.sourceRatio)*this.options.ratio,a0.height=(this.options.canvas.clientHeight||this.options.canvas.height/this.options.sourceRatio)*this.options.ratio,this.context=a0.getContext("2d"),this.context.scale(this.options.ratio,this.options.ratio);let Ye=document.createElement("canvas");Ye.width=a0.width,Ye.height=a0.height,this.tempContext=Ye.getContext("2d"),this.tempContext.scale(this.options.ratio,this.options.ratio)}else this.context=this.options.canvas.getContext("2d")}_updateOptions(a,_){if(!this.options.canvas)throw new Error("更新坐标轴参数需要提供canvas对象！");this.options.sourceRb=_||this.options.sourceRb||F().point(this.options.canvas.clientWidth||this.options.canvas.width/this.options.sourceRatio,this.options.canvas.clientHeight||this.options.canvas.height/this.options.sourceRatio),this.options.sourceLt=a||this.options.sourceLt||F().point(0,0),this.realRect=F().bounds(F().point(this.options.sourceLt.x,this.options.sourceLt.y),F().point(this.options.sourceRb.x,this.options.sourceRb.y))}draw(a,_){(_||a)&&this._updateOptions(a,_),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);const E=this.options.sourceRb.x-this.options.sourceLt.x,V=this.options.sourceRb.y-this.options.sourceLt.y;if(this.options.clip&&this.context.drawImage(this.options.canvas,this.options.sourceLt.x*this.options.sourceRatio,this.options.sourceLt.y*this.options.sourceRatio,E*this.options.sourceRatio,V*this.options.sourceRatio,this.options.sourceLt.x,this.options.sourceLt.y,E,V),this.drawAxisesAndGridLine(),this.drawBorder(),this.options.clip){this.tempContext.clearRect(0,0,this.tempContext.canvas.width,this.tempContext.canvas.height);const xt=this.options.padding.paddingTop,vt=this.options.padding.paddingBottom,Wt=this.options.padding.paddingRight,Ht=this.options.padding.paddingLeft;return this.tempContext.canvas.width=(Ht+E+Wt)*this.options.ratio,this.tempContext.canvas.height=(xt+V+vt)*this.options.ratio,this.options.backgroundColor&&(this.tempContext.fillStyle=this.options.backgroundColor,this.tempContext.fillRect(0,0,this.tempContext.canvas.width,this.tempContext.canvas.height)),this.tempContext.drawImage(this.context.canvas,(this.options.sourceLt.x-Ht)*this.options.ratio,(this.options.sourceLt.y-xt)*this.options.ratio,this.tempContext.canvas.width,this.tempContext.canvas.height,0,0,this.tempContext.canvas.width,this.tempContext.canvas.height),this.tempContext.canvas}return this.context.canvas}drawAxisesAndGridLine(){const a=this.options.map.getZoom();let _,E,V,xt,vt=1;vt=a>3&&a<12?2:a<17?3:4,E=this.options.bottomAxis&&this.options.bottomAxis.visible?this.drawAxis("b",vt,this.options.bottomAxis):{majorPts:[],minorPts:[]},_=this.options.leftAxis&&this.options.leftAxis.visible?this.drawAxis("l",vt,this.options.leftAxis):{majorPts:[],minorPts:[]},V=this.options.rightAxis&&this.options.rightAxis.visible?this.drawAxis("r",vt,this.options.rightAxis):{majorPts:[],minorPts:[]},xt=this.options.topAxis&&this.options.topAxis.visible?this.drawAxis("t",vt,this.options.topAxis):{majorPts:[],minorPts:[]};const Wt=(Gt,Xt,Ft)=>{if(Xt.majorPts.length>0&&Ft.majorPts.length===0){for(let te=0;te<Xt.majorPts.length;te++)Ft.majorPts.push(F().point(Xt.majorPts[te].x,Gt));for(let te=0;te<Xt.minorPts.length;te++)Ft.minorPts.push(F().point(Xt.minorPts[te].x,Gt))}};Wt(this.realRect.min.y,E,xt),Wt(this.realRect.max.y,xt,E);const Ht=(Gt,Xt,Ft)=>{if(Xt.majorPts.length>0&&Ft.majorPts.length===0){for(let te=0;te<Xt.majorPts.length;te++)Ft.majorPts.push(F().point(Gt,Xt.majorPts[te].y));for(let te=0;te<Xt.minorPts.length;te++)Ft.minorPts.push(F().point(Gt,Xt.minorPts[te].y))}};Ht(this.realRect.max.x,_,V),Ht(this.realRect.min.x,V,_),this.options.gridLine&&(this.drawGridLine(this.options.gridLine.majorLonLine,E.majorPts,xt.majorPts),this.drawGridLine(this.options.gridLine.majorLatLine,_.majorPts,V.majorPts),this.drawGridLine(this.options.gridLine.minorLonLine,E.minorPts,xt.minorPts),this.drawGridLine(this.options.gridLine.minorLatLine,_.minorPts,V.minorPts))}drawGridLine(a,_,E){const V=this.context;if(a&&a.visible&&_.length!==0&&E.length!==0&&_.length===E.length){V.save(),this.setLineContext(a,V),V.beginPath();for(let xt=0;xt<_.length;xt++)V.moveTo(_[xt].x,_[xt].y),V.lineTo(E[xt].x,E[xt].y);V.stroke(),V.restore()}}drawAxis(a,_,E){const V=a==="l"||a==="r",xt=(a0,Ye,d0,b0,O0,T0)=>{if(!E.visible)return;let R0,D0;O0=(0,I.defaultVal)(O0,_),(0,I.defined)(d0)?Ye=(b0-a0)/d0+1:d0=(b0-a0)/((Ye=(0,I.defaultVal)(Ye,5))-1);let $0=a0;for(let B0=0;B0<Ye;B0++)R0=$0,D0=R0.toFixed(O0),$0=R0+d0,T0(B0,D0,R0,$0)},vt=this.context;vt.save();let Wt=this.realRect.min.y;vt.textAlign="center",vt.textBaseline="bottom";let Ht=0,Gt=-3;a==="l"?(Wt=this.realRect.min.x,vt.textAlign="end",vt.textBaseline="alphabetic",Ht=-3,Gt=2):a==="r"?(Wt=this.realRect.max.x,vt.textAlign="start",vt.textBaseline="alphabetic",Ht=3,Gt=2):a==="b"&&(vt.textAlign="center",vt.textBaseline="top",Wt=this.realRect.max.y,Gt=0);const Xt=a0=>{let Ye=a==="r"||a==="b"?Wt-a0:Wt+a0,d0=Wt;const b0=(0,I.defaultVal)(E.position,"in");return b0==="cross"?a==="l"||a==="t"?(Ye-=a0/2,d0-=a0/2):(Ye+=a0/2,d0+=a0/2):b0==="out"&&(a==="l"||a==="t"?(Ye-=a0,d0-=a0):(Ye+=a0,d0+=a0)),[Ye,d0]},Ft=(0,I.defaultVal)(E.minorTick&&E.majorTick.tickLength,10),te=(0,I.defaultVal)(E.minorTick&&E.minorTick.tickLength,5),zt=Xt(Ft),ve=Xt(te),ye=(0,I.defaultVal)(E.startOffset,20),we=(0,I.defaultVal)(E.endOffset,20);let Ee,ze,Be;a==="l"?(ze=this.options.map.containerPointToLatLng(F().point(this.realRect.min.x+0,this.realRect.max.y+0-ye)),Be=this.options.map.containerPointToLatLng(F().point(this.realRect.min.x+0,this.realRect.min.y+0+we)),(0,I.defined)(this.options.leftAxis.start)&&(ze.lat=this.options.leftAxis.start),(0,I.defined)(this.options.leftAxis.end)&&(Be.lat=this.options.leftAxis.end),Ee=ze.lng):a==="r"?(ze=this.options.map.containerPointToLatLng(F().point(this.realRect.max.x+0,this.realRect.max.y+0-ye)),Be=this.options.map.containerPointToLatLng(F().point(this.realRect.max.x+0,this.realRect.min.y+0+we)),(0,I.defined)(this.options.rightAxis.start)&&(ze.lat=this.options.rightAxis.start),(0,I.defined)(this.options.rightAxis.end)&&(Be.lat=this.options.rightAxis.end),Ee=ze.lng):a==="b"?(ze=this.options.map.containerPointToLatLng(F().point(this.realRect.min.x+0+ye,this.realRect.max.y+0)),Be=this.options.map.containerPointToLatLng(F().point(this.realRect.max.x+0-we,this.realRect.max.y+0)),(0,I.defined)(this.options.bottomAxis.start)&&(ze.lng=this.options.bottomAxis.start),(0,I.defined)(this.options.bottomAxis.end)&&(Be.lng=this.options.bottomAxis.end),Ee=ze.lat):(ze=this.options.map.containerPointToLatLng(F().point(this.realRect.min.x+0+ye,this.realRect.min.y+0)),Be=this.options.map.containerPointToLatLng(F().point(this.realRect.max.x+0-we,this.realRect.min.y+0)),(0,I.defined)(this.options.topAxis.start)&&(ze.lng=this.options.topAxis.start),(0,I.defined)(this.options.topAxis.end)&&(Be.lng=this.options.topAxis.end),Ee=ze.lat);const e0=[],He=[];return xt(V?ze.lat:ze.lng,E.majorTick.tickCount,E.majorTick.tickInterval,V?Be.lat:Be.lng,E.label.decimal,(a0,Ye,d0,b0)=>{const O0=V?F().latLng(d0,Ee):F().latLng(Ee,d0),T0=this.options.map.latLngToContainerPoint(O0);if(E.label.converter&&(Ye=E.label.converter(Ye,O0.lng,O0.lat,T0.x,T0.y)),E.majorTick&&E.majorTick.tickLine.visible&&(vt.save(),this.setLineContext(E.majorTick.tickLine,vt),V?(vt.beginPath(),vt.moveTo(zt[0],T0.y),vt.lineTo(zt[1],T0.y),e0.push(F().point(Wt,T0.y))):(vt.beginPath(),vt.moveTo(T0.x,zt[0]),vt.lineTo(T0.x,zt[1]),e0.push(F().point(T0.x,Wt))),vt.stroke(),vt.restore(),E.minorTick&&E.minorTick.tickLine.visible&&a0<E.majorTick.tickCount-1&&(vt.save(),this.setLineContext(E.minorTick.tickLine,vt),vt.beginPath(),xt(d0,E.minorTick.tickCount,E.minorTick.tickInterval,b0,E.label.decimal,(R0,D0,$0,B0)=>{if(R0===0||R0>=E.minorTick.tickCount-1)return;const L0=this.options.map.latLngToContainerPoint(V?F().latLng($0,Ee):F().latLng(Ee,$0));V?(vt.moveTo(ve[0],L0.y),vt.lineTo(ve[1],L0.y),He.push(F().point(Wt,L0.y))):(vt.moveTo(L0.x,ve[0]),vt.lineTo(L0.x,ve[1]),He.push(F().point(L0.x,Wt)))}),vt.stroke(),vt.restore())),E.label.visible){vt.save(),this.setLabelContext(E.label,vt);const R0=(0,I.defaultVal)(E.label.offsetX,0),D0=(0,I.defaultVal)(E.label.offsetY,3);V?vt.fillText(Ye,zt[1]+R0+Ht,T0.y+D0+Gt):vt.fillText(Ye,T0.x+R0+Ht,zt[1]+D0+Gt),E.label.strokeColor&&(V?vt.strokeText(Ye,zt[1]+R0+Ht,T0.y+D0+Gt):vt.strokeText(Ye,T0.x+R0+Ht,zt[1]+D0+Gt)),vt.restore()}}),vt.restore(),{majorPts:e0,minorPts:He}}setLabelContext(a,_,E="black",V="12px",xt="Arial"){xt=(0,I.defaultVal)(a.font,xt),xt=(V=(0,I.defaultVal)(a.fontSize,V))+" "+xt,a.bold&&(xt="bold "+xt),a.italic&&(xt="italic "+xt),_.font=xt,_.fillStyle=(0,I.defaultVal)(a.textColor,E),a.strokeColor&&(_.strokeStyle=a.strokeColor)}setLineContext(a,_,E="black",V=2){_.strokeStyle=(0,I.defaultVal)(a.lineStyle,E),_.lineWidth=(0,I.defaultVal)(a.lineWidth,V),a.lineDash&&_.setLineDash(a.lineDash)}drawBorder(){if(!this.options.border||!this.options.border.visible)return;const a=this.context;a.save(),this.setLineContext(this.options.border,a);const _=this.realRect.getSize();a.strokeRect(this.realRect.min.x,this.realRect.min.y,_.x,_.y),a.restore()}}U0.defaultBorderAxisSingle={visible:!0,majorTick:{tickCount:5,tickLength:8,tickLine:{lineWidth:1,visible:!0}},minorTick:{tickCount:3,tickLength:6,tickLine:{lineWidth:1,visible:!0}},label:{visible:!0,fontSize:"15px"}},U0.defaultBorderAxisGridLine={lineDash:[3,3],lineWidth:1,lineStyle:"grey",visible:!0},U0.defaultBorderAxisOptions={border:{lineStyle:"black",visible:!0},padding:{},gridLine:{majorLonLine:U0.defaultBorderAxisGridLine,majorLatLine:U0.defaultBorderAxisGridLine,minorLatLine:void 0,minorLonLine:void 0},bottomAxis:Object.assign({},U0.defaultBorderAxisSingle),leftAxis:Object.assign({},U0.defaultBorderAxisSingle),topAxis:Object.assign(Object.assign({},U0.defaultBorderAxisSingle),{visible:!1}),rightAxis:Object.assign(Object.assign({},U0.defaultBorderAxisSingle),{visible:!1}),map:void 0,sourceLt:F().point(0,0),sourceRb:void 0,canvas:void 0,backgroundColor:"white",clip:!0,sourceRatio:1},U0.defaultPadding=50;class J0 extends W0{constructor(a){super({drawType:I.PlotTypes.POLYLINE,continious:!0}),this.totalLen=0;const _={polyline:(a==null?void 0:a.lineOptions)||{color:I.predefinedColorNames.blue,width:3,dashArray:[5,5,5,5]}},E=new X0({debugShowPerformance:!1}).setDrawOptions(_),V=new X0({debugShowPerformance:!1}).setDrawOptions(_);this.options.tempLineRenderer=V,this.options.renderer=E,this.on(I.VectorMapTool.EventTypes.pointAdd,vt=>this.addDistanceMarker(vt)),this.on(I.VectorMapTool.EventTypes.drawFinish,vt=>{this.clearTempMarker()});const xt=this.onPointerMove;this.listeners.onPointerMove=vt=>{xt(vt),this.updateMouseMove(vt)},this.distanceIcon=a==null?void 0:a.icon}clearTempMarker(){this.tempMarker&&(this.tempMarker.remove(),this.tempMarker=void 0),this.lastPoint=void 0,this.totalLen=0}updateMouseMove(a){if(!this.lastPoint)return;const _=a.toolEvent.latlng;this.tempMarker?this.tempMarker.setLatLng(_).setTooltipContent(this.getDistanceContent(_,!1)):this.tempMarker=this.createMarker(_,!1)}getDistance(a,_){return a.distanceTo(_)/1e3}getDistanceContent(a,_){const E=this.getDistance(a,this.lastPoint),V=this.totalLen+E;return _&&(this.totalLen=V),E.toFixed(3).trimEnd()+"千米，总长"+V.toFixed(3).trimEnd()+"千米"}createMarker(a,_){const E={};this.distanceIcon&&(E.icon=this.distanceIcon);const V=F().marker(a,E).bindTooltip(this.getDistanceContent(a,_),{permanent:!0});return V.addTo(this.markers),V.openTooltip(a),V}getScreenDistance(a){const _=this.map.latLngToContainerPoint(a),E=this.map.latLngToContainerPoint(this.lastPoint);return _.distanceTo(E)}addDistanceMarker(a){this.markers||(this.markers=F().layerGroup([]).addTo(this.map));const _=a.msg.source.toolEvent.latlng;if(this.lastPoint)this.getScreenDistance(_)>15&&this.createMarker(_,!0);else{const E={};this.distanceIcon&&(E.icon=this.distanceIcon),F().marker(_,E).addTo(this.markers),this.totalLen=0}this.lastPoint=_}clear(){this.tempMarker&&this.tempMarker.remove(),this.tempMarker=void 0,this.lastPoint=void 0,this.markers&&this.markers.remove(),this.markers=void 0,this.totalLen=0,super.clear()}}class yx extends ke{constructor(a){super((0,I.setOptions)({},a,yx.DefaultOptions)),this.redrawFromDataSourceTracking=()=>{this.layerOptions.trackDataSource&&this.redraw()}}onRemove(a){return super.onRemove(a),this.dataSource&&(this.dataSource.offActiveGridUpdated(this.redrawFromDataSourceTracking),this.dataSource.offIntTZChanged(this.redrawFromDataSourceTracking)),this}setDataSource(a){if(a)return this.dataSource&&this.dataSource!==a&&(this.dataSource.offActiveGridUpdated(this.redrawFromDataSourceTracking),this.dataSource.offIntTZChanged(this.redrawFromDataSourceTracking)),this.dataSource&&this.dataSource===a||(a.onActiveGridUpdated(this.redrawFromDataSourceTracking),a.onIntTZChanged(this.redrawFromDataSourceTracking),this.dataSource=a),this.drawOptions&&this.redraw(),this;I.logger.warn("数据源为空，无法更新！")}setDrawOptions(a,_=!0){return typeof a=="string"&&(this._theme=a,a=a.indexOf(I.consts.fieldLoaderIndicator)>0?(0,I.processFieldWithLoaders)(a):I.resourceService.getResource(a).instance),typeof a!="object"||a instanceof I.GridBaseStyle?this.drawOptions=a:_&&this.drawOptions?this.drawOptions.update(a):this.drawOptions=this._createStyleObjectFromStyleOptions(a),this.dataSource&&this.redraw(),this}}yx.DefaultOptions={cacheDrawOptions:!0};let cx=Float32Array;function H0(N,a,_){const E=new cx(3);return N&&(E[0]=N),a&&(E[1]=a),_&&(E[2]=_),E}function kx(N,a,_){_=_||new cx(3);const E=N[2]*a[0]-N[0]*a[2],V=N[0]*a[1]-N[1]*a[0];return _[0]=N[1]*a[2]-N[2]*a[1],_[1]=E,_[2]=V,_}function ri(N,a){a=a||new cx(3);const _=N[0]*N[0]+N[1]*N[1]+N[2]*N[2],E=Math.sqrt(_);return E>1e-5?(a[0]=N[0]/E,a[1]=N[1]/E,a[2]=N[2]/E):(a[0]=0,a[1]=0,a[2]=0),a}let Ox,$x,lx,y0=Float32Array;function he(N,a){return(a=a||new y0(16))[0]=N[0],a[1]=N[1],a[2]=N[2],a[3]=N[3],a[4]=N[4],a[5]=N[5],a[6]=N[6],a[7]=N[7],a[8]=N[8],a[9]=N[9],a[10]=N[10],a[11]=N[11],a[12]=N[12],a[13]=N[13],a[14]=N[14],a[15]=N[15],a}function Ae(N){return(N=N||new y0(16))[0]=1,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=1,N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=1,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}function Ve(N,a){a=a||new y0(16);const _=N[0],E=N[1],V=N[2],xt=N[3],vt=N[4],Wt=N[5],Ht=N[6],Gt=N[7],Xt=N[8],Ft=N[9],te=N[10],zt=N[11],ve=N[12],ye=N[13],we=N[14],Ee=N[15],ze=te*Ee,Be=we*zt,e0=Ht*Ee,He=we*Gt,a0=Ht*zt,Ye=te*Gt,d0=V*Ee,b0=we*xt,O0=V*zt,T0=te*xt,R0=V*Gt,D0=Ht*xt,$0=Xt*ye,B0=ve*Ft,L0=vt*ye,ox=ve*Wt,vx=vt*Ft,Fi=Xt*Wt,Vx=_*ye,Vr=ve*E,pn=_*Ft,mn=Xt*E,Jn=_*Wt,ii=vt*E,Wr=ze*Wt+He*Ft+a0*ye-(Be*Wt+e0*Ft+Ye*ye),Wx=Be*E+d0*Ft+T0*ye-(ze*E+b0*Ft+O0*ye),pr=e0*E+b0*Wt+R0*ye-(He*E+d0*Wt+D0*ye),Hn=Ye*E+O0*Wt+D0*Ft-(a0*E+T0*Wt+R0*Ft),u0=1/(_*Wr+vt*Wx+Xt*pr+ve*Hn);return a[0]=u0*Wr,a[1]=u0*Wx,a[2]=u0*pr,a[3]=u0*Hn,a[4]=u0*(Be*vt+e0*Xt+Ye*ve-(ze*vt+He*Xt+a0*ve)),a[5]=u0*(ze*_+b0*Xt+O0*ve-(Be*_+d0*Xt+T0*ve)),a[6]=u0*(He*_+d0*vt+D0*ve-(e0*_+b0*vt+R0*ve)),a[7]=u0*(a0*_+T0*vt+R0*Xt-(Ye*_+O0*vt+D0*Xt)),a[8]=u0*($0*Gt+ox*zt+vx*Ee-(B0*Gt+L0*zt+Fi*Ee)),a[9]=u0*(B0*xt+Vx*zt+mn*Ee-($0*xt+Vr*zt+pn*Ee)),a[10]=u0*(L0*xt+Vr*Gt+Jn*Ee-(ox*xt+Vx*Gt+ii*Ee)),a[11]=u0*(Fi*xt+pn*Gt+ii*zt-(vx*xt+mn*Gt+Jn*zt)),a[12]=u0*(L0*te+Fi*we+B0*Ht-(vx*we+$0*Ht+ox*te)),a[13]=u0*(pn*we+$0*V+Vr*te-(Vx*te+mn*we+B0*V)),a[14]=u0*(Vx*Ht+ii*we+ox*V-(Jn*we+L0*V+Vr*Ht)),a[15]=u0*(Jn*te+vx*V+mn*Ht-(pn*Ht+ii*te+Fi*V)),a}function x0(N,a,_){_=_||H0();const E=a[0],V=a[1],xt=a[2],vt=E*N[3]+V*N[7]+xt*N[11]+N[15];return _[0]=(E*N[0]+V*N[4]+xt*N[8]+N[12])/vt,_[1]=(E*N[1]+V*N[5]+xt*N[9]+N[13])/vt,_[2]=(E*N[2]+V*N[6]+xt*N[10]+N[14])/vt,_}function n0(N,a,_){_=_||H0();const E=a[0],V=a[1],xt=a[2];return _[0]=E*N[0]+V*N[4]+xt*N[8],_[1]=E*N[1]+V*N[5]+xt*N[9],_[2]=E*N[2]+V*N[6]+xt*N[10],_}var t0=Object.freeze({__proto__:null,axisRotate:function(N,a,_,E){E=E||new y0(16);let V=a[0],xt=a[1],vt=a[2];const Wt=Math.sqrt(V*V+xt*xt+vt*vt);V/=Wt,xt/=Wt,vt/=Wt;const Ht=V*V,Gt=xt*xt,Xt=vt*vt,Ft=Math.cos(_),te=Math.sin(_),zt=1-Ft,ve=Ht+(1-Ht)*Ft,ye=V*xt*zt+vt*te,we=V*vt*zt-xt*te,Ee=V*xt*zt-vt*te,ze=Gt+(1-Gt)*Ft,Be=xt*vt*zt+V*te,e0=V*vt*zt+xt*te,He=xt*vt*zt-V*te,a0=Xt+(1-Xt)*Ft,Ye=N[0],d0=N[1],b0=N[2],O0=N[3],T0=N[4],R0=N[5],D0=N[6],$0=N[7],B0=N[8],L0=N[9],ox=N[10],vx=N[11];return E[0]=ve*Ye+ye*T0+we*B0,E[1]=ve*d0+ye*R0+we*L0,E[2]=ve*b0+ye*D0+we*ox,E[3]=ve*O0+ye*$0+we*vx,E[4]=Ee*Ye+ze*T0+Be*B0,E[5]=Ee*d0+ze*R0+Be*L0,E[6]=Ee*b0+ze*D0+Be*ox,E[7]=Ee*O0+ze*$0+Be*vx,E[8]=e0*Ye+He*T0+a0*B0,E[9]=e0*d0+He*R0+a0*L0,E[10]=e0*b0+He*D0+a0*ox,E[11]=e0*O0+He*$0+a0*vx,N!==E&&(E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E},axisRotation:function(N,a,_){_=_||new y0(16);let E=N[0],V=N[1],xt=N[2];const vt=Math.sqrt(E*E+V*V+xt*xt);E/=vt,V/=vt,xt/=vt;const Wt=E*E,Ht=V*V,Gt=xt*xt,Xt=Math.cos(a),Ft=Math.sin(a),te=1-Xt;return _[0]=Wt+(1-Wt)*Xt,_[1]=E*V*te+xt*Ft,_[2]=E*xt*te-V*Ft,_[3]=0,_[4]=E*V*te-xt*Ft,_[5]=Ht+(1-Ht)*Xt,_[6]=V*xt*te+E*Ft,_[7]=0,_[8]=E*xt*te+V*Ft,_[9]=V*xt*te-E*Ft,_[10]=Gt+(1-Gt)*Xt,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},copy:he,create:function(){return new y0(16).fill(0)},frustum:function(N,a,_,E,V,xt,vt){const Wt=a-N,Ht=E-_,Gt=V-xt;return(vt=vt||new y0(16))[0]=2*V/Wt,vt[1]=0,vt[2]=0,vt[3]=0,vt[4]=0,vt[5]=2*V/Ht,vt[6]=0,vt[7]=0,vt[8]=(N+a)/Wt,vt[9]=(E+_)/Ht,vt[10]=xt/Gt,vt[11]=-1,vt[12]=0,vt[13]=0,vt[14]=V*xt/Gt,vt[15]=0,vt},getAxis:function(N,a,_){const E=4*a;return(_=_||H0())[0]=N[E+0],_[1]=N[E+1],_[2]=N[E+2],_},getTranslation:function(N,a){return(a=a||H0())[0]=N[12],a[1]=N[13],a[2]=N[14],a},identity:Ae,inverse:Ve,lookAt:function(N,a,_,E){return E=E||new y0(16),Ox=Ox||H0(),$x=$x||H0(),lx=lx||H0(),ri(function(V,xt,vt){return(vt=vt||new cx(3))[0]=V[0]-xt[0],vt[1]=V[1]-xt[1],vt[2]=V[2]-xt[2],vt}(N,a,lx),lx),ri(kx(_,lx,Ox),Ox),ri(kx(lx,Ox,$x),$x),E[0]=Ox[0],E[1]=Ox[1],E[2]=Ox[2],E[3]=0,E[4]=$x[0],E[5]=$x[1],E[6]=$x[2],E[7]=0,E[8]=lx[0],E[9]=lx[1],E[10]=lx[2],E[11]=0,E[12]=N[0],E[13]=N[1],E[14]=N[2],E[15]=1,E},multiply:function(N,a,_){_=_||new y0(16);const E=N[0],V=N[1],xt=N[2],vt=N[3],Wt=N[4],Ht=N[5],Gt=N[6],Xt=N[7],Ft=N[8],te=N[9],zt=N[10],ve=N[11],ye=N[12],we=N[13],Ee=N[14],ze=N[15],Be=a[0],e0=a[1],He=a[2],a0=a[3],Ye=a[4],d0=a[5],b0=a[6],O0=a[7],T0=a[8],R0=a[9],D0=a[10],$0=a[11],B0=a[12],L0=a[13],ox=a[14],vx=a[15];return _[0]=E*Be+Wt*e0+Ft*He+ye*a0,_[1]=V*Be+Ht*e0+te*He+we*a0,_[2]=xt*Be+Gt*e0+zt*He+Ee*a0,_[3]=vt*Be+Xt*e0+ve*He+ze*a0,_[4]=E*Ye+Wt*d0+Ft*b0+ye*O0,_[5]=V*Ye+Ht*d0+te*b0+we*O0,_[6]=xt*Ye+Gt*d0+zt*b0+Ee*O0,_[7]=vt*Ye+Xt*d0+ve*b0+ze*O0,_[8]=E*T0+Wt*R0+Ft*D0+ye*$0,_[9]=V*T0+Ht*R0+te*D0+we*$0,_[10]=xt*T0+Gt*R0+zt*D0+Ee*$0,_[11]=vt*T0+Xt*R0+ve*D0+ze*$0,_[12]=E*B0+Wt*L0+Ft*ox+ye*vx,_[13]=V*B0+Ht*L0+te*ox+we*vx,_[14]=xt*B0+Gt*L0+zt*ox+Ee*vx,_[15]=vt*B0+Xt*L0+ve*ox+ze*vx,_},negate:function(N,a){return(a=a||new y0(16))[0]=-N[0],a[1]=-N[1],a[2]=-N[2],a[3]=-N[3],a[4]=-N[4],a[5]=-N[5],a[6]=-N[6],a[7]=-N[7],a[8]=-N[8],a[9]=-N[9],a[10]=-N[10],a[11]=-N[11],a[12]=-N[12],a[13]=-N[13],a[14]=-N[14],a[15]=-N[15],a},ortho:function(N,a,_,E,V,xt,vt){return(vt=vt||new y0(16))[0]=2/(a-N),vt[1]=0,vt[2]=0,vt[3]=0,vt[4]=0,vt[5]=2/(E-_),vt[6]=0,vt[7]=0,vt[8]=0,vt[9]=0,vt[10]=2/(V-xt),vt[11]=0,vt[12]=(a+N)/(N-a),vt[13]=(E+_)/(_-E),vt[14]=(xt+V)/(V-xt),vt[15]=1,vt},perspective:function(N,a,_,E,V){V=V||new y0(16);const xt=Math.tan(.5*Math.PI-.5*N),vt=1/(_-E);return V[0]=xt/a,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=xt,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=(_+E)*vt,V[11]=-1,V[12]=0,V[13]=0,V[14]=_*E*vt*2,V[15]=0,V},rotateX:function(N,a,_){_=_||new y0(16);const E=N[4],V=N[5],xt=N[6],vt=N[7],Wt=N[8],Ht=N[9],Gt=N[10],Xt=N[11],Ft=Math.cos(a),te=Math.sin(a);return _[4]=Ft*E+te*Wt,_[5]=Ft*V+te*Ht,_[6]=Ft*xt+te*Gt,_[7]=Ft*vt+te*Xt,_[8]=Ft*Wt-te*E,_[9]=Ft*Ht-te*V,_[10]=Ft*Gt-te*xt,_[11]=Ft*Xt-te*vt,N!==_&&(_[0]=N[0],_[1]=N[1],_[2]=N[2],_[3]=N[3],_[12]=N[12],_[13]=N[13],_[14]=N[14],_[15]=N[15]),_},rotateY:function(N,a,_){_=_||new y0(16);const E=N[0],V=N[1],xt=N[2],vt=N[3],Wt=N[8],Ht=N[9],Gt=N[10],Xt=N[11],Ft=Math.cos(a),te=Math.sin(a);return _[0]=Ft*E-te*Wt,_[1]=Ft*V-te*Ht,_[2]=Ft*xt-te*Gt,_[3]=Ft*vt-te*Xt,_[8]=Ft*Wt+te*E,_[9]=Ft*Ht+te*V,_[10]=Ft*Gt+te*xt,_[11]=Ft*Xt+te*vt,N!==_&&(_[4]=N[4],_[5]=N[5],_[6]=N[6],_[7]=N[7],_[12]=N[12],_[13]=N[13],_[14]=N[14],_[15]=N[15]),_},rotateZ:function(N,a,_){_=_||new y0(16);const E=N[0],V=N[1],xt=N[2],vt=N[3],Wt=N[4],Ht=N[5],Gt=N[6],Xt=N[7],Ft=Math.cos(a),te=Math.sin(a);return _[0]=Ft*E+te*Wt,_[1]=Ft*V+te*Ht,_[2]=Ft*xt+te*Gt,_[3]=Ft*vt+te*Xt,_[4]=Ft*Wt-te*E,_[5]=Ft*Ht-te*V,_[6]=Ft*Gt-te*xt,_[7]=Ft*Xt-te*vt,N!==_&&(_[8]=N[8],_[9]=N[9],_[10]=N[10],_[11]=N[11],_[12]=N[12],_[13]=N[13],_[14]=N[14],_[15]=N[15]),_},rotationX:function(N,a){a=a||new y0(16);const _=Math.cos(N),E=Math.sin(N);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=_,a[6]=E,a[7]=0,a[8]=0,a[9]=-E,a[10]=_,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},rotationY:function(N,a){a=a||new y0(16);const _=Math.cos(N),E=Math.sin(N);return a[0]=_,a[1]=0,a[2]=-E,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=E,a[9]=0,a[10]=_,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},rotationZ:function(N,a){a=a||new y0(16);const _=Math.cos(N),E=Math.sin(N);return a[0]=_,a[1]=E,a[2]=0,a[3]=0,a[4]=-E,a[5]=_,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},scale:function(N,a,_){_=_||new y0(16);const E=a[0],V=a[1],xt=a[2];return _[0]=E*N[0],_[1]=E*N[1],_[2]=E*N[2],_[3]=E*N[3],_[4]=V*N[4],_[5]=V*N[5],_[6]=V*N[6],_[7]=V*N[7],_[8]=xt*N[8],_[9]=xt*N[9],_[10]=xt*N[10],_[11]=xt*N[11],N!==_&&(_[12]=N[12],_[13]=N[13],_[14]=N[14],_[15]=N[15]),_},scaling:function(N,a){return(a=a||new y0(16))[0]=N[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=N[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=N[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},setAxis:function(N,a,_,E){E!==N&&(E=he(N,E));const V=4*_;return E[V+0]=a[0],E[V+1]=a[1],E[V+2]=a[2],E},setDefaultType:function(N){const a=y0;return y0=N,a},setTranslation:function(N,a,_){return N!==(_=_||Ae())&&(_[0]=N[0],_[1]=N[1],_[2]=N[2],_[3]=N[3],_[4]=N[4],_[5]=N[5],_[6]=N[6],_[7]=N[7],_[8]=N[8],_[9]=N[9],_[10]=N[10],_[11]=N[11]),_[12]=a[0],_[13]=a[1],_[14]=a[2],_[15]=1,_},transformDirection:n0,transformNormal:function(N,a,_){_=_||H0();const E=Ve(N),V=a[0],xt=a[1],vt=a[2];return _[0]=V*E[0]+xt*E[1]+vt*E[2],_[1]=V*E[4]+xt*E[5]+vt*E[6],_[2]=V*E[8]+xt*E[9]+vt*E[10],_},transformPoint:x0,translate:function(N,a,_){_=_||new y0(16);const E=a[0],V=a[1],xt=a[2],vt=N[0],Wt=N[1],Ht=N[2],Gt=N[3],Xt=N[4],Ft=N[5],te=N[6],zt=N[7],ve=N[8],ye=N[9],we=N[10],Ee=N[11],ze=N[12],Be=N[13],e0=N[14],He=N[15];return N!==_&&(_[0]=vt,_[1]=Wt,_[2]=Ht,_[3]=Gt,_[4]=Xt,_[5]=Ft,_[6]=te,_[7]=zt,_[8]=ve,_[9]=ye,_[10]=we,_[11]=Ee),_[12]=vt*E+Xt*V+ve*xt+ze,_[13]=Wt*E+Ft*V+ye*xt+Be,_[14]=Ht*E+te*V+we*xt+e0,_[15]=Gt*E+zt*V+Ee*xt+He,_},translation:function(N,a){return(a=a||new y0(16))[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=N[0],a[13]=N[1],a[14]=N[2],a[15]=1,a},transpose:function(N,a){if((a=a||new y0(16))===N){let ze;return ze=N[1],N[1]=N[4],N[4]=ze,ze=N[2],N[2]=N[8],N[8]=ze,ze=N[3],N[3]=N[12],N[12]=ze,ze=N[6],N[6]=N[9],N[9]=ze,ze=N[7],N[7]=N[13],N[13]=ze,ze=N[11],N[11]=N[14],N[14]=ze,a}const _=N[0],E=N[1],V=N[2],xt=N[3],vt=N[4],Wt=N[5],Ht=N[6],Gt=N[7],Xt=N[8],Ft=N[9],te=N[10],zt=N[11],ve=N[12],ye=N[13],we=N[14],Ee=N[15];return a[0]=_,a[1]=vt,a[2]=Xt,a[3]=ve,a[4]=E,a[5]=Wt,a[6]=Ft,a[7]=ye,a[8]=V,a[9]=Ht,a[10]=te,a[11]=we,a[12]=xt,a[13]=Gt,a[14]=zt,a[15]=Ee,a}});const f0=5120,c0=5121,r0=5122,_0=5123,z0=5124,Q0=5125,_x=5126,ix={};{const N=ix;N[f0]=Int8Array,N[c0]=Uint8Array,N[r0]=Int16Array,N[_0]=Uint16Array,N[z0]=Int32Array,N[Q0]=Uint32Array,N[_x]=Float32Array,N[32819]=Uint16Array,N[32820]=Uint16Array,N[33635]=Uint16Array,N[5131]=Uint16Array,N[33640]=Uint32Array,N[35899]=Uint32Array,N[35902]=Uint32Array,N[36269]=Uint32Array,N[34042]=Uint32Array}function h0(N){if(N instanceof Int8Array)return f0;if(N instanceof Uint8Array||N instanceof Uint8ClampedArray)return c0;if(N instanceof Int16Array)return r0;if(N instanceof Uint16Array)return _0;if(N instanceof Int32Array)return z0;if(N instanceof Uint32Array)return Q0;if(N instanceof Float32Array)return _x;throw new Error("unsupported typed array type")}function Wi(N){if(N===Int8Array)return f0;if(N===Uint8Array||N===Uint8ClampedArray)return c0;if(N===Int16Array)return r0;if(N===Uint16Array)return _0;if(N===Int32Array)return z0;if(N===Uint32Array)return Q0;if(N===Float32Array)return _x;throw new Error("unsupported typed array type")}function bi(N){const a=ix[N];if(!a)throw new Error("unknown gl type");return a}const qx=typeof SharedArrayBuffer<"u"?function(N){return N&&N.buffer&&(N.buffer instanceof ArrayBuffer||N.buffer instanceof SharedArrayBuffer)}:function(N){return N&&N.buffer&&N.buffer instanceof ArrayBuffer};function Ex(...N){console.error(...N)}function Mx(...N){console.warn(...N)}const di=new Map;function Xx(N,a){if(!N||typeof N!="object")return!1;let _=di.get(a);_||(_=new WeakMap,di.set(a,_));let E=_.get(N);if(E===void 0){const V=Object.prototype.toString.call(N);E=V.substring(8,V.length-1)===a,_.set(N,E)}return E}function $n(N,a){return typeof WebGLRenderbuffer<"u"&&Xx(a,"WebGLRenderbuffer")}function yn(N,a){return typeof WebGLTexture<"u"&&Xx(a,"WebGLTexture")}const bs=35044,fi=34962,ia=34963,ws=34660,Xn=5120,Zr=5121,Ps=5122,Ss=5123,Ls=5124,Os=5125,Ts=5126,_n={attribPrefix:""};function gr(N,a,_,E,V){N.bindBuffer(a,_),N.bufferData(a,E,V||bs)}function Qn(N,a,_,E){if(typeof WebGLBuffer<"u"&&Xx(a,"WebGLBuffer"))return a;_=_||fi;const V=N.createBuffer();return gr(N,_,V,a,E),V}function jn(N){return N==="indices"}function Jr(N){return N.length?N:N.data}const q0=/coord|texture/i,hx=/color|colour/i;function bn(N,a,_){return N.numComponents||N.size||function(E,V){let xt;if(xt=q0.test(E)?2:hx.test(E)?4:3,V%xt>0)throw new Error("Can not guess numComponents for attribute '"+E+"'. Tried "+xt+" but "+V+" values is not evenly divisible by "+xt+". You should specify it.");return xt}(a,_||Jr(N).length)}function qi(N,a){if(qx(N))return N;if(qx(N.data))return N.data;Array.isArray(N)&&(N={data:N});let _=N.type?Zi(N.type):void 0;return _||(_=jn(a)?Uint16Array:Float32Array),new _(N.data)}function Zi(N){return typeof N=="number"?bi(N):N||Float32Array}function ts(N,a){return{buffer:a.buffer,numValues:24,type:(_=a.type,typeof _=="number"?_:_?Wi(_):Ts),arrayType:Zi(a.type)};var _}function k0(N,a){const _=a.data||a,E=Zi(a.type),V=_*E.BYTES_PER_ELEMENT,xt=N.createBuffer();return N.bindBuffer(fi,xt),N.bufferData(fi,V,a.drawType||bs),{buffer:xt,numValues:_,type:Wi(E),arrayType:E}}function dx(N,a,_){const E=qi(a,_);return{arrayType:E.constructor,buffer:Qn(N,E,void 0,a.drawType),type:h0(E),numValues:0}}function Hr(N,a,_,E){_=qi(_),E!==void 0?(N.bindBuffer(fi,a.buffer),N.bufferSubData(fi,E,_)):gr(N,fi,a.buffer,_,a.drawType)}const vr=["position","positions","a_position"];function px(N,a,_){const E=function(vt,Wt){const Ht={};return Object.keys(Wt).forEach(function(Gt){if(!jn(Gt)){const Ft=Wt[Gt],te=Ft.attrib||Ft.name||Ft.attribName||_n.attribPrefix+Gt;if(Ft.value){if(!Array.isArray(Ft.value)&&!qx(Ft.value))throw new Error("array.value is not array or typedarray");Ht[te]={value:Ft.value}}else{let zt;zt=Ft.buffer&&Ft.buffer instanceof WebGLBuffer?ts:typeof Ft=="number"||typeof Ft.data=="number"?k0:dx;const{buffer:ve,type:ye,numValues:we,arrayType:Ee}=zt(vt,Ft,Gt),ze=Ft.normalize!==void 0?Ft.normalize:(Xt=Ee)===Int8Array||Xt===Uint8Array,Be=bn(Ft,Gt,we);Ht[te]={buffer:ve,numComponents:Be,type:ye,normalize:ze,stride:Ft.stride||0,offset:Ft.offset||0,divisor:Ft.divisor===void 0?void 0:Ft.divisor,drawType:Ft.drawType}}}var Xt}),vt.bindBuffer(fi,null),Ht}(N,a),V=Object.assign({},_||{});V.attribs=Object.assign({},_?_.attribs:{},E);const xt=a.indices;if(xt){const vt=qi(xt,"indices");V.indices=Qn(N,vt,ia),V.numElements=vt.length,V.elementType=h0(vt)}else V.numElements||(V.numElements=function(vt,Wt){let Ht,Gt;for(Gt=0;Gt<vr.length&&(Ht=vr[Gt],!(Ht in Wt))&&(Ht=_n.attribPrefix+Ht,!(Ht in Wt));++Gt);Gt===vr.length&&(Ht=Object.keys(Wt)[0]);const Xt=Wt[Ht];if(!Xt.buffer)return 1;vt.bindBuffer(fi,Xt.buffer);const Ft=vt.getBufferParameter(fi,ws);var te;vt.bindBuffer(fi,null);const zt=Ft/((te=Xt.type)===Xn||te===Zr?1:te===Ps||te===Ss?2:te===Ls||te===Os||te===Ts?4:0),ve=Xt.numComponents||Xt.size,ye=zt/ve;if(ye%1!=0)throw new Error("numComponents "+ve+" not correct for length "+length);return ye}(N,V.attribs));return V}function Kr(N){return!!N.texStorage2D}const nr=function(){const N={},a={};return function(_,E){return function(V){const xt=V.constructor.name;if(!N[xt]){for(const vt in V)if(typeof V[vt]=="number"){const Wt=a[V[vt]];a[V[vt]]=Wt?Wt+" | "+vt:vt}N[xt]=!0}}(_),a[E]||(typeof E=="number"?"0x"+E.toString(16):E)}}(),Ux={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},rx=qx,Ji=function(){let N;return function(){return N=N||(typeof document<"u"&&document.createElement?document.createElement("canvas").getContext("2d"):null),N}}(),yr=6406,Nx=6407,j0=6408,_r=6409,wn=6410,sr=6402,Yr=34041,br=33071,es=9728,Pn=9729,ci=3553,ni=34067,Hi=32879,P0=35866,Zx=34069,tx=34070,As=34071,xs=34072,is=34073,rs=34074,wi=10241,$r=10240,Ki=10242,mx=10243,Yi=32882,Is=33082,Es=33083,ra=33084,Rs=33085,ns=34892,na=34893,Sn=3317,N0=3314,Ds=32878,Qx=3316,Jx=3315,ex=32877,Ln=37443,$i=37441,On=37440,Xi=33321,Rx=36756,Cs=33325,Tn=33326,ks=33330,gx=33329,Xr=33338,An=33337,Qi=33340,Ms=33339,zs=33323,ss=36757,In=33327,ar=33328,Qr=33336,wr=33335,Pr=33332,Pi=33331,as=33334,jr=33333,Sr=32849,tn=35905,pi=36194,Lr=36758,Or=35898,Hx=35901,En=34843,Tr=34837,os=36221,en=36239,Rn=36215,xn=36233,Bs=36209,Dn=36227,ls=32856,si=35907,or=36759,hs=32855,mi=32854,Cn=32857,Si=34842,sa=34836,rn=36220,Us=36238,kn=36975,aa=36214,Li=36232,Mn=36226,oa=36208,us=33189,la=33190,Oi=36012,ha=36013,Ar=35056,gi=5120,F0=5121,vi=5122,Ti=5123,Ai=5124,w0=5125,bx=5126,Ir=32819,ji=32820,Er=33635,Fx=5131,lr=36193,Tx=33640,Sx=35899,zn=35902,Ii=36269,Bn=34042,hr=33319,nx=33320,Kx=6403,yi=36244,ur=36248,jx=36249;let ds;function nn(N){if(!ds){const a={};a[yr]={textureFormat:yr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[F0,Fx,lr,bx]},a[_r]={textureFormat:_r,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[F0,Fx,lr,bx]},a[wn]={textureFormat:wn,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[F0,Fx,lr,bx]},a[Nx]={textureFormat:Nx,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[F0,Fx,lr,bx,Er]},a[j0]={textureFormat:j0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[F0,Fx,lr,bx,Ir,ji]},a[sr]={textureFormat:sr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[w0,Ti]},a[Xi]={textureFormat:Kx,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[F0]},a[Rx]={textureFormat:Kx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[gi]},a[Cs]={textureFormat:Kx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[bx,Fx]},a[Tn]={textureFormat:Kx,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[bx]},a[ks]={textureFormat:yi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[F0]},a[gx]={textureFormat:yi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[gi]},a[Pr]={textureFormat:yi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Ti]},a[Pi]={textureFormat:yi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[vi]},a[as]={textureFormat:yi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[w0]},a[jr]={textureFormat:yi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ai]},a[zs]={textureFormat:hr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[F0]},a[ss]={textureFormat:hr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[gi]},a[In]={textureFormat:hr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[bx,Fx]},a[ar]={textureFormat:hr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[bx]},a[Qr]={textureFormat:nx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[F0]},a[wr]={textureFormat:nx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[gi]},a[Xr]={textureFormat:nx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ti]},a[An]={textureFormat:nx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[vi]},a[Qi]={textureFormat:nx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[w0]},a[Ms]={textureFormat:nx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ai]},a[Sr]={textureFormat:Nx,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[F0]},a[tn]={textureFormat:Nx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[F0]},a[pi]={textureFormat:Nx,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[F0,Er]},a[Lr]={textureFormat:Nx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[gi]},a[Or]={textureFormat:Nx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[bx,Fx,Sx]},a[Hx]={textureFormat:Nx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[bx,Fx,zn]},a[En]={textureFormat:Nx,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[bx,Fx]},a[Tr]={textureFormat:Nx,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[bx]},a[os]={textureFormat:ur,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[F0]},a[en]={textureFormat:ur,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[gi]},a[Rn]={textureFormat:ur,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Ti]},a[xn]={textureFormat:ur,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[vi]},a[Bs]={textureFormat:ur,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[w0]},a[Dn]={textureFormat:ur,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Ai]},a[ls]={textureFormat:j0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[F0]},a[si]={textureFormat:j0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[F0]},a[or]={textureFormat:j0,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[gi]},a[hs]={textureFormat:j0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[F0,ji,Tx]},a[mi]={textureFormat:j0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[F0,Ir]},a[Cn]={textureFormat:j0,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Tx]},a[Si]={textureFormat:j0,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[bx,Fx]},a[sa]={textureFormat:j0,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[bx]},a[rn]={textureFormat:jx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[F0]},a[Us]={textureFormat:jx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[gi]},a[kn]={textureFormat:jx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Tx]},a[aa]={textureFormat:jx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ti]},a[Li]={textureFormat:jx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[vi]},a[Mn]={textureFormat:jx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Ai]},a[oa]={textureFormat:jx,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[w0]},a[us]={textureFormat:sr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[Ti,w0]},a[la]={textureFormat:sr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[w0]},a[Oi]={textureFormat:sr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[bx]},a[Ar]={textureFormat:Yr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Bn]},a[ha]={textureFormat:Yr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ii]},Object.keys(a).forEach(function(_){const E=a[_];E.bytesPerElementMap={},E.bytesPerElement.forEach(function(V,xt){const vt=E.type[xt];E.bytesPerElementMap[vt]=V})}),ds=a}return ds[N]}function Rr(N){const a=nn(N);if(!a)throw"unknown internal format";return{format:a.textureFormat,type:a.type[0]}}function Dr(N){return(N&N-1)==0}function Ns(N,a,_){return rx(a)?h0(a):_||F0}function Ei(N,a,_,E,V){if(V%1!=0)throw"can't guess dimensions";if(_||E){if(E){if(!_&&(_=V/E)%1)throw"can't guess dimensions"}else if((E=V/_)%1)throw"can't guess dimensions"}else{const xt=Math.sqrt(V/(a===ni?6:1));xt%1==0?(_=xt,E=xt):(_=V,E=1)}return{width:_,height:E}}function tr(N,a){a.colorspaceConversion!==void 0&&N.pixelStorei(Ln,a.colorspaceConversion),a.premultiplyAlpha!==void 0&&N.pixelStorei($i,a.premultiplyAlpha),a.flipY!==void 0&&N.pixelStorei(On,a.flipY)}function fs(N){N.pixelStorei(Sn,4),Kr(N)&&(N.pixelStorei(N0,0),N.pixelStorei(Ds,0),N.pixelStorei(Qx,0),N.pixelStorei(Jx,0),N.pixelStorei(ex,0))}function Fs(N,a,_){const E=_.target||ci;N.bindTexture(E,a),function(V,xt,vt,Wt){Wt.minMag&&(vt.call(V,xt,wi,Wt.minMag),vt.call(V,xt,$r,Wt.minMag)),Wt.min&&vt.call(V,xt,wi,Wt.min),Wt.mag&&vt.call(V,xt,$r,Wt.mag),Wt.wrap&&(vt.call(V,xt,Ki,Wt.wrap),vt.call(V,xt,mx,Wt.wrap),(xt===Hi||typeof WebGLSampler<"u"&&Xx(xt,"WebGLSampler"))&&vt.call(V,xt,Yi,Wt.wrap)),Wt.wrapR&&vt.call(V,xt,Yi,Wt.wrapR),Wt.wrapS&&vt.call(V,xt,Ki,Wt.wrapS),Wt.wrapT&&vt.call(V,xt,mx,Wt.wrapT),Wt.minLod!==void 0&&vt.call(V,xt,Is,Wt.minLod),Wt.maxLod!==void 0&&vt.call(V,xt,Es,Wt.maxLod),Wt.baseLevel!==void 0&&vt.call(V,xt,ra,Wt.baseLevel),Wt.maxLevel!==void 0&&vt.call(V,xt,Rs,Wt.maxLevel),Wt.compareFunc!==void 0&&vt.call(V,xt,na,Wt.compareFunc),Wt.compareMode!==void 0&&vt.call(V,xt,ns,Wt.compareMode)}(N,E,N.texParameteri,_)}function ai(N,a,_,E,V,xt){_=_||Ux.textureOptions,xt=xt||j0;const vt=_.target||ci;if(E=E||_.width,V=V||_.height,N.bindTexture(vt,a),function(Wt,Ht,Gt,Xt){if(!Kr(Wt))return Dr(Ht)&&Dr(Gt);const Ft=nn(Xt);if(!Ft)throw"unknown internal format";return Ft.colorRenderable&&Ft.textureFilterable}(N,E,V,xt))N.generateMipmap(vt);else{const Wt=function(Ht){const Gt=nn(Ht);if(!Gt)throw"unknown internal format";return Gt.textureFilterable}(xt)?Pn:es;N.texParameteri(vt,wi,Wt),N.texParameteri(vt,$r,Wt),N.texParameteri(vt,Ki,br),N.texParameteri(vt,mx,br)}}function Cr(N){return N.auto===!0||N.auto===void 0&&N.level===void 0}function sn(N,a){return(a=a||{}).cubeFaceOrder||[Zx,tx,As,xs,is,rs]}function er(N,a){const _=sn(0,a).map(function(E,V){return{face:E,ndx:V}});return _.sort(function(E,V){return E.face-V.face}),_}function Un(N,a,_,E){const V=(E=E||Ux.textureOptions).target||ci,xt=E.level||0;let vt=_.width,Wt=_.height;const Ht=E.internalFormat||E.format||j0,Gt=Rr(Ht),Xt=E.format||Gt.format,Ft=E.type||Gt.type;if(tr(N,E),N.bindTexture(V,a),V===ni){const te=_.width,zt=_.height;let ve,ye;if(te/6===zt)ve=zt,ye=[0,0,1,0,2,0,3,0,4,0,5,0];else if(zt/6===te)ve=te,ye=[0,0,0,1,0,2,0,3,0,4,0,5];else if(te/3==zt/2)ve=te/3,ye=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(te/2!=zt/3)throw"can't figure out cube map from element: "+(_.src?_.src:_.nodeName);ve=te/2,ye=[0,0,1,0,0,1,1,1,0,2,1,2]}const we=Ji();we?(we.canvas.width=ve,we.canvas.height=ve,vt=ve,Wt=ve,er(0,E).forEach(function(Ee){const ze=ye[2*Ee.ndx+0]*ve,Be=ye[2*Ee.ndx+1]*ve;we.drawImage(_,ze,Be,ve,ve,0,0,ve,ve),N.texImage2D(Ee.face,xt,Ht,Xt,Ft,we.canvas)}),we.canvas.width=1,we.canvas.height=1):typeof createImageBitmap<"u"&&(vt=ve,Wt=ve,er(0,E).forEach(function(Ee){const ze=ye[2*Ee.ndx+0]*ve,Be=ye[2*Ee.ndx+1]*ve;N.texImage2D(Ee.face,xt,Ht,ve,ve,0,Xt,Ft,null),createImageBitmap(_,ze,Be,ve,ve,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(e0){tr(N,E),N.bindTexture(V,a),N.texImage2D(Ee.face,xt,Ht,Xt,Ft,e0),Cr(E)&&ai(N,a,E,vt,Wt,Ht)})}))}else if(V===Hi||V===P0){const te=Math.min(_.width,_.height),zt=Math.max(_.width,_.height),ve=zt/te;if(ve%1!=0)throw"can not compute 3D dimensions of element";const ye=_.width===zt?1:0,we=_.height===zt?1:0;N.pixelStorei(Sn,1),N.pixelStorei(N0,_.width),N.pixelStorei(Ds,0),N.pixelStorei(ex,0),N.texImage3D(V,xt,Ht,te,te,te,0,Xt,Ft,null);for(let Ee=0;Ee<ve;++Ee){const ze=Ee*te*ye,Be=Ee*te*we;N.pixelStorei(Qx,ze),N.pixelStorei(Jx,Be),N.texSubImage3D(V,xt,0,0,Ee,te,te,1,Xt,Ft,_)}fs(N)}else N.texImage2D(V,xt,Ht,Xt,Ft,_);Cr(E)&&ai(N,a,E,vt,Wt,Ht),Fs(N,a,E)}function Ri(){}function kr(N){return typeof ImageBitmap<"u"&&N instanceof ImageBitmap||typeof ImageData<"u"&&N instanceof ImageData||typeof HTMLElement<"u"&&N instanceof HTMLElement}function Nn(N,a,_){return kr(N)?(setTimeout(function(){_(null,N)}),N):function(E,V,xt){let vt;if(xt=xt||Ri,V=V!==void 0?V:Ux.crossOrigin,V=function(Wt,Ht){return Ht!==void 0||function(Gt){if(typeof document<"u"){const Xt=document.createElement("a");return Xt.href=Gt,Xt.hostname===location.hostname&&Xt.port===location.port&&Xt.protocol===location.protocol}{const Xt=new URL(location.href).origin;return new URL(Gt,location.href).origin===Xt}}(Wt)?Ht:"anonymous"}(E,V),typeof Image<"u"){vt=new Image,V!==void 0&&(vt.crossOrigin=V);const Wt=function(){vt.removeEventListener("error",Ht),vt.removeEventListener("load",Gt),vt=null},Ht=function(){const Xt="couldn't load image: "+E;Ex(Xt),xt(Xt,vt),Wt()},Gt=function(){xt(null,vt),Wt()};return vt.addEventListener("error",Ht),vt.addEventListener("load",Gt),vt.src=E,vt}if(typeof ImageBitmap<"u"){let Wt,Ht;const Gt=function(){xt(Wt,Ht)},Xt={};V&&(Xt.mode="cors"),fetch(E,Xt).then(function(Ft){if(!Ft.ok)throw Ft;return Ft.blob()}).then(function(Ft){return createImageBitmap(Ft,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(Ft){Ht=Ft,setTimeout(Gt)}).catch(function(Ft){Wt=Ft,setTimeout(Gt)}),vt=null}return vt}(N,a,_)}function dr(N,a,_){const E=(_=_||Ux.textureOptions).target||ci;if(N.bindTexture(E,a),_.color===!1)return;const V=function(xt){return xt=xt||Ux.textureColor,rx(xt)?xt:new Uint8Array([255*xt[0],255*xt[1],255*xt[2],255*xt[3]])}(_.color);if(E===ni)for(let xt=0;xt<6;++xt)N.texImage2D(Zx+xt,0,j0,1,1,0,j0,F0,V);else E===Hi||E===P0?N.texImage3D(E,0,j0,1,1,1,0,j0,F0,V):N.texImage2D(E,0,j0,1,1,0,j0,F0,V)}function Fn(N,a,_,E){const V=(E=E||Ux.textureOptions).target||ci;N.bindTexture(V,a);let xt=E.width,vt=E.height,Wt=E.depth;const Ht=E.level||0,Gt=E.internalFormat||E.format||j0,Xt=Rr(Gt),Ft=E.format||Xt.format,te=E.type||Ns(0,_,Xt.type);if(rx(_))_ instanceof Uint8ClampedArray&&(_=new Uint8Array(_.buffer));else{const we=bi(te);_=new we(_)}const zt=function(we,Ee){const ze=nn(we);if(!ze)throw"unknown internal format";const Be=ze.bytesPerElementMap[Ee];if(Be===void 0)throw"unknown internal format";return Be}(Gt,te),ve=_.byteLength/zt;if(ve%1)throw"length wrong size for format: "+nr(N,Ft);let ye;if(V===Hi||V===P0)if(xt||vt||Wt)!xt||vt&&Wt?!vt||xt&&Wt?(ye=Ei(0,V,xt,vt,ve/Wt),xt=ye.width,vt=ye.height):(ye=Ei(0,V,xt,Wt,ve/vt),xt=ye.width,Wt=ye.height):(ye=Ei(0,V,vt,Wt,ve/xt),vt=ye.width,Wt=ye.height);else{const we=Math.cbrt(ve);if(we%1!=0)throw"can't guess cube size of array of numElements: "+ve;xt=we,vt=we,Wt=we}else ye=Ei(0,V,xt,vt,ve),xt=ye.width,vt=ye.height;if(fs(N),N.pixelStorei(Sn,E.unpackAlignment||1),tr(N,E),V===ni){const we=ve/6*(zt/_.BYTES_PER_ELEMENT);er(0,E).forEach(Ee=>{const ze=we*Ee.ndx,Be=_.subarray(ze,ze+we);N.texImage2D(Ee.face,Ht,Gt,xt,vt,0,Ft,te,Be)})}else V===Hi||V===P0?N.texImage3D(V,Ht,Gt,xt,vt,Wt,0,Ft,te,_):N.texImage2D(V,Ht,Gt,xt,vt,0,Ft,te,_);return{width:xt,height:vt,depth:Wt,type:te}}function Di(N,a,_){_=_||Ri,a=a||Ux.textureOptions;const E=N.createTexture(),V=a.target||ci;let xt=a.width||1,vt=a.height||1;const Wt=a.internalFormat||j0;N.bindTexture(V,E),V===ni&&(N.texParameteri(V,Ki,br),N.texParameteri(V,mx,br));let Ht=a.src;if(Ht)if(typeof Ht=="function"&&(Ht=Ht(N,a)),typeof Ht=="string")(function(Gt,Xt,Ft,te){te=te||Ri,Ft=Ft||Ux.textureOptions,dr(Gt,Xt,Ft),Nn((Ft=Object.assign({},Ft)).src,Ft.crossOrigin,function(zt,ve){zt?te(zt,Xt,ve):(Un(Gt,Xt,ve,Ft),te(null,Xt,ve))})})(N,E,a,_);else if(rx(Ht)||Array.isArray(Ht)&&(typeof Ht[0]=="number"||Array.isArray(Ht[0])||rx(Ht[0]))){const Gt=Fn(N,E,Ht,a);xt=Gt.width,vt=Gt.height}else Array.isArray(Ht)&&(typeof Ht[0]=="string"||kr(Ht[0]))?V===ni?function(Gt,Xt,Ft,te){te=te||Ri;const zt=Ft.src;if(zt.length!==6)throw"there must be 6 urls for a cubemap";const ve=Ft.level||0,ye=Ft.internalFormat||Ft.format||j0,we=Rr(ye),Ee=Ft.format||we.format,ze=Ft.type||F0,Be=Ft.target||ci;if(Be!==ni)throw"target must be TEXTURE_CUBE_MAP";dr(Gt,Xt,Ft),Ft=Object.assign({},Ft);let e0=6;const He=[],a0=sn(0,Ft);let Ye;Ye=zt.map(function(d0,b0){return Nn(d0,Ft.crossOrigin,(O0=a0[b0],function(T0,R0){--e0,T0?He.push(T0):R0.width!==R0.height?He.push("cubemap face img is not a square: "+R0.src):(tr(Gt,Ft),Gt.bindTexture(Be,Xt),e0===5?sn().forEach(function(D0){Gt.texImage2D(D0,ve,ye,Ee,ze,R0)}):Gt.texImage2D(O0,ve,ye,Ee,ze,R0),Cr(Ft)&&Gt.generateMipmap(Be)),e0===0&&te(He.length?He:void 0,Xt,Ye)}));var O0})}(N,E,a,_):function(Gt,Xt,Ft,te){te=te||Ri;const zt=Ft.src,ve=Ft.internalFormat||Ft.format||j0,ye=Rr(ve),we=Ft.format||ye.format,Ee=Ft.type||F0,ze=Ft.target||P0;if(ze!==Hi&&ze!==P0)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";dr(Gt,Xt,Ft),Ft=Object.assign({},Ft);let Be=zt.length;const e0=[];let He;const a0=Ft.level||0;let Ye=Ft.width,d0=Ft.height;const b0=zt.length;let O0=!0;He=zt.map(function(T0,R0){return Nn(T0,Ft.crossOrigin,(D0=R0,function($0,B0){if(--Be,$0)e0.push($0);else{if(tr(Gt,Ft),Gt.bindTexture(ze,Xt),O0){O0=!1,Ye=Ft.width||B0.width,d0=Ft.height||B0.height,Gt.texImage3D(ze,a0,ve,Ye,d0,b0,0,we,Ee,null);for(let L0=0;L0<b0;++L0)Gt.texSubImage3D(ze,a0,0,0,L0,Ye,d0,1,we,Ee,B0)}else{let L0,ox=B0;B0.width===Ye&&B0.height===d0||(L0=Ji(),ox=L0.canvas,L0.canvas.width=Ye,L0.canvas.height=d0,L0.drawImage(B0,0,0,Ye,d0)),Gt.texSubImage3D(ze,a0,0,0,D0,Ye,d0,1,we,Ee,ox),L0&&ox===L0.canvas&&(L0.canvas.width=0,L0.canvas.height=0)}Cr(Ft)&&Gt.generateMipmap(ze)}Be===0&&te(e0.length?e0:void 0,Xt,He)}));var D0})}(N,E,a,_):(Un(N,E,Ht,a),xt=Ht.width,vt=Ht.height);else(function(Gt,Xt,Ft){const te=Ft.target||ci;Gt.bindTexture(te,Xt);const zt=Ft.level||0,ve=Ft.internalFormat||Ft.format||j0,ye=Rr(ve),we=Ft.format||ye.format,Ee=Ft.type||ye.type;if(tr(Gt,Ft),te===ni)for(let ze=0;ze<6;++ze)Gt.texImage2D(Zx+ze,zt,ve,Ft.width,Ft.height,0,we,Ee,null);else te===Hi||te===P0?Gt.texImage3D(te,zt,ve,Ft.width,Ft.height,Ft.depth,0,we,Ee,null):Gt.texImage2D(te,zt,ve,Ft.width,Ft.height,0,we,Ee,null)})(N,E,a);return Cr(a)&&ai(N,E,a,xt,vt,Wt),Fs(N,E,a),E}const Mr=Ex;function an(N){return typeof document<"u"&&document.getElementById?document.getElementById(N):null}const fr=33984,on=34962,oi=35713,Gs=35714,Vs=35632,ua=35633,n=35981,d=35718,k=35721,it=35971,Ot=35382,Bt=35396,ce=35398,jt=35392,Ie=35395,qe=5124,s0=3553,g0=34067,S0=32879,wx=35866,p0={};function Gx(N,a){return p0[a].bindPoint}function zx(N,a){return function(_){N.uniform1i(a,_)}}function xr(N,a){return function(_){N.uniform1iv(a,_)}}function Ws(N,a){return function(_){N.uniform2iv(a,_)}}function qs(N,a){return function(_){N.uniform3iv(a,_)}}function Zs(N,a){return function(_){N.uniform4iv(a,_)}}function Dx(N,a,_,E){const V=Gx(0,a);return Kr(N)?function(xt){let vt,Wt;!xt||yn(0,xt)?(vt=xt,Wt=null):(vt=xt.texture,Wt=xt.sampler),N.uniform1i(E,_),N.activeTexture(fr+_),N.bindTexture(V,vt),N.bindSampler(_,Wt)}:function(xt){N.uniform1i(E,_),N.activeTexture(fr+_),N.bindTexture(V,xt)}}function Bx(N,a,_,E,V){const xt=Gx(0,a),vt=new Int32Array(V);for(let Wt=0;Wt<V;++Wt)vt[Wt]=_+Wt;return Kr(N)?function(Wt){N.uniform1iv(E,vt),Wt.forEach(function(Ht,Gt){let Xt,Ft;N.activeTexture(fr+vt[Gt]),!Ht||yn(0,Ht)?(Xt=Ht,Ft=null):(Xt=Ht.texture,Ft=Ht.sampler),N.bindSampler(_,Ft),N.bindTexture(xt,Xt)})}:function(Wt){N.uniform1iv(E,vt),Wt.forEach(function(Ht,Gt){N.activeTexture(fr+vt[Gt]),N.bindTexture(xt,Ht)})}}function ln(N,a){return function(_){if(_.value)switch(N.disableVertexAttribArray(a),_.value.length){case 4:N.vertexAttrib4fv(a,_.value);break;case 3:N.vertexAttrib3fv(a,_.value);break;case 2:N.vertexAttrib2fv(a,_.value);break;case 1:N.vertexAttrib1fv(a,_.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else N.bindBuffer(on,_.buffer),N.enableVertexAttribArray(a),N.vertexAttribPointer(a,_.numComponents||_.size,_.type||5126,_.normalize||!1,_.stride||0,_.offset||0),N.vertexAttribDivisor&&N.vertexAttribDivisor(a,_.divisor||0)}}function C0(N,a){return function(_){if(_.value){if(N.disableVertexAttribArray(a),_.value.length!==4)throw new Error("The length of an integer constant value must be 4!");N.vertexAttrib4iv(a,_.value)}else N.bindBuffer(on,_.buffer),N.enableVertexAttribArray(a),N.vertexAttribIPointer(a,_.numComponents||_.size,_.type||qe,_.stride||0,_.offset||0),N.vertexAttribDivisor&&N.vertexAttribDivisor(a,_.divisor||0)}}function cr(N,a){return function(_){if(_.value){if(N.disableVertexAttribArray(a),_.value.length!==4)throw new Error("The length of an unsigned integer constant value must be 4!");N.vertexAttrib4uiv(a,_.value)}else N.bindBuffer(on,_.buffer),N.enableVertexAttribArray(a),N.vertexAttribIPointer(a,_.numComponents||_.size,_.type||5125,_.stride||0,_.offset||0),N.vertexAttribDivisor&&N.vertexAttribDivisor(a,_.divisor||0)}}function cs(N,a,_){const E=_.size,V=_.count;return function(xt){N.bindBuffer(on,xt.buffer);const vt=xt.size||xt.numComponents||E,Wt=vt/V,Ht=xt.type||5126,Gt=p0[Ht].size*vt,Xt=xt.normalize||!1,Ft=xt.offset||0,te=Gt/V;for(let zt=0;zt<V;++zt)N.enableVertexAttribArray(a+zt),N.vertexAttribPointer(a+zt,Wt,Ht,Xt,Gt,Ft+te*zt),N.vertexAttribDivisor&&N.vertexAttribDivisor(a+zt,xt.divisor||0)}}p0[5126]={Type:Float32Array,size:4,setter:function(N,a){return function(_){N.uniform1f(a,_)}},arraySetter:function(N,a){return function(_){N.uniform1fv(a,_)}}},p0[35664]={Type:Float32Array,size:8,setter:function(N,a){return function(_){N.uniform2fv(a,_)}},cols:2},p0[35665]={Type:Float32Array,size:12,setter:function(N,a){return function(_){N.uniform3fv(a,_)}},cols:3},p0[35666]={Type:Float32Array,size:16,setter:function(N,a){return function(_){N.uniform4fv(a,_)}},cols:4},p0[qe]={Type:Int32Array,size:4,setter:zx,arraySetter:xr},p0[35667]={Type:Int32Array,size:8,setter:Ws,cols:2},p0[35668]={Type:Int32Array,size:12,setter:qs,cols:3},p0[35669]={Type:Int32Array,size:16,setter:Zs,cols:4},p0[5125]={Type:Uint32Array,size:4,setter:function(N,a){return function(_){N.uniform1ui(a,_)}},arraySetter:function(N,a){return function(_){N.uniform1uiv(a,_)}}},p0[36294]={Type:Uint32Array,size:8,setter:function(N,a){return function(_){N.uniform2uiv(a,_)}},cols:2},p0[36295]={Type:Uint32Array,size:12,setter:function(N,a){return function(_){N.uniform3uiv(a,_)}},cols:3},p0[36296]={Type:Uint32Array,size:16,setter:function(N,a){return function(_){N.uniform4uiv(a,_)}},cols:4},p0[35670]={Type:Uint32Array,size:4,setter:zx,arraySetter:xr},p0[35671]={Type:Uint32Array,size:8,setter:Ws,cols:2},p0[35672]={Type:Uint32Array,size:12,setter:qs,cols:3},p0[35673]={Type:Uint32Array,size:16,setter:Zs,cols:4},p0[35674]={Type:Float32Array,size:32,setter:function(N,a){return function(_){N.uniformMatrix2fv(a,!1,_)}},rows:2,cols:2},p0[35675]={Type:Float32Array,size:48,setter:function(N,a){return function(_){N.uniformMatrix3fv(a,!1,_)}},rows:3,cols:3},p0[35676]={Type:Float32Array,size:64,setter:function(N,a){return function(_){N.uniformMatrix4fv(a,!1,_)}},rows:4,cols:4},p0[35685]={Type:Float32Array,size:32,setter:function(N,a){return function(_){N.uniformMatrix2x3fv(a,!1,_)}},rows:2,cols:3},p0[35686]={Type:Float32Array,size:32,setter:function(N,a){return function(_){N.uniformMatrix2x4fv(a,!1,_)}},rows:2,cols:4},p0[35687]={Type:Float32Array,size:48,setter:function(N,a){return function(_){N.uniformMatrix3x2fv(a,!1,_)}},rows:3,cols:2},p0[35688]={Type:Float32Array,size:48,setter:function(N,a){return function(_){N.uniformMatrix3x4fv(a,!1,_)}},rows:3,cols:4},p0[35689]={Type:Float32Array,size:64,setter:function(N,a){return function(_){N.uniformMatrix4x2fv(a,!1,_)}},rows:4,cols:2},p0[35690]={Type:Float32Array,size:64,setter:function(N,a){return function(_){N.uniformMatrix4x3fv(a,!1,_)}},rows:4,cols:3},p0[35678]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:s0},p0[35680]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:g0},p0[35679]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:S0},p0[35682]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:s0},p0[36289]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:wx},p0[36292]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:wx},p0[36293]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:g0},p0[36298]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:s0},p0[36299]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:S0},p0[36300]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:g0},p0[36303]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:wx},p0[36306]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:s0},p0[36307]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:S0},p0[36308]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:g0},p0[36311]={Type:null,size:0,setter:Dx,arraySetter:Bx,bindPoint:wx};const K0={};K0[5126]={size:4,setter:ln},K0[35664]={size:8,setter:ln},K0[35665]={size:12,setter:ln},K0[35666]={size:16,setter:ln},K0[qe]={size:4,setter:C0},K0[35667]={size:8,setter:C0},K0[35668]={size:12,setter:C0},K0[35669]={size:16,setter:C0},K0[5125]={size:4,setter:cr},K0[36294]={size:8,setter:cr},K0[36295]={size:12,setter:cr},K0[36296]={size:16,setter:cr},K0[35670]={size:4,setter:C0},K0[35671]={size:8,setter:C0},K0[35672]={size:12,setter:C0},K0[35673]={size:16,setter:C0},K0[35674]={size:4,setter:cs,count:2},K0[35675]={size:9,setter:cs,count:3},K0[35676]={size:16,setter:cs,count:4};const Js=/ERROR:\s*\d+:(\d+)/gi,Gn=/^[ \t]*\n/;function G0(N){let a=0;return Gn.test(N)&&(a=1,N=N.replace(Gn,"")),{lineOffset:a,shaderSource:N}}function ps(N,a,_){let E,V,xt;if(typeof a=="function"&&(_=a,a=void 0),typeof N=="function")_=N,N=void 0;else if(N&&!Array.isArray(N)){const Gt=N;_=Gt.errorCallback,N=Gt.attribLocations,E=Gt.transformFeedbackVaryings,V=Gt.transformFeedbackMode,xt=Gt.callback}const vt=_||Mr,Wt=[],Ht={errorCallback(Gt,...Xt){Wt.push(Gt),vt(Gt,...Xt)},transformFeedbackVaryings:E,transformFeedbackMode:V,callback:xt,errors:Wt};{let Gt={};Array.isArray(N)?N.forEach(function(Xt,Ft){Gt[Xt]=a?a[Ft]:Ft}):Gt=N||{},Ht.attribLocations=Gt}return Ht}const Ue=["VERTEX_SHADER","FRAGMENT_SHADER"],ca=(N=0)=>new Promise(a=>setTimeout(a,N));function pa(N,a,_){const E=N.createProgram(),{attribLocations:V,transformFeedbackVaryings:xt,transformFeedbackMode:vt}=ps(_);for(let Ht=0;Ht<a.length;++Ht){let Gt=a[Ht];if(typeof Gt=="string"){const Xt=an(Gt),Ft=Xt?Xt.text:Gt;let te=N[Ue[Ht]];Xt&&Xt.type&&(te=((Wt=Xt.type).indexOf("frag")>=0?Vs:Wt.indexOf("vert")>=0?ua:void 0)||te),Gt=N.createShader(te),N.shaderSource(Gt,G0(Ft).shaderSource),N.compileShader(Gt),N.attachShader(E,Gt)}}var Wt;Object.entries(V).forEach(([Ht,Gt])=>N.bindAttribLocation(E,Gt,Ht));{let Ht=xt;Ht&&(Ht.attribs&&(Ht=Ht.attribs),Array.isArray(Ht)||(Ht=Object.keys(Ht)),N.transformFeedbackVaryings(E,Ht,vt||n))}return N.linkProgram(E),E}function zr(N,a,_,E,V){const xt=ps(_,E,V),vt=new Set(a),Wt=pa(N,a,xt);function Ht(Gt,Xt){const Ft=Br(Gt,Xt,xt.errorCallback);return Ft&&function(te,zt,ve){const ye=te.getAttachedShaders(zt);for(const we of ye)ve.has(we)&&te.deleteShader(we);te.deleteProgram(zt)}(Gt,Xt,vt),Ft}if(!xt.callback)return Ht(N,Wt)?void 0:Wt;Hs(N,Wt).then(()=>{const Gt=Ht(N,Wt);xt.callback(Gt,Gt?void 0:Wt)})}async function Hs(N,a){const _=N.getExtension("KHR_parallel_shader_compile"),E=_?(xt,vt)=>xt.getProgramParameter(vt,_.COMPLETION_STATUS_KHR):()=>!0;let V=0;do await ca(V),V=1e3/60;while(!E(N,a))}function Br(N,a,_){if(_=_||Mr,!N.getProgramParameter(a,Gs)){const E=N.getProgramInfoLog(a);return _("Error in program linking: "+E),E+`
`+N.getAttachedShaders(a).map(V=>function(xt,vt,Wt,Ht){if(Ht=Ht||Mr,!xt.getShaderParameter(Wt,oi)){const Gt=xt.getShaderInfoLog(Wt),{lineOffset:Xt,shaderSource:Ft}=G0(xt.getShaderSource(Wt)),te=function(zt,ve="",ye=0){const we=[...ve.matchAll(Js)],Ee=new Map(we.map((ze,Be)=>{const e0=parseInt(ze[1]),He=we[Be+1],a0=He?He.index:ve.length;return[e0-1,ve.substring(ze.index,a0)]}));return zt.split(`
`).map((ze,Be)=>{const e0=Ee.get(Be);return Be+1+ye+": "+ze+(e0?`

^^^ `+e0:"")}).join(`
`)}(Ft,Gt,Xt)+`
Error compiling `+nr(xt,vt)+": "+Gt;return Ht(te),te}return""}(N,N.getShaderParameter(V,N.SHADER_TYPE),V,_)).filter(V=>V).join(`
`)}}function Ks(N){const a=N.name;return a.startsWith("gl_")||a.startsWith("webgl_")}const ma=/(\.|\[|]|\w+)/g,ga=N=>N>="0"&&N<="9";function va(N,a,_,E){const V=N.split(ma).filter(Wt=>Wt!=="");let xt=0,vt="";for(;;){const Wt=V[xt++];vt+=Wt;const Ht=ga(Wt[0]),Gt=Ht?parseInt(Wt):Wt;if(Ht&&(vt+=V[xt++]),xt===V.length){_[Gt]=a;break}{const Xt=V[xt++],Ft=Xt==="[",te=_[Gt]||(Ft?[]:{});_[Gt]=te,_=te,E[vt]=E[vt]||function(zt){return function(ve){Vn(zt,ve)}}(te),vt+=Xt}}}function La(N,a){let _=0;function E(Wt,Ht,Gt){const Xt=Ht.name.endsWith("[0]"),Ft=Ht.type,te=p0[Ft];if(!te)throw new Error("unknown type: 0x"+Ft.toString(16));let zt;if(te.bindPoint){const ve=_;_+=Ht.size,zt=Xt?te.arraySetter(N,Ft,ve,Gt,Ht.size):te.setter(N,Ft,ve,Gt,Ht.size)}else zt=te.arraySetter&&Xt?te.arraySetter(N,Gt):te.setter(N,Gt);return zt.location=Gt,zt}const V={},xt={},vt=N.getProgramParameter(a,d);for(let Wt=0;Wt<vt;++Wt){const Ht=N.getActiveUniform(a,Wt);if(Ks(Ht))continue;let Gt=Ht.name;Gt.endsWith("[0]")&&(Gt=Gt.substr(0,Gt.length-3));const Xt=N.getUniformLocation(a,Ht.name);if(Xt){const Ft=E(0,Ht,Xt);V[Gt]=Ft,va(Gt,Ft,xt,V)}}return V}function Vn(N,a){for(const _ in a){const E=N[_];typeof E=="function"?E(a[_]):Vn(N[_],a[_])}}function ti(N,...a){const _=N.uniformSetters||N,E=a.length;for(let V=0;V<E;++V){const xt=a[V];if(Array.isArray(xt)){const vt=xt.length;for(let Wt=0;Wt<vt;++Wt)ti(_,xt[Wt])}else for(const vt in xt){const Wt=_[vt];Wt&&Wt(xt[vt])}}}function Ys(N,a){const _={},E=N.getProgramParameter(a,k);for(let V=0;V<E;++V){const xt=N.getActiveAttrib(a,V);if(Ks(xt))continue;const vt=N.getAttribLocation(a,xt.name),Wt=K0[xt.type],Ht=Wt.setter(N,vt,Wt);Ht.location=vt,_[xt.name]=Ht}return _}function m0(N,a,_){_.vertexArrayObject?N.bindVertexArray(_.vertexArrayObject):(function(E,V){for(const xt in V){const vt=E[xt];vt&&vt(V[xt])}}(a.attribSetters||a,_.attribs),_.indices&&N.bindBuffer(34963,_.indices))}function ax(N,a){const _={program:a,uniformSetters:La(N,a),attribSetters:Ys(N,a)};return Kr(N)&&(_.uniformBlockSpec=function(E,V){const xt=E.getProgramParameter(V,d),vt=[],Wt=[];for(let Xt=0;Xt<xt;++Xt){Wt.push(Xt),vt.push({});const Ft=E.getActiveUniform(V,Xt);vt[Xt].name=Ft.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(Xt){const Ft=Xt[0],te=Xt[1];E.getActiveUniforms(V,Wt,E[Ft]).forEach(function(zt,ve){vt[ve][te]=zt})});const Ht={},Gt=E.getProgramParameter(V,Ot);for(let Xt=0;Xt<Gt;++Xt){const Ft=E.getActiveUniformBlockName(V,Xt),te={index:E.getUniformBlockIndex(V,Ft),usedByVertexShader:E.getActiveUniformBlockParameter(V,Xt,Bt),usedByFragmentShader:E.getActiveUniformBlockParameter(V,Xt,ce),size:E.getActiveUniformBlockParameter(V,Xt,jt),uniformIndices:E.getActiveUniformBlockParameter(V,Xt,Ie)};te.used=te.usedByVertexShader||te.usedByFragmentShader,Ht[Ft]=te}return{blockSpecs:Ht,uniformData:vt}}(N,a),_.transformFeedbackInfo=function(E,V){const xt={},vt=E.getProgramParameter(V,it);for(let Wt=0;Wt<vt;++Wt){const Ht=E.getTransformFeedbackVarying(V,Wt);xt[Ht.name]={index:Wt,type:Ht.type,size:Ht.size}}return xt}(N,a)),_}const ir=/\s|{|}|;/;function Cx(N,a,_,E,V){const xt=ps(_,E,V),vt=[];if(a=a.map(function(Gt){if(!ir.test(Gt)){const Xt=an(Gt);if(Xt)Gt=Xt.text;else{const Ft="no element with id: "+Gt;xt.errorCallback(Ft),vt.push(Ft)}}return Gt}),vt.length)return function(Gt,Xt){return Gt.errorCallback(Xt),Gt.callback&&setTimeout(()=>{Gt.callback(Xt+`
`+Gt.errors.join(`
`))}),null}(xt,"");const Wt=xt.callback;Wt&&(xt.callback=(Gt,Xt)=>{Wt(Gt,Gt?void 0:ax(N,Xt))});const Ht=function(Gt,Xt,Ft,te,zt){return zr(Gt,Xt,Ft,te,zt)}(N,a,xt);return Ht?ax(N,Ht):null}function fx(N,a,_,E,V,xt){_=_===void 0?4:_;const vt=a.indices,Wt=a.elementType,Ht=E===void 0?a.numElements:E;V=V===void 0?0:V,Wt||vt?xt!==void 0?N.drawElementsInstanced(_,Ht,Wt===void 0?5123:a.elementType,V,xt):N.drawElements(_,Ht,Wt===void 0?5123:a.elementType,V):xt!==void 0?N.drawArraysInstanced(_,V,Ht,xt):N.drawArrays(_,V,Ht)}const ei=36161,$s=36064,ms=36096,Ci=33306,Ur=33071,Xs=9729,hn=[{format:6408,type:5121,min:Xs,wrap:Ur},{format:34041}],xi={};xi[34041]=Ci,xi[6401]=36128,xi[36168]=36128,xi[6402]=ms,xi[33189]=ms,xi[33190]=ms,xi[36012]=ms,xi[35056]=Ci,xi[36013]=Ci;const li={32854:!0,32855:!0,36194:!0,34041:!0,33189:!0,6401:!0,36168:!0};function Qs(N,a,_,E){const xt=N.createFramebuffer();N.bindFramebuffer(36160,xt),_=_||N.drawingBufferWidth,E=E||N.drawingBufferHeight;const vt=[],Wt={framebuffer:xt,attachments:[],width:_,height:E};return(a=a||hn).forEach(function(Ht,Gt){let Xt=Ht.attachment;const Ft=Ht.samples,te=Ht.format;let zt=Ht.attachmentPoint||function(ve,ye){return xi[ve]||xi[ye]}(te,Ht.internalFormat);if(zt||(zt=$s+Gt),function(ve){return ve>=$s&&ve<36096}(zt)&&vt.push(zt),!Xt)if(Ft!==void 0||function(ve){return li[ve]}(te))Xt=N.createRenderbuffer(),N.bindRenderbuffer(ei,Xt),Ft>1?N.renderbufferStorageMultisample(ei,Ft,te,_,E):N.renderbufferStorage(ei,te,_,E);else{const ve=Object.assign({},Ht);ve.width=_,ve.height=E,ve.auto===void 0&&(ve.auto=!1,ve.min=ve.min||ve.minMag||Xs,ve.mag=ve.mag||ve.minMag||Xs,ve.wrapS=ve.wrapS||ve.wrap||Ur,ve.wrapT=ve.wrapT||ve.wrap||Ur),Xt=Di(N,ve)}if($n(0,Xt))N.framebufferRenderbuffer(36160,zt,ei,Xt);else{if(!yn(0,Xt))throw new Error("unknown attachment type");Ht.layer!==void 0?N.framebufferTextureLayer(36160,zt,Xt,Ht.level||0,Ht.layer):N.framebufferTexture2D(36160,zt,Ht.target||3553,Xt,Ht.level||0)}Wt.attachments.push(Xt)}),N.drawBuffers&&N.drawBuffers(vt),Wt}function Oa(N,a,_,E,V){E=E||N.drawingBufferWidth,V=V||N.drawingBufferHeight,a.width=E,a.height=V,(_=_||hn).forEach(function(xt,vt){const Wt=a.attachments[vt],Ht=xt.format,Gt=xt.samples;if(Gt!==void 0||$n(0,Wt))N.bindRenderbuffer(ei,Wt),Gt>1?N.renderbufferStorageMultisample(ei,Gt,Ht,E,V):N.renderbufferStorage(ei,Ht,E,V);else{if(!yn(0,Wt))throw new Error("unknown attachment type");(function(Xt,Ft,te,zt,ve,ye){zt=zt||te.width,ve=ve||te.height,ye=ye||te.depth;const we=te.target||ci;Xt.bindTexture(we,Ft);const Ee=te.level||0,ze=te.internalFormat||te.format||j0,Be=Rr(ze),e0=te.format||Be.format;let He;const a0=te.src;if(He=a0&&(rx(a0)||Array.isArray(a0)&&typeof a0[0]=="number")?te.type||Ns(0,a0,Be.type):te.type||Be.type,we===ni)for(let Ye=0;Ye<6;++Ye)Xt.texImage2D(Zx+Ye,Ee,ze,zt,ve,0,e0,He,null);else we===Hi||we===P0?Xt.texImage3D(we,Ee,ze,zt,ve,ye,0,e0,He,null):Xt.texImage2D(we,Ee,ze,zt,ve,0,e0,He,null)})(N,Wt,xt,E,V)}})}function ki(N,a,_){_=_||36160,a?(N.bindFramebuffer(_,a.framebuffer),N.viewport(0,0,a.width,a.height)):(N.bindFramebuffer(_,null),N.viewport(0,0,N.drawingBufferWidth,N.drawingBufferHeight))}const Nr=/^(.*?)_/;function js(N,a){nr(N,0);const _=N.getExtension(a);if(_){const E={},V=Nr.exec(a)[1],xt="_"+V;for(const vt in _){const Wt=_[vt],Ht=typeof Wt=="function",Gt=Ht?V:xt;let Xt=vt;vt.endsWith(Gt)&&(Xt=vt.substring(0,vt.length-Gt.length)),N[Xt]!==void 0?Ht||N[Xt]===Wt||Mx(Xt,N[Xt],Wt,vt):Ht?N[Xt]=function(Ft){return function(){return Ft.apply(_,arguments)}}(Wt):(N[Xt]=Wt,E[Xt]=Wt)}E.constructor={name:_.constructor.name},nr(E,0)}return _}const Wn=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function gs(N){for(let a=0;a<Wn.length;++a)js(N,Wn[a])}const Fr=`
    void toClip(vec2 pt){
        float x=pt.x*2.-1.;
        float y=1.-pt.y*2.;
        gl_Position=vec4(x,y,0.,1.);
    }

    vec4 getClip(vec2 pt){
        float x=pt.x*2.-1.;
        float y=1.-pt.y*2.;
        return vec4(x,y,0.,1.);
    }
`;function Mi(N){let a=`
        const float PI = 3.141592653589793;
        const float earthR=`+(0,I.ensureFloatString)(N.options.crs.R)+`;
        const float mecatorScale=0.5 / (PI * earthR);
        const float rad2Deg=180./PI;
        const float deg2Rad=PI/180.;
        const float dd=rad2Deg/earthR;
        const float halfPI=PI/2.;
        `;return N.options.crs&&N.options.crs.code!="EPSG:3857"?a+=`
        const vec4 transParams= vec4(1./180., 1., -1./180., 0.5);
        `:a+=`
            const vec4 transParams= vec4(mecatorScale, 0.5, -mecatorScale, 0.5);
            const float maxLat=`+F().Projection.SphericalMercator.MAX_LATITUDE+`;
            `,a+`
        uniform vec2 origin; //map["getPixelOrigin"]
        uniform vec2 pan; //map["_getMapPanePos"]
        uniform float scale;
        uniform vec4 pxAttr; //[left,top,width,height]
        uniform vec4 geoAttr; //lon lat extent
    `}function un(N,a,_,E,V){const xt=N.getPixelOrigin(),vt=[xt.x,xt.y];let Wt=N._getMapPanePos(),Ht=[Wt.x,Wt.y];const Gt=256*Math.pow(2,N.getZoom());if(a=a||{},E){const Xt=[E.left,E.top,E.right-E.left+1,E.bottom-E.top+1];a.pxAttr=Xt}if(_){const Xt=N.getBounds(),Ft=[Math.max(Xt.getWest(),_.minLon),Math.min(Xt.getNorth(),_.maxLat),Math.min(Xt.getEast(),_.maxLon),Math.max(Xt.getSouth(),_.minLat)];a.geoAttr=Ft}return a.origin=vt,a.pan=Ht,a.scale=Gt,a}function dn(N){let a=`
    vec2 transform(vec2 point,float scale,vec4 abcd){  //更换其他投影的关键在于确定transform的参数以及本身从经纬度坐标转为投影坐标的方法
        vec2 res=vec2(0.);
        res.x = scale * (abcd.x * point.x + abcd.y);
        res.y = scale * (abcd.z * point.y + abcd.w);
        return res;
    }
    vec2 untransform(vec2 pos,float scale){
        float x=(pos.x/scale-transParams.y)/(transParams.x);
        float y=(pos.y/scale-transParams.w)/(transParams.z);
        return vec2(x,y);
    }
    `;return a+=N.options.crs&&N.options.crs.code!="EPSG:3857"?`

        vec2 projectCRS(vec2 point){
            return point;
        }

        vec2 unProjectCRS(vec2 pos){
            return pos;
        }

        // vec2 getLonLat(vec2 uv){
        //     // float lon=geoAttr.x+uv.x*(geoAttr.z-geoAttr.x);
        //     // float lat=geoAttr.y-uv.y*(geoAttr.y-geoAttr.w);
        //     // return vec2(lon,lat);
        // }
        `:`
        vec2 projectCRS(vec2 point){
            float lat = max(min(maxLat, point.y), -maxLat);
            float sinLat = sin(lat * deg2Rad);
            vec2 pt=vec2(earthR*point.x*deg2Rad,earthR*log((1.+sinLat)/(1.-sinLat))/2.);
            return pt;
        }

        vec2 unProjectCRS(vec2 pos){
            return vec2(pos.x * dd, (2. * atan(exp(pos.y / earthR)) - halfPI) * rad2Deg);
        }
        `,a+=`
        
        vec2 getLonLatFromPx(vec2 px){
            px.x=px.x+origin.x-pan.x;
            px.y=px.y+origin.y-pan.y; //to layer point 
            vec2 pos=untransform(px,scale);
            return unProjectCRS(pos);
        }

        vec2 getLonLat(vec2 uv){
            float px=pxAttr.x+uv.x*pxAttr.z;
            float py=pxAttr.y+uv.y*pxAttr.w; //get screen point
            return getLonLatFromPx(vec2(px,py));
        }

        vec2 getPx(vec2 point,float scale){
            vec2 pt=projectCRS(point);
            vec2 crsPt= transform(pt,scale,transParams);
            return crsPt-origin+pan;
        }
        
        `,a}class zi extends Te{constructor(a){super((0,I.setOptions)({},a,zi.DefaultOptions)),this.bufferDirty=!0,this.onDataSourceUpdate=()=>{this.bufferDirty=!0}}setVisible(a){return this._visible===a||(this._visible=a,this.layerOptions.loop||this._redraw()),this}deleteFrameBufferInfo(a,_){if(_){a.deleteFramebuffer(_.framebuffer);for(const E of _.attachments)E instanceof WebGLRenderbuffer?a.deleteRenderbuffer(E):a.deleteTexture(E)}}deleteBufferInfo(a,_){if(_){for(const E of Object.values(_.attribs))a.deleteBuffer(E.buffer);_.indices&&a.deleteBuffer(_.indices)}}destroyGL(a){this.context=void 0;const _=this.gl.getExtension("WEBGL_lose_context");_&&_.loseContext()}_resize(a){this.gl.clear(this.gl.COLOR_BUFFER_BIT),super._resize(a)}_redraw(){if(this.gl&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._visible))return this._sizeChanged?(this.setupGL(),void super._redraw()):void super._redraw()}onCanvasReady(a){super.onCanvasReady(a),this.gl=I.consts.useWebGL2?a.getContext("webgl2",{preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer}):a.getContext("webgl",{preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer}),gs(this.gl),this.context={gl:this.gl,map:this._map},this.setupGL()}onRemove(a){return super.onRemove(a),this.destroy(),this}destroy(){this.destroyGL(this.gl)}setDataSource(a){if(a)return this.dataSource&&(this.dataSource.offFeaturesUpdate(this.onDataSourceUpdate),this.drawOptions&&this.drawOptions.clearCaches()),this.dataSource=a,this.dataSource.onFeaturesUpdate(this.onDataSourceUpdate),this.bufferDirty=!0,this;I.logger.warn("数据源为空，无法更新！")}reinit(){return this.gl&&(this.setupGL(),this._redraw()),this}setDrawOptions(a,_=!0){return this.drawOptions&&this.drawOptions.clearCaches(),typeof a=="string"&&(this._theme=a,a=a.indexOf(I.consts.fieldLoaderIndicator)>0?(0,I.processFieldWithLoaders)(a):I.resourceService.getResource(a).instance),typeof a!="object"||a instanceof I.FeatureStyle?this.drawOptions=a:_&&this.drawOptions?this.drawOptions.update(a):this.drawOptions=this._createStyleObjectFromStyleOptions(a),this}supportRetina(){return!0}}zi.DefaultOptions={cacheDrawOptions:!0,preserveDrawingBuffer:!1};class hi extends zi{constructor(a){super((0,I.setOptions)({},a,hi.DefaultOptions)),this.bufferDirty=!0,this.uniforms={},this.visible=!0,this.onDataSourceUpdate=()=>{this.bufferDirty=!0}}setDrawOptions(a,_=!0){var E,V;if(super.setDrawOptions(a,_),this.layerOptions.staticStyle)try{const xt=this.drawOptions.polyline.width(void 0);typeof xt=="number"&&(this.lineWidth=xt);const vt=this.drawOptions.polyline.color(void 0);vt instanceof I.Spectra&&(this.lineColor=vt.glNumberArray())}catch{I.logger.debug("当前图层配置为静态颜色（dynamicStyle为false），但是没有提供有效的静态样式，将使用默认的静态样式！"),this.lineWidth=(E=this.lineWidth)!==null&&E!==void 0?E:2,this.lineColor=(V=this.lineColor)!==null&&V!==void 0?V:new I.Spectra("red").glNumberArray()}return this}setupGL(){var a;const _=(a=this.layerOptions.customContext)!==null&&a!==void 0?a:this.context,{map:E,gl:V}=_,xt=I.glNames.header+`
        precision highp float;
        `+I.glNames.attrIn+` vec2 position;
        `+I.glNames.attrIn+` float direction;
        `+I.glNames.attrIn+` vec2 next;
        `+I.glNames.attrIn+` vec2 previous;
        `+I.glNames.attrIn+` vec4 attrColor;
        `+I.glNames.attrIn+` float attrThickness;
        `+Mi(E)+`
        uniform vec2 reso;
        uniform float aspect;
        uniform float thickness;
        uniform vec4 lineColor;
        uniform bool fixedColor;
        uniform bool fixedThickness;
        uniform int miter;

        `+I.glNames.varOut+` vec4 v_color;
        
        `+dn(E)+`

        `+Fr+`

        void main(){
            if(fixedColor){
                v_color=lineColor;
            }else{
                v_color=attrColor;
            }
            float tn=thickness;
            if(!fixedThickness){
                tn=attrThickness;
            }
            vec2 aspectVec = vec2(aspect, 1.0);
            vec4 previousProjected = getClip(getPx(previous,scale)/reso);
            vec4 currentProjected = getClip(getPx(position,scale)/reso);
            vec4 nextProjected = getClip(getPx(next,scale)/reso);

            //get 2D screen space with W divide and aspect correction
            vec2 currentScreen = currentProjected.xy / currentProjected.w * aspectVec;
            vec2 previousScreen = previousProjected.xy / previousProjected.w * aspectVec;
            vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;

            float len = tn;
            float orientation = direction;

            //starting point uses (next - current)
            vec2 dir = vec2(0.0);
            if (currentScreen == previousScreen) {
              dir = normalize(nextScreen - currentScreen);
            } 
            //ending point uses (current - previous)
            else if (currentScreen == nextScreen) {
              dir = normalize(currentScreen - previousScreen);
            }
            //somewhere in middle, needs a join
            else {
              //get directions from (C - B) and (B - A)
              vec2 dirA = normalize((currentScreen - previousScreen));
              if (miter == 1) {
                vec2 dirB = normalize((nextScreen - currentScreen));
                //now compute the miter join normal and length
                vec2 tangent = normalize(dirA + dirB);
                vec2 perp = vec2(-dirA.y, dirA.x);
                vec2 miter = vec2(-tangent.y, tangent.x);
                dir = tangent;
                len = tn / dot(miter, perp);
              } else {
                dir = dirA;
              }
            }
            vec2 normal = vec2(-dir.y, dir.x);
            normal *= len/2.0;
            normal.x /= aspect;
        
            vec4 offset = vec4(normal * orientation, 0.0, 0.0);
            gl_Position = currentProjected + offset;
            //gl_PointSize = 1.0;
            
        }
        `,vt=I.glNames.header+`
        precision highp float;
        `+I.glNames.varIn+` vec4 v_color;
        `+I.glNames.outColorDefine+`

        void main(){
            `+I.glNames.outColorName+`=v_color;
        }
        `;return this.program=Cx(V,[xt,vt]),this.updateBuffers(_),this.lineWidth>=.5&&(this.lineWidth=this.lineWidth/_.gl.canvas.clientWidth*2),this}_createStyleObjectFromStyleOptions(a){return new I.FeatureStyle(a)}onRedraw(a){var _;if(!this.visible)return this;const E=(_=this.layerOptions.customContext)!==null&&_!==void 0?_:this.context,V=E.gl;V.disable(V.CULL_FACE),E.gl.useProgram(this.program.program),this.updateBuffers(E),m0(E.gl,this.program,this.buffers),un(E.map,this.uniforms);const xt=E.gl.canvas;this.uniforms.reso=[xt.clientWidth,xt.clientHeight],this.uniforms.aspect=xt.clientWidth/xt.clientHeight,this.uniforms.miter=1,this.lineWidth?(this.uniforms.fixedThickness=1,this.uniforms.thickness=this.lineWidth):(this.uniforms.fixedThickness=0,this.uniforms.thickness=.03),this.lineColor?(this.uniforms.fixedColor=1,this.uniforms.lineColor=this.lineColor):this.uniforms.fixedColor=0,ti(this.program,this.uniforms),fx(E.gl,this.buffers)}draw(){return this.onRedraw(void 0),this}destroy(){var a,_,E,V;this.buffers&&this.deleteBufferInfo((_=(a=this.layerOptions.customContext)===null||a===void 0?void 0:a.gl)!==null&&_!==void 0?_:this.context.gl,this.buffers),this.program&&((V=(E=this.layerOptions.customContext)===null||E===void 0?void 0:E.gl)!==null&&V!==void 0?V:this.context.gl).deleteProgram(this.program.program),super.destroy()}updateBuffers(a){var _;if(!this.bufferDirty||!(!((_=this.dataSource)===null||_===void 0)&&_.getFeatures()))return;const{map:E,gl:V}=a,xt=this.dataSource.getFeatures(),vt=[],Wt=[],Ht=[],Gt=[],Xt=[],Ft=[];let te=[],zt=0;if(gt(xt,(we,Ee)=>{var ze;if(!we.geometry||we.geometry.type!=="LineString")return;const Be=we.geometry.coordinates;if(Be.length<2)return;let e0,He,a0=vt.length/2;vt.push(Be[0][0],Be[0][1]),vt.push(Be[0][0],Be[0][1]),Wt.push(Be[0][0],Be[0][1]),Wt.push(Be[0][0],Be[0][1]),Ht.push(Be[1][0],Be[1][1]),Ht.push(Be[1][0],Be[1][1]),this.lineColor||(e0=(ze=this.drawOptions.polyline.color(we))===null||ze===void 0?void 0:ze.glNumberArray(),e0||(e0=new I.Spectra("red").glNumberArray()),Xt.push(...e0,...e0)),(0,I.defined)(this.lineWidth)||(He=this.drawOptions.polyline.width(we),He||(He=3),He>=.5&&(He=He/a.gl.canvas.clientWidth*2),Ft.push(He,He)),Gt.push(-1,1);for(let b0=1;b0<Be.length-1;b0++)vt.push(Be[b0][0],Be[b0][1]),Wt.push(Be[b0-1][0],Be[b0-1][1]),Ht.push(Be[b0+1][0],Be[b0+1][1]),vt.push(Be[b0][0],Be[b0][1]),Wt.push(Be[b0-1][0],Be[b0-1][1]),Ht.push(Be[b0+1][0],Be[b0+1][1]),e0&&Xt.push(...e0,...e0),He&&Ft.push(He,He),Gt.push(-1,1);const Ye=Be.length-1;vt.push(Be[Ye][0],Be[Ye][1]),Wt.push(Be[Ye-1][0],Be[Ye-1][1]),Ht.push(Be[Ye][0],Be[Ye][1]),vt.push(Be[Ye][0],Be[Ye][1]),Wt.push(Be[Ye-1][0],Be[Ye-1][1]),Ht.push(Be[Ye][0],Be[Ye][1]),e0&&Xt.push(...e0,...e0),He&&Ft.push(He,He),Gt.push(-1,1);let d0=te.length;zt=0;for(let b0=0;b0<Be.length-1;b0++){let O0=a0+zt;te[d0++]=O0+0,te[d0++]=O0+1,te[d0++]=O0+2,te[d0++]=O0+2,te[d0++]=O0+1,te[d0++]=O0+3,zt+=2}}),this.buffers){for(const we of Object.values(this.buffers.attribs))V.deleteBuffer(we.buffer);V.deleteBuffer(this.buffers.indices),this.buffers=void 0}const ve=this.layerOptions.staticVertex?V.STATIC_DRAW:V.DYNAMIC_DRAW,ye={position:{numComponents:2,data:new Float32Array(vt),drawType:ve},previous:{numComponents:2,data:new Float32Array(Wt),drawType:ve},next:{numComponents:2,data:new Float32Array(Ht),drawType:ve},direction:{numComponents:1,data:new Float32Array(Gt),drawType:ve},indices:{data:new Uint32Array(te)}};Xt.length&&(ye.attrColor={numComponents:4,data:new Float32Array(Xt),drawType:ve}),Ft.length&&(ye.attrThickness={numComponents:1,data:new Float32Array(Ft),drawType:ve}),this.buffers=px(V,ye),this.bufferDirty=!1}}hi.DefaultOptions={staticVertex:!0,staticStyle:!0},hi.qeName="l_gl_line",I.layerCreator.register(hi);class qn extends Te{constructor(a){super((0,I.setOptions)({},a,qn.DefaultOptions)),this.dataPercent=0,this.maskUniforms={},this.emptyTexture=I.consts.useWebGL2?{}:void 0,this.vectorGridMode="sd",this.updateTDataPercent=()=>{this.dataPercent=this.dataSource.currentTIdx-this.dataSource.getIntTIdx(),this.layerOptions.interpFromPreSource&&this._redraw()},this.updateZDataPercent=()=>{this.dataPercent=this.dataSource.currentZIdx-this.dataSource.getIntZIdx(),this.layerOptions.interpFromPreSource&&this._redraw()},this.transferCurrentData=()=>{const _=this.preTexture,E=this.preTexture2;this.preTexture&&(this.preGrid=void 0),this.preTexture2&&(this.preGrid2=void 0),this.layerOptions.interpFromPreSource&&(this.preGrid=this.currentGrid,this.preTexture=this.currentTexture,this.dataPercent=0,this.preGrid2=this.currentGrid2,this.preTexture2=this.currentTexture2,this.currentTexture=_,this.currentTexture2=E),this.dataSource.getU?this.vectorGridMode==="sd"?(this.currentGrid=this.dataSource.getS(),this.currentGrid2=this.dataSource.getD()):(this.currentGrid=this.dataSource.getU(),this.currentGrid2=this.dataSource.getV()):this.currentGrid=this.dataSource.getGrid(),this.textureDirty=!0,this._redraw()}}setVisible(a){return this._visible===a||(this._visible=a,this.layerOptions.loop||this._redraw()),this}deleteFrameBufferInfo(a,_){if(_){a.deleteFramebuffer(_.framebuffer);for(const E of _.attachments)E instanceof WebGLRenderbuffer?a.deleteRenderbuffer(E):a.deleteTexture(E)}}deleteBufferInfo(a,_){if(_){for(const E of Object.values(_.attribs))a.deleteBuffer(E.buffer);_.indices&&a.deleteBuffer(_.indices)}}destroyGL(a){this.preTexture&&a.deleteTexture(this.preTexture),this.preTexture2&&a.deleteTexture(this.preTexture2),this.currentTexture&&a.deleteTexture(this.currentTexture),this.currentTexture2&&a.deleteTexture(this.currentTexture2),this.deleteFrameBufferInfo(a,this.maskFrameInfo),this.deleteBufferInfo(a,this.maskBufferInfo),this.maskProgram&&a.deleteProgram(this.maskProgram.program),this.maskLine&&this.maskLine.destroy(),this.maskLine=void 0,this.maskProgram=void 0,this.context=void 0;const _=this.gl.getExtension("WEBGL_lose_context");_&&_.loseContext()}_resize(a){this.gl.clear(this.gl.COLOR_BUFFER_BIT),super._resize(a)}_redraw(){if(this.gl&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._visible)){if(this._sizeChanged)return this.drawMaskBuffer(),this.setupGL(this.gl),this.checkDataTexture(),void super._redraw();this.drawMaskBuffer(),this.checkDataTexture(),super._redraw()}}drawMaskBuffer(){this.hasMask&&(ki(this.gl,this.maskFrameInfo),this._sizeChanged&&Oa(this.gl,this.maskFrameInfo,this.maskFrameInfo.attachments,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.layerOptions.maskType!=="all"&&this.layerOptions.maskType!=="polygon"||(this.gl.useProgram(this.maskProgram.program),m0(this.gl,this.maskProgram,this.maskBufferInfo),this.maskUniforms.reso=[this._canvas.clientWidth,this._canvas.clientHeight],un(this._map,this.maskUniforms),ti(this.maskProgram,this.maskUniforms),fx(this.gl,this.maskBufferInfo)),this.layerOptions.maskType!=="all"&&this.layerOptions.maskType!=="polyline"||this.maskLine.draw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))}get hasMask(){return(0,I.defined)(this.layerOptions.mask)&&(this.maskBufferInfo!==void 0||this.maskLine!==void 0)}setupMaskGL(){if(this.layerOptions.maskType==="polygon"||this.layerOptions.maskType==="all"){const a=I.glNames.header+`
            precision highp float;
            `+Mi(this._map)+`
            uniform vec2 reso;

            `+I.glNames.attrIn+` vec2 pos;
            
            `+dn(this._map)+`

            `+Fr+`

            void main(){
                vec2 pt=getPx(pos,scale)/reso;
                toClip(pt);
            }
        `,_=I.glNames.header+`
            precision highp float;
            `+I.glNames.outColorDefine+`

            void main(){
                `+I.glNames.outColorName+`=vec4(1.,0.,0.,1.);
            }
        `;this.maskProgram=Cx(this.gl,[a,_]),this.updateMaskBuffer()}this.layerOptions.maskType!=="all"&&this.layerOptions.maskType!=="polyline"||(this.maskLine=new hi({staticVertex:!0,customContext:this.context}),this.maskLine.setDataSource(new I.GeoJSONFeatureProvider(this.layerOptions.mask)),this.drawOptions.maskLineStyle?this.maskLine.setDrawOptions({polyline:this.drawOptions.maskLineStyle}):this.maskLine.setDrawOptions({polyline:{width:5,color:I.predefinedColorNames.red}}),this.maskLine.setupGL()),this.maskFrameInfo=Qs(this.gl,[{width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight,src:new Uint8Array(this.gl.drawingBufferWidth*this.gl.drawingBufferHeight*4),format:this.gl.RGBA,type:this.gl.UNSIGNED_BYTE,wrap:this.gl.CLAMP_TO_EDGE,minMag:this.gl.LINEAR}],this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}updateMaskBuffer(){if(this.gl){if(this.layerOptions.maskType==="polygon"||this.layerOptions.maskType==="all"){if(this.maskBufferInfo){for(const V of Object.values(this.maskBufferInfo.attribs))this.gl.deleteBuffer(V.buffer);this.gl.deleteBuffer(this.maskBufferInfo.indices),this.maskBufferInfo=void 0}if(!this.layerOptions.mask)return;const a=[],_=[];gt(this.layerOptions.mask,V=>{var xt;if(((xt=V==null?void 0:V.geometry)===null||xt===void 0?void 0:xt.type)!=="Polygon")return;const vt=(0,I.earcutFlatten)(V.geometry.coordinates),Wt=(0,I.earcut)(vt.vertices,vt.holes,vt.dimensions),Ht=a.length/vt.dimensions;for(let Gt=0;Gt<vt.vertices.length;Gt++)a.push(vt.vertices[Gt]);Wt.forEach(Gt=>{_.push(Gt+Ht)})});const E=new Float32Array(a);this.maskBufferInfo=px(this.gl,{pos:{numComponents:2,data:E},indices:{data:new Uint16Array(_)}})}(this.maskLine&&this.layerOptions.maskType==="all"||this.layerOptions.maskType==="polyline")&&this.maskLine.setDataSource(new I.GeoJSONFeatureProvider(this.layerOptions.mask))}}onCanvasReady(a){super.onCanvasReady(a),this.gl=I.consts.useWebGL2?a.getContext("webgl2",{preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer}):a.getContext("webgl",{preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer}),gs(this.gl),this.context={gl:this.gl,map:this._map},this.setupGL(this.gl),this.setupMaskGL()}parseNumberStopRules(a){const _=a.getStops(),E=a.getVals(),V=[];for(const vt of _)V.push(parseFloat(vt));const xt=[];for(const vt of E)xt.push(parseFloat(vt));return{numbers:V,steps:xt}}parseColorStopRules(a){const _=a.getStops(),E=a.getVals(),V=[];for(const vt of _){const Wt=vt;V.push(Wt.red()/255,Wt.green()/255,Wt.blue()/255,Wt.alpha())}const xt=[];for(const vt of E)xt.push(parseFloat(vt));return{colors:V,steps:xt}}setLayerOptions(a,_=!0){const E=this.layerOptions.trackDataSource,V=this.layerOptions.mask;super.setLayerOptions(a,_),E!=this.layerOptions.trackDataSource&&this.dataSource&&(this.unsetDataSourceListener(),this.setDataSourceListener()),V!==this.layerOptions.mask&&this.updateMaskBuffer()}onRemove(a){return super.onRemove(a),this.destroy(),this}destroy(){this.destroyGL(this.gl),this.dataSource&&this.unsetDataSourceListener()}setDataSource(a){if(a)return this.dataSource&&this.dataSource!==a&&(this.unsetDataSourceListener(),this.dataPercent=0,this.preGrid=void 0,this.gl&&this.preTexture&&this.gl.deleteTexture(this.preTexture),this.gl&&this.preTexture2&&this.gl.deleteTexture(this.preTexture2),this.preTexture=void 0,this.preTexture2=void 0,this.textureDirty=!0),this.dataSource&&this.dataSource===a||(this.dataSource=a,this.setDataSourceListener(),this.dataSource.getU?this.vectorGridMode==="sd"?(this.currentGrid=this.dataSource.getS(),this.currentGrid2=this.dataSource.getD()):(this.currentGrid=this.dataSource.getU(),this.currentGrid2=this.dataSource.getV()):this.currentGrid=this.dataSource.getGrid()),this;I.logger.warn("数据源为空，无法更新！")}reinit(){return this.gl&&(this.setupGL(this.gl),this._redraw()),this}setDrawOptions(a,_=!0){return typeof a=="string"&&(this._theme=a,a=a.indexOf(I.consts.fieldLoaderIndicator)>0?(0,I.processFieldWithLoaders)(a):I.resourceService.getResource(a).instance),typeof a!="object"||a instanceof I.GridGLBaseStyle?this.drawOptions=a:_&&this.drawOptions?this.drawOptions.update(a):this.drawOptions=this._createStyleObjectFromStyleOptions(a),this.drawOptions&&(this.planeOptions=this.drawOptions.getPlaneOptions(void 0,this.layerOptions.cacheDrawOptions)),this}clearPreDataSource(){this.gl&&this.gl.deleteTexture(this.preTexture),this.gl&&this.gl.deleteTexture(this.preTexture2),this.preTexture=void 0,this.preTexture2=void 0,this.preGrid=void 0,this.preGrid2=void 0,this.dataPercent=0}unsetDataSourceListener(){this.dataSource.offTChanged(this.updateTDataPercent),this.dataSource.offZChanged(this.updateZDataPercent),this.dataSource.offIntTZChanged(this.transferCurrentData),this.dataSource.offActiveGridUpdated(this.transferCurrentData)}setDataSourceListener(){this.layerOptions.trackDataSource&&(this.dataSource.onTChanged(this.updateTDataPercent),this.dataSource.onZChanged(this.updateZDataPercent),this.dataSource.onIntTChanged(()=>{this.dataPercent=this.dataSource.currentTIdx-this.dataSource.getIntTIdx(),this.transferCurrentData()}),this.dataSource.onIntZChanged(()=>{this.dataPercent=this.dataSource.currentZIdx-this.dataSource.getIntZIdx(),this.transferCurrentData()}),this.dataSource.onActiveGridUpdated(this.transferCurrentData))}createImageTexture(a,_,E,V,xt=!1){const vt=V.createTexture();return V.bindTexture(V.TEXTURE_2D,vt),xt?V.texImage2D(V.TEXTURE_2D,0,V.RGBA,V.RGBA,V.UNSIGNED_BYTE,E):V.texImage2D(V.TEXTURE_2D,0,V.RGBA,a,_,0,V.RGBA,V.UNSIGNED_BYTE,E||null),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.NEAREST),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.NEAREST),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),vt}createDataTexture(a){let _,E=this.gl.NEAREST;if(this.planeOptions.optimizedInterp&&this.planeOptions&&this.planeOptions.fillMode!==I.GridDataGLFillMode.bitmap&&(E=this.gl.LINEAR),a instanceof I.GrayImageGridData)_=Di(this.gl,{width:a.xSize,height:a.ySize,format:this.gl.RGBA,internalFormat:this.gl.RGBA,type:this.gl.UNSIGNED_BYTE,min:E,mag:E,src:a.imageSource,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,flipY:0});else{const V=this.getGLDataInfo(a);_=Di(this.gl,{width:a.xSize,height:a.ySize,min:E,mag:E,format:V.pixelFormat,internalFormat:V.innerFormat,type:V.dataType,src:V.rawData,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,flipY:0})}return _}getGLDataInfo(a){let _=a.dataType!==I.GridDataType.UInt8&&I.consts.useWebGL2?this.gl.RED:this.gl.ALPHA,E=a.dataType===I.GridDataType.UInt8?this.gl.UNSIGNED_BYTE:this.gl.FLOAT,V=_,xt=a.dataType===I.GridDataType.UInt8||a.dataType===I.GridDataType.Float32?a.raw:new Float32Array(a.raw);return _===this.gl.RED&&(V=this.gl.R32F),{rawData:xt,dataType:E,innerFormat:V,pixelFormat:_}}checkDataTexture(){this.currentGrid?this.currentTexture?this.textureDirty&&(this.updateTexture(this.currentTexture,this.currentGrid),this.currentGrid2&&this.updateTexture(this.currentTexture2,this.currentGrid2),this.textureDirty=!1):(this.currentTexture=this.createDataTexture(this.currentGrid),this.currentGrid2&&(this.currentTexture2=this.createDataTexture(this.currentGrid2))):I.logger.warn("当前数据源为空！")}updateTexture(a,_){const E=performance.now();let V=this.gl.NEAREST;if(this.planeOptions.optimizedInterp&&this.planeOptions&&this.planeOptions.fillMode!==I.GridDataGLFillMode.bitmap&&(V=this.gl.LINEAR),_ instanceof I.GrayImageGridData)Un(this.gl,a,_.imageSource,{width:_.xSize,height:_.ySize,format:this.gl.RGBA,internalFormat:this.gl.RGBA,type:this.gl.UNSIGNED_BYTE,min:V,mag:V,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,flipY:0});else{const xt=this.getGLDataInfo(_);Fn(this.gl,a,xt.rawData,{width:_.xSize,height:_.ySize,min:V,mag:V,format:xt.pixelFormat,internalFormat:xt.innerFormat,type:xt.dataType,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,flipY:0})}this.layerOptions.debugShowPerformance&&I.logger.debug("update texture costs "+(performance.now()-E)+"ms")}supportRetina(){return!0}}qn.DefaultOptions={trackDataSource:!0,cacheDrawOptions:!0,interpFromPreSource:!1,preserveDrawingBuffer:!1,maskType:"polygon"};class rr extends qn{constructor(a){super((0,I.setOptions)({},a,rr.DefaultOptions)),this.fillUniforms={},this.lineUniforms={},this.reliefUniforms={}}setDrawOptions(a,_=!0){if(super.setDrawOptions(a,_),this.drawOptions.colorScale&&(this.csTexture&&(this.gl.deleteTexture(this.csTexture),this.csTexture=void 0),this._updateColorScaleMaxMin()),this.drawOptions.fillColor){const E=this.parseColorStopRules(this.drawOptions.fillColor);this.fillColors=E.colors,this.fillSteps=E.steps}return this.splineMat=t0.transpose([-this.drawOptions.pixelRatio,2-this.drawOptions.pixelRatio,this.drawOptions.pixelRatio-2,this.drawOptions.pixelRatio,2*this.drawOptions.pixelRatio,this.drawOptions.pixelRatio-3,3-2*this.drawOptions.pixelRatio,-this.drawOptions.pixelRatio,-this.drawOptions.pixelRatio,0,this.drawOptions.pixelRatio,0,0,1,0,0]),this.dataSource&&this.redraw(),this}setDataSource(a){return super.setDataSource(a),this._updateColorScaleMaxMin(),this}_updateColorScaleMaxMin(){var a,_;if(this.dataSource&&(!((_=(a=this.planeOptions)===null||a===void 0?void 0:a.colorScale)===null||_===void 0)&&_.colorScale)&&(!(0,I.defined)(this.planeOptions.colorScale.min)||!(0,I.defined)(this.planeOptions.colorScale.max))){I.logger.debug("当前colorScale没有配置最大或者最小值，将使用数据中的值，可能造成连续动画时最大最小值不一致！");const E=this.dataSource.getGrid().maxMin;(0,I.defined)(this.planeOptions.colorScale.min)||(this.planeOptions.colorScale.min=E.min),(0,I.defined)(this.planeOptions.colorScale.max)||(this.planeOptions.colorScale.max=E.max)}}setupFill(){var a,_;this.fillProgram&&(this.gl.deleteProgram(this.fillProgram.program),this.deleteBufferInfo(this.gl,this.fillBufferInfo),this.deleteFrameBufferInfo(this.gl,this.fillFrameInfo));const E=I.glNames.header+`
        precision highp float;

        `+I.glNames.attrIn+` vec2 pos;
        `+I.glNames.attrIn+` vec2 uv;
        `+I.glNames.varOut+` vec2 vUv;

        `+Fr+`
        
        void main(){
            vUv=uv;
            toClip(pos);
        }
        `,V=dn(this._map),xt=(_=(a=this.fillSteps)===null||a===void 0?void 0:a.length)!==null&&_!==void 0?_:1,vt=I.glNames.header+`
        precision highp float;
        precision mediump int;
        precision highp sampler2D;

        const int stepCount=`+xt+`;
        uniform sampler2D currentData;
        uniform sampler2D preData;
        uniform float dataPercent;
        uniform int fillMode; //0-none(bitmap,no-color-interp&no-data-interp),1-bi(pixel1),2-cardinal(pixel2),3-shaded(no-color-interp&cardinal)
        uniform mat4 cardinalSplineMat;
        uniform bool hasPre;
        `+(0,I.getAlgoConstsAndUniforms)(this.currentGrid,!0)+`
        `+Mi(this._map)+`
        uniform vec4 xAttr; //[start,end,delta,size]
        uniform vec4 yAttr;    
        //data
        uniform vec4 colors[stepCount];
        uniform float steps[stepCount];
        uniform sampler2D csTexture;
        uniform float csMin;
        uniform float csMax;
        uniform bool hasCs;
        uniform bool hasMask;
        uniform sampler2D maskTexture;
        uniform vec2 reso;
        uniform float globalOpacity;

        $inject

        `+I.glNames.varIn+` vec2 vUv;
        `+I.glNames.outColorDefine+`

        `+V+`

        void main(){
            if(hasMask && !`+I.qeGLFuncs.qe_maskout+`(reso,maskTexture)){
                discard;
            }
            vec2 lonLat=getLonLat(vUv);
            vec2 uv=`+I.qeGLFuncs.qe_getLonLatTexPos+`(lonLat,xAttr,yAttr);
            vec2 val;
            int interpMethod=fillMode;
            if(fillMode==3|| fillMode==2){ //shaded
                //cardinal
                interpMethod=2;
            }else if(fillMode==4){ //shaded2
                interpMethod=1;
            }
            if(hasPre){
                val=`+I.qeGLFuncs.qe_interpGridValByUV+`(preData,uv,xAttr,yAttr,undef,interpMethod,currentData,dataPercent);
            }else{
                val=`+I.qeGLFuncs.qe_readGridValByUV+`(currentData,uv,xAttr,yAttr,undef,interpMethod);
            }
            float selVal=fillMode==0?val.x:val.y;
            if(hasCs){
                `+I.glNames.outColorName+"="+I.qeGLFuncs.qe_getColorByScale+`(selVal);
            }else{
                if(fillMode==0|| fillMode>=3){ //no-color-interp
                    `+I.glNames.outColorName+"="+I.qeGLFuncs.qe_getColor+`(selVal);
                }else{
                    `+I.glNames.outColorName+"="+I.qeGLFuncs.qe_interpColor+`(selVal);
                }
            }
            `+I.glNames.outColorName+".a="+I.glNames.outColorName+`.a*globalOpacity;
        }
        `;this.fillProgram=Cx(this.gl,[E,(0,I.injectBuiltInShaderFunctions)(vt)]);const Wt=new Float32Array([0,0,0,1,1,1,0,0,1,1,1,0]);this.fillBufferInfo=px(this.gl,{pos:{numComponents:2,data:new Float32Array(12)},uv:{numComponents:2,data:Wt}}),this.fillFrameInfo=Qs(this.gl,[this.getFillTextureOptions()]),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}getFillTextureOptions(){return{width:this.gl.canvas.width,height:this.gl.canvas.height,min:this.gl.NEAREST,mag:this.gl.NEAREST,warp:this.gl.CLAMP_TO_EDGE,attach:this.gl.COLOR_ATTACHMENT0}}setupLine(){this.lineProgram&&(this.gl.deleteProgram(this.lineProgram.program),this.deleteBufferInfo(this.gl,this.lineBufferInfo));const a=I.glNames.header+`
        precision highp float;
        `+I.glNames.attrIn+` vec2 position;
        `+I.glNames.attrIn+` vec2 uv;
        `+I.glNames.varOut+` vec2 vUv;

        void main(){
            vUv=uv;
            gl_Position=vec4(position,0.,1.);
        }
        `,_=I.glNames.header+`
            precision highp sampler2D; 
            precision mediump int;
            precision highp float;
            const float weight1=1./6.;
            const float weight2=weight1*0.5;
            `+(0,I.getRGBA2FloatConsts)()+`
            uniform sampler2D fillTexture;
            uniform bool showShaded;
            uniform vec2 viewportDelta;
            uniform float contourlineWidth;
            uniform vec4 contourlineColor;
            uniform bool contourWithPal;

            `+I.glNames.varIn+` vec2 vUv;

            `+I.glNames.outColorDefine+`

            $inject

            bool isContour(vec4 col,vec2 uv){
                float center=`+I.qeGLFuncs.qe_rgba2float+`(col);
                vec2 vpDelta=viewportDelta*contourlineWidth*0.5;
                float surrounds[8];
                surrounds[0]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(0.,vpDelta.y)));
                surrounds[1]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(vpDelta.x,0.)));
                surrounds[2]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(0.,-vpDelta.y)));
                surrounds[3]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(-vpDelta.x,0.)));

                surrounds[4]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vpDelta));
                surrounds[5]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv-vpDelta));
                surrounds[6]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(vpDelta.x,-vpDelta.y)));
                surrounds[7]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv-vec2(vpDelta.x,-vpDelta.y)));
                float alpha=0.;
                for(int i=0;i<4;i++){
                    if(abs(surrounds[i]-center)>0.){ //not same range
                        alpha+=weight1;
                    }
                }
                for(int i=4;i<8;i++){
                    if(abs(surrounds[i]-center)>0.){ //not same range
                        alpha+=weight2;
                    }
                }
                return alpha>=weight1;
            }

            void main(){
                `+I.glNames.outColorName+`=vec4(0.);
                vec2 uv=vec2(vUv.x,1.-vUv.y);
                vec4 col=`+I.glNames.textureFunc+`(fillTexture,uv);
                if(showShaded){
                    `+I.glNames.outColorName+`=col;
                }
                if(col.a<0.001){
                    return;
                }
                if(isContour(col,uv)){
                    if(contourWithPal){
                        `+I.glNames.outColorName+`=col;
                    }else{
                        `+I.glNames.outColorName+`=contourlineColor;
                    }
                }
            }
        `;this.lineProgram=Cx(this.gl,[a,(0,I.injectBuiltInShaderFunctions)(_)]),this.lineBufferInfo=px(this.gl,{position:{numComponents:2,data:[-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]},uv:{numComponents:2,data:[0,0,0,1,1,1,0,0,1,1,1,0]}}),this.viewportDelta=[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight]}setupRelief(){this.reliefProgram&&(this.gl.deleteProgram(this.reliefProgram.program),this.deleteBufferInfo(this.gl,this.reliefBufferInfo));const a=I.glNames.header+`
        precision highp float;
        `+I.glNames.attrIn+` vec2 position;
        `+I.glNames.attrIn+` vec2 uv;
        `+I.glNames.varOut+` vec2 vUv;

        void main(){
            vUv=uv;
            gl_Position=vec4(position,0.,1.);
        }
        `,_=I.glNames.header+`
            precision highp sampler2D; 
            precision mediump int;
            precision highp float;
            const float offset=128./255.;
            uniform sampler2D fillTexture;
            uniform vec2 viewportDelta;

            `+I.glNames.varIn+` vec2 vUv;

            `+I.glNames.outColorDefine+`

            $inject

            void main(){
                `+I.glNames.outColorName+`=vec4(0.);
                vec2 uv=vec2(vUv.x,1.-vUv.y);
                vec4 col=`+I.glNames.textureFunc+`(fillTexture,uv);
                if(uv.x<=(1.-viewportDelta.x)){
                    vec2 rUv=uv+vec2(viewportDelta.x,0.);
                    vec4 rCol=`+I.glNames.textureFunc+`(fillTexture,rUv);
                    vec3 rgb=col.xyz-rCol.xyz+vec3(offset);
                    rgb=vec3(clamp(rgb.x,0.,1.),clamp(rgb.y,0.,1.),clamp(rgb.z,0.,1.));
                    col=vec4(rgb,col.a);
                    //col=vec4(col.x-rCol.x+offset,col.y-rCol.y+offset,col.z-rCol.z+offset,col.w);
                }
                if(col.a<0.001){
                    return;
                }
                `+I.glNames.outColorName+`=col;
            }
        `;this.reliefProgram=Cx(this.gl,[a,(0,I.injectBuiltInShaderFunctions)(_)]),this.reliefBufferInfo=px(this.gl,{position:{numComponents:2,data:[-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]},uv:{numComponents:2,data:[0,0,0,1,1,1,0,0,1,1,1,0]}}),this.viewportDelta=[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight]}setupGL(a){this._map instanceof Jt&&(this.setupFill(),this.setupLine(),this.setupRelief())}drawFill(a,_,E,V){var xt;const vt=(0,I.gridOptionsToExtent)(this.dataSource.gridOptions);this.dataSource.gridOptions.xDelta>0?vt.maxLon=vt.maxLon+this.dataSource.gridOptions.xDelta:vt.minLon=vt.minLon-this.dataSource.gridOptions.xDelta,this.dataSource.gridOptions.yDelta>0?vt.maxLat=vt.maxLat+this.dataSource.gridOptions.yDelta:vt.minLat=vt.minLat+this.dataSource.gridOptions.yDelta;const Wt=F().latLng(vt.minLat,vt.minLon),Ht=F().latLng(vt.maxLat,vt.maxLon),Gt=(_.bounds,this._map.latLngToContainerPoint(Wt)),Xt=this._map.latLngToContainerPoint(Ht),Ft=a.canvas;if(Gt.x>=Ft.clientWidth||Gt.y<=0||Xt.x<=0||Xt.y>=Ft.clientHeight)return;const te=Math.max(0,Gt.x),zt=Math.max(0,Xt.y),ve=Math.min(Ft.clientWidth,Xt.x),ye=Math.min(Ft.clientHeight,Gt.y);Gt.x=te/Ft.clientWidth,Gt.y=ye/Ft.clientHeight,Xt.x=ve/Ft.clientWidth,Xt.y=zt/Ft.clientHeight;const we=[this.dataSource.gridOptions.xStart,this.dataSource.gridOptions.xEnd,this.dataSource.gridOptions.xDelta,this.dataSource.gridOptions.xSize],Ee=[this.dataSource.gridOptions.yStart,this.dataSource.gridOptions.yEnd,this.dataSource.gridOptions.yDelta,this.dataSource.gridOptions.ySize],ze=new Float32Array([Gt.x,Xt.y,Gt.x,Gt.y,Xt.x,Gt.y,Gt.x,Xt.y,Xt.x,Gt.y,Xt.x,Xt.y]);if(V&&(ki(a,V),a.clear(a.COLOR_BUFFER_BIT)),a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight),a.useProgram(this.fillProgram.program),Hr(a,this.fillBufferInfo.attribs.pos,ze),m0(a,this.fillProgram,this.fillBufferInfo),this.fillUniforms.currentData=this.currentTexture,this.preTexture?this.fillUniforms.preData=this.preTexture:delete this.fillUniforms.preData,this.fillUniforms.dataPercent=this.dataPercent,this.fillUniforms.fillMode=E.fillMode,this.fillUniforms.cardinalSplineMat=this.splineMat,this.fillUniforms.hasPre=this.preTexture?1:0,(0,I.setDirectAlgoUniforms)(this.currentGrid,this.fillUniforms),this.fillUniforms.xAttr=we,this.fillUniforms.yAttr=Ee,E.colorScale){if(this.fillUniforms.hasCs=!0,!this.csTexture){const Be=E.colorScale.colorScale,e0=Be instanceof HTMLVideoElement?Be.videoWidth:Be.width,He=Be instanceof HTMLVideoElement?Be.videoHeight:Be.height;this.csTexture=this.createImageTexture(e0,He,Be,a,!0)}this.fillUniforms.csTexture=this.csTexture,this.fillUniforms.csMin=E.colorScale.min,this.fillUniforms.csMax=E.colorScale.max,delete this.fillUniforms.colors,delete this.fillUniforms.steps}else this.fillUniforms.hasCs=!1,delete this.fillUniforms.csTexture,this.fillUniforms.colors=this.fillColors,this.fillUniforms.steps=this.fillSteps;this.fillUniforms.reso=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight],un(this._map,this.fillUniforms,vt,{left:te,top:zt,bottom:ye,right:ve},this.moving),this.fillUniforms.hasMask=this.hasMask,this.fillUniforms.maskTexture=this.maskFrameInfo&&this.maskFrameInfo.attachments[0],this.fillUniforms.globalOpacity=(xt=E.globalOpacity)!==null&&xt!==void 0?xt:1,ti(this.fillProgram,this.fillUniforms),fx(a,this.fillBufferInfo),V&&a.bindFramebuffer(a.FRAMEBUFFER,null)}drawLine(a,_,E){var V;let xt=!0;_.fillMode!==I.GridDataGLFillMode.shaded1&&(_.fillMode!==I.GridDataGLFillMode.none&&this.drawFill(a,E,_,void 0),xt=!1);const vt=Object.assign({},_);vt.fillMode=(V=_.fillModeForLine)!==null&&V!==void 0?V:_.fillMode===I.GridDataGLFillMode.pixel1?I.GridDataGLFillMode.shaded1:I.GridDataGLFillMode.shaded2,this.drawFill(a,E,vt,this.fillFrameInfo),a.bindFramebuffer(a.FRAMEBUFFER,null),a.useProgram(this.lineProgram.program),a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight),this.lineUniforms.fillTexture=this.fillFrameInfo.attachments[0],this.lineUniforms.showShaded=xt,this.lineUniforms.viewportDelta=this.viewportDelta,this.lineUniforms.contourlineWidth=vt.lineWidth,this.lineUniforms.contourlineColor=vt.lineColor||[0,0,0,0],this.lineUniforms.contourWithPal=!vt.lineColor,m0(a,this.lineProgram,this.lineBufferInfo),ti(this.lineProgram,this.lineUniforms),fx(a,this.lineBufferInfo)}drawRelief(a,_){Object.assign({},_).fillMode!==I.GridDataGLFillMode.none&&(a.useProgram(this.reliefProgram.program),a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight),this.reliefUniforms.fillTexture=this.fillFrameInfo.attachments[0],this.reliefUniforms.viewportDelta=this.viewportDelta,m0(a,this.reliefProgram,this.reliefBufferInfo),ti(this.reliefProgram,this.reliefUniforms),fx(a,this.reliefBufferInfo))}onRedraw(a){if(this.planeOptions.fillMode===I.GridDataGLFillMode.none&&!this.planeOptions.showLine||this._canvas.className.indexOf("web-inspector")>=0)return;const _=this.gl;_.enable(_.CULL_FACE),_.cullFace(_.BACK),_.disable(_.DEPTH_TEST),_.enable(_.BLEND),_.blendFunc(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA),_.clear(_.COLOR_BUFFER_BIT),this.planeOptions.showLine?this.drawLine(_,this.planeOptions,a):this.planeOptions.showRelief?(this.drawFill(_,a,this.planeOptions,this.fillFrameInfo),this.drawRelief(_,this.planeOptions)):this.drawFill(_,a,this.planeOptions,void 0)}destroyGL(a){this.fillProgram&&this.gl.deleteProgram(this.fillProgram.program),this.lineProgram&&this.gl.deleteProgram(this.lineProgram.program),this.fillBufferInfo&&this.deleteBufferInfo(this.gl,this.fillBufferInfo),this.lineBufferInfo&&this.deleteBufferInfo(this.gl,this.lineBufferInfo),super.destroyGL(a)}_createStyleObjectFromStyleOptions(a){return new I.PixelLayerStyle(a)}}rr.DefaultOptions={pane:I.consts.customPanes.filled.name},rr.qeName="l_pixel",I.layerCreator.register(rr);class Zn extends qn{constructor(a){super((0,I.setOptions)({},a,Zn.DefaultOptions)),this.positionUniforms={},this.ptTextureDirty=!1,this.particleUniforms={},this.screenUniforms={},this.quadCoords=new Float32Array([-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]),this.timestamp=0,this.dirty=!1,this.updateMapBounds=()=>{const _=this._map.getBounds();let E=_.getSouthWest(),V=_.getNorthEast();this.mapExtent=this.updateVisExtent(E.lng,V.lng,E.lat,V.lat),E=F().latLng(this.gridExt.minLat,this.gridExt.minLon),V=F().latLng(this.gridExt.maxLat,this.gridExt.maxLon);const xt=this._map.latLngToContainerPoint(E),vt=this._map.latLngToContainerPoint(V),Wt=this.gl.canvas;if(xt.x>=Wt.clientWidth||xt.y<=0||vt.x<=0||vt.y>=Wt.clientHeight)return;const Ht=Math.max(0,xt.x),Gt=Math.max(0,vt.y),Xt=Math.min(Wt.clientWidth,vt.x),Ft=Math.min(Wt.clientHeight,xt.y);this.pxBounds={left:Ht,top:Gt,right:Xt,bottom:Ft}},this.vectorGridMode="uv",this._pixelLayer=new rr(a)}onAdd(a){return this._pixelLayer.onAdd(a),super.onAdd(a),this}onRemove(a){return super.onRemove(a),this._pixelLayer.onRemove(a),this}setDrawOptions(a,_=!0){var E;super.setDrawOptions(a,_);const V=this.parseColorStopRules(this.drawOptions.color);this.colors=V.colors,this.steps=V.steps;const xt=this.drawOptions.interpSmoothFactor;this.splineMat=t0.transpose([-xt,2-xt,xt-2,xt,2*xt,xt-3,3-2*xt,-xt,-xt,0,xt,0,0,1,0,0]);const vt=(E=this.layerOptions.count)!==null&&E!==void 0?E:this.drawOptions.count;return this._count?this._count!==vt&&this.dataSource?(this._sizeChanged=!0,this._reset(),this._count=vt):this.dataSource&&this.redraw():this._count=vt,this.drawOptions.showPixel?this._pixelLayer.setVisible(!0):this._pixelLayer.setVisible(!1),this._currentImageTexture!==this.drawOptions.texture&&(this._currentImageTexture=this.drawOptions.texture,this.ptTextureDirty=!0),this._pixelLayer.setDrawOptions(this.drawOptions.pixelOptions),this}setDataSource(a){if(!a.getS)return I.logger.error("风场数据源必须为风场类provider！"),this;super.setDataSource(a);const _=this.gridExt=(0,I.gridOptionsToExtent)(this.dataSource.gridOptions);return this.dataExtent=this.updateVisExtent(_.minLon,_.maxLon,_.minLat,_.maxLat),this.xAttr=[this.dataSource.gridOptions.xStart,this.dataSource.gridOptions.xEnd,this.dataSource.gridOptions.xDelta,this.dataSource.gridOptions.xSize],this.yAttr=[this.dataSource.gridOptions.yStart,this.dataSource.gridOptions.yEnd,this.dataSource.gridOptions.yDelta,this.dataSource.gridOptions.ySize],this._pixelLayer.setDataSource(a),this}setupPositionGL(a){var _;const E=I.glNames.header+`
        `+I.glNames.attrIn+` vec2 pos;
        `+I.glNames.varOut+` vec2 vUV;
        void main(){
            vUV=(pos.xy+1.)/2.;
            gl_Position=vec4(pos,0.,1.0);
        }
        `,V=I.glNames.header+`
        precision highp int;
        precision highp float;
        precision highp sampler2D;
        const float earthC = 40075.;  //km
        const float degPerLatKM = `+1/111.32+`; //每公里多少度
        const float pxPerMeterSec=5./20.; //风速20m/s的时候，代码中的每秒前进5个像素
        uniform float dropRate;
        uniform sampler2D posTexture;
        uniform float randSeed;
        uniform sampler2D uTexture;
        uniform sampler2D vTexture;
        uniform sampler2D preUTexture;
        uniform sampler2D preVTexture;
        uniform float percent;
        uniform bool hasPre;
        uniform vec4 extent; //xStart,xEnd,yStart,yEnd->data options
        uniform float dt; //seconds
        uniform float spdFactor;
        uniform vec4 visExtent; //xStart,xEnd,yStart,yEnd
        `+(0,I.getAlgoConstsAndUniforms)(this.dataSource.getU(),!0)+`
        uniform mat4 cardinalSplineMat;
        uniform vec4 xAttr;
        uniform vec4 yAttr;
        uniform int interpMethod;
        `+Mi(this._map)+`
        uniform vec2 reso;
        uniform vec2 scReso;
        uniform float zoom;

        `+I.glNames.varIn+` vec2 vUV;
        `+I.glNames.outColorDefine+`

        $inject

        `+dn(this._map)+`

        // pseudo-random generator
        const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);
        float rand(const vec2 co) {
            float t = dot(rand_constants.xy, co);
            return fract(sin(t) * (rand_constants.z + t));
        }

        vec4 getRandPos(vec2 seed){
            vec2 randPos=vec2(rand(seed+1.6),rand(seed+2.8));
            return vec4(
                fract(randPos * 255.0),
                floor(randPos * 255.0) / 255.0); 
        }

        vec4 encodePosition(vec2 rawPos){
            return vec4(
                fract(rawPos * 255.0),
                floor(rawPos * 255.0) / 255.0); 
        }

        vec2 distort(vec2 pos,vec2 uv){
            vec2 xy=getPx(pos,scale);
            //distortion
            float p2=2.0*PI;
            float h=5.;
            float hl=pos.x<0.?h:-h;
            float hf=pos.y<0.?h:-h;
            vec2 pl=getPx(vec2(pos.x+hl,pos.y),scale);
            vec2 pf=getPx(vec2(pos.x,pos.y+hf),scale);
            float k=cos((pos.y/360.)*p2);
            vec4 d=vec4((pl.x-xy.x)/hl/k,(pl.y-xy.y)/hl/k,(pf.x-xy.x)/hf,(pf.y-xy.y)/hf);
            return vec2(d.x*uv.x+d.z*uv.y,d.y*uv.x+d.w*uv.y);
        }

        vec2 updatePos(vec2 current,vec2 uv,vec2 lonLat){
            vec2 res=fract(1.0+current+uv*spdFactor*dt*0.002);
            return res;
        }

        vec2 decodePos(vec4 src){
            return vec2(
                src.r / 255.0 + src.b,
                src.g / 255.0 + src.a);
        }

        //以屏幕坐标作为发射单位，这样无需进行distortion计算（因为屏幕坐标不存在地球两极形变），而且放大缩小不会改变速度，perfect！
        void main(){
            //previous encoded position
            vec4 posTex=`+I.glNames.textureFunc+`(posTexture,vUV);
            vec2 pos=decodePos(posTex); //screen percent
            vec2 seed=(vUV+pos)*randSeed;
            vec4 randPos=getRandPos(seed);
            if(posTex.r==0. && posTex.g==0. && posTex.b==0. && posTex.a==0.){
                //first load,use all random pos
                `+I.glNames.outColorName+`=randPos;
                return;
            }else{
                vec2 scPos=pos*scReso;
                vec2 geo=getLonLatFromPx(scPos);
                if(geo.x>visExtent.y || geo.x<visExtent.x || geo.y>visExtent.w || geo.y<visExtent.z){
                    `+I.glNames.outColorName+`=randPos;
                    return;
                }
                vec2 texPos=`+I.qeGLFuncs.qe_getLonLatTexPos+`(geo,xAttr,yAttr);
                vec2 u;
                vec2 v;
                if(hasPre){
                    u=`+I.qeGLFuncs.qe_interpGridValByUV+`(preUTexture,texPos,xAttr,yAttr,undef,interpMethod,uTexture,percent);
                    v=`+I.qeGLFuncs.qe_interpGridValByUV+`(preVTexture,texPos,xAttr,yAttr,undef,interpMethod,vTexture,percent);
                }else{
                    u=`+I.qeGLFuncs.qe_readGridValByUV+`(uTexture,texPos,xAttr,yAttr,undef,interpMethod);
                    v=`+I.qeGLFuncs.qe_readGridValByUV+`(vTexture,texPos,xAttr,yAttr,undef,interpMethod);
                }
                vec2 uv=vec2(u.y,-v.y);
                if(`+I.qeGLFuncs.qe_isUndef+"(uv.x,undef) || "+I.qeGLFuncs.qe_isUndef+`(uv.y,undef)){
                    `+I.glNames.outColorName+`=randPos;
                    return;
                }
                pos=updatePos(pos,uv,geo);
                posTex=encodePosition(pos);
                float drop=step(1.0 - dropRate, rand(seed));
                `+I.glNames.outColorName+`=mix(posTex,randPos,drop); //avoid floating error
            }
        }
        `,xt=(_=this.layerOptions.count)!==null&&_!==void 0?_:this.planeOptions.count;this.postionProgramInfo=Cx(a,[E,(0,I.injectBuiltInShaderFunctions)(V)]),this.positionTexture=this.createImageTexture(xt,xt,null,a,!1),this.positionBackTexture=this.createImageTexture(xt,xt,new Uint8Array(xt*xt*4),a,!1)}setupParticlesGL(a){var _;const E=I.glNames.header+`
        precision highp float;
        precision highp sampler2D;
        
        `+I.glNames.attrIn+` float idx;
        `+Mi(this._map)+`
        uniform sampler2D posTexture;
        uniform sampler2D preTexture;
        uniform mediump int isPoint;
        uniform float cols; //cols equals rows
        uniform vec4 extent;
        uniform float lineExceedGap;
        uniform float pointSize;
        uniform vec2 reso;
        uniform vec4 xAttr;
        uniform vec4 yAttr;
        uniform vec4 visExtent;
        `+I.glNames.varOut+` vec2 vPos;

        `+dn(this._map)+`

        `+Fr+`

        vec2 getUV(float currentIdx){
            return vec2(
                fract(currentIdx / cols),
                floor(currentIdx / cols)/cols
            );
        }

        $inject

        void main(){
            vec2 uv;
            vec4 posTex;
            vec4 otherTex;
            int used=1;
            if(isPoint==1){
                uv=getUV(idx);
                posTex=`+I.glNames.textureFunc+`(posTexture,uv);
                otherTex=posTex;
            }else{
                if(fract(idx/2.)==0.){
                    float realIdx=idx/2.;
                    uv=getUV(realIdx);
                    posTex=`+I.glNames.textureFunc+`(preTexture,uv);
                    otherTex=`+I.glNames.textureFunc+`(posTexture,uv);
                }else{
                    float realIdx=(idx-1.)/2.;
                    uv=vec2(
                        fract(realIdx / cols),
                        floor(realIdx / cols)/cols);
                    posTex=`+I.glNames.textureFunc+`(posTexture,uv);
                    otherTex=`+I.glNames.textureFunc+`(preTexture,uv);
                }
            }
            vec2 pos=vec2(
                posTex.r / 255.0 + posTex.b,
                posTex.g / 255.0 + posTex.a);
            vec2 pxPos=pos*reso;
            vec2 lonLat=getLonLatFromPx(pxPos);
            if(lonLat.x>visExtent.y || lonLat.x<visExtent.x || lonLat.y>visExtent.w || lonLat.y<visExtent.z){
                gl_Position=vec4(-2.,-2.,0.,1.);
                return;
            }
            if(isPoint==0){
                vec2 otherPos=vec2(
                    otherTex.r / 255.0 + otherTex.b,
                    otherTex.g / 255.0 + otherTex.a);
                vec2 otherPxPos=otherPos*reso;
                vec2 otherLonLat=getLonLatFromPx(otherPxPos);
                if(otherLonLat.x>visExtent.y || otherLonLat.x<visExtent.x || otherLonLat.y>visExtent.w || otherLonLat.y<visExtent.z){
                    gl_Position=vec4(-2.,-2.,0.,1.);
                    return;
                }
                vec2 space=abs(pxPos-otherPxPos);
                if(space.x>=lineExceedGap || space.y>=lineExceedGap){
                    used=0;
                }else{
                    used=1;
                }
            }else{
                used=1;
                gl_PointSize=pointSize;
            }
            vPos=`+I.qeGLFuncs.qe_getLonLatTexPos+`(lonLat,xAttr,yAttr);
            if(vPos.x<0. || vPos.x>1. || vPos.y<0. ||vPos.y>1.){
                used=0;
            }
            if(used==0){
                gl_Position=vec4(-2.,-2.,0.,1.);
                return;
            }
            toClip(pos);
        }
        `,V=I.glNames.header+`
        precision highp float;
        precision highp sampler2D;

        const int stepCount=`+this.steps.length+`;
        uniform float opacityRatio;
        uniform sampler2D uTexture;
        uniform sampler2D vTexture;
        uniform sampler2D preUTexture;
        uniform sampler2D preVTexture;
        uniform bool hasPre;
        uniform vec4 colors[stepCount];
        uniform float steps[stepCount];
        uniform bool hasMask;
        uniform sampler2D maskTexture;
        uniform vec2 reso;
        uniform vec2 retinaReso;
        uniform float minUVSpeed;
        uniform sampler2D ptTexture;
        uniform int usePtTexture;
        `+(0,I.getAlgoConstsAndUniforms)(this.dataSource.getU(),!0)+`
        uniform vec4 xAttr;
        uniform vec4 yAttr;
        uniform int fadeWithSpeed;
        uniform mat4 cardinalSplineMat;
        uniform int interpMethod;
        uniform float percent;
        uniform mediump int isPoint;
        uniform float pointY;

        `+I.glNames.varIn+` vec2 vPos;

        `+I.glNames.outColorDefine+`

        $inject

        void main(){
            if(hasMask && !`+I.qeGLFuncs.qe_maskout+`(retinaReso,maskTexture)){
                discard;
            }
            vec2 u;
            vec2 v;
            if(hasPre){
                u=`+I.qeGLFuncs.qe_interpGridValByUV+`(preUTexture,vPos,xAttr,yAttr,undef,interpMethod,uTexture,percent);
                v=`+I.qeGLFuncs.qe_interpGridValByUV+`(preVTexture,vPos,xAttr,yAttr,undef,interpMethod,vTexture,percent);
            }else{
                u=`+I.qeGLFuncs.qe_readGridValByUV+`(uTexture,vPos,xAttr,yAttr,undef,interpMethod);
                v=`+I.qeGLFuncs.qe_readGridValByUV+`(vTexture,vPos,xAttr,yAttr,undef,interpMethod);
            }
            float speed=sqrt(u.y*u.y+v.y*v.y);
            if(speed<=minUVSpeed){
                discard;
            }
            `+I.glNames.outColorName+"="+I.qeGLFuncs.qe_interpColor+`(speed);
            if(isPoint==1){
                if(pointY<1. && pointY>0. && gl_PointCoord.y>pointY){
                    discard;
                }
                if(usePtTexture==1){
                    float dir=radians(mod(270. - (atan(v.y, u.y) * 180.0) / 3.1415926,360.));
                    float c = cos(dir);
                    float s = sin(dir);
                    vec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,c * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);
                    vec4 ptTex = `+I.glNames.textureFunc+`( ptTexture,  rotatedUV );
                    if(ptTex.a<0.1){
                        discard;
                    }
                    //vec4 ptTex=`+I.glNames.textureFunc+`(ptTexture,gl_PointCoord);
                    `+I.glNames.outColorName+"="+I.glNames.outColorName+`*ptTex;
                }
            }
            if(fadeWithSpeed==1){
                float opacity=max(0.2,min(speed*opacityRatio,1.));
                `+I.glNames.outColorName+`.a=opacity;
            }
        }
        `;this.particleProgramInfo=Cx(a,[(0,I.injectBuiltInShaderFunctions)(E),(0,I.injectBuiltInShaderFunctions)(V)]);const xt=(_=this.layerOptions.count)!==null&&_!==void 0?_:this.planeOptions.count;let vt=xt*xt;const Wt=new Float32Array(vt);for(let Ht=0;Ht<vt;Ht++)Wt[Ht]=Ht;this.particleBufferInfo=px(a,{idx:{numComponents:1,data:Wt}})}setupScreenGL(a){const _=I.glNames.header+`
        `+I.glNames.attrIn+` vec2 pos;
        `+I.glNames.varOut+` vec2 vUV;

        void main(){
            vUV=(pos.xy+1.)/2.;
            gl_Position=vec4(pos,0.,1.0);
        }
        `,E=I.glNames.header+`
        precision highp int;
        precision highp float;
        
        uniform sampler2D screenTexture;
        uniform float opacity;
        uniform float minOpacity;
        
        `+I.glNames.varIn+` vec2 vUV;

        `+I.glNames.outColorDefine+`

        void main(){
            vec4 color=`+I.glNames.textureFunc+`(screenTexture,vUV);
            color=vec4(floor(255.0 * color * opacity) / 255.0);
            // color.a=color.a*opacity;
            if(color.a<minOpacity){
                color.a=0.;
            }
            `+I.glNames.outColorName+`=color;
        }
        `;this.screenProgramInfo=Cx(a,[_,E]),this.quadBufferInfo=px(a,{pos:{numComponents:2,data:this.quadCoords}})}setupGL(a){this.postionProgramInfo&&this.destroyCurrent(a),this.setupPositionGL(a),this.setupScreenGL(a),this.setupParticlesGL(a),this.frameBuffer=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,null),this.timestamp=performance.now()}destroyCurrent(a){this.positionBackTexture&&this.gl.deleteTexture(this.positionBackTexture),this.positionTexture&&this.gl.deleteTexture(this.positionTexture),this.postionProgramInfo&&this.gl.deleteProgram(this.postionProgramInfo.program),this.particleTexture0&&this.gl.deleteTexture(this.particleTexture0),this.particleTexture1&&this.gl.deleteTexture(this.particleTexture1),this.particleProgramInfo&&this.gl.deleteProgram(this.particleProgramInfo.program),this.screenProgramInfo&&this.gl.deleteProgram(this.screenProgramInfo.program),this.deleteBufferInfo(a,this.quadBufferInfo),this.deleteBufferInfo(a,this.particleBufferInfo),this.gl.deleteFramebuffer(this.frameBuffer)}destroyGL(a){this.destroyCurrent(a),super.destroyGL(a)}_createStyleObjectFromStyleOptions(a){return new I.WindLayerStyle(a)}updateVisExtent(a,_,E,V){return{xmin:a,xmax:_,ymin:Math.max(E,-85),ymax:Math.min(V,85)}}updatePositions(a,_,E){var V;a.useProgram(this.postionProgramInfo.program),m0(a,this.postionProgramInfo,this.quadBufferInfo),this.positionUniforms.dropRate=this.drawOptions.dropRate,this.positionUniforms.posTexture=this.positionBackTexture,this.positionUniforms.randSeed=E,this.positionUniforms.uTexture=this.currentTexture,this.positionUniforms.vTexture=this.currentTexture2,this.preTexture?(this.positionUniforms.preUTexture=this.preTexture,this.positionUniforms.preVTexture=this.preTexture2):(delete this.positionUniforms.preUTexture,delete this.positionUniforms.preVTexture),this.positionUniforms.percent=this.dataPercent,this.positionUniforms.hasPre=this.preTexture!==void 0;const xt=this.dataSource.gridOptions;this.positionUniforms.extent=[xt.xStart,xt.xEnd,xt.yStart,xt.yEnd],this.positionUniforms.dt=_,this.positionUniforms.spdFactor=this.drawOptions.speedFactor,un(this._map,this.positionUniforms,this.gridExt,this.pxBounds);let vt=this.dataExtent;this.positionUniforms.visExtent=[vt.xmin,vt.xmax,vt.ymin,vt.ymax],this.positionUniforms.xAttr=this.xAttr,this.positionUniforms.yAttr=this.yAttr,this.positionUniforms.interpMethod=this.drawOptions.interpMethod,this.positionUniforms.cardinalSplineMat=this.splineMat;const Wt=(V=this.layerOptions.count)!==null&&V!==void 0?V:this.planeOptions.count;this.positionUniforms.reso=[Wt,Wt],this.positionUniforms.scReso=[this._canvas.clientWidth,this._canvas.clientHeight],this.drawOptions.speedFitZoom?this.positionUniforms.zoom=this._map.getZoom():this.positionUniforms.zoom=1,(0,I.setDirectAlgoUniforms)(this.currentGrid,this.positionUniforms),ti(this.postionProgramInfo,this.positionUniforms),fx(a,this.quadBufferInfo),a.finish()}updateScreenQuad(a,_,E){a.useProgram(this.screenProgramInfo.program),m0(a,this.screenProgramInfo,this.quadBufferInfo),this.screenUniforms.screenTexture=_,this.screenUniforms.opacity=E,this.screenUniforms.minOpacity=this.drawOptions.minOpacity,ti(this.screenProgramInfo,this.screenUniforms),fx(a,this.quadBufferInfo),a.finish()}updateParticles(a){var _;a.useProgram(this.particleProgramInfo.program),m0(a,this.particleProgramInfo,this.particleBufferInfo),un(this._map,this.particleUniforms,this.gridExt,this.pxBounds),this.particleUniforms.posTexture=this.positionTexture,this.particleUniforms.preTexture=this.positionBackTexture,this.particleUniforms.isPoint=this.drawOptions.usePoint?1:0,this.particleUniforms.pointY=this.drawOptions.pointDropPosY,this.particleUniforms.cols=(_=this.layerOptions.count)!==null&&_!==void 0?_:this.planeOptions.count;const E=this.dataSource.gridOptions;this.particleUniforms.extent=[E.xStart,E.xEnd,E.yStart,E.yEnd],this.particleUniforms.xAttr=this.xAttr,this.particleUniforms.yAttr=this.yAttr;let V=this.dataExtent;this.particleUniforms.visExtent=[V.xmin,V.xmax,V.ymin,V.ymax],this.particleUniforms.lineExceedGap=this.layerOptions.lineMaxDistance,this.particleUniforms.pointSize=this.drawOptions.pointSize,this.particleUniforms.opacityRatio=1/this.drawOptions.fadeSpeedMax,this.particleUniforms.uTexture=this.currentTexture,this.preTexture?(this.particleUniforms.preUTexture=this.preTexture,this.particleUniforms.preVTexture=this.preTexture2):(delete this.particleUniforms.preUTexture,delete this.particleUniforms.preVTexture),this.particleUniforms.vTexture=this.currentTexture2,this.particleUniforms.hasPre=this.preTexture!==void 0,this.particleUniforms.colors=this.colors,this.particleUniforms.steps=this.steps,this.particleUniforms.hasMask=this.hasMask,this.particleUniforms.maskTexture=this.maskFrameInfo.attachments[0],this.particleUniforms.reso=[this._canvas.clientWidth,this._canvas.clientHeight],this.particleUniforms.retinaReso=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight],this.particleUniforms.minUVSpeed=this.drawOptions.minSpeed,this.ptTexture?this.particleUniforms.ptTexture=this.ptTexture:delete this.particleUniforms.ptTexture,this.particleUniforms.usePtTexture=this.ptTexture===void 0?0:1,(0,I.setDirectAlgoUniforms)(this.currentGrid,this.particleUniforms),this.particleUniforms.fadeWithSpeed=this.drawOptions.fadeWithSpeed?1:0,this.particleUniforms.cardinalSplineMat=this.splineMat,this.particleUniforms.interpMethod=this.drawOptions.interpMethod,this.particleUniforms.percent=this.dataPercent,ti(this.particleProgramInfo,this.particleUniforms);const xt=this.drawOptions.usePoint?a.POINTS:a.LINES;fx(a,this.particleBufferInfo,xt),a.finish()}_reset(){this.updateMapBounds(),this.particleTexture0=void 0,this.particleTexture1=void 0,this.dirty=!0,super._reset()}_resize(a){this.particleTexture0=void 0,this.particleTexture1=void 0,super._resize(a)}onRedraw(a){var _;this._pixelLayer._sizeChanged=this._sizeChanged;const E=this.gl;if(!this.particleTexture1){const Ht=new Uint8Array(E.drawingBufferWidth*E.drawingBufferHeight*4);this.particleTexture1=this.createImageTexture(E.drawingBufferWidth,E.drawingBufferHeight,Ht,E,!1)}if(this.particleTexture0||(this.particleTexture0=this.createImageTexture(E.drawingBufferWidth,E.drawingBufferHeight,null,E,!1)),this.ptTexture&&this.ptTextureDirty&&(E.deleteTexture(this.ptTexture),this.ptTexture=void 0),this.ptTextureDirty=!1,this.drawOptions.texture&&!this.ptTexture&&(this.ptTexture=this.createImageTexture(this.drawOptions.texture.width,this.drawOptions.texture.height,this.drawOptions.texture,E,!0)),this.moving)return;E.disable(E.BLEND),E.bindFramebuffer(E.FRAMEBUFFER,this.frameBuffer);const V=(_=this.layerOptions.count)!==null&&_!==void 0?_:this.planeOptions.count;this.dirty&&(E.viewport(0,0,V,V),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.positionTexture,0),E.clear(E.COLOR_BUFFER_BIT),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.positionBackTexture,0),E.clear(E.COLOR_BUFFER_BIT),E.viewport(0,0,E.drawingBufferWidth,E.drawingBufferHeight),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.particleTexture0,0),E.clear(E.COLOR_BUFFER_BIT),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.particleTexture1,0),E.clear(E.COLOR_BUFFER_BIT),this.dirty=!1),E.viewport(0,0,V,V),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.positionTexture,0);const xt=(performance.now()-this.timestamp)/1e3;this.timestamp=performance.now();const vt=Math.random();this.updatePositions(E,xt,vt),E.viewport(0,0,E.drawingBufferWidth,E.drawingBufferHeight),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.particleTexture0,0),this.updateScreenQuad(E,this.particleTexture1,this.drawOptions.fadeRate),this.updateParticles(E),E.enable(E.BLEND),this.drawOptions.mixColor?E.blendFunc(E.SRC_ALPHA,E.DST_ALPHA):E.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA),E.bindFramebuffer(E.FRAMEBUFFER,null),E.viewport(0,0,E.drawingBufferWidth,E.drawingBufferHeight),this.updateScreenQuad(E,this.particleTexture0,1);let Wt=this.particleTexture0;this.particleTexture0=this.particleTexture1,this.particleTexture1=Wt,Wt=this.positionBackTexture,this.positionBackTexture=this.positionTexture,this.positionTexture=Wt}}Zn.DefaultOptions={loop:!0},Zn.qeName="l_wind",I.layerCreator.register(Zn);class Bi extends F().GridLayer{constructor(a){super((0,I.setOptions)({},a,Bi.DefaultOptions)),this.layerOptions={},this.dataPercent=0,this.emptyTexture=I.consts.useWebGL2?{}:void 0,this._visible=!0,this.vShaderCommon=`
    `+I.glNames.attrIn+` vec2 aVertexCoords;
    `+I.glNames.attrIn+` vec2 aTextureCoords;
    `+I.glNames.attrIn+` vec2 aCRSCoords;
    `+I.glNames.attrIn+` vec2 aLatLngCoords;
    `+I.glNames.varOut+` vec2 vTextureCoords;
    `+I.glNames.varOut+` vec2 vCRSCoords;
    `+I.glNames.varOut+` vec2 vLatLngCoords;
    `,this.vShaderSetPostionAndVaryings=`
        gl_Position = vec4(aVertexCoords , 1.0, 1.0);
		vTextureCoords = aTextureCoords;
		vCRSCoords = aCRSCoords;
		vLatLngCoords = aLatLngCoords;
    `,this.fShaderCommon=`
        precision highp float;
		`+I.glNames.varIn+` vec2 vTextureCoords;
		`+I.glNames.varIn+` vec2 vCRSCoords;
		`+I.glNames.varIn+` vec2 vLatLngCoords;
    `,this.cachedContexts={},this.updateTDataPercent=()=>{this.dataPercent=this.dataSource.currentTIdx-this.dataSource.getIntTIdx(),this.layerOptions.interpFromPreSource&&this._redraw()},this.updateZDataPercent=()=>{this.dataPercent=this.dataSource.currentZIdx-this.dataSource.getIntZIdx(),this.layerOptions.interpFromPreSource&&this._redraw()},this.transferCurrentData=()=>{const _=this.preTexture,E=this.preTexture2;this.preTexture&&(this.preGrid=void 0),this.preTexture2&&(this.preGrid2=void 0),this.layerOptions.interpFromPreSource&&(this.preGrid=this.currentGrid,this.preTexture=this.currentTexture,this.dataPercent=0,this.preGrid2=this.currentGrid2,this.preTexture2=this.currentTexture2,this.currentTexture=_,this.currentTexture2=E),this.dataSource.getU?this.dataSource.defaultGrid==="speed"?(this.currentGrid=this.dataSource.getS(),this.currentGrid2=this.dataSource.getD()):(this.currentGrid=this.dataSource.getU(),this.currentGrid2=this.dataSource.getV()):this.currentGrid=this.dataSource.getGrid(),this.textureDirty=!0,this._redraw()},this.setLayerOptions((0,I.setOptions)({},a,Bi.DefaultOptions),!1)}setVisible(a){return this._visible===a||(this._visible=a,this.layerOptions.loop||this._redraw()),this}isVisible(){return this._visible}createTile(a){const _=F().DomUtil.create("canvas","leaflet-tile");_.width=this.renderer.width,_.height=this.renderer.height,_.onselect=_.onmousemove=F().Util.falseFn;const E=_.getContext("2d");return this.cachedContexts[this.unwrappedKey]=E,this.renderTile(a),E.drawImage(this.renderer,0,0),_}_addTile(a,_){this.unwrappedKey=this._tileCoordsToKey(a),super._addTile(a,_)}_removeTile(a){delete this.cachedContexts[a],super._removeTile(a)}deleteFrameBufferInfo(a,_){if(_){a.deleteFramebuffer(_.framebuffer);for(const E of _.attachments)E instanceof WebGLRenderbuffer?a.deleteRenderbuffer(E):a.deleteTexture(E)}}deleteBufferInfo(a,_){if(_){for(const E of Object.values(_.attribs))a.deleteBuffer(E.buffer);_.indices&&a.deleteBuffer(_.indices)}}destroyGL(a){this.preTexture&&a.deleteTexture(this.preTexture),this.preTexture2&&a.deleteTexture(this.preTexture2),this.currentTexture&&a.deleteTexture(this.currentTexture),this.currentTexture2&&a.deleteTexture(this.currentTexture2);const _=this.gl.getExtension("WEBGL_lose_context");_&&_.loseContext()}_redraw(){var a,_;if(!(this.dataSource&&this.drawOptions&&this._map&&this.gl))return;const E=performance.now();for(const V in this._tiles){const xt=this._tiles[V],vt=this._keyToTileCoords(V);xt.current&&xt.loaded&&(this.renderTile(vt),(a=this.cachedContexts[V])===null||a===void 0||a.clearRect(0,0,this.renderer.width,this.renderer.height),(_=this.cachedContexts[V])===null||_===void 0||_.drawImage(this.renderer,0,0))}this.layerOptions.debugShowPerformance&&I.logger.debug("redraw "+Object.keys(this._tiles).length+" tiles costs "+(performance.now()-E)+" ms")}renderTile(a){if(!this._visible)return;this.checkDataTexture();const _=this._tileCoordsToBounds(a),E=_.getWest(),V=_.getEast(),xt=_.getNorth(),vt=_.getSouth(),Wt=[V,xt,E,xt,V,vt,E,vt],Ht=this._map.options.crs,Gt=Ht.project(F().latLng(vt,E)),Xt=Ht.project(F().latLng(xt,V)),Ft=[Xt.x,Xt.y,Gt.x,Xt.y,Xt.x,Gt.y,Gt.x,Gt.y];Hr(this.gl,this.posBufferInfo.attribs.aLatLngCoords,Wt),Hr(this.gl,this.posBufferInfo.attribs.aCRSCoords,Ft),this.onRenderTile(a,_)}setup(){if(!this.renderer){this.renderer=F().DomUtil.create("canvas");const a=this.getTileSize();this.renderer.width=a.x,this.renderer.height=a.y,this.gl=I.consts.useWebGL2?this.renderer.getContext("webgl2",{preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer}):this.renderer.getContext("webgl",{preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer}),gs(this.gl);const _=new Float32Array(8),E=new Float32Array([1,1,-1,1,1,-1,-1,-1]),V=new Float32Array([1,0,0,0,1,1,0,1]),xt=new Float32Array(8);this.posBufferInfo=px(this.gl,{aVertexCoords:{numComponents:2,data:E},aTextureCoords:{numComponents:2,data:V},aCRSCoords:{numComponents:2,data:_},aLatLngCoords:{numComponents:2,data:xt}})}this.setupGL(this.gl)}parseNumberStopRules(a){const _=a.getStops(),E=a.getVals(),V=[];for(const vt of _)V.push(parseFloat(vt));const xt=[];for(const vt of E)xt.push(parseFloat(vt));return{numbers:V,steps:xt}}parseColorStopRules(a){const _=a.getStops(),E=a.getVals(),V=[];for(const vt of _){const Wt=vt;V.push(Wt.red()/255,Wt.green()/255,Wt.blue()/255,Wt.alpha())}const xt=[];for(const vt of E)xt.push(parseFloat(vt));return{colors:V,steps:xt}}loop(){this.redraw(),this.animFrame=F().Util.requestAnimFrame(this.loop,this)}redraw(){return this._redraw(),this}onAdd(a){return this.posBufferInfo||this.setup(),super.onAdd(a),this.animFrame&&F().Util.cancelAnimFrame(this.animFrame),this.layerOptions.loop&&(this.animFrame=F().Util.requestAnimFrame(this.loop,this)),this._map.on(Jt.EventTypes.themeChanged,this.onThemeChanged,this),this}setLayerOptions(a,_=!0){var E,V;const xt=(E=this.layerOptions)===null||E===void 0?void 0:E.trackDataSource;typeof a=="string"?(this.layerOptions=(V=I.resourceService.getResource(a))===null||V===void 0?void 0:V.instance,this.layerOptions||I.logger.error("图层属性资源"+a+"不存在！")):_&&this.layerOptions?(0,I.setOptions)(this.layerOptions,a):((0,I.setOptions)(this.layerOptions,a,Bi.DefaultOptions),this.layerOptions.name=(0,I.defaultVal)(this.layerOptions.name,(0,I.uid)())),xt!=this.layerOptions.trackDataSource&&this.dataSource&&(this.unsetDataSourceListener(),this.setDataSourceListener()),this.redraw()}onRemove(a){return super.onRemove(a),this._map.off(Jt.EventTypes.themeChanged,this.onThemeChanged,this),this.animFrame&&F().Util.cancelAnimFrame(this.animFrame),this.destroy(),this.dataSource&&this.unsetDataSourceListener(),this}destroy(){this.destroyGL(this.gl)}setDataSource(a){if(a)return this.dataSource&&this.dataSource!==a&&(this.unsetDataSourceListener(),this.dataPercent=0,this.preGrid=void 0,this.gl&&this.preTexture&&this.gl.deleteTexture(this.preTexture),this.gl&&this.preTexture2&&this.gl.deleteTexture(this.preTexture2),this.preTexture=void 0,this.preTexture2=void 0,this.textureDirty=!0),this.dataSource&&this.dataSource===a||(this.dataSource=a,this.setDataSourceListener(),this.dataSource.getU?this.dataSource.defaultGrid==="speed"?(this.currentGrid=this.dataSource.getS(),this.currentGrid2=this.dataSource.getD()):(this.currentGrid=this.dataSource.getU(),this.currentGrid2=this.dataSource.getV()):this.currentGrid=this.dataSource.getGrid()),this;I.logger.warn("数据源为空，无法更新！")}reinit(){return this.gl&&(this.setupGL(this.gl),this._redraw()),this}setDrawOptions(a,_=!0){return typeof a=="string"&&(this._theme=a,a=a.indexOf(I.consts.fieldLoaderIndicator)>0?(0,I.processFieldWithLoaders)(a):I.resourceService.getResource(a).instance),typeof a!="object"||a instanceof I.GridGLBaseStyle?this.drawOptions=a:_&&this.drawOptions?this.drawOptions.update(a):this.drawOptions=this._createStyleObjectFromStyleOptions(a),this.drawOptions&&(this._planeOptions=this.drawOptions.getPlaneOptions(void 0,this.layerOptions.cacheDrawOptions)),this}clearPreDataSource(){this.gl&&this.gl.deleteTexture(this.preTexture),this.gl&&this.gl.deleteTexture(this.preTexture2),this.preTexture=void 0,this.preTexture2=void 0,this.preGrid=void 0,this.preGrid2=void 0,this.dataPercent=0}onThemeChanged(a){var _;if(!this._map||!this._theme)return;const E=this._theme.split(I.consts.themeIndicator),V=E.length===1?"":E[1],xt=(_=a.msg.newTheme)!==null&&_!==void 0?_:"";if(V==xt)return;const vt=E[0]+"@"+xt;this.setDrawOptions(vt,!1)}unsetDataSourceListener(){this.dataSource.offTChanged(this.updateTDataPercent),this.dataSource.offZChanged(this.updateZDataPercent),this.dataSource.offIntTZChanged(this.transferCurrentData),this.dataSource.offActiveGridUpdated(this.transferCurrentData)}setDataSourceListener(){this.layerOptions.trackDataSource&&(this.dataSource.onTChanged(this.updateTDataPercent),this.dataSource.onZChanged(this.updateZDataPercent),this.dataSource.onIntTZChanged(this.transferCurrentData),this.dataSource.onActiveGridUpdated(this.transferCurrentData))}createImageTexture(a,_,E,V,xt=!1){const vt=V.createTexture();return V.bindTexture(V.TEXTURE_2D,vt),xt?V.texImage2D(V.TEXTURE_2D,0,V.RGBA,V.RGBA,V.UNSIGNED_BYTE,E):V.texImage2D(V.TEXTURE_2D,0,V.RGBA,a,_,0,V.RGBA,V.UNSIGNED_BYTE,E||null),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.NEAREST),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.NEAREST),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),vt}createDataTexture(a){let _;if(a instanceof I.GrayImageGridData)_=Di(this.gl,{width:a.xSize,height:a.ySize,format:this.gl.RGBA,internalFormat:this.gl.RGBA,type:this.gl.UNSIGNED_BYTE,min:this.gl.NEAREST,mag:this.gl.NEAREST,src:a.imageSource,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,flipY:0});else{const E=this.getGLDataInfo(a);_=Di(this.gl,{width:a.xSize,height:a.ySize,min:this.gl.NEAREST,mag:this.gl.NEAREST,format:E.pixelFormat,internalFormat:E.innerFormat,type:E.dataType,src:E.rawData,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,flipY:0})}return _}getGLDataInfo(a){const _=a.dataType!==I.GridDataType.UInt8&&I.consts.useWebGL2?this.gl.RED:this.gl.ALPHA;let E=a.dataType===I.GridDataType.UInt8?this.gl.UNSIGNED_BYTE:this.gl.FLOAT,V=_,xt=a.dataType===I.GridDataType.UInt8||a.dataType===I.GridDataType.Float32?a.raw:new Float32Array(a.raw);return _===this.gl.RED&&(V=this.gl.R32F),{rawData:xt,dataType:E,innerFormat:V,pixelFormat:_}}updateTexture(a,_){const E=performance.now();if(_ instanceof I.GrayImageGridData)Un(this.gl,a,_.imageSource);else{const V=this.getGLDataInfo(_);Fn(this.gl,a,V.rawData)}this.layerOptions.debugShowPerformance&&I.logger.debug("update texture costs "+(performance.now()-E)+"ms")}checkDataTexture(){this.currentGrid?this.currentTexture?this.textureDirty&&(this.updateTexture(this.currentTexture,this.currentGrid),this.currentGrid2&&this.updateTexture(this.currentTexture2,this.currentGrid2),this.textureDirty=!1):(this.currentTexture=this.createDataTexture(this.currentGrid),this.currentGrid2&&(this.currentTexture2=this.createDataTexture(this.currentGrid2))):I.logger.warn("当前数据源为空！")}}Bi.DefaultOptions={trackDataSource:!0,cacheDrawOptions:!0,interpFromPreSource:!1,preserveDrawingBuffer:!1,loop:!1,tileSize:512};class fn extends F().GridLayer{constructor(a){super((0,I.setOptions)({},a,fn.DefaultOptions)),this.layerOptions=(0,I.setOptions)({},a,fn.DefaultOptions)}setup(){var a,_,E;let V;this._renderer=F().DomUtil.create("canvas"),typeof this.layerOptions.tileSize=="number"?this._renderer.width=this._renderer.height=this.layerOptions.tileSize:(this._renderer.width=this.layerOptions.tileSize.x,this._renderer.height=this.layerOptions.tileSize.y),this._glError=!1,I.consts.useWebGL2?this._gl=this._renderer.getContext("webgl2",{preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer,premultipliedAlpha:!1}):this._gl=this._renderer.getContext("webgl",{premultipliedAlpha:!1,preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer})||this._renderer.getContext("experimental-webgl",{premultipliedAlpha:!1,preserveDrawingBuffer:this.layerOptions.preserveDrawingBuffer}),V=this._gl,this._tileLayers=Array.from(this.layerOptions.tileLayers);for(var xt=0;xt<((a=this.layerOptions.tileUrls)===null||a===void 0?void 0:a.length)&&xt<8;xt++)((_=this.layerOptions.tileOptions)===null||_===void 0?void 0:_.length)===((E=this.layerOptions.tileUrls)===null||E===void 0?void 0:E.length)?this._tileLayers.push(F().tileLayer(this.layerOptions.tileUrls[xt],this.layerOptions.tileOptions[xt])):this._tileLayers.push(F().tileLayer(this.layerOptions.tileUrls[xt]));for(this._loadGLProgram(),this._textures=[],xt=0;xt<this._tileLayers.length&&xt<8;xt++)this._textures[xt]=V.createTexture(),V.uniform1i(V.getUniformLocation(this._glProgram,"uTexture"+xt),xt)}_loadGLProgram(){const a=this._gl;for(var _=I.glNames.header+`
`+I.glNames.attrIn+` vec2 aVertexCoords;  
`+I.glNames.attrIn+` vec2 aTextureCoords;  
`+I.glNames.attrIn+` vec2 aCRSCoords;  
`+I.glNames.attrIn+` vec2 aLatLngCoords;  
`+I.glNames.varOut+` vec2 vTextureCoords;  
`+I.glNames.varOut+` vec2 vCRSCoords;  
`+I.glNames.varOut+` vec2 vLatLngCoords;  
void main(void) {  
	gl_Position = vec4(aVertexCoords , 1.0, 1.0);  
	vTextureCoords = aTextureCoords;  
	vCRSCoords = aCRSCoords;  
	vLatLngCoords = aLatLngCoords;  
}`,E=I.glNames.header+`
precision highp float;
uniform float uNow;
uniform vec3 uTileCoords;
`+I.glNames.varIn+` vec2 vTextureCoords;
`+I.glNames.varIn+` vec2 vCRSCoords;
`+I.glNames.varIn+` vec2 vLatLngCoords;
`,V=0;V<this._tileLayers.length&&V<8;V++)E+="uniform sampler2D uTexture"+V+`;
`;E+=this._getUniformSizes();var xt=this._glProgram=a.createProgram(),vt=a.createShader(a.VERTEX_SHADER),Wt=a.createShader(a.FRAGMENT_SHADER);return a.shaderSource(vt,_),E+=`
        `+I.glNames.outColorDefine+`

        vec4 getRes(vec4 color){
            `+this.layerOptions.colorShader+`
            return color;
        }

        void main(){
            vec4 texColor = `+I.glNames.textureFunc+`(uTexture0, vec2(vTextureCoords.s, vTextureCoords.t));
            `+I.glNames.outColorName+`=getRes(texColor);
        }
        `,a.shaderSource(Wt,E),a.compileShader(vt),a.compileShader(Wt),a.getShaderParameter(vt,a.COMPILE_STATUS)?a.getShaderParameter(Wt,a.COMPILE_STATUS)?(a.attachShader(xt,vt),a.attachShader(xt,Wt),a.linkProgram(xt),a.useProgram(xt),this._aVertexPosition=a.getAttribLocation(xt,"aVertexCoords"),this._aTexPosition=a.getAttribLocation(xt,"aTextureCoords"),this._aCRSPosition=a.getAttribLocation(xt,"aCRSCoords"),this._aLatLngPosition=a.getAttribLocation(xt,"aLatLngCoords"),this._initUniforms(xt),this._isReRenderable&&(this._fetchedTextures={},this._2dContexts={}),this._CRSBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this._CRSBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(8),a.STATIC_DRAW),this._aCRSPosition!==-1&&(a.enableVertexAttribArray(this._aCRSPosition),a.vertexAttribPointer(this._aCRSPosition,2,a.FLOAT,!1,8,0)),this._LatLngBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this._LatLngBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(8),a.STATIC_DRAW),this._aLatLngPosition!==-1&&(a.enableVertexAttribArray(this._aLatLngPosition),a.vertexAttribPointer(this._aLatLngPosition,2,a.FLOAT,!1,8,0)),this._TexCoordsBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this._TexCoordsBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),a.STATIC_DRAW),this._aTexPosition!==-1&&(a.enableVertexAttribArray(this._aTexPosition),a.vertexAttribPointer(this._aTexPosition,2,a.FLOAT,!1,8,0)),this._VertexCoordsBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this._VertexCoordsBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),a.STATIC_DRAW),void(this._aVertexPosition!==-1&&(a.enableVertexAttribArray(this._aVertexPosition),a.vertexAttribPointer(this._aVertexPosition,2,a.FLOAT,!1,8,0)))):(this._glError=a.getShaderInfoLog(Wt),console.error(this._glError),null):(this._glError=a.getShaderInfoLog(vt),console.error(this._glError),null)}_getUniformSizes(){var a="";for(var _ in this._uniformSizes={},this.layerOptions.uniforms){var E=this.layerOptions.uniforms[_];if(typeof E=="number")this._uniformSizes[_]=0,a+="uniform float "+_+`;
`;else{if(!(E instanceof Array))throw new Error("Default value for uniforms must be either number or array of numbers");if(E.length>4)throw new Error("Max size for uniform value is 4 elements");this._uniformSizes[_]=E.length,E.length===1?a+="uniform float "+_+`;
`:a+="uniform vec"+E.length+" "+_+`;
`}}return a}_initUniforms(a){var _=this._gl;for(var E in this._uTileCoordsPosition=_.getUniformLocation(a,"uTileCoords"),this._uNowPosition=_.getUniformLocation(a,"uNow"),this._isReRenderable=!1,this._uNowPosition&&(_.uniform1f(this._uNowPosition,performance.now()),this._isReRenderable=!0),this._uniformLocations={},this.layerOptions.uniforms)this._uniformLocations[E]=_.getUniformLocation(a,E),this.setUniform(E,this.layerOptions.uniforms[E]),this._isReRenderable=!0}_render(a){var _=this._gl;_.viewport(0,0,_.drawingBufferWidth,_.drawingBufferHeight),_.clearColor(.5,.5,.5,0),_.enable(_.BLEND);var E=this._tileCoordsToBounds(a),V=E.getWest(),xt=E.getEast(),vt=E.getNorth(),Wt=E.getSouth(),Ht=[xt,vt,V,vt,xt,Wt,V,Wt];_.bindBuffer(_.ARRAY_BUFFER,this._LatLngBuffer),_.bufferData(_.ARRAY_BUFFER,new Float32Array(Ht),_.STATIC_DRAW);var Gt=this._map.options.crs,Xt=Gt.project(F().latLng(Wt,V)),Ft=Gt.project(F().latLng(vt,xt)),te=[Ft.x,Ft.y,Xt.x,Ft.y,Ft.x,Xt.y,Xt.x,Xt.y];_.bindBuffer(_.ARRAY_BUFFER,this._CRSBuffer),_.bufferData(_.ARRAY_BUFFER,new Float32Array(te),_.STATIC_DRAW),_.uniform3f(this._uTileCoordsPosition,a.x,a.y,a.z),_.drawArrays(_.TRIANGLE_STRIP,0,4)}_bindTexture(a,_){var E=this._gl;E.activeTexture(E.TEXTURE0+a),E.bindTexture(E.TEXTURE_2D,this._textures[a]),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,_),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR_MIPMAP_NEAREST),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.generateMipmap(E.TEXTURE_2D)}_addTile(a,_){this._unwrappedKey=this._tileCoordsToKey(a),super._addTile(a,_)}createTile(a,_){var E=F().DomUtil.create("canvas","leaflet-tile");E.width=this._gl.canvas.width,E.height=this._gl.canvas.height,E.onselectstart=E.onmousemove=F().Util.falseFn;for(var V=E.getContext("2d"),xt=this._unwrappedKey,vt=[],Wt=0;Wt<this._tileLayers.length&&Wt<8;Wt++)vt.push(this._getNthTile(Wt,a));return Promise.all(vt).then((function(Ht){if(this._map){if(this._isReRenderable){var Gt=this._tileCoordsToKey(a);this._fetchedTextures[Gt]=Ht,this._2dContexts[xt]=V}this._gl;for(var Xt=0;Xt<this._tileLayers.length&&Xt<8;Xt++)this._bindTexture(Xt,Ht[Xt]);this._render(a),V.drawImage(this._renderer,0,0),_()}}).bind(this),(function(Ht){F().TileLayer.prototype._tileOnError.call(this,_,E,Ht)}).bind(this)).catch(I.logger.debug),E}_removeTile(a){this._isReRenderable&&(delete this._fetchedTextures[a],delete this._2dContexts[a]),F().TileLayer.prototype._removeTile.call(this,a)}_onFrame(){this._uNowPosition&&this._map&&(this.reRender(),this._animFrame=F().Util.requestAnimFrame(this._onFrame,this,!1))}reRender(){if(this._isReRenderable){var a=this._gl;for(var _ in a.uniform1f(this._uNowPosition,performance.now()),this._tiles){var E=this._tiles[_],V=this._keyToTileCoords(_),xt=this._tileCoordsToKey(this._wrapCoords(V));if(E.current&&E.loaded&&this._fetchedTextures[xt]){for(var vt=0;vt<this._tileLayers.length&&vt<8;vt++)this._bindTexture(vt,this._fetchedTextures[xt][vt]);this._render(V),this._2dContexts[_].drawImage(this._renderer,0,0)}}}}setUniform(a,_){switch(this._uniformSizes[a]){case 0:this._gl.uniform1f(this._uniformLocations[a],_);break;case 1:this._gl.uniform1fv(this._uniformLocations[a],_);break;case 2:this._gl.uniform2fv(this._uniformLocations[a],_);break;case 3:this._gl.uniform3fv(this._uniformLocations[a],_);break;case 4:this._gl.uniform4fv(this._uniformLocations[a],_)}}_getNthTile(a,_){var E=this._tileLayers[a];return E._tileZoom=this._tileZoom,E._map=this._map,E._crs=this._map.options.crs,E._globalTileRange=this._globalTileRange,new Promise((function(V,xt){var vt=document.createElement("img");vt.crossOrigin="",vt.src=E.getTileUrl(_),F().DomEvent.on(vt,"load",V.bind(this,vt)),F().DomEvent.on(vt,"error",xt.bind(this,vt))}).bind(this))}getGlError(){return this._glError}onAdd(a){return this.setup(),this._uNowPosition&&(F().Util.cancelAnimFrame(this._animFrame),this._animFrame=F().Util.requestAnimFrame(this._onFrame,this)),F().TileLayer.prototype.onAdd.call(this,a),this}onRemove(a){super.onRemove(a),F().Util.cancelAnimFrame(this._animFrame),F().TileLayer.prototype.onRemove.call(this,a),this._gl.deleteBuffer(this._LatLngBuffer),this._gl.deleteBuffer(this._CRSBuffer),this._gl.deleteBuffer(this._TexCoordsBuffer),this._gl.deleteBuffer(this._VertexCoordsBuffer);for(const E of this._textures)this._gl.deleteTexture(E);this._gl.deleteProgram(this._glProgram);const _=this._gl.getExtension("WEBGL_lose_context");return _&&_.loseContext(),this}}fn.DefaultOptions={tileUrls:[],tileLayers:[],colorShader:"",uniforms:{},tileOptions:[],tileSize:256,preserveDrawingBuffer:!1};class Ui extends yx{constructor(a){super((0,I.setOptions)({},a,Ui.DefaultOptions))}clearPreDataSource(){}_createStyleObjectFromStyleOptions(a){return new I.PixelLayerStyle(a)}drawBitmap(a,_,E,V,xt){let vt=0;for(let Wt=_.y;Wt<=E.y;Wt++){const Ht=this._map.containerPointToLatLng(F().point(_.x,Wt)),Gt=this._map.containerPointToLatLng(F().point(_.x+1,Wt)).lng-Ht.lng;let Xt=Ht.lng;const Ft=(0,I.getGridPosIndex)(a.yStart,a.yDelta,Ht.lat);for(let te=_.x;te<=E.x;te++){const zt=(0,I.getGridPosIndex)(a.xStart,a.xDelta,Xt),ve=V.getPos(Ft,zt);let ye=V.read1D(ve);if(Xt+=Gt,isNaN(ye)||ye===void 0||V.isUndef(ye)){vt+=4;continue}const we=this.drawOptions.fillColor.getRule(ye).stop;xt[vt++]=we.red(),xt[vt++]=we.green(),xt[vt++]=we.blue(),xt[vt++]=255*we.alpha()}}}drawBIInterp(a,_,E,V,xt,vt){let Wt=0;const Ht=Math.abs(a.xDelta);Math.abs(a.yDelta);for(let Gt=_.y;Gt<=E.y;Gt++){const Xt=this._map.containerPointToLatLng(F().point(_.x,Gt)),Ft=this._map.containerPointToLatLng(F().point(_.x+1,Gt)).lng-Xt.lng;let te=Xt.lng;const zt=(0,I.getGridPosIndex)(a.yStart,a.yDelta,Xt.lat),ve=a.yStart+a.yDelta*zt,ye=(Xt.lat-ve)/a.yDelta;let we=Gt!==_.y&&Gt!==E.y;for(let Ee=_.x;Ee<=E.x;Ee++){const ze=(0,I.getGridPosIndex)(a.xStart,a.xDelta,te),Be=V.getPos(zt,ze);let e0=V.read1D(Be);if(isNaN(e0)||e0===void 0||V.isUndef(e0)){Wt+=4,te+=Ft;continue}if(we&&Ee!==_.x&&Ee!==E.x){const Ye=V.read1D(Be+1);if(!V.isUndef(Ye)){const d0=V.getPos(zt+1,ze),b0=V.read1D(d0);if(!V.isUndef(b0)){const O0=V.read1D(d0+1);if(!V.isUndef(O0)){const T0=(te-(a.xStart+a.xDelta*ze))/Ht;e0=(e0*(1-T0)+Ye*T0)*(1-ye)+(b0*(1-T0)+O0*T0)*ye}}}}te+=Ft;let He=this.drawOptions.fillColor.getRule(e0),a0=He.stop;if(vt&&He.idx>0){const Ye=this.drawOptions.fillColor.stops[He.idx-1];if(Ye.stop!==a0){let d0=(e0-Ye.value)/(He.value-Ye.value);a0=(0,I.pickColor)(a0,Ye.stop,d0,a0.alpha())}}xt[Wt++]=a0.red(),xt[Wt++]=a0.green(),xt[Wt++]=a0.blue(),xt[Wt++]=255*a0.alpha()}}}onRedraw(a){if(!this.dataSource||!this.drawOptions||this.drawOptions.fillMode===I.GridDataGLFillMode.none)return;const _=this.dataSource.gridOptions,E=Math.max(_.yStart,_.yEnd),V=Math.min(_.yStart,_.yEnd),xt=Math.max(_.xStart,_.xEnd),vt=[E,Math.min(_.xStart,_.xEnd)],Wt=[V,xt],Ht=this._map.latLngToContainerPoint(vt),Gt=this._map.latLngToContainerPoint(Wt),Xt=a.canvas.width,Ft=a.canvas.height;if(Ht.x>Xt||Ht.y>Ft||Gt.x<0||Gt.y<0)return;Ht.x=Math.max(Ht.x,0),Ht.y=Math.max(Ht.y,0),Gt.x=Math.min(Gt.x,Xt),Gt.y=Math.min(Gt.y,Ft);let te=this.dataSource.getGrid();const zt=this.dataSource.gridOptions,ve=a.canvas.getContext("2d"),ye=Gt.x-Ht.x+1,we=Gt.y-Ht.y+1,Ee=ve.getImageData(Ht.x,Ht.y,ye,we),ze=Ee.data;this.drawOptions.fillMode===I.GridDataGLFillMode.bitmap?this.drawBitmap(zt,Ht,Gt,te,ze):this.drawOptions.fillMode!==I.GridDataGLFillMode.pixel1&&this.drawOptions.fillMode!==I.GridDataGLFillMode.shaded1||this.drawBIInterp(zt,Ht,Gt,te,ze,this.drawOptions.fillMode===I.GridDataGLFillMode.pixel1),ve.putImageData(Ee,Ht.x,Ht.y)}}Ui.DefaultOptions={trackDataSource:!0,cacheDrawOptions:!1,interpFromPreSource:!1};class cn extends F().Layer{constructor(a){var _;if(super((0,I.setOptions)({},a||{},cn.DefaultOptions)),this._zooming=!1,this._visible=!0,!mapboxgl)throw new Error("该功能需要通过script引入mapboxgl-js库及其样式！");a.accessToken&&(!((_=mapboxgl.accessToken)===null||_===void 0)&&_.length?I.logger.debug("已经设置过mapboxgl的accessToken！"):mapboxgl.accessToken=a.accessToken),this._throttledUpdate=F().Util.throttle(this._update,this.options.updateInterval,this)}setDrawOptions(a){const _=(0,I.processFieldWithLoaders)(a);return this._drawOptions=_,this._map&&this._glMap&&this._map.whenReady(()=>{this._glMap.setStyle(this._drawOptions)}),this}setDataSource(a){return this}initialize(a){F().setOptions(this,a)}setVisible(a){return this._visible===a||(this._container.style.display=a?null:"none",this._visible=a),this}isVisible(){return this._visible}onAdd(a){this._container||this._initContainer();var _=this.getPaneName();return a.getPane(_).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),a.options.zoomAnimation&&F().DomEvent.on(a._proxy,F().DomUtil.TRANSITION_END,this._transitionEnd,this),a._addZoomLimit(this),this._drawOptions&&this._map.whenReady(()=>{this._glMap.setStyle(this._drawOptions)}),this}onRemove(a){this._map._proxy&&this._map.options.zoomAnimation&&F().DomEvent.off(this._map._proxy,F().DomUtil.TRANSITION_END,this._transitionEnd,this),this._glMap.remove();var _=this.getPaneName();return a.getPane(_).removeChild(this._container),this}getEvents(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}}getMapboxMap(){return this._glMap}getCanvas(){return this._glMap.getCanvas()}getSize(){const a=this._map.getSize().multiplyBy(1+2*this.options.padding);return F().point(parseInt(a.x.toFixed(0)),parseInt(a.y.toFixed(0)))}getBounds(){var a=this.getSize().multiplyBy(.5),_=this._map.latLngToContainerPoint(this._map.getCenter());return F().latLngBounds(this._map.containerPointToLatLng(_.subtract(a)),this._map.containerPointToLatLng(_.add(a)))}getContainer(){return this._container}getPaneName(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"}_initContainer(){var a=this._container=F().DomUtil.create("div","leaflet-gl-layer"),_=this.getSize(),E=this._map.getSize().multiplyBy(this.options.padding);a.style.width=_.x+"px",a.style.height=_.y+"px";var V=this._map.containerPointToLayerPoint([0,0]).subtract(E);F().DomUtil.setPosition(a,V)}_initGL(){var a=this._map.getCenter(),_=F().extend({},this.options,{container:this._container,center:[a.lng,a.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap?(this._glMap.setCenter(_.center),this._glMap.setZoom(_.zoom)):this._glMap=new mapboxgl.Map(_),this._glMap.transform.latRange=null,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var E=this._glMap._actualCanvas;F().DomUtil.addClass(E,"leaflet-image-layer"),F().DomUtil.addClass(E,"leaflet-zoom-animated"),this.options.interactive&&F().DomUtil.addClass(E,"leaflet-interactive"),this.options.className&&F().DomUtil.addClass(E,this.options.className)}_update(a){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var _=this.getSize(),E=this._container,V=this._glMap,xt=this._map.getSize().multiplyBy(this.options.padding),vt=this._map.containerPointToLayerPoint([0,0]).subtract(xt);F().DomUtil.setPosition(E,vt),this._transformGL(V),V.transform.width!==_.x||V.transform.height!==_.y?(E.style.width=_.x+"px",E.style.height=_.y+"px",V._resize!==null&&V._resize!==void 0?V._resize():V.resize()):V._update!==null&&V._update!==void 0?V._update():V.update()}}_transformGL(a){var _=this._map.getCenter(),E=a.transform;E.center=mapboxgl.LngLat.convert([_.lng,_.lat]),E.zoom=this._map.getZoom()-1}_pinchZoom(a){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})}_animateZoom(a){var _=this._map.getZoomScale(a.zoom),E=this._map.getSize().multiplyBy(this.options.padding*_),V=this.getSize()._divideBy(2),xt=this._map.project(a.center,a.zoom)._subtract(V)._add(this._map._getMapPanePos().add(E))._round(),vt=this._map.project(this._map.getBounds().getNorthWest(),a.zoom)._subtract(xt);F().DomUtil.setTransform(this._glMap._actualCanvas,vt.subtract(this._offset),_)}_zoomStart(a){this._zooming=!0}_zoomEnd(){var a=this._map.getZoomScale(this._map.getZoom());F().DomUtil.setTransform(this._glMap._actualCanvas,null,a),this._zooming=!1,this._update()}_transitionEnd(a){F().Util.requestAnimFrame(function(){var _=this._map.getZoom(),E=this._map.getCenter(),V=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());F().DomUtil.setTransform(this._glMap._actualCanvas,V,1),this._glMap.once("moveend",F().Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:E,zoom:_-1})},this)}_resize(a){this._transitionEnd(a)}}cn.DefaultOptions={updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},cn.qeName="l_mapboxgl",I.layerCreator.register(cn);class Gr extends ke{constructor(a){super((0,I.setOptions)({},a,Gr.DefaultOptions)),this.layerOptions.axisOptions.backgroundColor||(this.layerOptions.axisOptions.backgroundColor="transparent")}onRedraw(a){var _,E;this._borderAxisTool||(this.layerOptions.axisOptions=this.layerOptions.axisOptions,this.layerOptions.axisOptions.clip=!1,this.layerOptions.axisOptions.map=this._map,this.layerOptions.axisOptions.canvas=this._canvas,this.layerOptions.axisOptions.padding={paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0},this._borderAxisTool=new U0(this.layerOptions.axisOptions));let V=(_=this.layerOptions.axisOptions)===null||_===void 0?void 0:_.sourceLt,xt=(E=this.layerOptions.axisOptions)===null||E===void 0?void 0:E.sourceRb;if(this.layerOptions.fixedMode==="geo"){if(!V||!xt)throw new Error("当绘制模式为geo的时候需要指定绘制的左上角和右下角经纬度！");V=this._map.latLngToContainerPoint(F().latLng(V.y,V.x)),xt=this._map.latLngToContainerPoint(F().latLng(xt.y,xt.x))}this._borderAxisTool.draw(V,xt)}}Gr.DefaultOptions={fixedMode:"screen",axisOptions:{map:void 0,canvas:void 0,border:{visible:!1},leftAxis:{position:"in",visible:!0,majorTick:Object.assign(Object.assign({},U0.defaultBorderAxisOptions.leftAxis.majorTick),{tickCount:10,tickLength:0}),minorTick:Object.assign(Object.assign({},U0.defaultBorderAxisOptions.leftAxis.minorTick),{tickCount:0}),label:Object.assign(Object.assign({},U0.defaultBorderAxisOptions.leftAxis.label),{offsetX:50,offsetY:-5})},bottomAxis:{position:"in",visible:!0,majorTick:Object.assign(Object.assign({},U0.defaultBorderAxisSingle.majorTick),{tickCount:15,tickLength:5}),minorTick:Object.assign(Object.assign({},U0.defaultBorderAxisSingle.minorTick),{tickCount:0}),label:Object.assign(Object.assign({},U0.defaultBorderAxisSingle.label),{offsetX:5,offsetY:-50,visible:!0}),startOffset:100}}};class Ni extends yx{constructor(a){super((0,I.setOptions)({},a,Ni.DefaultOptions)),this.textWidthCache={},this.Pi2=2*Math.PI,this._zoomDeltaYCache={}}setDataSource(a){return super.setDataSource(a),this._zoomDeltaYCache={},this}setDrawOptions(a,_){return super.setDrawOptions(a,_),this._zoomDeltaYCache={},this}_createStyleObjectFromStyleOptions(a){return new I.GridLabelStyle(a)}getGridInfo(a,_){const E=this._map.containerPointToLatLng([a,_]),V=(0,I.getGridPosIndex)(this.dataSource.gridOptions.xStart,this.dataSource.gridOptions.xDelta,E.lng),xt=(0,I.getGridPosIndex)(this.dataSource.gridOptions.yStart,this.dataSource.gridOptions.yDelta,E.lat),vt=F().latLng(this.dataSource.gridOptions.yStart+xt*this.dataSource.gridOptions.yDelta,this.dataSource.gridOptions.xStart+V*this.dataSource.gridOptions.xDelta);return{originLatLng:E,idx:{x:V,y:xt},correctedLatLng:vt,correctedScreenPt:this.proj([vt.lng,vt.lat])}}onRedraw(a){if(this.imgWaiters={},this.textWidthCache={},!this.dataSource||!this.drawOptions||!this.drawOptions.image&&!this.drawOptions.text)return;const _=this.dataSource.gridOptions,E=Math.abs(_.xDelta),V=Math.abs(_.yDelta),xt=_.yDelta>0?_.yEnd+_.yDelta:_.yStart,vt=_.yDelta<0?_.yEnd+_.yDelta:_.yStart,Wt=_.xDelta>0?_.xEnd+_.xDelta:_.xStart,Ht=_.xDelta<0?_.xEnd+_.xDelta:_.xStart,Gt=[xt,Ht],Xt=[vt,Wt],Ft=this._map.latLngToContainerPoint(Gt),te=this._map.latLngToContainerPoint(Xt),zt=a.canvas.clientWidth,ve=a.canvas.clientHeight;if(Ft.x>zt||Ft.y>ve||te.x<0||te.y<0)return;const ye=this.drawOptions.interval[0],we=this.drawOptions.interval[1],Ee=Math.abs(_.xDelta)/a.reso.x;let ze=1;Ee<=ye-1&&(ze=parseInt((ye-1)/Ee)+1);const Be=Math.max(0,Ft.x),e0=Math.min(zt,te.x),He=Math.max(0,Ft.y),a0=Math.min(ve,te.y),Ye=this._map.containerPointToLatLng(F().point(Be,He));let d0=(0,I.getGridPosIndex)(Ht,E,Ye.lng);if(d0<0)d0=0;else if(d0>=_.xSize)return;d0=parseInt(d0/ze)*ze;const b0=this._map.containerPointToLatLng(F().point(e0,a0)),O0=b0.lng;let T0=(0,I.getGridPosIndex)(Ht,E,O0);T0>=_.xSize&&(T0=_.xSize-1);let R0=(0,I.getGridPosIndex)(xt,-V,Ye.lat);if(R0<0)R0=0;else if(R0>=_.ySize)return;const D0=b0.lat;let $0=(0,I.getGridPosIndex)(xt,-V,D0);$0>=_.ySize&&($0=_.ySize-1);let B0,L0,ox=this.dataSource.getGrid();if(this.dataSource.getS&&(ox=this.dataSource.getS(),B0=this.dataSource.getD()),Ni.bufferingDraw){const Vx=document.createElement("canvas");Vx.width=this._canvas.width,Vx.height=this._canvas.height,L0=Vx.getContext("2d"),L0.scale(this.ratio,this.ratio)}else L0=this._canvas.getContext("2d");let vx,Fi=-1/0;for(let Vx=R0;Vx<=$0;Vx++){const Vr=xt-Vx*V,pn=(0,I.getGridPosIndex)(_.yStart,_.yDelta,Vr-V/2);let mn=!1;const Jn=Vr-this.drawOptions.pos[1]*V;for(let ii=d0;ii<=T0;ii+=ze){const Wr=Ht+ii*E,Wx=Wr+this.drawOptions.pos[0]*E;if(vx=this._map.latLngToContainerPoint([Jn,Wx]),vx.y-Fi<we)break;const pr=(0,I.getGridPosIndex)(_.xStart,_.xDelta,Wr+E/2),Hn=ox.getPos(pn,pr),u0=ox.read1D(Hn);if(isNaN(u0)||u0===void 0||ox.isUndef(u0))continue;const E0=[u0];B0&&E0.push(B0.read1D(Hn));const ux=this.drawOptions.getPlaneOptions(u0,this.layerOptions.cacheDrawOptions,E0);this.drawLabel(vx,ux,L0),mn=!0}mn&&(Fi=vx.y)}Ni.bufferingDraw&&this._canvas.getContext("2d").drawImage(L0.canvas,0,0,L0.canvas.width,L0.canvas.height,0,0,a.canvas.clientWidth,a.canvas.clientHeight)}drawLabel(a,_,E){if(_.image&&_.image.data){if(this._zoom<_.image.zoomMin||this._zoom>_.image.zoomMax||!_.image.visible)return;const V=_.image,xt=vt=>{vt&&(E.save(),V.offset&&(a.x+=V.offset[0],a.y+=V.offset[1]),V.shadowColor?(E.shadowColor=V.shadowColor.rgbaString(),E.shadowBlur=V.shadowBlur,E.shadowOffsetX=V.shadowOffset[0],E.shadowOffsetY=V.shadowOffset[1]):E.shadowColor="rgba(0,0,0,0)",V.angle&&(E.translate(a.x,a.y),E.rotate(V.angle),E.translate(-a.x,-a.y)),E.drawImage(vt,0,0,vt.width,vt.height,a.x-V.size[0]/2,a.y-V.size[1]/2,V.size[0],V.size[1]),V.color&&(E.globalCompositeOperation="source-atop",E.fillStyle=V.color.rgbaString(),E.fillRect(a.x-V.size[0]/2,a.y-V.size[1]/2,V.size[0],V.size[1])),E.restore(),E.globalCompositeOperation="source-over")};typeof V.data=="string"?this.onceImageLoaded(V.data,vt=>{xt(vt)}):xt(V.data)}if(_.text&&_.text.data){if(this._zoom<_.text.zoomMin||this._zoom>_.text.zoomMax||!_.text.visible)return;const V=_.text;if(E.save(),V.offset&&(a.x+=V.offset[0],a.y+=V.offset[1]),E.font=V.font,V.angle&&(E.translate(a.x,a.y),E.rotate(V.angle),E.translate(-a.x,-a.y)),V.backColor){V.backShadowColor?(E.shadowColor=V.backShadowColor.rgbaString(),E.shadowBlur=V.backShadowBlur,E.shadowOffsetX=V.backShadowOffset[0],E.shadowOffsetY=V.backShadowOffset[1]):E.shadowColor="rgba(0,0,0,0)";let xt=this.textWidthCache[V.data];xt===void 0&&(xt=E.measureText(V.data).width,this.textWidthCache[V.data]=xt),xt+=2*V.backPadding[0];const vt=V.backHeight+2*V.backPadding[1];E.beginPath(),V.backRoundRect?(0,I.drawRoundRect)(E,a.x-xt/2,a.y-vt/2,xt,vt,V.backRoundRadius):V.backCircle?E.arc(a.x,a.y,xt-V.backPadding[0],0,this.Pi2):E.rect(a.x-xt/2,a.y-vt/2,xt,vt),E.fillStyle=V.backColor.rgbaString(),E.fill(),V.backStrokeColor&&V.backStrokeWidth&&(E.strokeStyle=V.backStrokeColor.rgbaString(),E.lineWidth=V.backStrokeWidth,V.backStrokeDashArray?E.setLineDash(V.backStrokeDashArray):E.setLineDash([]),E.stroke())}V.baseline&&(E.textBaseline=V.baseline),V.align&&(E.textAlign=V.align),V.shadowColor&&(E.shadowColor=V.shadowColor.rgbaString(),E.shadowOffsetX=V.shadowOffset[0],E.shadowOffsetY=V.shadowOffset[1],E.shadowBlur=V.shadowBlur),V.strokeColor&&V.strokeWidth&&(E.strokeStyle=V.strokeColor,E.lineWidth=V.strokeWidth,E.strokeText(V.data,a.x,a.y)),E.fillStyle=V.color.rgbaString(),E.fillText(V.data,a.x,a.y),E.restore()}}}Ni.bufferingDraw=!0,Ni.DefaultOptions={ignoreRetina:!0},Ni.qeName="l_grid_label",I.layerCreator.register(Ni);class ui extends Bi{constructor(a){super((0,I.setOptions)({},a,ui.DefaultOptions)),this.fillUniforms={},this.lineUniforms={}}getFillTextureOptions(){return{width:this.gl.canvas.width,height:this.gl.canvas.height,min:this.gl.NEAREST,mag:this.gl.NEAREST,warp:this.gl.CLAMP_TO_EDGE,attach:this.gl.COLOR_ATTACHMENT0}}setDrawOptions(a,_=!0){if(super.setDrawOptions(a,_),this.drawOptions.colorScale&&(this.csTexture&&(this.gl.deleteTexture(this.csTexture),this.csTexture=void 0),this._updateColorScaleMaxMin()),this.drawOptions.fillColor){const E=this.parseColorStopRules(this.drawOptions.fillColor);this.fillColors=E.colors,this.fillSteps=E.steps}return this.splineMat=t0.transpose([-this.drawOptions.pixelRatio,2-this.drawOptions.pixelRatio,this.drawOptions.pixelRatio-2,this.drawOptions.pixelRatio,2*this.drawOptions.pixelRatio,this.drawOptions.pixelRatio-3,3-2*this.drawOptions.pixelRatio,-this.drawOptions.pixelRatio,-this.drawOptions.pixelRatio,0,this.drawOptions.pixelRatio,0,0,1,0,0]),this}setDataSource(a){return super.setDataSource(a),this._updateColorScaleMaxMin(),this}_updateColorScaleMaxMin(){var a,_;if(this.dataSource&&(!((_=(a=this._planeOptions)===null||a===void 0?void 0:a.colorScale)===null||_===void 0)&&_.colorScale)&&(!(0,I.defined)(this._planeOptions.colorScale.min)||!(0,I.defined)(this._planeOptions.colorScale.max))){I.logger.debug("当前colorScale没有配置最大或者最小值，将使用数据中的值，可能造成连续动画时最大最小值不一致！");const E=this.dataSource.getGrid().maxMin;(0,I.defined)(this._planeOptions.colorScale.min)||(this._planeOptions.colorScale.min=E.min),(0,I.defined)(this._planeOptions.colorScale.max)||(this._planeOptions.colorScale.max=E.max)}}setupFill(){var a,_;this.fillProgram?this.gl.deleteProgram(this.fillProgram.program):(this.fillFrameInfo=Qs(this.gl,[this.getFillTextureOptions()]),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null));const E=I.glNames.header+`
            `+this.vShaderCommon+`
             void main(){
                `+this.vShaderSetPostionAndVaryings+`
             }
        `,V=(_=(a=this.fillSteps)===null||a===void 0?void 0:a.length)!==null&&_!==void 0?_:1,xt=I.glNames.header+`
            precision mediump int;
            precision highp sampler2D;
            `+this.fShaderCommon+`
            const int stepCount=`+V+`;
        
            uniform sampler2D currentData;
            uniform sampler2D preData;
            uniform float dataPercent;
            uniform int fillMode; //0-none(bitmap,no-color-interp&no-data-interp),1-bi(pixel1),2-cardinal(pixel2),3-shaded(no-color-interp&cardinal)
            uniform mat4 cardinalSplineMat;
            uniform bool hasPre;
            `+(0,I.getAlgoConstsAndUniforms)(this.currentGrid,!0)+`
            uniform vec4 xAttr; //[start,end,delta,size]
            uniform vec4 yAttr;    
            //data
            uniform vec4 colors[stepCount];
            uniform float steps[stepCount];
            uniform sampler2D csTexture;
            uniform float csMin;
            uniform float csMax;
            uniform bool hasCs;
            uniform vec2 reso;
            `+I.glNames.outColorDefine+`

             $inject

             void main(){
                vec2 lonLat=vLatLngCoords;
                if(lonLat.x<0.){
                    lonLat.x+=360.;
                }
                if(lonLat.x<xAttr.x || lonLat.x>xAttr.y){
                    discard;
                }
                float maxLat=max(yAttr.x,yAttr.y);
                float minLat=min(yAttr.x,yAttr.y);
                if(lonLat.y>maxLat || lonLat.y<minLat){
                    discard;
                }
                vec2 uv=`+I.qeGLFuncs.qe_getLonLatTexPos+`(lonLat,xAttr,yAttr);
                vec2 val;
                int interpMethod=fillMode;
                if(fillMode==3|| fillMode==2){ //shaded
                    //cardinal
                    interpMethod=2;
                }else if(fillMode==4){ //shaded2
                    interpMethod=1;
                }
                if(hasPre){
                    val=`+I.qeGLFuncs.qe_interpGridValByUV+`(preData,uv,xAttr,yAttr,undef,interpMethod,currentData,dataPercent);
                }else{
                    val=`+I.qeGLFuncs.qe_readGridValByUV+`(currentData,uv,xAttr,yAttr,undef,interpMethod);
                }
                float selVal=fillMode==0?val.x:val.y;
                if(hasCs){
                    `+I.glNames.outColorName+"="+I.qeGLFuncs.qe_getColorByScale+`(selVal);
                }else{
                    if(fillMode==0|| fillMode>=3){ //no-color-interp
                        `+I.glNames.outColorName+"="+I.qeGLFuncs.qe_getColor+`(selVal);
                    }else{
                        `+I.glNames.outColorName+"="+I.qeGLFuncs.qe_interpColor+`(selVal);
                    }
                }
             }
        `;this.fillProgram=Cx(this.gl,[E,(0,I.injectBuiltInShaderFunctions)(xt)])}setupLine(){this.lineProgram&&this.gl.deleteProgram(this.lineProgram.program);const a=I.glNames.header+`
        precision highp float;
        `+I.glNames.attrIn+` vec2 position;
        `+I.glNames.attrIn+` vec2 uv;
        `+I.glNames.varOut+` vec2 vUv;

        void main(){
            vUv=uv;
            gl_Position=vec4(position,0.,1.);
        }
        `,_=I.glNames.header+`
            precision highp sampler2D; 
            precision mediump int;
            precision highp float;
            const float weight1=1./6.;
            const float weight2=weight1*0.5;
            `+(0,I.getRGBA2FloatConsts)()+`
            uniform sampler2D fillTexture;
            uniform bool showShaded;
            uniform vec2 viewportDelta;
            uniform float contourlineWidth;
            uniform vec4 contourlineColor;
            uniform bool contourWithPal;

            `+I.glNames.varIn+` vec2 vUv;

            `+I.glNames.outColorDefine+`

            $inject

            bool isContour(vec4 col,vec2 uv){
                float center=`+I.qeGLFuncs.qe_rgba2float+`(col);
                vec2 vpDelta=viewportDelta*contourlineWidth*0.5;
                float surrounds[8];
                surrounds[0]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(0.,vpDelta.y)));
                surrounds[1]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(vpDelta.x,0.)));
                surrounds[2]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(0.,-vpDelta.y)));
                surrounds[3]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(-vpDelta.x,0.)));

                surrounds[4]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vpDelta));
                surrounds[5]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv-vpDelta));
                surrounds[6]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv+vec2(vpDelta.x,-vpDelta.y)));
                surrounds[7]=`+I.qeGLFuncs.qe_rgba2float+"("+I.glNames.textureFunc+`(fillTexture,uv-vec2(vpDelta.x,-vpDelta.y)));
                float alpha=0.;
                for(int i=0;i<4;i++){
                    if(abs(surrounds[i]-center)>0.){ //not same range
                        alpha+=weight1;
                    }
                }
                for(int i=4;i<8;i++){
                    if(abs(surrounds[i]-center)>0.){ //not same range
                        alpha+=weight2;
                    }
                }
                return alpha>=weight1;
            }

            void main(){
                `+I.glNames.outColorName+`=vec4(0.);
                vec2 uv=vec2(vUv.x,1.-vUv.y);
                vec4 col=`+I.glNames.textureFunc+`(fillTexture,uv);
                if(showShaded){
                    `+I.glNames.outColorName+`=col;
                }
                if(col.a<0.001){
                    return;
                }
                if(isContour(col,uv)){
                    if(contourWithPal){
                        `+I.glNames.outColorName+`=col;
                    }else{
                        `+I.glNames.outColorName+`=contourlineColor;
                    }
                }
            }
        `;this.lineProgram=Cx(this.gl,[a,(0,I.injectBuiltInShaderFunctions)(_)]),this.lineBufferInfo=px(this.gl,{position:{numComponents:2,data:[-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]},uv:{numComponents:2,data:[0,0,0,1,1,1,0,0,1,1,1,0]}}),this.viewportDelta=[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight]}setupGL(a){this._map instanceof Jt&&(this.setupFill(),this.setupLine())}drawFill(a,_,E){const V=[this.dataSource.gridOptions.xStart,this.dataSource.gridOptions.xEnd,this.dataSource.gridOptions.xDelta,this.dataSource.gridOptions.xSize],xt=[this.dataSource.gridOptions.yStart,this.dataSource.gridOptions.yEnd,this.dataSource.gridOptions.yDelta,this.dataSource.gridOptions.ySize];if(E&&(ki(a,E),a.clear(a.COLOR_BUFFER_BIT)),a.viewport(0,0,a.canvas.width,a.canvas.height),a.useProgram(this.fillProgram.program),m0(a,this.fillProgram,this.posBufferInfo),this.fillUniforms.currentData=this.currentTexture,this.preTexture?this.fillUniforms.preData=this.preTexture:delete this.fillUniforms.preData,this.fillUniforms.dataPercent=this.dataPercent,this.fillUniforms.fillMode=_.fillMode,this.fillUniforms.cardinalSplineMat=this.splineMat,this.fillUniforms.hasPre=this.preTexture?1:0,(0,I.setDirectAlgoUniforms)(this.currentGrid,this.fillUniforms),this.fillUniforms.xAttr=V,this.fillUniforms.yAttr=xt,_.colorScale){if(this.fillUniforms.hasCs=!0,!this.csTexture){const vt=_.colorScale.colorScale,Wt=vt instanceof HTMLVideoElement?vt.videoWidth:vt.width,Ht=vt instanceof HTMLVideoElement?vt.videoHeight:vt.height;this.csTexture=this.createImageTexture(Wt,Ht,vt,a,!0)}this.fillUniforms.csTexture=this.csTexture,this.fillUniforms.csMin=_.colorScale.min,this.fillUniforms.csMax=_.colorScale.max,delete this.fillUniforms.colors,delete this.fillUniforms.steps}else this.fillUniforms.hasCs=!1,delete this.fillUniforms.csTexture,this.fillUniforms.colors=this.fillColors,this.fillUniforms.steps=this.fillSteps;this.fillUniforms.reso=[this.gl.canvas.width,this.gl.canvas.height],ti(this.fillProgram,this.fillUniforms),fx(a,this.posBufferInfo,a.TRIANGLE_STRIP),E&&a.bindFramebuffer(a.FRAMEBUFFER,null)}drawLine(a,_){var E;let V=!0;_.fillMode!==I.GridDataGLFillMode.shaded1&&(_.fillMode!==I.GridDataGLFillMode.none&&this.drawFill(a,_,void 0),V=!1);const xt=Object.assign({},_);xt.fillMode=(E=_.fillModeForLine)!==null&&E!==void 0?E:_.fillMode===I.GridDataGLFillMode.pixel1?I.GridDataGLFillMode.shaded1:I.GridDataGLFillMode.shaded2,this.drawFill(a,xt,this.fillFrameInfo),a.useProgram(this.lineProgram.program),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,a.canvas.width,a.canvas.height),this.lineUniforms.fillTexture=this.fillFrameInfo.attachments[0],this.lineUniforms.showShaded=V,this.lineUniforms.viewportDelta=this.viewportDelta,this.lineUniforms.contourlineWidth=xt.lineWidth,this.lineUniforms.contourlineColor=xt.lineColor||[0,0,0,0],this.lineUniforms.contourWithPal=!xt.lineColor,m0(a,this.lineProgram,this.lineBufferInfo),ti(this.lineProgram,this.lineUniforms),fx(a,this.lineBufferInfo)}onRenderTile(a,_){if(this._planeOptions.fillMode===I.GridDataGLFillMode.none&&!this._planeOptions.showLine)return;const E=this.gl;E.enable(E.CULL_FACE),E.cullFace(E.BACK),E.disable(E.DEPTH_TEST),E.enable(E.BLEND),E.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA),E.clear(E.COLOR_BUFFER_BIT),this._planeOptions.showLine?this.drawLine(E,this._planeOptions):this.drawFill(E,this._planeOptions,void 0)}_createStyleObjectFromStyleOptions(a){return new I.PixelLayerStyle(a)}}ui.DefaultOptions={updateWhenZooming:!1,updateInterval:100,pane:I.consts.customPanes.filled.name,minZoom:3},ui.qeName="l_pixel_tile",I.layerCreator.register(ui);class Lx extends Ne{constructor(a){super((0,I.setOptions)({},a,Lx.DefaultOptions)),this.redrawFromDataSourceTracking=()=>{this.layerOptions.trackDataSource&&this.drawOptions&&this._getCSDatasource().then(_=>{super.setDataSource(_)})}}setDrawOptions(a,_){super.setDrawOptions(a,_);const E=this._anaValues;return this._anaValues=a.analysisValues,this.originalSource&&E!==a.analysisValues&&this._getCSDatasource().then(V=>{super.setDataSource(V)}),this}setDataSource(a){if(a.getFeatures){const _=this.originalSource,E=a;_&&_.offFeaturesUpdate(this.redrawFromDataSourceTracking),E&&E.onFeaturesUpdate(this.redrawFromDataSourceTracking)}else{const _=this.originalSource,E=a;_&&this.originalSource!==E&&(_.offActiveGridUpdated(this.redrawFromDataSourceTracking),_.offIntTZChanged(this.redrawFromDataSourceTracking)),_&&_===E||(E.onActiveGridUpdated(this.redrawFromDataSourceTracking),E.onIntTZChanged(this.redrawFromDataSourceTracking))}return this.originalSource=a,this.drawOptions&&this._getCSDatasource().then(_=>{super.setDataSource(_)}),this}_getCSDatasource(){return a=this,_=void 0,V=function*(){let xt=this.originalSource;this.originalSource.getFeatures&&(xt=I.TracingService.interpToGridProvider(this.drawOptions.interpGridOptions,this.originalSource,this.drawOptions.interpField,this.drawOptions.undef));const vt=new I.TracingService(void 0),Wt={dataSource:xt,withShaded:this.drawOptions.withShaded,analysisValues:this.drawOptions.analysisValues(),reserveTracingInfo:!0};return this.layerOptions.wasm?(yield vt.tracingContourShadedWASM(Wt)).dataSource:vt.tracingContourShaded(Wt).dataSource},new((E=void 0)||(E=Promise))(function(xt,vt){function Wt(Xt){try{Gt(V.next(Xt))}catch(Ft){vt(Ft)}}function Ht(Xt){try{Gt(V.throw(Xt))}catch(Ft){vt(Ft)}}function Gt(Xt){var Ft;Xt.done?xt(Xt.value):(Ft=Xt.value,Ft instanceof E?Ft:new E(function(te){te(Ft)})).then(Wt,Ht)}Gt((V=V.apply(a,_||[])).next())});var a,_,E,V}_createStyleObjectFromStyleOptions(a){return new I.CSStyle(a)}}function ya(N){const a=(0,I.gridOptionsToExtent)(N);return F().latLngBounds(F().latLng(a.minLat,a.minLon),F().latLng(a.maxLat,a.maxLon))}function ta(N,a){const _=(0,I.getImageTileUrls)(N);a=a||{};const E=Object.assign({minZoom:_.minZoom,maxZoom:_.maxZoom,subdomains:_.subdomains,zoomOffset:_.zoomOffset,tms:_.tms,detectRetina:_.detectRetina,pane:I.consts.customPanes.bottommap.name},a);for(const V in E)E[V]||delete E[V];return F().tileLayer(_.url,E)}Lx.DefaultOptions={wasm:!1},Lx.qeName="l_grid_cs",I.layerCreator.register(Lx),I.logger.note("二维地图支持免费测试和线上部署，请勿删除底部版权声明，如需商业版本请联系微信mofangbao！")})(),Y})())})(quickearth_leaflet);var quickearth_leafletExports=quickearth_leaflet.exports;const _hoisted_1=["id"],__default__=defineComponent({name:""}),_sfc_main$1=defineComponent({...__default__,props:{center:{type:Array,default:()=>[138.9,22.4]},zoom:{type:Number,default:6},domId:{type:String,default:"1"}},emits:["mapReady"],setup(Je,{emit:Ce}){console.log(quickearth_leafletExports.LMap);const ne=Je;let Zt=null;const de=()=>{Zt=new quickearth_leafletExports.LMap(`map-${ne.domId}`,{crs:L$1.CRS.EPSG3857,zoomControl:!1,preferCanvas:!0,zoomSnap:0,minZoom:3,maxZoom:18,renderer:L$1.canvas()}).setView([ne.center[1],ne.center[0]],ne.zoom);const Et=new L$1.TileLayer.WMS("http://devapi.weatherone.com.cn:8605/geoserver/map/wms",{layers:"map:15水系",styles:"",format:"image/png",transparent:!0}),Dt=quickearth_leafletExports.createTileLayer(quickearth_coreExports.predefinedImageTiles.windy,{pane:quickearth_coreExports.consts.customPanes.topmap.name});Zt.addLayer(Dt),Et.addTo(Zt)};return onMounted(()=>{de()}),(Et,Dt)=>(openBlock(),createElementBlock("div",{id:`map-${Je.domId}`,class:"leaflet-com"},null,8,_hoisted_1))}}),Index_vue_vue_type_style_index_0_scoped_81e32fea_lang="",QeMap=_export_sfc(_sfc_main$1,[["__scopeId","data-v-81e32fea"]]),_sfc_main=defineComponent({__name:"Index",setup(Je){return(Ce,ne)=>(openBlock(),createBlock(QeMap,{center:[105.19,37.8],zoom:4.5}))}});export{_sfc_main as default};
